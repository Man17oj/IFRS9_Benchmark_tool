# .idea\.gitignore

```
# Default ignored files
/shelf/
/workspace.xml
# Editor-based HTTP Client requests
/httpRequests/
# Datasource local storage ignored files
/dataSources/
/dataSources.local.xml

```

# .idea\Benchmarking.iml

```iml
<?xml version="1.0" encoding="UTF-8"?>
<module type="PYTHON_MODULE" version="4">
  <component name="NewModuleRootManager">
    <content url="file://$MODULE_DIR$">
      <excludeFolder url="file://$MODULE_DIR$/.venv" />
    </content>
    <orderEntry type="jdk" jdkName="Python 3.11 (Benchmarking)" jdkType="Python SDK" />
    <orderEntry type="sourceFolder" forTests="false" />
  </component>
  <component name="PyDocumentationSettings">
    <option name="format" value="PLAIN" />
    <option name="myDocStringFormat" value="Plain" />
  </component>
</module>
```

# .idea\inspectionProfiles\profiles_settings.xml

```xml
<component name="InspectionProjectProfileManager">
  <settings>
    <option name="USE_PROJECT_PROFILE" value="false" />
    <version value="1.0" />
  </settings>
</component>
```

# .idea\misc.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="Black">
    <option name="sdkName" value="Python 3.11 (Benchmarking)" />
  </component>
  <component name="ProjectRootManager" version="2" project-jdk-name="Python 3.11 (Benchmarking)" project-jdk-type="Python SDK" />
</project>
```

# .idea\modules.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="ProjectModuleManager">
    <modules>
      <module fileurl="file://$PROJECT_DIR$/.idea/Benchmarking.iml" filepath="$PROJECT_DIR$/.idea/Benchmarking.iml" />
    </modules>
  </component>
</project>
```

# .idea\workspace.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="AutoImportSettings">
    <option name="autoReloadType" value="SELECTIVE" />
  </component>
  <component name="ChangeListManager">
    <list default="true" id="f1c2b62c-95ec-4d90-bbd8-b029171218eb" name="Changes" comment="" />
    <option name="SHOW_DIALOG" value="false" />
    <option name="HIGHLIGHT_CONFLICTS" value="true" />
    <option name="HIGHLIGHT_NON_ACTIVE_CHANGELIST" value="false" />
    <option name="LAST_RESOLUTION" value="IGNORE" />
  </component>
  <component name="FileTemplateManagerImpl">
    <option name="RECENT_TEMPLATES">
      <list>
        <option value="Python Script" />
      </list>
    </option>
  </component>
  <component name="FlaskConsoleOptions" custom-start-script="import sys; print('Python %s on %s' % (sys.version, sys.platform)); sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])&#10;from flask.cli import ScriptInfo, NoAppException&#10;for module in [&quot;main.py&quot;, &quot;wsgi.py&quot;, &quot;app.py&quot;]:&#10;    try: locals().update(ScriptInfo(app_import_path=module, create_app=None).load_app().make_shell_context()); print(&quot;\nFlask App: %s&quot; % app.import_name); break&#10;    except NoAppException: pass">
    <envs>
      <env key="FLASK_APP" value="app" />
    </envs>
    <option name="myCustomStartScript" value="import sys; print('Python %s on %s' % (sys.version, sys.platform)); sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])&#10;from flask.cli import ScriptInfo, NoAppException&#10;for module in [&quot;main.py&quot;, &quot;wsgi.py&quot;, &quot;app.py&quot;]:&#10;    try: locals().update(ScriptInfo(app_import_path=module, create_app=None).load_app().make_shell_context()); print(&quot;\nFlask App: %s&quot; % app.import_name); break&#10;    except NoAppException: pass" />
    <option name="myEnvs">
      <map>
        <entry key="FLASK_APP" value="app" />
      </map>
    </option>
  </component>
  <component name="ProjectColorInfo"><![CDATA[{
  "associatedIndex": 7
}]]></component>
  <component name="ProjectId" id="2xUv3WQDU2haHuU0FGo7C0L7puG" />
  <component name="ProjectViewState">
    <option name="hideEmptyMiddlePackages" value="true" />
    <option name="showLibraryContents" value="true" />
  </component>
  <component name="PropertiesComponent"><![CDATA[{
  "keyToString": {
    "RunOnceActivity.ShowReadmeOnStart": "true",
    "ignore.virus.scanning.warn.message": "true",
    "node.js.detected.package.eslint": "true",
    "node.js.detected.package.tslint": "true",
    "node.js.selected.package.eslint": "(autodetect)",
    "node.js.selected.package.tslint": "(autodetect)",
    "nodejs_package_manager_path": "npm",
    "settings.editor.selected.configurable": "preferences.general",
    "vue.rearranger.settings.migration": "true"
  }
}]]></component>
  <component name="SharedIndexes">
    <attachedChunks>
      <set>
        <option value="bundled-js-predefined-d6986cc7102b-deb605915726-JavaScript-PY-243.22562.180" />
        <option value="bundled-python-sdk-85c76a3b01b3-9a18a617cbe4-com.jetbrains.pycharm.pro.sharedIndexes.bundled-PY-243.22562.180" />
      </set>
    </attachedChunks>
  </component>
  <component name="SpellCheckerSettings" RuntimeDictionaries="0" Folders="0" CustomDictionaries="0" DefaultDictionary="application-level" UseSingleDictionary="true" transferred="true" />
  <component name="TaskManager">
    <task active="true" id="Default" summary="Default task">
      <changelist id="f1c2b62c-95ec-4d90-bbd8-b029171218eb" name="Changes" comment="" />
      <created>1748005267836</created>
      <option name="number" value="Default" />
      <option name="presentableId" value="Default" />
      <updated>1748005267836</updated>
      <workItem from="1748005269075" duration="25126000" />
    </task>
    <servers />
  </component>
  <component name="TypeScriptGeneratedFilesManager">
    <option name="version" value="3" />
  </component>
</project>
```

# Archive Prompts\EY_FinSight_Prompts3.csv

```csv
Bank,PromptName,PromptText
HSBC,Scenario ECL,"Given the full document content provided, extract the Reported ECL, Central scenario, Upside scenario , Downside scenario , Downside 2 scenario  ECL (Provisions)  for the following categories: Retail analysis and Wholesale analysis, as reported for the latest period presented in the document. Focus specifically on sections titled ""Wholesale and retail sensitivity analysis"" within the document, as these sections contain the detailed breakdown of Reported ECL, Central scenario, Upside scenario , Downside scenario , Downside 2 scenario by category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each category (Reported ECL, Central scenario, Upside scenario , Downside scenario , Downside 2 scenario), expressed in �m.
4. Locate and extract the data directly from sections titled ""Wholesale and retail sensitivity analysis"". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. ""Retail & Business Banking"" is split into Mortgages,EDB - Credit Cards, EDB - Other as separate rows within the table. validate totals against provided aggregates where possible.
7. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers. 
8. Return the result as a JSON string with the following structure:
   {
       ""Wholesale analysis"": {
       ""Reported ECL "": {""ECL"": ""<value>""},
       ""Central scenario "": {""ECL"": ""<value>""},
       ""Upside scenario "": {""ECL"": ""<value>""}
       ""Downside scenario "": {""ECL"": ""<value>""}
       ""Downside 2 scenario "": {""ECL"": ""<value>""}
     },
       ""Retail analysis"": {
       ""Reported ECL "": {""ECL"": ""<value>""},
       ""Central scenario "": {""ECL"": ""<value>""},
       ""Upside scenario "": {""ECL"": ""<value>""}
       ""Downside scenario "": {""ECL"": ""<value>""}
       ""Downside 2 scenario "": {""ECL"": ""<value>""}   
   },
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
HSBC,Scenario Weight,"Given the full document content provided, extract the scenario weight for the  Central scenario, Upside scenario , Downside scenario , Downside 2 scenario  as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       ""Scenario weights %"": {

       ""Central "": {""Weight"": ""<value>""},
       ""Upside "": {""Weight"": ""<value>""}
       ""Downside "": {""Weight"": ""<value>""}
       ""Downside 2  "": {""Weight"": ""<value>""}
     }
   }"
Santander,Scenario ECL,"Given the full document content provided, extract the Upside, Base case, Downside 1, Downside 2 and Weighted ECL (Provisions) and Balance (Exposure) for the following categories: Retail & Business Banking, Mortgages, Consumer Finance, Corporate & Commercial Banking and Corporate Centre , as reported for the latest period presented in the document. Focus specifically on sections titled ""Scenario sensitivity"" within the document, as these sections contain the detailed breakdown of Upside, Base case, Downside 1, Downside 2 and Weighted by category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each category (Retail & Business Banking, Mortgages, Consumer Finance, Corporate & Commercial Banking and Corporate Centre), expressed in �m.
2. Balance refers to the Exposure for each stage and category, expressed in �m.
4. Locate and extract the data directly from sections titled ""Scenario sensitivity"". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. ""Retail & Business Banking"" is split into Mortgages,EDB - Credit Cards, EDB - Other as separate rows within the table. validate totals against provided aggregates where possible.
7. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers. 
8. Return the result as a JSON string with the following structure:
   {
       ""Retail & Business Banking"": {
       ""Upside"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Base"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     },
""Mortgages"": {
       ""Upside"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Base"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     },
     "" Consumer Finance"": {
       ""Upside"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Base"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     },
     "" Corporate & Commercial Banking "": {
       ""Upside"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Base"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     },
     "" Corporate Centre "": {
       ""Upside"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Base"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     },
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Santander,Scenario Weight,"Given the full document content provided, extract the scenario weight for the  Upside , Base case , Downside 1 , Downside 2 scenario  as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       ""Scenario weights %"": {

       ""Upside "": {""Weight"": ""<value>""},
       ""Base case "": {""Weight"": ""<value>""}
       ""Downside 1"": {""Weight"": ""<value>""}
       ""Downside 2  "": {""Weight"": ""<value>""}
     }
   }"
Nationwide,Scenario ECL,"Given the full document content provided, extract the Upside scenario  , Base case scenario , Downside scenario , Severe Downside  scenario and reported Provisions  for the following categories: Residential mortgages, Consumer banking � credit cards , Consumer banking � personal loans and overdraft, Commercial lending, as reported for the latest period presented in the document. Focus specifically on sections titled ""ECL under 100% weighted scenarios "" within the document, as these sections contain the detailed breakdown of Upside scenario  , Base case scenario , Downside scenario , Severe Downside  scenario and reported Provisions. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each category (Residential mortgages, Consumer banking � credit cards , Consumer banking � personal loans and overdraft, Commercial lending), expressed in �m.
4. Locate and extract the data directly from sections titled ""ECL under 100% weighted scenarios "". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.

7. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers. 
8. Return the result as a JSON string with the following structure:
   {
       ""Residential mortgages "": {
       ""Upside scenario"": {""ECL"": ""<value>""},
       ""Base case scenario"": {""ECL"": ""<value>""},
       ""Downside scenario"": {""ECL"": ""<value>""}
       ""Severe Downside scenario"": {""ECL"": ""<value>""}
       ""Reported provisions"": {""ECL"": ""<value>""}
     },
       ""Consumer banking � credit cards "": {
       ""Upside scenario"": {""ECL"": ""<value>""},
       ""Base case scenario"": {""ECL"": ""<value>""},
       ""Downside scenario"": {""ECL"": ""<value>""}
       ""Severe Downside scenario"": {""ECL"": ""<value>""}
       ""Reported provisions"": {""ECL"": ""<value>""}
     },
       ""Consumer banking � personal loans and overdraft "": {
       ""Upside scenario"": {""ECL"": ""<value>""},
       ""Base case scenario"": {""ECL"": ""<value>""},
       ""Downside scenario"": {""ECL"": ""<value>""}
       ""Severe Downside scenario"": {""ECL"": ""<value>""}
       ""Reported provisions"": {""ECL"": ""<value>""}
     },
       ""Commercial lending "": {
       ""Upside scenario"": {""ECL"": ""<value>""},
       ""Base case scenario"": {""ECL"": ""<value>""},
       ""Downside scenario"": {""ECL"": ""<value>""}
       ""Severe Downside scenario"": {""ECL"": ""<value>""}
       ""Reported provisions"": {""ECL"": ""<value>""}
     },
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Nationwide,Scenario Weight,"Given the full document content provided, extract the Scenario probability weighting (%)  for the  Upside scenario  , Base case scenario , Downside scenario , Severe Downside  scenario  as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       ""Scenario weights %"": {
       ""Upside scenario "": {""Weight"": ""<value>""},
       ""Base case scenario"": {""Weight"": ""<value>""}
       ""Downside scenario"": {""Weight"": ""<value>""}
       ""Severe Downside scenario  "": {""Weight"": ""<value>""}
     }
   }"
VMUK,Scenario ECL,"Given the full document content provided extract the Upside, Base, Downside, Severe Downside, and Probability Weighted impairment provisions for the following categories: Mortgages, Unsecured Lending � Cards, Unsecured Lending � Personal Loans and Overdrafts, and Business Lending, as reported for the latest period presented. Focus specifically on the table titled ""Economic scenarios"" under the section ""The calculation of the Group�s impairment provision,"" which contains the detailed breakdown of Upside, Base, Downside, Severe Downside, and Probability Weighted modelled provisions. Use the following guidelines:

Locate and extract the data directly from the ""Economic scenarios"" table. The table provides the latest period data, so use only that period�s data. For the ""Unsecured"" category, break down the data into subcategories ""Cards"" and ""Personal loans and overdrafts"" as provided.
If OCR errors or inconsistencies are detected (e.g., totals not aligning with category sums), adjust values to align with totals or logical consistency, and note adjustments.
Show only on balance sheet numbers (the table does not indicate off balance sheet numbers, so this is assumed to be on balance sheet).
Return the result as a JSON string with the following structure:  
{
    ""Mortgages"": {
        ""Upside"": {""Impairment Provisions"": ""<value>""},
        ""Base"": {""Impairment Provisions"": ""<value>""},
        ""Downside"": {""Impairment Provisions"": ""<value>""},
        ""Severe Downside"": {""Impairment Provisions"": ""<value>""},
        ""Probability Weighted"": {""Impairment Provisions"": ""<value>""}
    },
    ""Unsecured Lending � Cards"": {
        ""Upside"": {""Impairment Provisions"": ""<value>""},
        ""Base"": {""Impairment Provisions"": ""<value>""},
        ""Downside"": {""Impairment Provisions"": ""<value>""},
        ""Severe Downside"": {""Impairment Provisions"": ""<value>""},
        ""Probability Weighted"": {""Impairment Provisions"": ""<value>""}
    },
    ""Unsecured Lending � Personal Loans and Overdrafts"": {
        ""Upside"": {""Impairment Provisions"": ""<value>""},
        ""Base"": {""Impairment Provisions"": ""<value>""},
        ""Downside"": {""Impairment Provisions"": ""<value>""},
        ""Severe Downside"": {""Impairment Provisions"": ""<value>""},
        ""Probability Weighted"": {""Impairment Provisions"": ""<value>""}
    },
    ""Business Lending"": {
        ""Upside"": {""Impairment Provisions"": ""<value>""},
        ""Base"": {""Impairment Provisions"": ""<value>""},
        ""Downside"": {""Impairment Provisions"": ""<value>""},
        ""Severe Downside"": {""Impairment Provisions"": ""<value>""},
        ""Probability Weighted"": {""Impairment Provisions"": ""<value>""}
    }
}
Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m).
Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated totals), and validation against totals if applicable.
If the required data is not found, state that the information is unavailable and explain why (e.g., missing section, lack of scenario breakdown)."
VMUK,Scenario Weight,"Given the full document content provided  extract the scenario probability weightings (%) for the Upside, Base, Downside, and Severe Downside scenarios as reported for the latest period presented i nthe document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
{
    ""Scenario weights %"": {
        ""Upside"": {""Weight"": ""<value>""},
        ""Base"": {""Weight"": ""<value>""},
        ""Downside"": {""Weight"": ""<value>""},
        ""Severe Downside"": {""Weight"": ""<value>""}
    }
}"
NWG,Scenario ECL,"Given the full document content provided, extract the Moderate Upside Scenario, Base Scenario, Moderate Downside Scenario, Extreme Downside Scenario, and Actual Stage 1 and Stage 2 modelled ECL for the following categories: Mortgages, Unsecured Lending, Business Lending � Property, and Business Lending � Non-Property, as reported for the latest period presented in the table . Focus specifically on the table titled ""Measuring uncertainty and ECL sensitivity analysis (audited),"" which contains the detailed breakdown of Stage 1 and Stage 2 modelled ECL under the Base Scenario, Moderate Upside Scenario, Moderate Downside Scenario, Extreme Downside Scenario, and Actual values. Use the following guidelines:

Locate and extract the data directly from the ""Measuring uncertainty and ECL sensitivity analysis (audited)"" table. The table provides the latest period data, so use only that period�s data. For the ""Retail Banking - unsecured"" category, use the total ECL provided (do not break down into subcategories like Cards or Personal Loans and Overdrafts, as the table does not provide this breakdown). For ""Business Lending,"" break down the data into ""Property"" and ""Non-Property"" subcategories as provided (using ""Non-personal - property"" and ""Non-personal - non-property"").
If OCR errors or inconsistencies are detected (e.g., totals not aligning with category sums), adjust values to align with totals or logical consistency, and note adjustments.
Show only on balance sheet numbers (the table does not indicate off balance sheet numbers, so this is assumed to be on balance sheet).
Return the result as a JSON string with the following structure:
{
    ""Mortgages"": {
        ""Moderate Upside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Base Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Moderate Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Extreme Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Actual"": {""Stage 1 and Stage 2 ECL"": ""<value>""}
    },
    ""Unsecured Lending"": {
        ""Moderate Upside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Base Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Moderate Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Extreme Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Actual"": {""Stage 1 and Stage 2 ECL"": ""<value>""}
    },
    ""Business Lending � Property"": {
        ""Moderate Upside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Base Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Moderate Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Extreme Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Actual"": {""Stage 1 and Stage 2 ECL"": ""<value>""}
    },
    ""Business Lending � Non-Property"": {
        ""Moderate Upside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Base Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Moderate Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Extreme Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Actual"": {""Stage 1 and Stage 2 ECL"": ""<value>""}
    }
}
Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m).
Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated totals), and validation against totals if applicable.
If the required data is not found, state that the information is unavailable and explain why (e.g., missing section, lack of scenario breakdown)."
NWG,Scenario Weight,"Given the full document content provided, extract the scenario probability weightings (%) for the Moderate Upside Scenario, Base Scenario, Moderate Downside Scenario, and Extreme Downside Scenario as reported in the document. Use the following guidelines:

Search the document for a section or table that provides the scenario probability weightings for the scenarios labeled as ""Moderate Upside Scenario,"" ""Base Scenario,"" ""Moderate Downside Scenario,"" and ""Extreme Downside Scenario"" (as used in the ""Measuring uncertainty and ECL sensitivity analysis (audited)"" table). If the weightings are not found in the document, note that they are unavailable and refer to any previously provided data (e.g., a ""Scenario"" table with weightings for these scenarios).
Return the result as a JSON string with the following structure:
{
    ""Scenario weights %"": {
        ""Moderate Upside Scenario"": {""Weight"": ""<value>""},
        ""Base Scenario"": {""Weight"": ""<value>""},
        ""Moderate Downside Scenario"": {""Weight"": ""<value>""},
        ""Extreme Downside Scenario"": {""Weight"": ""<value>""}
    }
}
Express the weights as percentage strings without the '%' symbol (e.g., ""10"" for 10%).
Include a note after the JSON detailing the data source (e.g., specific table or section) and any adjustments made if applicable. If the weightings are not found in the document, explicitly state this and reference any previously provided data (e.g., a ""Scenario"" table with weightings: Upside 10%, Base 55%, Downside 20%, Severe Downside 15%) that may align with the scenarios after adjusting for terminology differences.
If the required data is not found, state that the information is unavailable and explain why (e.g., missing table, lack of scenario weights)."
LBG,Scenario ECL,"Given the full document content provided , extract the Upside, Base, Downside, Severe Downside, and Probability-weighted ECL provisions for the following categories: UK Mortgages, Credit cards, Other Retail, and Commercial Banking, as reported for the latest period presented in the document. Focus specifically on the table titled ""Total expected credit loss allowance sensitivity to economic assumptions � statutory and underlying basis"", as this table contains the detailed breakdown of Upside, Base, Downside, Severe Downside, and Probability-weighted ECL provisions. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each category (UK Mortgages, Credit cards, Other Retail, Commercial Banking), expressed in �m.
2. Locate and extract the data  from the table titled ""Total expected credit loss allowance sensitivity to economic assumptions � statutory and underlying basis"" . Use the latest period presented,""
3. If OCR errors or inconsistencies are detected (e.g., totals not aligning with category sums), adjust values to align with totals or logical consistency, and note adjustments.
4. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers.
5. Return the result as a JSON string with the following structure:
   {
       ""UK Mortgages"": {
           ""Upside"": {""ECL"": ""<value>""},
           ""Base"": {""ECL"": ""<value>""},
           ""Downside"": {""ECL"": ""<value>""},
           ""Severe Downside"": {""ECL"": ""<value>""},
           ""Probability-weighted"": {""ECL"": ""<value>""}
       },
       ""Credit cards"": {
           ""Upside"": {""ECL"": ""<value>""},
           ""Base"": {""ECL"": ""<value>""},
           ""Downside"": {""ECL"": ""<value>""},
           ""Severe Downside"": {""ECL"": ""<value>""},
           ""Probability-weighted"": {""ECL"": ""<value>""}
       },
       ""Other Retail"": {
           ""Upside"": {""ECL"": ""<value>""},
           ""Base"": {""ECL"": ""<value>""},
           ""Downside"": {""ECL"": ""<value>""},
           ""Severe Downside"": {""ECL"": ""<value>""},
           ""Probability-weighted"": {""ECL"": ""<value>""}
       },
       ""Commercial Banking"": {
           ""Upside"": {""ECL"": ""<value>""},
           ""Base"": {""ECL"": ""<value>""},
           ""Downside"": {""ECL"": ""<value>""},
           ""Severe Downside"": {""ECL"": ""<value>""},
           ""Probability-weighted"": {""ECL"": ""<value>""}
       },
       ""Other"": {
           ""Upside"": {""ECL"": ""<value>""},
           ""Base"": {""ECL"": ""<value>""},
           ""Downside"": {""ECL"": ""<value>""},
           ""Severe Downside"": {""ECL"": ""<value>""},
           ""Probability-weighted"": {""ECL"": ""<value>""}
       },
   }

6. Express monetary values in �m (millions) as strings without commas (e.g., ""1064"" for �1,064m).
7. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated totals), and validation against totals if applicable.
8. If the required data is not found, state that the information is unavailable and explain why (e.g., missing section, lack of scenario breakdown)."
LBG,Scenario Weight,"Given the full document content provided, extract the scenario probability weightings (%) for the **Upside**, **Base**, **Downside**, and **Severe Downside** scenarios as reported in the document. Use the following guidelines:

1. Search the document for a section or table that provides the scenario probability weightings, focusing on the ""Risk management"" section . If the weightings are not found in the document, note that they are unavailable and refer to any previously provided data (e.g., a ""Scenario"" table with weightings for these scenarios).
2. Return the result as a JSON string with the following structure:

   {
       ""Scenario weights %"": {
           ""Upside"": {""Weight"": ""<value>""},
           ""Base"": {""Weight"": ""<value>""},
           ""Downside"": {""Weight"": ""<value>""},
           ""Severe Downside"": {""Weight"": ""<value>""}
       }
   }
Express the weights as percentage strings without the '%' symbol (e.g., ""10"" for 10%).
Include a note after the JSON detailing the data source (e.g., specific table or section) and any adjustments made if applicable. If the weightings are not found in the document, explicitly state this and reference any previously provided data (e.g., a ""Scenario"" table with weightings: Upside 10%, Base 55%, Downside 20%, Severe Downside 15%) that may align with the scenarios after adjusting for terminology differences.
If the required data is not found, state that the information is unavailable and explain why (e.g., missing table, lack of scenario weights)."
Principality,IFRS9 Data by Stage,"Given the full document content provided, extract the Gross loan balance,Loss allowance,by stage as well as total. Use the following guidelines:''is the ratio of Loss allowance to Gross loan balance (expressed as a percentage) for each stage and category. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.  Focus on sections titled:  "" Provision for impairment losses"" For Stage 2, use the total values (e.g., 'Stage 2 total' or sum of subcategories like up to date, 1-30 DPD, >30 DPD) unless otherwise specified. If subcategories are present, sum them for Gross loan balance and Loss allowance and recalculate  if table percentages are inconsistent.  Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").  Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.  If you don't know the answer, just say that you don�t know, don�t try to make up an answer.  Extract data for the following portfolios: Group,,,,. Output the result as a JSON string with the following structure :
   {
     'Group': {
       'Stage 1': {'Loss allowance': '<value>', 'Gross loan balance': '<value>', 'Coverage': '<value>'},
       'Stage 2': {'Loss allowance': '<value>', 'Gross loan balance': '<value>', 'Coverage': '<value>'},
       'Stage 3': {'Loss allowance': '<value>', 'Gross loan balance': '<value>', 'Coverage': '<value>'}
     }
   } 
"
Principality,Arrears Rates,"Given the full document content provided, extract the payment due status for the following categories:Group, as reported for the latest period presented in the document.Focus specifically on tables that  ""provides further information on the first and second charge retail loans secured on residential property by payment due status:"" within the document, as these sections contain the detailed breakdown of Gross exposure by payment due status. Use the following guidelines:
1. Locate and extract the data directly from tables that ""provides further information on the first and second charge retail loans secured on residential property by payment due status: "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. 
2. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
3. Return the result as a JSON string with the following structure:
   {
     ""Group"": {
       ""Current"": {""Balance"": ""<value>""},
       ""Past due up to 3 months"": {""Balance"": ""<value>""},
       ""Past due 3 months up to 6 months"": {""Balance"": ""<value>""},
       ""Past due 6 months up to 12 months"":{""Balance"": ""<value>""},
       ""Past due over 12 months "": {""Balance"": ""<value>""},
       ""Possessions "": {""Balance"": ""<value>""},
     }
   }
4. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
5. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
6. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Coventry,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (Provisions), Balance (Gross Balances), and Coverage (Provisions as a % of total balance) for the following categories: Group, as reported for the latest period presented in the document. Focus specifically on tables labeled ""Movements in gross exposure and ECL provision"" within the document, as these tables contain the detailed breakdown of Provisions and Gross Balances by stage and category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each stage (1, 2, 3) and category (Group), expressed in �m.
2. Balance refers to the gross balances for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables titled""""Movements in gross exposure and ECL provision"". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. For Stage 2, use the total values (e.g., ""Stage 2 total"" or sum of subcategories like up to date, Not past due, Past due) unless otherwise specified. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Return the result as a JSON string with the following structure:
   {
     ""Group"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
   }
7. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
8. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
9. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Leeds,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (Impairment loss provision), Balance (Gross exposure ) and Coverage (Provision 
coverage) for the following categories: Retail mortgages and Loan commitments, as reported for the latest period presented in the document. Focus specifically on tables that  ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions"" within the document, as these tables contain the detailed breakdown of Impairment loss provision, Gross exposure and Provision coverage by stage and category. Use the following guidelines:

1. ECL refers to Impairment loss provision on credit exposures for each stage (1, 2, 3) and category (Retail mortgages and Loan commitments), expressed in �m.
2. Balance refers to the Gross exposure for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables that ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. For Stage 2, use the total values (e.g., ""Stage 2 total"" or sum of subcategories like Stage 2 and <30 days past due, Stage 2 and 30+ days past due ) unless otherwise specified.  For Stage 3, use the total values (e.g., ""Stage 3 total"" or sum of subcategories like Stage 3 and <90 days past due, Stage 3 and 90+ days past due ) unless otherwise specified If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Return the result as a JSON string with the following structure:
   {
     ""Retail mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Loan commitments"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
   }
8. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
9. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
10. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Leeds,Arrears Rates,"Given the full document content provided, extract the Stage 1, Stage 2 and Stage 3 days past due for the following categories:Retail mortgages and Loan commitments, as reported for the latest period presented in the document.Focus specifically on tables that  ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions"" within the document, as these tables contain the detailed breakdown of Impairment loss provision, Gross exposure and Provision coverage by stage and category. Use the following guidelines:

1. ECL refers to Impairment loss provision on credit exposures for each stage (1, 2, 3) and category (Retail mortgages and Loan commitments), expressed in �m.
2. Balance refers to the Gross exposure for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables that ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. 
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Return the result as a JSON string with the following structure:
   {
     ""Retail mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2 and <30 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2 and 30+ days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3 and <90 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3 and 90+ days past due "": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Loan commitments"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2 and <30 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2 and 30+ days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3 and <90 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3 and 90+ days past due "": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
   }
4. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
5. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
6. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Nationwide,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (Provisions), Balance (Gross Balances), and Coverage (Provisions as a % of total balance) for the following categories: Owner-occupied, buy-to-let and legacy, Overdrawn current accounts, Personal Loans and Credit Cards, as reported for the latest period presented in the document. Focus specifically on tables labeled ""Consumer banking product and staging analysis""and ""Residential mortgages staging analysis"" within the document, as these tables contain the detailed breakdown of Provisions, Gross Balances and Provisions as a % of total balance by stage and category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each stage (1, 2, 3) and category (Owner-occupied, buy-to-let and legacy, Overdrawn current accounts, Personal Loans and Credit Cards), expressed in �m.
2. Balance refers to the gross balances for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables titled""Consumer banking product and staging analysis""and ""Residential mortgages staging analysis"". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. For Stage 2, use the total values (e.g., ""Stage 2 total"" or sum of subcategories like up to date, 1-30 DPD, >30 DPD) unless otherwise specified. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Assume ""Unsecured"" is split into Overdrawn current accounts, Personal Loans and Credit Cards as separate rowa within the table, and validate totals against provided aggregates where possible.
7. Return the result as a JSON string with the following structure:
   {
     ""Owner-occupied"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Buy-to-let and legacy"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Overdrawn current accounts"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Personal loans"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
     ""Credit cards"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
   }
8. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
9. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
10. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Santander,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (Provisions), Balance (Exposures), and Coverage  (Coverage Ratio) for the following categories: Mortgages,EDB - Credit Cards, EDB - Other, Consumer Finance, Corporate & Commercial Banking and Corporate Centre , as reported for the latest period presented in the document. Focus specifically on tables labeled ""Credit quality"" within the document, as these tables contain the detailed breakdown of ECL, Exposure and Coverage Ratio by stage and category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each stage (1, 2, 3) and category (Mortgages,EDB - Credit Cards, EDB - Other, Consumer Finance, Corporate & Commercial Banking and Corporate Centre), expressed in �m.
2. Balance refers to the Exposure for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables titled""Credit quality"""". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. ""Retail & Business Banking"" is split into Mortgages,EDB - Credit Cards, EDB - Other as separate rows within the table. validate totals against provided aggregates where possible.
7. If both on balance sheet and off balance sheet numvbers are present, show only the on balance shete numbers. 
8. Return the result as a JSON string with the following structure:
   {
     ""Mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""EDB - Credit Cards"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""EDB - Other"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     "" Consumer Finance"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
     "" Corporate & Commercial Banking "": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
     "" Corporate Centre "": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Skipton,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (Loss allowance), Balance (Gross carrying amount) for the following categories: Residential mortgages, Other lending and Commercial mortgages, as reported for the latest period presented in the document. Focus specifically on tables that provide ""information on movements in the gross carrying amount"" and ""information on movements in the impairment loss allowance"" within the document, as these tables contain the detailed breakdown of Loss allowance and Gross carrying amount by stage and category. Use the following guidelines:

1. ECL refers to Loss allowance on credit exposures for each stage (1, 2, 3) and category (Residential mortgages, Other lending and Commercial mortgages), expressed in �m.
2. Balance refers to the Gross carrying amount for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables that provide ""information on movements in the gross carrying amount"" and ""information on movements in the impairment loss allowance"" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. If both Group and Society numbers are presented, provide results for the Group. 
7. Return the result as a JSON string with the following structure:
   {
     ""Residential mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Commercial mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Other lending"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
   }
8. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
9. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
10. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Skipton,Arrears Rates,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 days past due for the following categories: Residential mortgages, Other lending and Commercial mortgages, as reported for the latest period presented in the document. Focus specifically on tables that provide ""loans and advances by payment due status"" within the document, as these tables contain the detailed breakdown of days past due by stage and category. Use the following guidelines:

1. Locate and extract the data directly from tables that provide ""loans and advances by payment due status"" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.
2. If both Group and Society numbers are presented, provide results for the Group. 
3. Return the result as a JSON string with the following structure:
   {
     ""Residential mortgages"": {
       ""Stage 1"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 2"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 3"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" }
     },
     ""Commercial mortgages"": {
       ""Stage 1"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 2"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 3"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" }
     },
     ""Other lending"": {
       ""Stage 1"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 2"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 3"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" }
     },
   }
4. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
5. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
6. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
VMUK,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 Expected Credit Loss (ECL), Balance (gross loans and advances), and Coverage (provision-to-loan ratio) for the following categories: Mortgages, Cards, Loans and Overdrafts, and Business, as reported for the latest period presented in the document. Focus specifically on tables labeled ""Gross loans and advances (1) ECL and coverage"" within the document, as these tables contain the detailed breakdown of ECL, Balance, and Coverage by stage and category. Use the following guidelines:

1. ECL refers to impairment provisions on credit exposures for each stage (1, 2, 3) and category (Mortgages, Cards, Loans and Overdrafts, Business), expressed in �m.
2. Balance refers to the gross loans and advances for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables titled ""Gross loans and advances (1) ECL and coverage."" If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. For Stage 2, use the total values (e.g., ""Stage 2 - total"" or sum of subcategories like 0 DPD, <30 DPD, >30 DPD) unless otherwise specified. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Assume ""Unsecured"" is split into ""Cards"" and ""Loans and Overdrafts"" as separate columns within the table, and validate totals against provided aggregates where possible.
7. Return the result as a JSON string with the following structure:
   {
     ""Mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Cards"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Loans and Overdrafts"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Business"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
   }
8. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
9. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
10. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Yorkshire,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (ECL), Balance (Gross exposure ) and Coverage (Coverage) for the following categories: Retail mortgages and Loan commitments, as reported for the latest period presented in the document. Focus specifically on tables titled  ""Staging and POCI"" within the document, as these tables contain the detailed breakdown of ECL, Gross exposure and Coverage by stage and category. Use the following guidelines:

1. ECL for each stage (1, 2, 3) and category (Retail mortgages and Loan commitments), expressed in �m.
2. Balance refers to the Gross exposure for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables that ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. 
5. Return the result as a JSON string with the following structure:
   {
     ""Group"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
   }
8. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
9. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
10. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Yorkshire,Arrears Rates,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 Balance (Gross exposure ) for the following categories: Group, as reported for the latest period presented in the document. Focus specifically on tables titled  ""Staging and POCI"" within the document, as these tables contain the detailed breakdown of  Gross exposure . Use the following guidelines:

2. Balance refers to the Gross exposure for each stage and category, expressed in �m.
4. Locate and extract the data directly from tables that ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. 
6. Return the result as a JSON string with the following structure:
   {
     ""Group"": {
       ""Stage 1"": {""Balance"": ""<value>""},
       ""Stage 2"": {""Balance"": ""<value>""},
       ""Less than 30 days past due"": {""Balance"": ""<value>""},
       ""More than 30 days past due"": {"" ""Balance"": ""<value>""},
       ""Stage 3"": {"" ""Balance"": ""<value>""},
       ""Less than 30 days past due"": {""Balance"": ""<value>""},
       ""30-90 days past due"": {""Balance"": ""<value>""}'
       ""More than 90 days past due"": {""Balance"": ""<value>""}'
     }
   }
4. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
5. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
6. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Leeds,Scenario ECL,"""Given the full document content provided, extract the Reported ECL, Central scenario, Upside scenario , Downside scenario , Alternative Downside scenario  ECL (Provisions)  for the following categories: Retail mortgages and Loan commitments, as reported for the latest period presented in the document. Focus specifically on sections titled """"Critical accounting estimates and judgements"""" within the document, as these sections contain the detailed breakdown of Reported ECL, Central scenario, Upside scenario , Downside scenario , Alternative Downside scenario by category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each category (Reported ECL, Central scenario, Upside scenario , Downside scenario , Alternative Downside scenario), expressed in �m.
4. Locate and extract the data directly from sections titled """"Critical accounting estimates and judgements"""". If multiple periods are present, identify the latest period by the most recent date (e.g., """"As at [date]"""") or context (e.g., """"current period"""" vs. """"prior period""""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. If cannot find the data by category, show the aggregate numbers. validate totals against provided aggregates where possible.
7. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers.
8. Return the result as a JSON string with the following structure:
   {
       """"Retail mortgages"""": {
       """"Reported ECL """": {""""ECL"""": """"<value>""""},
       """"Central scenario """": {""""ECL"""": """"<value>""""},
       """"Upside scenario """": {""""ECL"""": """"<value>""""},
       """"Downside scenario """": {""""ECL"""": """"<value>""""},
       """"Alternative Downside scenario """": {""""ECL"""": """"<value>""""}
     },
       """"Loan commitments"""": {
       """"Reported ECL """": {""""ECL"""": """"<value>""""},
       """"Central scenario """": {""""ECL"""": """"<value>""""},
       """"Upside scenario """": {""""ECL"""": """"<value>""""},
       """"Downside scenario """": {""""ECL"""": """"<value>""""},
       """"Alternative Downside scenario """": {""""ECL"""": """"<value>""""}  
   },
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., """"52370"""" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., """"0.84%"""").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."""
Leeds,Scenario Weight,"""Given the full document content provided, extract the scenario weight for the  Central scenario, Upside scenario , Downside scenario , Alternative Downside scenario  as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       """"Scenario weights %"""": {

       """"Central """": {""""Weight"""": """"<value>""""},
       """"Upside """": {""""Weight"""": """"<value>""""}
       """"Downside """": {""""Weight"""": """"<value>""""}
       """"Alternative Downside  """": {""""Weight"""": """"<value>""""}
     }
   }"""
Coventry,Scenario ECL,"Given the full document content provided, extract the Weighted average ECL, Base scenario ECL, Upside scenario ECL, Downside scenario ECL, and Severe downside scenario ECL (Provisions) for the category **Retail analysis** (representing the total mortgage portfolio ECL), as reported for the latest period (31 December 2024) presented in the document. Focus specifically on tables within the section titled **""14. Impairment on loans and advances to customers""**, particularly the table on **page 156 under ""31 December 2024 Scenarios"" showing ""Total ECL (�m)"" by scenario** OR the table on **page 155 showing ""IFRS 9 provision �m"" for 31 December 2024**. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each scenario category (Weighted average, Base, Upside, Downside, Severe downside), expressed in �m.
2. Locate and extract the data directly from the specified tables. The table on page 156 (""31 December 2024 Scenarios"") is the preferred source for ""Total ECL (�m)"". If this specific breakdown is not found, the table on page 155 (""IFRS 9 provision �m"" for 31 December 2024 scenarios) can be used.
3. If OCR errors or inconsistencies are detected (e.g., unclear ECL values), prioritize values that align with totals or logical consistency if possible, and note adjustments.
4. As Coventry Building Society's primary business is retail mortgages and savings, ""Retail analysis"" will represent the total portfolio ECLs. ""Wholesale analysis"" is not expected to be detailed in the same manner for scenario ECLs.
5. If both on balance sheet and off balance sheet numbers are present for these specific scenario ECLs, show only the on balance sheet numbers. (Note: For Coventry, the ECL tables referenced are typically aggregated).
6. Return the result as a JSON string with the following structure. If ""Wholesale analysis"" data is not found for scenario ECLs, provide an empty object for it.
   {
       ""Wholesale analysis"": {},
       ""Retail analysis"": {
           ""Weighted average ECL"": {""ECL"": ""<value>""},
           ""Base scenario ECL"": {""ECL"": ""<value>""},
           ""Upside scenario ECL"": {""ECL"": ""<value>""},
           ""Downside scenario ECL"": {""ECL"": ""<value>""},
           ""Severe downside scenario ECL"": {""ECL"": ""<value>""}
       }
   }
7. Express monetary values in �m (millions) as strings without commas (e.g., ""24.3"" for �24.3m).
8. Include a note after the JSON detailing the data source (e.g., specific table and page number), any adjustments made due to OCR errors or inconsistencies, and state that ""Retail analysis"" represents the total portfolio for Coventry Building Society as per the available scenario ECL breakdown.
9. If you don't know the answer for a specific value, use ""null"" or state that the specific breakdown is not available. Do not try to make up an answer."
Coventry,Scenario Weight,"""Given the full document content provided, extract the scenario weight for the  Central scenario, Upside scenario , Downside scenario , Alternative Downside scenario  as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       """"Scenario weights %"""": {

       """"Central """": {""""Weight"""": """"<value>""""},
       """"Upside """": {""""Weight"""": """"<value>""""}
       """"Downside """": {""""Weight"""": """"<value>""""}
       """"Alternative Downside  """": {""""Weight"""": """"<value>""""}
     }
   }"""

```

# codebase_backend.md

```md
# .idea\.gitignore

\`\`\`
# Default ignored files
/shelf/
/workspace.xml
# Editor-based HTTP Client requests
/httpRequests/
# Datasource local storage ignored files
/dataSources/
/dataSources.local.xml

\`\`\`

# .idea\Benchmarking.iml

\`\`\`iml
<?xml version="1.0" encoding="UTF-8"?>
<module type="PYTHON_MODULE" version="4">
  <component name="NewModuleRootManager">
    <content url="file://$MODULE_DIR$">
      <excludeFolder url="file://$MODULE_DIR$/.venv" />
    </content>
    <orderEntry type="inheritedJdk" />
    <orderEntry type="sourceFolder" forTests="false" />
  </component>
  <component name="PyDocumentationSettings">
    <option name="format" value="PLAIN" />
    <option name="myDocStringFormat" value="Plain" />
  </component>
</module>
\`\`\`

# .idea\inspectionProfiles\profiles_settings.xml

\`\`\`xml
<component name="InspectionProjectProfileManager">
  <settings>
    <option name="USE_PROJECT_PROFILE" value="false" />
    <version value="1.0" />
  </settings>
</component>
\`\`\`

# .idea\modules.xml

\`\`\`xml
<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="ProjectModuleManager">
    <modules>
      <module fileurl="file://$PROJECT_DIR$/.idea/Benchmarking.iml" filepath="$PROJECT_DIR$/.idea/Benchmarking.iml" />
    </modules>
  </component>
</project>
\`\`\`

# dataextract-ey-main\.gitignore

\`\`\`
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

\`\`\`

# dataextract-ey-main\components.json

\`\`\`json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "src/index.css",
    "baseColor": "slate",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  }
}
\`\`\`

# dataextract-ey-main\eslint.config.js

\`\`\`js
import js from "@eslint/js";
import globals from "globals";
import reactHooks from "eslint-plugin-react-hooks";
import reactRefresh from "eslint-plugin-react-refresh";
import tseslint from "typescript-eslint";

export default tseslint.config(
  { ignores: ["dist"] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ["**/*.{ts,tsx}"],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      "react-hooks": reactHooks,
      "react-refresh": reactRefresh,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      "react-refresh/only-export-components": [
        "warn",
        { allowConstantExport: true },
      ],
      "@typescript-eslint/no-unused-vars": "off",
    },
  }
);

\`\`\`

# dataextract-ey-main\index.html

\`\`\`html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>finscope-data-miner</title>
    <meta name="description" content="Lovable Generated Project" />
    <meta name="author" content="Lovable" />

    <meta property="og:title" content="finscope-data-miner" />
    <meta property="og:description" content="Lovable Generated Project" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  </head>

  <body>
    <div id="root"></div>
    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

\`\`\`

# dataextract-ey-main\package.json

\`\`\`json
{
  "name": "vite_react_shadcn_ts",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "build:dev": "vite build --mode development",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@hookform/resolvers": "^3.9.0",
    "@radix-ui/react-accordion": "^1.2.0",
    "@radix-ui/react-alert-dialog": "^1.1.1",
    "@radix-ui/react-aspect-ratio": "^1.1.0",
    "@radix-ui/react-avatar": "^1.1.0",
    "@radix-ui/react-checkbox": "^1.1.1",
    "@radix-ui/react-collapsible": "^1.1.0",
    "@radix-ui/react-context-menu": "^2.2.1",
    "@radix-ui/react-dialog": "^1.1.2",
    "@radix-ui/react-dropdown-menu": "^2.1.1",
    "@radix-ui/react-hover-card": "^1.1.1",
    "@radix-ui/react-label": "^2.1.0",
    "@radix-ui/react-menubar": "^1.1.1",
    "@radix-ui/react-navigation-menu": "^1.2.0",
    "@radix-ui/react-popover": "^1.1.1",
    "@radix-ui/react-progress": "^1.1.0",
    "@radix-ui/react-radio-group": "^1.2.0",
    "@radix-ui/react-scroll-area": "^1.1.0",
    "@radix-ui/react-select": "^2.1.1",
    "@radix-ui/react-separator": "^1.1.0",
    "@radix-ui/react-slider": "^1.2.0",
    "@radix-ui/react-slot": "^1.1.0",
    "@radix-ui/react-switch": "^1.1.0",
    "@radix-ui/react-tabs": "^1.1.0",
    "@radix-ui/react-toast": "^1.2.1",
    "@radix-ui/react-toggle": "^1.1.0",
    "@radix-ui/react-toggle-group": "^1.1.0",
    "@radix-ui/react-tooltip": "^1.1.4",
    "@tanstack/react-query": "^5.56.2",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.0.0",
    "date-fns": "^3.6.0",
    "embla-carousel-react": "^8.3.0",
    "framer-motion": "^12.10.5",
    "input-otp": "^1.2.4",
    "lucide-react": "^0.462.0",
    "next-themes": "^0.3.0",
    "pdfjs-dist": "^3.10.111",
    "react": "^18.3.1",
    "react-day-picker": "^8.10.1",
    "react-dom": "^18.3.1",
    "react-hook-form": "^7.53.0",
    "react-resizable-panels": "^2.1.3",
    "react-router-dom": "^6.26.2",
    "recharts": "^2.12.7",
    "sonner": "^1.5.0",
    "tailwind-merge": "^2.5.2",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^0.9.3",
    "xlsx": "^0.18.5",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@eslint/js": "^9.9.0",
    "@tailwindcss/typography": "^0.5.15",
    "@types/node": "^22.5.5",
    "@types/react": "^18.3.3",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react-swc": "^3.5.0",
    "autoprefixer": "^10.4.20",
    "eslint": "^9.9.0",
    "eslint-plugin-react-hooks": "^5.1.0-rc.0",
    "eslint-plugin-react-refresh": "^0.4.9",
    "globals": "^15.9.0",
    "lovable-tagger": "^1.1.7",
    "postcss": "^8.4.47",
    "tailwindcss": "^3.4.11",
    "typescript": "^5.5.3",
    "typescript-eslint": "^8.0.1",
    "vite": "^5.4.1"
  }
}

\`\`\`

# dataextract-ey-main\postcss.config.js

\`\`\`js
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}

\`\`\`

# dataextract-ey-main\public\favicon.ico

This is a binary file of the type: Binary

# dataextract-ey-main\public\placeholder.svg

This is a file of the type: SVG Image

# dataextract-ey-main\public\robots.txt

\`\`\`txt
User-agent: Googlebot
Allow: /

User-agent: Bingbot
Allow: /

User-agent: Twitterbot
Allow: /

User-agent: facebookexternalhit
Allow: /

User-agent: *
Allow: /

\`\`\`

# dataextract-ey-main\README.md

\`\`\`md
# Welcome to your Lovable project

## Project info

**URL**: https://lovable.dev/projects/f1c52b0c-481b-4d58-84cf-5beb28959f75

## How can I edit this code?

There are several ways of editing your application.

**Use Lovable**

Simply visit the [Lovable Project](https://lovable.dev/projects/f1c52b0c-481b-4d58-84cf-5beb28959f75) and start prompting.

Changes made via Lovable will be committed automatically to this repo.

**Use your preferred IDE**

If you want to work locally using your own IDE, you can clone this repo and push changes. Pushed changes will also be reflected in Lovable.

The only requirement is having Node.js & npm installed - [install with nvm](https://github.com/nvm-sh/nvm#installing-and-updating)

Follow these steps:

\`\`\`sh
# Step 1: Clone the repository using the project's Git URL.
git clone <YOUR_GIT_URL>

# Step 2: Navigate to the project directory.
cd <YOUR_PROJECT_NAME>

# Step 3: Install the necessary dependencies.
npm i

# Step 4: Start the development server with auto-reloading and an instant preview.
npm run dev
\`\`\`

**Edit a file directly in GitHub**

- Navigate to the desired file(s).
- Click the "Edit" button (pencil icon) at the top right of the file view.
- Make your changes and commit the changes.

**Use GitHub Codespaces**

- Navigate to the main page of your repository.
- Click on the "Code" button (green button) near the top right.
- Select the "Codespaces" tab.
- Click on "New codespace" to launch a new Codespace environment.
- Edit files directly within the Codespace and commit and push your changes once you're done.

## What technologies are used for this project?

This project is built with:

- Vite
- TypeScript
- React
- shadcn-ui
- Tailwind CSS

## How can I deploy this project?

Simply open [Lovable](https://lovable.dev/projects/f1c52b0c-481b-4d58-84cf-5beb28959f75) and click on Share -> Publish.

## Can I connect a custom domain to my Lovable project?

Yes, you can!

To connect a domain, navigate to Project > Settings > Domains and click Connect Domain.

Read more here: [Setting up a custom domain](https://docs.lovable.dev/tips-tricks/custom-domain#step-by-step-guide)

\`\`\`

# dataextract-ey-main\src\App.css

\`\`\`css
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}

\`\`\`

# dataextract-ey-main\src\App.tsx

\`\`\`tsx

import { Toaster } from "@/components/ui/toaster";
import { Toaster as Sonner } from "@/components/ui/sonner";
import { TooltipProvider } from "@/components/ui/tooltip";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { BrowserRouter, Routes, Route, useLocation } from "react-router-dom";
import { AnimatePresence, motion } from "framer-motion";
import IntroScreen from "./components/IntroScreen";
import Dashboard from "./pages/Dashboard";
import BankSelection from "./pages/BankSelection";
import NotFound from "./pages/NotFound";
import { ThemeProvider } from "./components/ThemeProvider";
import { ThemeToggle } from "./components/ThemeToggle";

const queryClient = new QueryClient();

// Simple, elegant fade transition
const pageVariants = {
  initial: {
    opacity: 0
  },
  in: {
    opacity: 1
  },
  out: {
    opacity: 0
  }
};

// Smooth, quick transition
const pageTransition = {
  duration: 0.3,
  ease: "easeInOut"
};

// Animation wrapper component with elegant transitions
const AnimatedRoutes = () => {
  const location = useLocation();
  
  return (
    <AnimatePresence mode="wait">
      <motion.div
        key={location.pathname}
        initial="initial"
        animate="in"
        exit="out"
        variants={pageVariants}
        transition={pageTransition}
        className="w-full min-h-screen"
      >
        {/* Theme toggle positioned in header instead of fixed position */}
        <Routes location={location}>
          <Route path="/" element={<IntroScreen />} />
          <Route path="/select-bank" element={<BankSelection />} />
          <Route path="/dashboard" element={<Dashboard />} />
          <Route path="*" element={<NotFound />} />
        </Routes>
      </motion.div>
    </AnimatePresence>
  );
};

const App = () => (
  <QueryClientProvider client={queryClient}>
    <ThemeProvider defaultTheme="light">
      <TooltipProvider>
        <Toaster />
        <Sonner />
        <BrowserRouter>
          <AnimatedRoutes />
        </BrowserRouter>
      </TooltipProvider>
    </ThemeProvider>
  </QueryClientProvider>
);

export default App;

\`\`\`

# dataextract-ey-main\src\components\dashboard\CombinedTab.tsx

\`\`\`tsx

import { Button } from '@/components/ui/button';
import { ProcessingResult } from '@/lib/types';
import { Download } from 'lucide-react';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';

interface CombinedTabProps {
  results: ProcessingResult[];
  onDownloadResults: () => void;
}

const CombinedTab = ({ results, onDownloadResults }: CombinedTabProps) => {
  // Extract unique data entries from all results
  const combinedData = results
    .filter(result => result.status === 'success' && result.data)
    .flatMap(result => {
      return result.data?.map(item => ({
        ...item,
        Source: `${result.fileName} - ${result.promptName}`
      })) || [];
    });

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h2 className="text-lg font-semibold mb-1">Combined Results</h2>
          <p className="text-sm text-muted-foreground">
            View and download the final processed data in Excel format
          </p>
        </div>
        <Button 
          variant="outline" 
          size="sm" 
          onClick={onDownloadResults}
          className="flex items-center gap-1 border-yellow-400 bg-white text-black hover:bg-yellow-50"
        >
          <Download className="h-4 w-4" />
          <span>Download Excel</span>
        </Button>
      </div>
      
      {combinedData.length > 0 ? (
        <div className="border rounded-lg overflow-hidden">
          <div className="flex justify-between items-center p-3 bg-muted border-b">
            <Button 
              variant="outline" 
              size="sm" 
              className="py-1 h-8 bg-yellow-400 hover:bg-yellow-500 border-none text-black"
            >
              Combined View
            </Button>
            <div className="text-sm text-muted-foreground">
              {combinedData.length} rows
            </div>
          </div>
          
          {/* Increased the height from 500px to 650px for larger view */}
          <ScrollArea className="h-[650px]">
            <Table>
              <TableHeader className="bg-muted/70 sticky top-0">
                <TableRow>
                  <TableHead className="font-semibold text-black">Category</TableHead>
                  <TableHead className="font-semibold text-black">Stage</TableHead>
                  <TableHead className="font-semibold text-black">Field</TableHead>
                  <TableHead className="font-semibold text-black">Value</TableHead>
                  <TableHead className="font-semibold text-black">Source</TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {combinedData.map((item, index) => (
                  <TableRow key={index}>
                    <TableCell>{item.Category === 'ECL By Stage' ? 'ECL' : item.Category}</TableCell>
                    <TableCell>{item.Stage}</TableCell>
                    <TableCell>{item.Field}</TableCell>
                    <TableCell>{item.Value}</TableCell>
                    <TableCell>{item.Source}</TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </ScrollArea>
        </div>
      ) : (
        <div className="border rounded-lg p-12 text-center">
          <p className="text-muted-foreground">No results available yet.</p>
          <p className="text-sm text-muted-foreground mt-1">Process files with prompts to see combined results.</p>
        </div>
      )}
    </div>
  );
};

export default CombinedTab;

\`\`\`

# dataextract-ey-main\src\components\dashboard\Footer.tsx

\`\`\`tsx

const Footer = () => {
  return (
    <footer className="bg-gray-100 border-t mt-auto py-4">
      <div className="container mx-auto px-4">
        <div className="flex justify-between items-center text-sm text-muted-foreground">
          <div>AiDEx - AI powered Data Extraction</div>
          <div>© {new Date().getFullYear()} Barclays Financial Services</div>
        </div>
      </div>
    </footer>
  );
};

export default Footer;

\`\`\`

# dataextract-ey-main\src\components\dashboard\PromptsTab.tsx

\`\`\`tsx

import PromptSelector from '@/components/PromptSelector';
import PromptDescriptions from '@/components/PromptDescriptions';
import { PromptOption } from '@/lib/types';
import { useCallback } from 'react';

interface PromptsTabProps {
  onPromptSelected: (prompts: PromptOption[]) => void;
  isProcessing: boolean;
  selectedPrompts?: PromptOption[];
}

const PromptsTab = ({ onPromptSelected, isProcessing, selectedPrompts = [] }: PromptsTabProps) => {
  // Use a callback to avoid setState during render
  const handlePromptSelected = useCallback((prompts: PromptOption[]) => {
    onPromptSelected(prompts);
  }, [onPromptSelected]);

  return (
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div>
        <PromptSelector 
          onPromptSelected={handlePromptSelected}
          disabled={isProcessing}
          selectedPrompts={selectedPrompts}
        />
      </div>
      <div>
        <PromptDescriptions />
      </div>
    </div>
  );
};

export default PromptsTab;

\`\`\`

# dataextract-ey-main\src\components\dashboard\ResultsTab.tsx

\`\`\`tsx

import ResultsViewer from '@/components/ResultsViewer';
import { ProcessingResult } from '@/lib/types';

interface ResultsTabProps {
  results: ProcessingResult[];
  onDownloadResults: () => void;
  isProcessing: boolean;
  processingProgress: number;
  processingStep: string;
}

const ResultsTab = ({ 
  results, 
  onDownloadResults, 
  isProcessing, 
  processingProgress, 
  processingStep 
}: ResultsTabProps) => {
  // Calculate total files and processed files from the results
  const uniqueFileIds = new Set(results.map(r => r.fileId));
  const totalFiles = isProcessing ? Math.max(1, uniqueFileIds.size) : uniqueFileIds.size;
  const processedFiles = isProcessing && processingProgress >= 100 ? totalFiles : uniqueFileIds.size;
  
  return (
    <ResultsViewer 
      results={results}
      onDownloadResults={onDownloadResults}
      isProcessing={isProcessing}
      processingProgress={processingProgress}
      processingStep={processingStep}
      totalFiles={totalFiles}
      processedFiles={processedFiles}
    />
  );
};

export default ResultsTab;

\`\`\`

# dataextract-ey-main\src\components\dashboard\SideBySideTab.tsx

\`\`\`tsx

import { useState, useEffect } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Button } from '@/components/ui/button';
import { RefreshCw } from 'lucide-react';
import { ProcessingResult } from '@/lib/types';
import PDFViewer from '@/components/PDFViewer';

interface SideBySideTabProps {
  results: ProcessingResult[];
}

const SideBySideTab = ({ results }: SideBySideTabProps) => {
  const [selectedFile, setSelectedFile] = useState<File | null>(null);
  const [selectedResult, setSelectedResult] = useState<ProcessingResult | null>(
    results.length > 0 ? results[0] : null
  );
  const [retryCounter, setRetryCounter] = useState(0);
  const [pdfFiles, setPdfFiles] = useState<Map<string, File>>(new Map());

  // Group results by file
  const resultsByFile: Record<string, ProcessingResult[]> = results.reduce((acc, result) => {
    if (!result) return acc;
    if (!acc[result.fileId]) {
      acc[result.fileId] = [];
    }
    acc[result.fileId].push(result);
    return acc;
  }, {} as Record<string, ProcessingResult[]>);

  // Get unique file names
  const uniqueFiles = Object.entries(resultsByFile).map(([_, fileResults]) => {
    return fileResults[0];
  });

  // Create an improved dummy PDF file with better formatting - same as in UploadTab
  const createDummyPDF = (fileName: string): File => {
    // This is a higher quality PDF with better formatting
    const base64PDF = `JVBERi0xLjcKJeTjz9IKMSAwIG9iago8PC9UeXBlL0NhdGFsb2cvUGFnZXMgMiAwIFIvTGFuZyhqYS1KUCkgL1N0cnVjdFRyZWVSb290IDIxIDAgUi9NYXJrSW5mbzw8L01hcmtlZCB0cnVlPj4vTWV0YWRhdGEgNTggMCBSL1ZpZXdlclByZWZlcmVuY2VzIDU5IDAgUj4+CmVuZG9iagoyIDAgb2JqCjw8L1R5cGUvUGFnZXMvQ291bnQgMS9LaWRzWyAzIDAgUl0gPj4KZW5kb2JqCjMgMCBvYmoKPDwvVHlwZS9QYWdlL1BhcmVudCAyIDAgUi9SZXNvdXJjZXM8PC9YT2JqZWN0PDwvSW1hZ2U1IDUgMCBSL0ltYWdlNyA3IDAgUj4+L0ZvbnQ8PC9GMSAxMSAwIFIvRjIgMTMgMCBSL0YzIDE1IDAgUi9GNCAxNyAwIFI+Pi9FeHRHU3RhdGU8PC9HUzcgNyAwIFIvR1M4IDggMCBSPj4vUHJvY1NldFsvUERGL1RleHQvSW1hZ2VCL0ltYWdlQy9JbWFnZUldID4+L01lZGlhQm94WyAwIDAgNTk1LjMyIDg0MS45Ml0gL0NvbnRlbnRzIDQgMCBSL0dyb3VwPDwvVHlwZS9Hcm91cC9TL1RyYW5zcGFyZW5jeS9DUy9EZXZpY2VSR0I+Pi9UYWJzL1MvU3RydWN0UGFyZW50cyAwPj4KZW5kb2JqCjQgMCBvYmoKPDwvRmlsdGVyL0ZsYXRlRGVjb2RlL0xlbmd0aCAxOTA4Pj4Kc3RyZWFtCnictVnbkps4EH3nK3Q5uwo1urHB43gnpHBiy4iL12vv5mErD4MsMBXGBXgr+4d8XDeSuRgwdpKtmiqEkOg+3af7yHy7It9olr6TM87oNb2JxYGqM8qTrCCxgD8CBS3oi0xyEYn0nIooAynMaM5SciW/ZCknb7Oz8w8kE2QinkYHcq2iI8lj8g0awW+p/HuWvvAYBp6wPDqQmNIF/Emf4BFRamDNBHklMTzNNQIqwC4JjI9T+FeSh39MegVj9CjN0E6jBQWnISVqwXOaJCALfodFnBZCo89FivXlErBTYAa841mSJ+mJ8MmzDDC+1QxuJ+pEefBHzJKMJwcS8cN+RtVs8+NPwBa7wOxpt3i8eXn4gfrju8Ct3h1CLx1G7+7QuH+Anj4Oj90XgfmrOOye/WwO+1npeI7ukDsFrrjcHUbyGU0IvkZTp8pfa33pwsb7UuC1gYs8QdNq5jYZxNYzX+/oDXrTTOA+WCzCnJEUJrhA7q0wC3JE4ZPNH3W1mROL04h1Qhim4OKmdhPbAcrTIiVvdZ2z9DC6dAA+UFw4bjA2/P54g+1+PB6NvEvn2Ld6u+pBE9ufjI39wUg/D3F6aoLBHLScFLLJksm+xM/JXCNYM4YeBicJvc8rC7PSK5G6Tjv4i8Wt4wcj63q1ut6qhlggOcgcUYk20WXJHC7Vdu4wSnOEeQrmJpnDxKBkOgLS5kS2KQdTqUHmsHxhnB+GlaEggPm4bDq/rUlUvUjrx4i2DXDjo1hMBHxkDMsODMexmsHZeqXN9+VqKDEpPJhKkDs18A6kTGPycPv00ADXRkNEvF8xRdspeH8QLGfr3wE5KQCh7y/xziq8IATdLe3z1ZPvu9Po0L7ls/lyTA8s1zwx6/aipdyGvrI4SDx7E9cNeGdf3b2et7BfIxgBybl5YQzMoNsqSZS1h9HbCI1zdw6HpcT9hdiBBEcHkiFgY5YXSkAVGjuvamNUrSYyeUp1Gp7oicxolhfyuTsloXNpDRzuTLnjDifqveWQivUky2PkpeB7hFRdRV6wVbyrzLMCHqxUUW/HGQj7VEwIMEOZoVUbVZnWxp4Ge1mCstY3VHkOkUW4dPZVtSvdX51rXq4tUPhM+cyjdAlOM9g0E66NuugYnUCMr9311TxRn51l90OwvcFq4KKw1pQ42gAsntdgwrqmJ/Brl2P82jZQYzOUFO5LqPYvzc/bhpy+N3ubZnfVAJ+pDaKZIL/lQzdTDstKjB6gXjcr9bY9Dru6QF3Ac415RwleFebeUxGlPB5fd9/9gl3oQonA7eUXarKL9KhHka22R4CleLvNYlSY7UgVW3LQmKcd90zcqJPJCcCdiX/62fXPrcdJLJssALwbnztejx93ndtvHcpGx7ocwX8aSO00vRdTTBZeQni3WjjEIb58LMeQO4e/aBMFLTHvizWssNRIkltzmJJCH0nP7ci+co6Pmvr8M/awR8FFekLNDNcymoI7JlvzZquAKc9MsJQHx2+6m8t7oG0zG6S6uCW3cTAdOUfmznGcN6ZM0tyhr7RT4BqKFeBhcMXHwRptklv0KiDZLewprKkKtjTGpuq+d8ctsrGXbnVTB59DE8vjXIXlnJNsKqTqdfqL85PVLBHZU4DUfHWUt1sW5wnXHS2HlQ3GZghWyMvKZYLEf+XimTTHD0te3mdpeML10Xf6TrC3XRu6pksPUrQX1cUQN1hAQGF2aL8feZNFhbq2JIA06UM2wUuTBPjuDAIpPRAVVIQHKJ6Juo5E54bc70m2kUWNSYk8I3cSoNt90tKkmwkLiRLIpGq41cQE9+QrPQzp21JAcDdAA1J8jFWqKOlnQSsj225Yu4R/2EOWWtheOD6IQn8wCdptq5bU90v8l/zAiThahUZBNYzgdGZG3CKqTDehjCfYbIGluBVteMXWN2z/ut6wrSINS+4X6PcYwXVPrZ/IXEU452MocU826M76xG7j6W0B5qAjUYxc/DVJdXOXt6JKbAA2C1+r3ELS+J6T6rRfILmcZCphP+Z9hd8/0QPecIxS/CIRfJ7X97hoRc82nLdXLo1wHtdx998hmVxJynrA01ulvqjjjCUJeEXepU6NJXrW18vtdcbYI80CeXcogFNWJctyyDFxKHcWO76Zawsfpzjrx0ffQTWGusezbCs3v/49v87ZF8X+2O23cr7cyi2fLdBjrm6/K9A/vTLv1bHfdcDhqy+FhdLD8YQN5O+1fwEqNfLlCmVuZHN0cmVhbQplbmRvYmoKMjEgMCBvYmoKPDwvVHlwZS9TdHJ1Y3RUcmVlUm9vdC9QYXJlbnRUcmVlID0gNiAwIFIgL0sgPSA1MCAwIFIvSURUcmVlID0gNTEgMCBSID4+CmVuZG9iagoyMiAwIG9iago8PC9UeXBlL0ZvbnQvU3VidHlwZS9UcnVlVHlwZS9OYW1lL0YxL0Jhc2VGb250L0JDREVFRStDYWxpYnJpL0VuY29kaW5nL1dpbkFuc2lFbmNvZGluZy9Gb250RGVzY3JpcHRvciAyMyAwIFIvRmlyc3RDaGFyIDMyL0xhc3RDaGFyIDg0L1dpZHRocyA1MyAwIFI+PgplbmRvYmoKMjMgMCBvYmoKPDwvVHlwZS9Gb250RGVzY3JpcHRvci9Gb250TmFtZS9CQ0RFRUUrQ2FsaWJyaS9GbGFncyAzMi9JdGFsaWNBbmdsZSAwL0FzY2VudCA3NTAvRGVzY2VudCAtMjUwL0NhcEhlaWdodCA3NTAvQXZnV2lkdGggNTIxL01heFdpZHRoIDE3NDMvRm9udFdlaWdodCA0MDAvWEhlaWdodCAyNTAvU3RlbVYgNTIvRm9udEJCb3hbIC01MDMgLTI1MCAxMjQwIDc1MF0gL0ZvbnRGaWxlMiA1MiAwIFI+PgplbmRvYmoKNTMgMCBvYmoKWyAyMjYgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDY0MyAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCA3MTUgMCA2NjIgMCAwIDAgNTQ0XSAKZW5kb2JqCjUwIDAgb2JqCjw8L1R5cGUvU3RydWN0RWxlbS9TL1Jvb3QvUC11dGlsKFRpdGxlKS9LWzQ5IDAgUl0gL1BnIDMgMCBSID4+CmVuZG9iago0OSAwIG9iago8PC9UeXBlL1N0cnVjdEVsZW0vUy9UaXRsZS9QLXV0aWwoSGVhZGluZzEpL0tbNDggMCBSXSAvUGcgMyAwIFIgPj4KZW5kb2JqCjQ4IDAgb2JqCjw8L1R5cGUvU3RydWN0RWxlbS9TL0hlYWRpbmcxL1AvNTAgMCBSL0tbMF0gL1BnIDMgMCBSID4+CmVuZG9iago1MSAwIG9iago8PC9OYW1lcygibG9hbiIpID4+CmVuZG9iago2IDAgb2JqCjw8L051bXMgWzAgWyA0OCAwIFJdIF0gPj4KZW5kb2JqCnhyZWYKMSA0CjAwMDAwMDAwMTAgNjU1MzUgZiAKMDAwMDAwMDAxNSAwMDAwMCBuIAowMDAwMDAwMTgxIDAwMDAwIG4gCjAwMDAwMDAyMzggMDAwMDAgbiAKMTEgMgowMDAwMDAwMDAwIDAwMDAwIGYgCjAwMDAwMDAwMDAgMDAwMDAgZiAKMjEgNAowMDAwMDAyMzMwIDAwMDAwIG4gCjAwMDAwMDI0MTggMDAwMDAgbiAKMDAwMDAwMjU5NSAwMDAwMCBuIAowMDAwMDAyODU4IDAwMDAwIG4gCjQ4IDMKMDAwMDAwMzA3NyAwMDAwMCBuIAowMDAwMDAzMDAwIDAwMDAwIG4gCjAwMDAwMDI5MzUgMDAwMDAgbiAKNTAgMQowMDAwMDAyODY1IDAwMDAwIG4gCjUyIDIKMDAwMDAwMDAwMCAwMDAwMCBmIAowMDAwMDAwMDAwIDAwMDAwIGYgCnRyYWlsZXIKPDwvU2l6ZSA1NS9Sb290IDEgMCBSL0luZm8gMjAgMCBSL0lEWzwyRTA1NzM5MkZDM0JCMTQxQjNDNDkzODNBODY4NDg5OD48MkUwNTczOTJGQzNCQjE0MUIzQzQ5MzgzQTg2ODQ4OTg+XSA+PgpzdGFydHhyZWYKMzE0NQolJUVPRgo=`;
    
    try {
      // Convert base64 to blob
      const binaryString = window.atob(base64PDF);
      const len = binaryString.length;
      const bytes = new Uint8Array(len);
      for (let i = 0; i < len; i++) {
        bytes[i] = binaryString.charCodeAt(i);
      }
      
      // Create a blob from the binary data
      const pdfBlob = new Blob([bytes.buffer], { type: 'application/pdf' });
      
      // Create a File object from the blob
      const file = new File([pdfBlob], fileName, { type: 'application/pdf' });
      
      // Store the file in our map
      const updatedFiles = new Map(pdfFiles);
      updatedFiles.set(fileName, file);
      setPdfFiles(updatedFiles);
      
      console.log("Created higher-quality PDF file:", file.name, file.size, "bytes");
      return file;
    } catch (error) {
      console.error("Error creating PDF file:", error);
      // Create a minimal fallback PDF
      const minimalPDF = 'JVBERi0xLjAKMSAwIG9iago8PC9UeXBlL0NhdGFsb2cvUGFnZXMgMiAwIFI+PgplbmRvYmoKMiAwIG9iago8PC9UeXBlL1BhZ2VzL0tpZHNbMyAwIFJdL0NvdW50IDE+PgplbmRvYmoKMyAwIG9iago8PC9UeXBlL1BhZ2UvTWVkaWFCb3hbMCAwIDMgM10+PgplbmRvYmoKdHJhaWxlcgo8PC9Sb290IDEgMCBSPj4K';
      const fallbackBytes = Uint8Array.from(window.atob(minimalPDF), c => c.charCodeAt(0));
      const fallbackBlob = new Blob([fallbackBytes], { type: 'application/pdf' });
      return new File([fallbackBlob], fileName, { type: 'application/pdf' });
    }
  };

  // Initialize PDFs when component mounts
  useEffect(() => {
    if (results.length === 0) {
      setSelectedFile(null);
      setSelectedResult(null);
      return;
    }

    // Initialize PDFs for all files
    const newPdfFiles = new Map();
    
    uniqueFiles.forEach(fileInfo => {
      const pdfFile = createDummyPDF(fileInfo.fileName);
      newPdfFiles.set(fileInfo.fileName, pdfFile);
    });
    
    setPdfFiles(newPdfFiles);
    
    // Set defaults if needed
    if (!selectedResult && results.length > 0) {
      setSelectedResult(results[0]);
    }
    
    // Load the first file by default
    if (uniqueFiles.length > 0) {
      const firstFile = uniqueFiles[0];
      const pdfFile = newPdfFiles.get(firstFile.fileName);
      if (pdfFile) {
        setSelectedFile(pdfFile);
      }
    }
  }, [results, retryCounter]);

  // Handle file selection
  const handleFileSelect = (fileId: string, fileName: string) => {
    console.log("File selected:", fileName);
    
    // Use the already created PDF from our map
    const existingPDF = pdfFiles.get(fileName);
    if (existingPDF) {
      setSelectedFile(existingPDF);
    } else {
      // Create one if it doesn't exist yet
      const newPDF = createDummyPDF(fileName);
      setSelectedFile(newPDF);
    }
    
    // Set the first result from this file as the selected result
    const fileResults = resultsByFile[fileId];
    if (fileResults && fileResults.length > 0) {
      setSelectedResult(fileResults[0]);
    }
  };

  // Handle result selection
  const handleResultSelect = (result: ProcessingResult) => {
    setSelectedResult(result);
    
    // Make sure we have a PDF file for this result
    if (result.fileName) {
      const existingPDF = pdfFiles.get(result.fileName);
      if (existingPDF) {
        setSelectedFile(existingPDF);
      } else {
        const newPDF = createDummyPDF(result.fileName);
        setSelectedFile(newPDF);
      }
    }
  };

  // Handle retry loading
  const handleRetryLoading = () => {
    console.log("Retrying PDF load...");
    setRetryCounter(prev => prev + 1);
    
    // Re-create all PDFs
    if (uniqueFiles.length > 0) {
      const newPdfFiles = new Map();
      
      uniqueFiles.forEach(fileInfo => {
        const pdfFile = createDummyPDF(fileInfo.fileName);
        newPdfFiles.set(fileInfo.fileName, pdfFile);
      });
      
      setPdfFiles(newPdfFiles);
      
      // Refresh the current selection
      if (selectedResult?.fileName) {
        const refreshedPDF = newPdfFiles.get(selectedResult.fileName);
        if (refreshedPDF) {
          setSelectedFile(refreshedPDF);
        }
      }
    }
  };

  // Display a loading message if no results are available
  if (results.length === 0) {
    return (
      <div className="space-y-6">
        <div>
          <h2 className="text-lg font-semibold mb-1">Side by Side Comparison</h2>
          <p className="text-sm text-muted-foreground">Compare extracted data with the original document</p>
        </div>
        
        <Card>
          <CardContent className="flex flex-col items-center justify-center p-12 text-center">
            <div className="text-muted-foreground mb-2">
              No extraction results yet
            </div>
            <div className="text-sm text-muted-foreground">
              Process files to see side by side comparison
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-lg font-semibold mb-1">Side by Side Comparison</h2>
        <p className="text-sm text-muted-foreground">Compare extracted data with the original document</p>
      </div>
      
      <div className="grid grid-cols-1 lg:grid-cols-7 gap-6">
        {/* Left sidebar - File and Result selection */}
        <div className="lg:col-span-2">
          <div className="border rounded-lg overflow-hidden">
            <div className="bg-black text-white p-2 text-sm font-medium">
              Processed Files
            </div>
            <ScrollArea className="h-[600px]">
              <div className="p-2">
                {uniqueFiles.map((fileInfo) => (
                  <div key={fileInfo.fileId} className="mb-4">
                    <div 
                      className="text-sm font-medium p-2 bg-muted cursor-pointer hover:bg-gray-200"
                      onClick={() => handleFileSelect(fileInfo.fileId, fileInfo.fileName)}
                    >
                      {fileInfo.fileName}
                    </div>
                    
                    {resultsByFile[fileInfo.fileId].map(result => {
                      const isSelected = selectedResult?.id === result.id;
                      
                      return (
                        <div 
                          key={result.id}
                          className={`flex items-center justify-between p-2 text-sm rounded-md cursor-pointer ${
                            isSelected ? "bg-yellow-50 border border-yellow-400 text-black" : "hover:bg-muted"
                          }`}
                          onClick={() => handleResultSelect(result)}
                        >
                          <div className="truncate pr-2">{result.promptName}</div>
                        </div>
                      );
                    })}
                  </div>
                ))}
              </div>
            </ScrollArea>
          </div>
        </div>
        
        {/* Center - PDF Viewer */}
        <div className="lg:col-span-2">
          <div className="border rounded-lg overflow-hidden h-full flex flex-col">
            <div className="bg-black text-white p-2 text-sm font-medium">
              Document Preview
            </div>
            <div className="flex-1 flex flex-col bg-white">
              <PDFViewer 
                file={selectedFile}
                className="flex-1"
              />
              
              {/* Retry button */}
              <div className="flex justify-center p-2 bg-white border-t">
                <Button 
                  variant="outline" 
                  size="sm" 
                  className="flex items-center gap-2"
                  onClick={handleRetryLoading}
                >
                  <RefreshCw className="h-4 w-4" />
                  Refresh PDF
                </Button>
              </div>
            </div>
          </div>
        </div>
        
        {/* Right - Extracted Data */}
        <div className="lg:col-span-3">
          <div className="border rounded-lg overflow-hidden h-full flex flex-col">
            <div className="bg-black text-white p-3 flex justify-between items-center">
              <div>
                <div className="font-medium">{selectedResult?.promptName}</div>
                <div className="text-xs text-gray-400">From: {selectedResult?.fileName}</div>
              </div>
            </div>
            
            <div className="p-3 flex-1">
              {selectedResult && selectedResult.status === 'success' && selectedResult.data ? (
                <ScrollArea className="h-[550px]">
                  <Table>
                    <TableHeader className="bg-muted sticky top-0">
                      <TableRow>
                        <TableHead className="font-semibold">Category</TableHead>
                        <TableHead className="font-semibold">Stage</TableHead>
                        <TableHead className="font-semibold">Field</TableHead>
                        <TableHead className="font-semibold">Value</TableHead>
                      </TableRow>
                    </TableHeader>
                    <TableBody>
                      {selectedResult.data.map((item, index) => {
                        if (!item) return null;
                        
                        return (
                          <TableRow key={index}>
                            <TableCell>
                              {item.Category === 'ECL By Stage' ? 'ECL' : item.Category}
                            </TableCell>
                            <TableCell>{item.Stage}</TableCell>
                            <TableCell>{item.Field}</TableCell>
                            <TableCell className="font-medium">{item.Value}</TableCell>
                          </TableRow>
                        );
                      })}
                    </TableBody>
                  </Table>
                </ScrollArea>
              ) : (
                <div className="flex flex-col items-center justify-center h-[550px]">
                  <div className="text-muted-foreground">
                    Select a result to view extracted data
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default SideBySideTab;

\`\`\`

# dataextract-ey-main\src\components\dashboard\TabNavigation.tsx

\`\`\`tsx

import { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Upload, FileText, FileSpreadsheet, Download, LayoutPanelLeft } from 'lucide-react';
import { ThemeToggle } from '@/components/ThemeToggle';

interface TabNavigationProps {
  activeTab: string;
  setActiveTab: (value: string) => void;
}

const TabNavigation = ({ activeTab, setActiveTab }: TabNavigationProps) => {
  return (
    <div className="border-b dark:border-gray-700">
      <div className="container mx-auto px-4 flex items-center justify-between">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
          <TabsList className="grid grid-cols-5 w-full max-w-2xl mx-auto my-4">
            <TabsTrigger 
              value="upload" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <Upload className="h-4 w-4 mr-2" />
              Upload
            </TabsTrigger>
            <TabsTrigger 
              value="prompts" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <FileText className="h-4 w-4 mr-2" />
              Prompts
            </TabsTrigger>
            <TabsTrigger 
              value="results" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <FileSpreadsheet className="h-4 w-4 mr-2" />
              Results
            </TabsTrigger>
            <TabsTrigger 
              value="combined" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <Download className="h-4 w-4 mr-2" />
              Combined
            </TabsTrigger>
            <TabsTrigger 
              value="sidebyside" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <LayoutPanelLeft className="h-4 w-4 mr-2" />
              Side by Side
            </TabsTrigger>
          </TabsList>
        </Tabs>
        <ThemeToggle className="mr-4" />
      </div>
    </div>
  );
};

export default TabNavigation;

\`\`\`

# dataextract-ey-main\src\components\dashboard\UploadTab.tsx

\`\`\`tsx

import { Button } from '@/components/ui/button';
import FileUploader from '@/components/FileUploader';
import { UploadedFile } from '@/lib/types';
import { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { FileText, Eye, EyeOff } from 'lucide-react';
import PDFViewer from '@/components/PDFViewer';
import { motion } from 'framer-motion';

interface UploadTabProps {
  onFilesUploaded: (files: UploadedFile[]) => void;
  uploadedFiles: UploadedFile[];
  goToNextTab: () => void;
}

const UploadTab = ({ onFilesUploaded, uploadedFiles, goToNextTab }: UploadTabProps) => {
  const [selectedFile, setSelectedFile] = useState<UploadedFile | null>(null);
  const [showPreview, setShowPreview] = useState<boolean>(true);
  const [pdfFile, setPdfFile] = useState<File | null>(null);
  const [actualFiles, setActualFiles] = useState<Map<string, File>>(new Map());

  // Select the first file for preview when files are uploaded
  useEffect(() => {
    if (uploadedFiles.length > 0) {
      // Always select the newest file when a new file is uploaded
      const newestFile = uploadedFiles[uploadedFiles.length - 1];
      setSelectedFile(newestFile);
      const file = actualFiles.get(newestFile.id);
      if (file) {
        setPdfFile(file);
      }
    } else {
      setSelectedFile(null);
      setPdfFile(null);
    }
  }, [uploadedFiles, actualFiles]);

  // Handle files uploaded
  const handleFilesUploaded = (files: UploadedFile[], newActualFiles: Map<string, File>) => {
    // Pass files to parent
    onFilesUploaded(files);
    
    // Store actual File objects
    setActualFiles(newActualFiles);
    
    // If we have files, select the latest one for immediate preview
    if (files.length > 0) {
      const latestFile = files[files.length - 1];
      setSelectedFile(latestFile);
      
      // Set the PDF file for immediate preview
      const fileForPreview = newActualFiles.get(latestFile.id);
      if (fileForPreview) {
        setPdfFile(fileForPreview);
        setShowPreview(true); // Ensure preview is visible
      }
    }
  };

  // Toggle PDF preview visibility
  const togglePreview = () => {
    setShowPreview(!showPreview);
  };

  // Handle file selection
  const handleFileSelection = (file: UploadedFile) => {
    setSelectedFile(file);
    const actualFile = actualFiles.get(file.id);
    if (actualFile) {
      setPdfFile(actualFile);
    }
  };

  return (
    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div className="lg:col-span-1 space-y-6">
        <FileUploader 
          onFilesUploaded={handleFilesUploaded}
          acceptedFileTypes={['.pdf']}
        />
        
        {uploadedFiles.length > 0 && (
          <motion.div 
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ duration: 0.3 }}
            className="border rounded-md"
          >
            <div className="bg-muted p-3 font-medium flex justify-between items-center">
              <div>Uploaded Files ({uploadedFiles.length}/10)</div>
              <Button 
                variant="ghost" 
                size="sm" 
                className="h-8 px-2 text-muted-foreground"
                onClick={togglePreview}
              >
                {showPreview ? <EyeOff className="h-4 w-4 mr-1" /> : <Eye className="h-4 w-4 mr-1" />}
                {showPreview ? "Hide Preview" : "Show Preview"}
              </Button>
            </div>
            <div className="divide-y max-h-[300px] overflow-y-auto">
              {uploadedFiles.map((file) => (
                <motion.div
                  key={file.id}
                  className={`p-3 flex items-center justify-between cursor-pointer hover:bg-muted/50 transition-colors ${selectedFile?.id === file.id ? 'bg-yellow-50 border-l-2 border-yellow-400' : ''}`}
                  onClick={() => handleFileSelection(file)}
                >
                  <div className="flex items-center">
                    <FileText className="h-4 w-4 text-muted-foreground mr-2" />
                    <span className="text-sm font-medium">{file.name}</span>
                  </div>
                  <div className="text-xs text-muted-foreground">
                    {Math.round(file.size / 1024).toLocaleString()} KB
                  </div>
                </motion.div>
              ))}
            </div>
          </motion.div>
        )}
      </div>

      {/* PDF Preview Section - larger size for A4 display */}
      {uploadedFiles.length > 0 && selectedFile && showPreview && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ duration: 0.3 }}
          className="lg:col-span-2"
        >
          <Card className="h-full">
            <CardHeader className="pb-3">
              <CardTitle className="text-base flex items-center justify-between">
                <div className="flex items-center">
                  <FileText className="h-4 w-4 mr-2" />
                  PDF Preview
                </div>
                <div className="text-sm font-normal">
                  {selectedFile.name}
                </div>
              </CardTitle>
            </CardHeader>
            <CardContent className="p-0">
              <div className="bg-muted/30 h-[750px] flex flex-col">
                <PDFViewer file={pdfFile} className="h-full" />
              </div>
            </CardContent>
          </Card>
        </motion.div>
      )}

      <div className="flex justify-end col-span-full">
        <motion.div>
          <Button 
            onClick={goToNextTab} 
            disabled={uploadedFiles.length === 0}
            className="bg-yellow-400 hover:bg-yellow-500 text-black"
          >
            Next: Select Prompts
          </Button>
        </motion.div>
      </div>
    </div>
  );
};

export default UploadTab;

\`\`\`

# dataextract-ey-main\src\components\FileUploader.tsx

\`\`\`tsx

import { useState, useRef, useCallback } from 'react';
import { Button } from '@/components/ui/button';
import { UploadedFile } from '@/lib/types';
import { Upload, FileText, X, Check, Loader } from 'lucide-react';
import { Progress } from '@/components/ui/progress';
import { cn } from '@/lib/utils';
import { useToast } from '@/hooks/use-toast';

interface FileUploaderProps {
  onFilesUploaded: (files: UploadedFile[], actualFiles: Map<string, File>) => void;
  acceptedFileTypes?: string[];
  maxFiles?: number;
}

const FileUploader = ({ 
  onFilesUploaded, 
  acceptedFileTypes = ['.pdf'], 
  maxFiles = 10 
}: FileUploaderProps) => {
  const [files, setFiles] = useState<UploadedFile[]>([]);
  const [isDragging, setIsDragging] = useState(false);
  const fileInputRef = useRef<HTMLInputElement>(null);
  const [actualFiles, setActualFiles] = useState<Map<string, File>>(new Map());
  const { toast } = useToast();

  const handleFileSelect = useCallback((selectedFiles: FileList | null) => {
    if (!selectedFiles || selectedFiles.length === 0) return;

    // Check if adding these files would exceed the maximum
    if (files.length + selectedFiles.length > maxFiles) {
      toast({
        title: "Too many files",
        description: `You can upload a maximum of ${maxFiles} files.`,
        variant: "destructive",
      });
      return;
    }

    const newFiles: UploadedFile[] = [];
    const newActualFiles = new Map(actualFiles);
    
    Array.from(selectedFiles).forEach(file => {
      // Check file type
      const fileExtension = `.${file.name.split('.').pop()?.toLowerCase()}`;
      if (!acceptedFileTypes.includes(fileExtension) && !acceptedFileTypes.includes('*')) {
        toast({
          title: "Invalid file type",
          description: `${file.name} is not a supported file type. Please upload ${acceptedFileTypes.join(", ")} files.`,
          variant: "destructive",
        });
        return;
      }
      
      // File is valid, add it to our list
      const fileId = `file-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
      const newFile: UploadedFile = {
        id: fileId,
        name: file.name,
        size: file.size,
        type: file.type,
        lastModified: file.lastModified,
        status: 'success' as const,  // Mark as success immediately for simplicity
        progress: 100,  // Set to 100% immediately
      };
      
      // Store the actual File object in our Map
      newActualFiles.set(fileId, file);
      newFiles.push(newFile);
    });
    
    if (newFiles.length > 0) {
      // Update state in a single batch
      const updatedFiles = [...files, ...newFiles];
      setFiles(updatedFiles);
      setActualFiles(newActualFiles);
      
      // Notify parent component after our state is updated
      setTimeout(() => {
        onFilesUploaded(updatedFiles, newActualFiles);
      }, 0);
    }
  }, [files, actualFiles, maxFiles, acceptedFileTypes, onFilesUploaded, toast]);

  const removeFile = useCallback((id: string) => {
    const updatedFiles = files.filter(file => file.id !== id);
    setFiles(updatedFiles);
    
    // Also remove the actual File object
    const newActualFiles = new Map(actualFiles);
    newActualFiles.delete(id);
    setActualFiles(newActualFiles);
    
    onFilesUploaded(updatedFiles, newActualFiles);
  }, [files, actualFiles, onFilesUploaded]);

  const formatFileSize = (sizeInBytes: number) => {
    if (sizeInBytes < 1024) return `${sizeInBytes} B`;
    else if (sizeInBytes < 1048576) return `${(sizeInBytes / 1024).toFixed(1)} KB`;
    else return `${(sizeInBytes / 1048576).toFixed(1)} MB`;
  };

  const handleDragOver = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(true);
  };

  const handleDragLeave = () => {
    setIsDragging(false);
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(false);
    handleFileSelect(e.dataTransfer.files);
  };

  return (
    <div className="w-full space-y-4">
      {/* File upload area */}
      <div
        className={cn(
          "border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors",
          isDragging ? "border-yellow-400 bg-yellow-50" : "border-muted-foreground/20",
          files.length >= maxFiles && "opacity-50 cursor-not-allowed"
        )}
        onDragOver={handleDragOver}
        onDragLeave={handleDragLeave}
        onDrop={handleDrop}
        onClick={() => files.length < maxFiles && fileInputRef.current?.click()}
      >
        <input
          type="file"
          ref={fileInputRef}
          className="hidden"
          accept={acceptedFileTypes.join(',')}
          multiple
          onChange={(e) => handleFileSelect(e.target.files)}
          disabled={files.length >= maxFiles}
        />
        <div className="flex flex-col items-center justify-center gap-2">
          <Upload className="h-12 w-12 text-muted-foreground" />
          <h3 className="text-lg font-medium">Upload PDF Financial Reports</h3>
          <p className="text-sm text-muted-foreground max-w-md mx-auto">
            Drag and drop files here, or click to browse. We accept PDF files with financial data.
          </p>
          <Button 
            variant="outline"
            className="mt-2"
            disabled={files.length >= maxFiles}
          >
            Select Files
          </Button>
        </div>
      </div>

      {/* File list */}
      {files.length > 0 && (
        <div className="mt-6">
          <h3 className="font-medium mb-2 text-sm">Uploaded Files ({files.length}/{maxFiles})</h3>
          <div className="space-y-2">
            {files.map(file => (
              <div 
                key={file.id} 
                className="flex items-center p-3 bg-muted/30 rounded-md border"
              >
                <FileText className="h-5 w-5 text-muted-foreground mr-3" />
                <div className="flex-1 min-w-0">
                  <div className="flex justify-between">
                    <p className="text-sm font-medium truncate">{file.name}</p>
                    <span className="text-xs text-muted-foreground">{formatFileSize(file.size)}</span>
                  </div>
                  {file.status === 'pending' && (
                    <Progress value={file.progress} className="h-1 mt-1" />
                  )}
                </div>
                <div className="ml-4 flex items-center">
                  {file.status === 'pending' && <Loader className="h-4 w-4 text-muted-foreground animate-spin" />}
                  {file.status === 'success' && <Check className="h-4 w-4 text-green-500" />}
                  {file.status === 'error' && <X className="h-4 w-4 text-destructive" />}
                  <button 
                    onClick={(e) => {
                      e.stopPropagation();
                      removeFile(file.id);
                    }}
                    className="ml-2 text-muted-foreground hover:text-destructive transition-colors"
                  >
                    <X className="h-4 w-4" />
                  </button>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
};

export default FileUploader;

\`\`\`

# dataextract-ey-main\src\components\IntroScreen.tsx

\`\`\`tsx
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { useNavigate } from 'react-router-dom';
import { Progress } from '@/components/ui/progress';
import { motion } from 'framer-motion';

const IntroScreen = () => {
  const navigate = useNavigate();
  const [loading, setLoading] = useState(true);
  const [loadingProgress, setLoadingProgress] = useState(0);
  
  useEffect(() => {
    // Simulate progressive loading
    const totalTime = 2000; // 2 seconds
    const intervalTime = 50; // update every 50ms
    const steps = totalTime / intervalTime;
    let currentStep = 0;
    
    const timer = setInterval(() => {
      currentStep += 1;
      const newProgress = Math.min(100, Math.floor((currentStep / steps) * 100));
      setLoadingProgress(newProgress);
      
      if (newProgress >= 100) {
        clearInterval(timer);
        setTimeout(() => setLoading(false), 200);
      }
    }, intervalTime);
    
    return () => clearInterval(timer);
  }, []);

  const handleEnterApp = () => {
    navigate('/select-bank');
  };

  // Animation variants for the logo and letters
  const containerVariants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: {
        delayChildren: 0.3,
        staggerChildren: 0.1
      }
    }
  };

  const letterVariants = {
    hidden: { y: 20, opacity: 0 },
    visible: {
      y: 0,
      opacity: 1,
      transition: {
        type: "spring",
        damping: 12,
        stiffness: 100
      }
    }
  };

  const floatVariants = {
    animate: {
      y: [0, -10, 0],
      transition: {
        duration: 2,
        repeat: Infinity,
        repeatType: "reverse" as const,
        ease: "easeInOut"
      }
    }
  };

  const logoVariants = {
    hidden: { scale: 0.8, opacity: 0 },
    visible: {
      scale: 1,
      opacity: 1,
      transition: {
        type: "spring",
        damping: 12,
        stiffness: 100
      }
    }
  };

  // Combined animation for the logo that includes floating effect
  const logoAnimation = {
    scale: 1,
    opacity: 1,
    y: [0, -8, 0]
  };
  
  // Combined transition for the logo
  const logoTransition = {
    scale: {
      type: "spring",
      damping: 12,
      stiffness: 100
    },
    opacity: {
      type: "spring",
      damping: 12,
      stiffness: 100
    },
    y: {
      duration: 3,
      repeat: Infinity,
      repeatType: "reverse",
      ease: "easeInOut"
    }
  };
  
  const buttonVariants = {
    initial: { scale: 1 },
    hover: { 
      scale: 1.05,
      transition: { type: "spring", stiffness: 400, damping: 10 }
    },
    tap: { scale: 0.95 }
  };

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-ey-black text-white">
      <div className="w-full max-w-md px-6 py-12 text-center">
        <motion.div 
          className="mb-8"
          initial="hidden"
          animate="visible"
          variants={containerVariants}
        >
          <motion.div 
            className="flex justify-center mb-6"
          >
            <motion.div 
              className="h-16 w-16 bg-ey-yellow rounded-md"
              variants={logoVariants}
              initial="hidden"
              animate={logoAnimation}
              transition={logoTransition}
              whileHover={{ scale: 1.05 }}
            ></motion.div>
          </motion.div>
          
          <motion.h1 
            className="text-4xl font-bold mb-2 flex justify-center"
            variants={containerVariants}
          >
            {Array.from("AiDEx").map((letter, index) => (
              <motion.span
                key={index}
                className="inline-block"
                variants={letterVariants}
                custom={index}
                whileHover={floatVariants.animate}
              >
                {letter}
              </motion.span>
            ))}
          </motion.h1>
          
          <motion.p 
            className="text-ey-gray-400"
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.8 }}
          >
            AI powered Data Extraction
          </motion.p>
          
          <motion.p 
            className="text-ey-gray-500 text-sm mt-1"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 1 }}
          >
            Supported by EYQ
          </motion.p>
        </motion.div>
        
        {loading ? (
          <motion.div 
            className="space-y-3"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.5 }}
          >
            <Progress 
              value={loadingProgress} 
              className="h-2" 
              indicatorClassName="bg-ey-yellow" 
            />
            <p className="text-sm text-ey-gray-400 animate-pulse">
              Loading application... {loadingProgress}%
            </p>
          </motion.div>
        ) : (
          <motion.div
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2 }}
          >
            <motion.button
              onClick={handleEnterApp}
              className="w-full bg-ey-yellow hover:bg-ey-yellow/90 text-ey-black font-medium py-2 px-4 rounded"
              variants={buttonVariants}
              initial="initial"
              whileHover="hover"
              whileTap="tap"
            >
              Enter Application
            </motion.button>
          </motion.div>
        )}
        
        <motion.div 
          className="mt-12 text-xs text-ey-gray-500"
          initial={{ opacity: 0 }}
          animate={{ opacity: 0.7 }}
          transition={{ delay: 1.2 }}
        >
          <p>© {new Date().getFullYear()} EY | A better working world</p>
        </motion.div>
      </div>
    </div>
  );
};

export default IntroScreen;

\`\`\`

# dataextract-ey-main\src\components\PDFViewer.tsx

\`\`\`tsx

import { useState, useEffect, useRef } from 'react';
import * as pdfjs from 'pdfjs-dist';
import { Button } from '@/components/ui/button';
import { ChevronLeft, ChevronRight, Loader, RefreshCw } from 'lucide-react';
import { ScrollArea } from '@/components/ui/scroll-area';

// Fix worker import
import { GlobalWorkerOptions } from 'pdfjs-dist';

// Set worker source directly
GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.min.js`;

interface PDFViewerProps {
  file: File | null;
  className?: string;
}

const PDFViewer = ({ file, className = '' }: PDFViewerProps) => {
  const [pdfDoc, setPdfDoc] = useState<pdfjs.PDFDocumentProxy | null>(null);
  const [pageNum, setPageNum] = useState(1);
  const [totalPages, setTotalPages] = useState(0);
  const [isLoading, setIsLoading] = useState(false);
  const [renderError, setRenderError] = useState<string | null>(null);
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const [retryCount, setRetryCount] = useState(0); // Track retry attempts
  const containerRef = useRef<HTMLDivElement>(null);

  // Load the PDF when the file changes or when retryCount changes
  useEffect(() => {
    if (!file) {
      setPdfDoc(null);
      return;
    }

    let isMounted = true;
    
    // Reset states
    setIsLoading(true);
    setRenderError(null);
    
    console.log("Starting to load PDF file:", file.name);
    
    // Convert file to array buffer
    const fileReader = new FileReader();
    
    fileReader.onload = async (event) => {
      if (!isMounted) return;
      
      try {
        const arrayBuffer = event.target?.result;
        
        if (!arrayBuffer) {
          setRenderError("Failed to read file");
          setIsLoading(false);
          return;
        }
        
        // Load the PDF document
        const typedArray = new Uint8Array(arrayBuffer as ArrayBuffer);
        
        console.log("Creating PDF loading task");
        const loadingTask = pdfjs.getDocument(typedArray);
        
        loadingTask.promise
          .then(pdf => {
            if (!isMounted) return;
            
            console.log("PDF loaded successfully with", pdf.numPages, "pages");
            setPdfDoc(pdf);
            setTotalPages(pdf.numPages);
            setPageNum(1); // Reset to first page when loading new PDF
            setIsLoading(false);
          })
          .catch(error => {
            if (!isMounted) return;
            
            console.error('Error loading PDF:', error);
            setRenderError(`Error loading PDF: ${error.message}`);
            setIsLoading(false);
          });
      } catch (error: any) {
        if (!isMounted) return;
        
        console.error('Error processing PDF:', error);
        setRenderError(`Error processing PDF: ${error.message}`);
        setIsLoading(false);
      }
    };
    
    fileReader.onerror = () => {
      if (!isMounted) return;
      
      setRenderError("Error reading file");
      setIsLoading(false);
    };
    
    // Start reading the file
    fileReader.readAsArrayBuffer(file);
    
    return () => {
      isMounted = false;
      if (pdfDoc) {
        try {
          pdfDoc.destroy().catch(e => console.error("Error destroying PDF:", e));
        } catch (error) {
          console.error("Error destroying previous PDF:", error);
        }
      }
    };
  }, [file, retryCount]);

  // Render the PDF page
  useEffect(() => {
    if (!pdfDoc || !canvasRef.current) return;

    let isMounted = true;
    
    const renderPage = async () => {
      if (!isMounted) return;
      
      try {
        // Get the page
        console.log("Getting page", pageNum);
        const page = await pdfDoc.getPage(pageNum);
        
        if (!isMounted || !canvasRef.current) return;
        
        const canvas = canvasRef.current;
        const context = canvas.getContext('2d');
        
        if (!context) {
          setRenderError("Could not get canvas context");
          return;
        }
        
        // Calculate scale to fit width
        const containerWidth = containerRef.current?.clientWidth || canvas.parentElement?.clientWidth || 800;
        const viewport = page.getViewport({ scale: 1.0 });
        const scale = Math.min(containerWidth / viewport.width, 1.0); // Limit scale to 1.0 for better quality
        const scaledViewport = page.getViewport({ scale });

        // Set canvas dimensions
        canvas.height = scaledViewport.height;
        canvas.width = scaledViewport.width;
        
        // Improve rendering quality
        context.imageSmoothingEnabled = true;
        context.imageSmoothingQuality = 'high';
        
        // Set background color
        context.fillStyle = '#FFFFFF';
        context.fillRect(0, 0, canvas.width, canvas.height);
        
        // Render the page
        console.log("Rendering page", pageNum, "of PDF");
        const renderContext = {
          canvasContext: context,
          viewport: scaledViewport,
          background: 'rgba(255,255,255,1)',
        };
        
        await page.render(renderContext).promise;
        
        // Add subtle page border
        context.strokeStyle = '#e2e8f0';
        context.lineWidth = 1;
        context.strokeRect(0, 0, canvas.width, canvas.height);
      } catch (error: any) {
        if (isMounted) {
          console.error('Error rendering page:', error);
          setRenderError(`Error rendering page: ${error.message}`);
        }
      }
    };

    renderPage();
    
    return () => {
      isMounted = false;
    };
  }, [pdfDoc, pageNum]);

  // Effect to adjust canvas size when window resizes
  useEffect(() => {
    const handleResize = () => {
      // Re-render the current page to adjust for new container width
      if (pdfDoc) {
        // Simply update pageNum state to trigger re-render effect
        setPageNum(prevPage => prevPage);
      }
    };

    window.addEventListener('resize', handleResize);
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, [pdfDoc]);

  const goToPreviousPage = () => {
    if (pageNum <= 1) return;
    setPageNum(pageNum - 1);
  };

  const goToNextPage = () => {
    if (pageNum >= totalPages) return;
    setPageNum(pageNum + 1);
  };

  // Create a simple PDF retry button
  const handleRetry = () => {
    if (!file) return;
    setRetryCount(retryCount + 1); // Increment retry count to trigger useEffect
    setIsLoading(true);
    setRenderError(null);
  };

  return (
    <div className={`flex flex-col h-full ${className}`}>
      <ScrollArea className="flex-1 h-full bg-gray-50">
        <div ref={containerRef} className="flex justify-center p-4">
          {isLoading ? (
            <div className="flex flex-col items-center justify-center h-64 w-full">
              <Loader className="h-8 w-8 animate-spin text-yellow-400 mb-4" />
              <div className="text-muted-foreground">
                Loading PDF...
              </div>
            </div>
          ) : renderError ? (
            <div className="flex flex-col items-center justify-center h-64 w-full">
              <div className="text-red-500 mb-4">{renderError}</div>
              <Button 
                variant="outline" 
                size="sm"
                onClick={handleRetry}
                className="flex items-center gap-2"
              >
                <RefreshCw className="h-4 w-4" />
                Retry Loading PDF
              </Button>
            </div>
          ) : !pdfDoc ? (
            <div className="flex items-center justify-center h-64 w-full">
              <div className="text-center">
                <div className="text-muted-foreground mb-2">No PDF selected</div>
                <div className="text-xs text-muted-foreground">Upload a PDF document to view it here</div>
              </div>
            </div>
          ) : (
            <div className="relative shadow-lg bg-white rounded-lg p-1">
              <canvas ref={canvasRef} className="relative z-10 rounded-lg" />
            </div>
          )}
        </div>
      </ScrollArea>

      {pdfDoc && (
        <div className="p-2 border-t bg-white flex justify-between items-center">
          <div className="text-sm text-gray-600 truncate max-w-[150px]">
            {file?.name || "Document"}
          </div>
          <div className="flex items-center space-x-2">
            <Button
              variant="outline"
              size="icon"
              className="h-8 w-8"
              disabled={pageNum === 1}
              onClick={goToPreviousPage}
            >
              <ChevronLeft className="h-4 w-4" />
            </Button>
            <span className="text-sm font-medium min-w-[50px] text-center">
              {pageNum} / {totalPages}
            </span>
            <Button
              variant="outline"
              size="icon"
              className="h-8 w-8"
              disabled={pageNum === totalPages}
              onClick={goToNextPage}
            >
              <ChevronRight className="h-4 w-4" />
            </Button>
          </div>
        </div>
      )}
    </div>
  );
};

export default PDFViewer;

\`\`\`

# dataextract-ey-main\src\components\ProcessingStatus.tsx

\`\`\`tsx

import { Card, CardContent } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { cn } from "@/lib/utils";
import { Loader } from "lucide-react";

interface ProcessingStatusProps {
  isProcessing: boolean;
  progress: number;
  currentStep: string;
  totalFiles?: number;
  processedFiles?: number;
  className?: string;
}

const ProcessingStatus = ({
  isProcessing,
  progress,
  currentStep,
  totalFiles = 1,
  processedFiles = 0,
  className
}: ProcessingStatusProps) => {
  if (!isProcessing) return null;

  return (
    <Card className={cn("border-yellow-400 bg-yellow-50", className)}>
      <CardContent className="p-4 space-y-3">
        <div className="flex items-center justify-between">
          <div>
            <div className="flex items-center text-sm">
              <span className="font-medium text-black">Processing</span>
              <span className="ml-2 text-black/70">{processedFiles}/{totalFiles} files</span>
            </div>
            <p className="text-xs text-black/70">Extracting financial data from reports</p>
          </div>
          <Loader className="h-4 w-4 text-yellow-500 animate-spin" />
        </div>
        
        <div className="space-y-2">
          <div className="text-sm font-medium text-black">{currentStep}</div>
          <div className="relative">
            <Progress 
              value={progress} 
              className="h-2" 
              indicatorClassName="bg-yellow-400" 
            />
            <div className="absolute right-0 top-0 -mt-5 text-xs font-medium text-black">
              {progress.toFixed(1)}%
            </div>
          </div>
          <div className="text-xs text-black/70">
            Processing financial data, please wait...
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

export default ProcessingStatus;

\`\`\`

# dataextract-ey-main\src\components\PromptDescriptions.tsx

\`\`\`tsx

import { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from "@/components/ui/accordion";
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { Building, FileText, BookOpen, Activity, BarChart4, Scale } from "lucide-react";
import { useEffect, useState } from "react";

interface Prompt {
  bank: string;
  description: string;
}

interface PromptCategory {
  id: string;
  title: string;
  icon: JSX.Element;
  description: string;
  prompts: Prompt[];
}

const PromptDescriptions = () => {
  const [selectedBank, setSelectedBank] = useState<string>('barclays');
  const [selectedBanks, setSelectedBanks] = useState<string[]>([]);
  const [enableMultiBanks, setEnableMultiBanks] = useState<boolean>(false);
  
  // Fetch bank selection from session storage
  useEffect(() => {
    const bank = sessionStorage.getItem('selectedBank') || 'barclays';
    const multiBank = sessionStorage.getItem('enableMultiBanks') === 'true';
    const storedBanks = sessionStorage.getItem('selectedBanks');
    const parsedBanks = storedBanks ? JSON.parse(storedBanks) : [bank];
    
    setSelectedBank(bank);
    setSelectedBanks(parsedBanks);
    setEnableMultiBanks(multiBank);
  }, []);
  
  const promptCategories: PromptCategory[] = [
    {
      id: "ecl",
      title: "ECL By Stage",
      icon: <FileText className="h-5 w-5 text-yellow-500" />,
      description: "Extract detailed Expected Credit Loss (ECL) data broken down by stages",
      prompts: [
        { bank: "Barclays", description: "Extract ECL values, gross exposures and coverage ratios by product category and stage." },
        { bank: "Santander", description: "Extract ECL provisions, gross balances and coverage ratios for all business categories." },
        { bank: "VM", description: "Extract Stage 1, 2, and 3 ECL, gross exposure, and coverage ratio information." },
        { bank: "HSBC", description: "Extract ECL values across stages for all loan portfolios." },
        { bank: "Lloyds", description: "Extract ECL values and exposure by stage for retail and commercial portfolios." },
        { bank: "NatWest", description: "Extract ECL metrics by stage across personal and commercial banking." },
        { bank: "Standard", description: "Extract ECL provisions across wholesale and retail banking segments." }
      ]
    },
    {
      id: "adjustments",
      title: "Management Adjustments",
      icon: <Scale className="h-5 w-5 text-yellow-500" />,
      description: "Extract adjustments made by management to ECL models",
      prompts: [
        { bank: "Barclays", description: "Extract economic uncertainty adjustments, other adjustments, and total management adjustments." },
        { bank: "Santander", description: "Extract all information related to management overlays or judgemental adjustments." },
        { bank: "HSBC", description: "Extract management adjustments related to economic uncertainty." },
        { bank: "Lloyds", description: "Extract post-model adjustments and management overlays." },
        { bank: "NatWest", description: "Extract in-model and post-model management adjustments." },
        { bank: "Standard", description: "Extract management overlay amounts by portfolio segment." }
      ]
    },
    {
      id: "scenarios",
      title: "Scenario Weights",
      icon: <BarChart4 className="h-5 w-5 text-yellow-500" />,
      description: "Extract scenario probability weights used in IFRS 9 ECL calculations",
      prompts: [
        { bank: "Barclays", description: "Extract probability weights assigned to Upside, Baseline, and Downside scenarios." },
        { bank: "Santander", description: "Extract forward-looking economic scenarios used in IFRS 9 ECL framework." },
        { bank: "HSBC", description: "Extract scenario weightings for Central, Upside and Downside scenarios." },
        { bank: "Lloyds", description: "Extract Base, Upside, and Downside scenario probability weights." },
        { bank: "NatWest", description: "Extract Base, Upside, and Severe downside scenario weights." },
        { bank: "Standard", description: "Extract probability-weighted scenario assumptions." }
      ]
    },
    {
      id: "macro",
      title: "Macro Variables",
      icon: <Activity className="h-5 w-5 text-yellow-500" />,
      description: "Extract macroeconomic variables used in IFRS 9 ECL calculations",
      prompts: [
        { bank: "Barclays", description: "Extract GDP, unemployment, HPI, and bank rate variables for forecast years." },
        { bank: "Santander", description: "Extract macroeconomic variables used in IFRS 9 base case scenario." },
        { bank: "HSBC", description: "Extract key economic inputs for all modeled scenarios." },
        { bank: "Lloyds", description: "Extract UK GDP, unemployment and HPI forecast assumptions." },
        { bank: "NatWest", description: "Extract macroeconomic variables and their five-year outlook." },
        { bank: "Standard", description: "Extract economic factor assumptions across major markets." }
      ]
    },
    {
      id: "other",
      title: "Other Metrics",
      icon: <BookOpen className="h-5 w-5 text-yellow-500" />,
      description: "Extract various credit quality metrics, staging criteria, and sensitivity analyses",
      prompts: [
        { bank: "Barclays", description: "Extract credit quality metrics, staging criteria, and ECL sensitivity analysis." },
        { bank: "Santander", description: "Extract credit and financial metrics by business segment." },
        { bank: "HSBC", description: "Extract staging criteria and significant increase in credit risk (SICR) thresholds." },
        { bank: "Lloyds", description: "Extract credit quality metrics and sensitivity analysis results." },
        { bank: "NatWest", description: "Extract credit risk metrics and SICR thresholds by product type." },
        { bank: "Standard", description: "Extract credit quality metrics by geographic region." }
      ]
    }
  ];

  // Filter prompts based on selected bank(s) and multi-bank setting
  const filterPrompts = (prompts: Prompt[]) => {
    if (enableMultiBanks) {
      // In multi-bank mode, filter by selected banks (case-insensitive)
      return prompts.filter(prompt => 
        selectedBanks.some(bank => 
          prompt.bank.toLowerCase() === bank.toLowerCase()
        )
      );
    }
    
    // In single bank mode, filter by selected bank (case-insensitive)
    return prompts.filter(prompt => 
      prompt.bank.toLowerCase() === selectedBank.toLowerCase()
    );
  };

  // Format selected bank names for display
  const formatBankNames = () => {
    if (!enableMultiBanks) {
      return selectedBank.charAt(0).toUpperCase() + selectedBank.slice(1);
    }

    // Convert bank IDs to display names
    const bankDisplayNames = selectedBanks.map(bankId => {
      const capitalizedBank = bankId.charAt(0).toUpperCase() + bankId.slice(1);
      // Handle special cases
      if (bankId.toLowerCase() === 'natwest') return 'NatWest Group';
      if (bankId.toLowerCase() === 'lloyds') return 'Lloyds Banking Group';
      if (bankId.toLowerCase() === 'standard') return 'Standard Chartered';
      return capitalizedBank;
    });

    if (bankDisplayNames.length === 0) return 'no banks';
    if (bankDisplayNames.length === 1) return bankDisplayNames[0];
    if (bankDisplayNames.length === 2) return `${bankDisplayNames[0]} and ${bankDisplayNames[1]}`;
    
    const lastBank = bankDisplayNames.pop();
    return `${bankDisplayNames.join(', ')}, and ${lastBank}`;
  };

  return (
    <Card className="shadow-lg border border-gray-200 hover:shadow-xl transition-shadow dark:border-gray-700">
      <CardHeader className="bg-gradient-to-r from-gray-100 to-white dark:from-gray-800 dark:to-gray-700">
        <CardTitle className="text-lg flex items-center">
          <Building className="mr-2 h-5 w-5 text-yellow-500" />
          Available Extraction Prompts
        </CardTitle>
        <CardDescription className="dark:text-gray-300">
          {enableMultiBanks 
            ? `The system can extract the following types of IFRS9 data from ${selectedBanks.length} bank report${selectedBanks.length !== 1 ? 's' : ''}`
            : `The system can extract the following types of IFRS9 data from ${formatBankNames()} reports`
          }
        </CardDescription>
      </CardHeader>
      <CardContent className="pt-4">
        <Accordion type="single" collapsible className="w-full">
          {promptCategories.map((category) => {
            const filteredPrompts = filterPrompts(category.prompts);
            // Skip categories that have no prompts for the selected bank(s)
            if (filteredPrompts.length === 0) return null;
            
            return (
              <AccordionItem key={category.id} value={category.id} className="border-b border-gray-200 dark:border-gray-700">
                <AccordionTrigger className="hover:bg-gray-50 px-4 py-3 rounded-md dark:hover:bg-gray-800">
                  <div className="flex items-center">
                    {category.icon}
                    <span className="ml-2 font-medium">{category.title}</span>
                  </div>
                </AccordionTrigger>
                <AccordionContent className="px-4 pt-2 pb-4">
                  <p className="text-sm text-gray-600 mb-4 dark:text-gray-400">{category.description}</p>
                  <div className="space-y-3">
                    {filteredPrompts.map((prompt, idx) => (
                      <div key={idx} className="bg-gray-50 p-4 rounded-md border border-gray-200 hover:border-yellow-400 transition-colors dark:bg-gray-800 dark:border-gray-700">
                        <div className="flex items-center mb-2">
                          <div className="w-2 h-2 bg-yellow-400 rounded-full mr-2"></div>
                          <div className="font-medium text-sm">{prompt.bank}</div>
                        </div>
                        <div className="text-xs text-gray-600 pl-4 dark:text-gray-400">{prompt.description}</div>
                      </div>
                    ))}
                  </div>
                </AccordionContent>
              </AccordionItem>
            );
          })}
        </Accordion>
      </CardContent>
      <CardFooter className="bg-gray-50 text-xs text-center py-3 border-t border-gray-200 dark:bg-gray-800 dark:border-gray-700">
        <div className="w-full flex items-center justify-center">
          <span className="text-gray-500 dark:text-gray-400">Supported by</span>
          <span className="font-semibold text-black ml-1 dark:text-white">EYQ</span>
          <span className="text-gray-500 ml-1 dark:text-gray-400">natural language processing</span>
        </div>
      </CardFooter>
    </Card>
  );
};

export default PromptDescriptions;

\`\`\`

# dataextract-ey-main\src\components\PromptSelector.tsx

\`\`\`tsx

import { useState, useEffect } from 'react';
import { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/card';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Label } from '@/components/ui/label';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { Check, FileText, Upload } from 'lucide-react';
import { PromptOption, DEFAULT_PROMPTS } from '@/lib/types';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Badge } from '@/components/ui/badge';
import { cn } from '@/lib/utils';
import { parseExcelPrompts } from '@/lib/excelUtils';
import { useToast } from '@/hooks/use-toast';

interface PromptSelectorProps {
  onPromptSelected: (prompts: PromptOption[]) => void;
  disabled?: boolean;
  selectedPrompts?: PromptOption[];
}

const PromptSelector = ({ 
  onPromptSelected, 
  disabled = false,
  selectedPrompts: externalSelectedPrompts = [] 
}: PromptSelectorProps) => {
  const [selectedPrompts, setSelectedPrompts] = useState<PromptOption[]>(externalSelectedPrompts);
  const [customPromptFile, setCustomPromptFile] = useState<File | null>(null);
  const [customPrompts, setCustomPrompts] = useState<PromptOption[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const { toast } = useToast();
  
  // Group prompts by category
  const promptsByCategory: Record<string, PromptOption[]> = DEFAULT_PROMPTS.reduce((acc, prompt) => {
    if (!acc[prompt.category]) {
      acc[prompt.category] = [];
    }
    acc[prompt.category].push(prompt);
    return acc;
  }, {} as Record<string, PromptOption[]>);
  
  // Group custom prompts by category
  const customPromptsByCategory: Record<string, PromptOption[]> = customPrompts.reduce((acc, prompt) => {
    if (!acc[prompt.category]) {
      acc[prompt.category] = [];
    }
    acc[prompt.category].push(prompt);
    return acc;
  }, {} as Record<string, PromptOption[]>);
  
  // Sync with external selected prompts when they change
  useEffect(() => {
    if (externalSelectedPrompts.length > 0) {
      setSelectedPrompts(externalSelectedPrompts);
    }
  }, [externalSelectedPrompts]);
  
  const togglePrompt = (prompt: PromptOption) => {
    if (disabled) return;
    
    const isSelected = selectedPrompts.some(p => p.id === prompt.id);
    
    if (isSelected) {
      setSelectedPrompts(selectedPrompts.filter(p => p.id !== prompt.id));
    } else {
      setSelectedPrompts([...selectedPrompts, prompt]);
    }
  };
  
  const selectAllPrompts = () => {
    if (disabled) return;
    setSelectedPrompts(DEFAULT_PROMPTS);
  };
  
  const deselectAllPrompts = () => {
    if (disabled) return;
    setSelectedPrompts([]);
  };
  
  const handleApply = () => {
    onPromptSelected(selectedPrompts);
  };
  
  const handleCustomPromptUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    if (e.target.files && e.target.files[0]) {
      const file = e.target.files[0];
      setCustomPromptFile(file);
      setIsLoading(true);
      
      try {
        const parsedPrompts = await parseExcelPrompts(file);
        setCustomPrompts(parsedPrompts);
        toast({
          title: "Excel File Processed",
          description: `${parsedPrompts.length} prompts loaded from Excel file`,
        });
      } catch (error) {
        toast({
          title: "Error Processing Excel File",
          description: error instanceof Error ? error.message : "Unknown error occurred",
          variant: "destructive",
        });
      } finally {
        setIsLoading(false);
      }
    }
  };
  
  const useCustomPrompts = () => {
    if (customPrompts.length > 0) {
      setSelectedPrompts(customPrompts);
      onPromptSelected(customPrompts);
      toast({
        title: "Custom Prompts Selected",
        description: `${customPrompts.length} custom prompts will be used for extraction`,
      });
    }
  };

  return (
    <div className="space-y-6">
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Left side - Info */}
        <div className="space-y-4">
          <div>
            <h2 className="text-lg font-semibold mb-1">Select Data to Extract</h2>
            <p className="text-sm text-muted-foreground">
              Choose which financial data points you want to extract from Barclays's uploaded PDFs.
            </p>
          </div>
          
          <div className="bg-muted p-4 rounded-lg border">
            <h3 className="font-medium mb-2">How It Works</h3>
            <p className="text-sm text-muted-foreground">
              Each prompt is designed to extract specific IFRS9 data points from financial reports. Select prompts based on the data you need.
            </p>
          </div>
        </div>

        {/* Right side - Prompt selection */}
        <div>
          <Tabs defaultValue="predefined" className="w-full">
            <TabsList className="grid grid-cols-2 mb-4 w-full">
              <TabsTrigger value="predefined" className="text-sm">Predefined Prompts</TabsTrigger>
              <TabsTrigger value="custom" className="text-sm">Custom Excel Prompts</TabsTrigger>
            </TabsList>
            
            <TabsContent value="predefined">
              <div className="space-y-4">
                <div className="flex justify-between items-center">
                  <div>
                    <span className="text-sm font-medium">
                      {selectedPrompts.length} of {DEFAULT_PROMPTS.length} selected
                    </span>
                  </div>
                  <div className="space-x-2">
                    <Button 
                      variant="outline" 
                      size="sm" 
                      onClick={selectAllPrompts} 
                      disabled={disabled || selectedPrompts.length === DEFAULT_PROMPTS.length}
                    >
                      Select All
                    </Button>
                    <Button 
                      variant="outline" 
                      size="sm" 
                      onClick={deselectAllPrompts} 
                      disabled={disabled || selectedPrompts.length === 0}
                    >
                      Deselect All
                    </Button>
                  </div>
                </div>
                
                <ScrollArea className="h-[350px] pr-4 -mr-4">
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                    {DEFAULT_PROMPTS.map((prompt) => (
                      <div 
                        key={prompt.id}
                        className={cn(
                          "border rounded-md p-3 cursor-pointer transition-all",
                          selectedPrompts.some(p => p.id === prompt.id) 
                            ? "border-yellow-400 bg-yellow-50 text-black" 
                            : "border-border"
                        )}
                        onClick={() => togglePrompt(prompt)}
                      >
                        <div className="flex justify-between">
                          <div className="font-medium text-sm">{prompt.name}</div>
                          {selectedPrompts.some(p => p.id === prompt.id) && (
                            <Check className="h-4 w-4 text-yellow-500" />
                          )}
                        </div>
                        <div className="text-xs text-muted-foreground mt-1">
                          {prompt.description}
                        </div>
                      </div>
                    ))}
                  </div>
                </ScrollArea>
                
                <Button 
                  className="w-full bg-yellow-400 hover:bg-yellow-500 text-black" 
                  onClick={handleApply}
                  disabled={disabled || selectedPrompts.length === 0}
                >
                  Apply Selected Prompts
                </Button>
              </div>
            </TabsContent>
            
            <TabsContent value="custom">
              <div className="space-y-6">
                <div className="bg-muted/50 p-4 rounded-md border">
                  <div className="flex items-start">
                    <FileText className="h-6 w-6 text-muted-foreground mr-3 mt-1" />
                    <div>
                      <h4 className="font-medium text-sm">Excel Prompt File Format</h4>
                      <p className="text-xs text-muted-foreground mt-1">
                        Upload an Excel file with prompts. The file should contain columns for Prompt Name, Description, Template, and Category.
                      </p>
                    </div>
                  </div>
                </div>
                
                <div>
                  <Label htmlFor="promptFile">Upload Prompt Excel File</Label>
                  <div className="mt-2 flex items-center space-x-3">
                    <div className="flex-1 relative">
                      <Input 
                        id="promptFile"
                        type="file" 
                        onChange={handleCustomPromptUpload} 
                        accept=".xlsx,.xls"
                        disabled={disabled || isLoading}
                        className="flex-1"
                      />
                      {isLoading && (
                        <div className="absolute inset-0 flex items-center justify-center bg-white/70">
                          <div className="animate-spin h-5 w-5 border-2 border-yellow-400 border-t-transparent rounded-full"></div>
                        </div>
                      )}
                    </div>
                    <Button 
                      variant="outline"
                      size="icon"
                      disabled={disabled || isLoading}
                      onClick={() => document.getElementById('promptFile')?.click()}
                    >
                      <Upload className="h-4 w-4" />
                    </Button>
                  </div>
                  {customPromptFile && (
                    <div className="mt-2 flex items-center">
                      <FileText className="h-4 w-4 text-yellow-500 mr-2" />
                      <span className="text-sm">{customPromptFile.name}</span>
                      <Badge variant="outline" className="ml-2">
                        {isLoading ? 'Processing...' : `${customPrompts.length} prompts loaded`}
                      </Badge>
                    </div>
                  )}
                </div>
                
                {customPrompts.length > 0 && (
                  <div className="border rounded-md p-4">
                    <h3 className="text-sm font-medium mb-3">Loaded Custom Prompts</h3>
                    <ScrollArea className="h-[150px]">
                      <div className="space-y-2">
                        {Object.entries(customPromptsByCategory).map(([category, prompts]) => (
                          <div key={category} className="mb-3">
                            <h4 className="text-xs font-semibold text-muted-foreground mb-1">{category}</h4>
                            {prompts.map((prompt, idx) => (
                              <div key={idx} className="text-sm py-1 px-2 rounded-sm hover:bg-muted">
                                {prompt.name}
                              </div>
                            ))}
                          </div>
                        ))}
                      </div>
                    </ScrollArea>
                  </div>
                )}
                
                <Button 
                  className="w-full bg-yellow-400 hover:bg-yellow-500 text-black" 
                  disabled={!customPromptFile || disabled || customPrompts.length === 0}
                  onClick={useCustomPrompts}
                >
                  Use Custom Prompts
                </Button>
              </div>
            </TabsContent>
          </Tabs>
        </div>
      </div>
    </div>
  );
};

export default PromptSelector;

\`\`\`

# dataextract-ey-main\src\components\ResultsViewer.tsx

\`\`\`tsx

import { useState } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { Button } from '@/components/ui/button';
import { AlertCircle, Check, Download, Loader, Star } from 'lucide-react';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { ProcessingResult } from '@/lib/types';
import { cn } from '@/lib/utils';
import { Badge } from '@/components/ui/badge';
import { ScrollArea } from '@/components/ui/scroll-area';
import ProcessingStatus from './ProcessingStatus';

interface ResultsViewerProps {
  results: ProcessingResult[];
  onDownloadResults: () => void;
  isProcessing?: boolean;
  processingProgress?: number;
  processingStep?: string;
  totalFiles?: number;
  processedFiles?: number;
}

const ResultsViewer = ({ 
  results, 
  onDownloadResults, 
  isProcessing = false, 
  processingProgress = 0, 
  processingStep = '',
  totalFiles = 1,
  processedFiles = 0
}: ResultsViewerProps) => {
  const [selectedResult, setSelectedResult] = useState<string | null>(
    results.length > 0 && results[0] ? results[0].id : null
  );
  const [activeTab, setActiveTab] = useState('results');

  const currentResult = results.find(result => result && result.id === selectedResult);
  
  // Group results by file
  const resultsByFile: Record<string, ProcessingResult[]> = results.reduce((acc, result) => {
    if (!result) return acc;
    if (!acc[result.fileId]) {
      acc[result.fileId] = [];
    }
    acc[result.fileId].push(result);
    return acc;
  }, {} as Record<string, ProcessingResult[]>);

  // Check if the current result has ECL By Stage data
  const isEclByStageCategory = currentResult?.data?.some(item => item?.Category === 'ECL By Stage');
  
  if (results.length === 0 && !isProcessing) {
    return (
      <div className="space-y-6">
        <div>
          <h2 className="text-lg font-semibold mb-1">Extraction Results</h2>
          <p className="text-sm text-muted-foreground">View and download the extracted financial data for Barclays</p>
        </div>
        
        <Card>
          <CardContent className="flex flex-col items-center justify-center p-12 text-center">
            <div className="text-muted-foreground mb-2">
              No extraction results yet
            </div>
            <div className="text-sm text-muted-foreground">
              Process files to see extraction results
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  if (isProcessing) {
    return (
      <div className="space-y-6">
        <div>
          <h2 className="text-lg font-semibold mb-1">Extraction Results</h2>
          <p className="text-sm text-muted-foreground">View and download the extracted financial data for Barclays</p>
        </div>
        
        {/* Processing status */}
        <ProcessingStatus
          isProcessing={isProcessing}
          progress={processingProgress}
          currentStep={processingStep}
          totalFiles={totalFiles}
          processedFiles={processedFiles}
        />
        
        <div className="mt-10">
          <h2 className="text-lg font-semibold mb-6">Extraction Results</h2>
          
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div className="lg:col-span-1">
              <div className="border rounded-lg overflow-hidden">
                <div className="bg-black text-white p-2 text-sm font-medium">
                  Processed Files
                </div>
                <div className="p-2 border-b">
                  <div className="text-sm font-medium p-2 bg-muted rounded">Currently Processing</div>
                </div>
                <div className="p-2">
                  <div className="flex items-center justify-between p-2 text-sm rounded-md hover:bg-muted cursor-pointer">
                    <div className="truncate pr-2">Management Adjustments</div>
                    <div className="flex items-center">
                      <Star className="h-3 w-3 text-yellow-400 fill-yellow-400" />
                    </div>
                  </div>
                  <div className="flex items-center justify-between p-2 text-sm rounded-md hover:bg-muted cursor-pointer">
                    <div className="truncate pr-2">Loan Loss Rate</div>
                    <div className="flex items-center">
                      <Star className="h-3 w-3 text-yellow-400 fill-yellow-400" />
                    </div>
                  </div>
                  <div className="flex items-center justify-between p-2 text-sm rounded-md hover:bg-muted cursor-pointer">
                    <div className="truncate pr-2">Macro Variables</div>
                    <div className="flex items-center">
                      <Star className="h-3 w-3 text-yellow-400 fill-yellow-400" />
                    </div>
                  </div>
                </div>
                <div className="p-2 border-t bg-muted/40">
                  <div className="text-sm font-medium p-2">FY24-Barclays-Results-RA.pdf</div>
                  <div className="flex items-center justify-between p-2 text-sm rounded-md hover:bg-muted cursor-pointer bg-yellow-50 border border-yellow-400">
                    <div className="truncate pr-2 text-black">ECL By Stage</div>
                    <div className="flex items-center">
                      <Star className="h-3 w-3 text-yellow-400 fill-yellow-400" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div className="lg:col-span-2">
              <div className="flex items-center justify-center h-[400px] border rounded-lg">
                <div className="text-center p-8">
                  <div className="flex items-center justify-center mb-4">
                    <div className="animate-spin h-10 w-10 border-4 border-yellow-400 border-t-transparent rounded-full"></div>
                  </div>
                  <h3 className="text-lg font-medium mb-2">Processing Data</h3>
                  <p className="text-sm text-muted-foreground">
                    Extracting information from your documents...
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <Tabs value={activeTab} onValueChange={setActiveTab}>
      <div className="space-y-6">
        <div className="flex justify-between items-center">
          <div>
            <h2 className="text-lg font-semibold mb-1">Extraction Results</h2>
            <p className="text-sm text-muted-foreground">View and download the extracted financial data for Barclays</p>
          </div>
          <Button 
            variant="outline" 
            size="sm" 
            onClick={onDownloadResults}
            className="flex items-center gap-1 border-yellow-400 hover:bg-yellow-50"
          >
            <Download className="h-4 w-4" />
            <span>Download All</span>
          </Button>
        </div>
        
        <TabsList className="grid grid-cols-2 max-w-[400px]">
          <TabsTrigger value="results">Results</TabsTrigger>
          <TabsTrigger value="combined">Combined View</TabsTrigger>
        </TabsList>
        
        <TabsContent value="results" className="space-y-6">
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div className="lg:col-span-1">
              <div className="border rounded-lg overflow-hidden">
                <div className="bg-black text-white p-2 text-sm font-medium">
                  Processed Files
                </div>
                <ScrollArea className="h-[400px]">
                  <div className="p-2">
                    {Object.entries(resultsByFile).map(([fileId, fileResults]) => {
                      const fileInfo = fileResults[0];
                      if (!fileInfo) return null;
                      
                      return (
                        <div key={fileId} className="mb-4">
                          <div className="text-sm font-medium p-2 bg-muted">
                            {fileInfo.fileName}
                          </div>
                          {fileResults.map(result => {
                            if (!result) return null;
                            const isSelected = selectedResult === result.id;
                            
                            return (
                              <div 
                                key={result.id}
                                className={cn(
                                  "flex items-center justify-between p-2 text-sm rounded-md cursor-pointer",
                                  isSelected ? "bg-yellow-50 border border-yellow-400 text-black" : "hover:bg-muted"
                                )}
                                onClick={() => setSelectedResult(result.id)}
                              >
                                <div className="truncate pr-2">{result.promptName}</div>
                                <div className="flex items-center">
                                  <Star className="h-3 w-3 text-yellow-400 fill-yellow-400" />
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      );
                    })}
                  </div>
                </ScrollArea>
              </div>
            </div>
            
            <div className="lg:col-span-2">
              {currentResult ? (
                <div className="border rounded-lg overflow-hidden">
                  <div className="bg-black text-white p-3 flex justify-between items-center">
                    <div>
                      <div className="font-medium">{currentResult.promptName}</div>
                      <div className="text-xs text-gray-400">From: {currentResult.fileName}</div>
                    </div>
                    <Badge 
                      className={cn(
                        "capitalize",
                        currentResult.status === 'success' && "bg-green-500",
                        currentResult.status === 'error' && "bg-destructive",
                        currentResult.status === 'processing' && "bg-amber-500"
                      )}
                    >
                      {currentResult.status}
                    </Badge>
                  </div>
                  
                  <div className="p-3">
                    {currentResult.status === 'processing' && (
                      <div className="flex flex-col items-center justify-center h-[350px] py-8">
                        <Loader className="h-8 w-8 text-yellow-400 animate-spin mb-2" />
                        <div className="text-sm">Processing data extraction...</div>
                      </div>
                    )}
                    
                    {currentResult.status === 'error' && currentResult.error && (
                      <Alert variant="destructive" className="mb-4">
                        <AlertCircle className="h-4 w-4" />
                        <AlertTitle>Error</AlertTitle>
                        <AlertDescription>
                          {currentResult.error}
                        </AlertDescription>
                      </Alert>
                    )}
                    
                    {currentResult.status === 'success' && currentResult.data && (
                      <Tabs defaultValue="table">
                        <TabsList className="mb-4">
                          <TabsTrigger value="table">Table View</TabsTrigger>
                          <TabsTrigger value="json">JSON View</TabsTrigger>
                          {/* Only show By Stage tab for ECL By Stage category */}
                          {isEclByStageCategory && (
                            <TabsTrigger value="by-stage">By Stage</TabsTrigger>
                          )}
                        </TabsList>
                        
                        <TabsContent value="table" className="mt-0">
                          <ScrollArea className="h-[350px]">
                            <Table>
                              <TableHeader className="bg-muted sticky top-0">
                                <TableRow>
                                  <TableHead className="font-semibold">Category</TableHead>
                                  <TableHead className="font-semibold">Stage</TableHead>
                                  <TableHead className="font-semibold">Field</TableHead>
                                  <TableHead className="font-semibold">Value</TableHead>
                                </TableRow>
                              </TableHeader>
                              <TableBody>
                                {currentResult.data.map((item, index) => {
                                  if (!item) return null;
                                  
                                  return (
                                    <TableRow key={index}>
                                      <TableCell>
                                        {item.Category === 'ECL By Stage' ? 'ECL' : item.Category}
                                      </TableCell>
                                      <TableCell>{item.Stage}</TableCell>
                                      <TableCell>{item.Field}</TableCell>
                                      <TableCell className="font-medium">{item.Value}</TableCell>
                                    </TableRow>
                                  );
                                })}
                              </TableBody>
                            </Table>
                          </ScrollArea>
                        </TabsContent>
                        
                        <TabsContent value="json" className="mt-0">
                          <ScrollArea className="h-[350px]">
                            <pre className="bg-muted p-4 rounded-md text-xs overflow-x-auto">
                              {JSON.stringify(currentResult.data, null, 2)}
                            </pre>
                          </ScrollArea>
                        </TabsContent>
                        
                        {/* Only render By Stage content for ECL By Stage category */}
                        {isEclByStageCategory && (
                          <TabsContent value="by-stage" className="mt-0">
                            <ScrollArea className="h-[350px]">
                              <div className="space-y-4">
                                {/* Group data by Stage */}
                                {(() => {
                                  // Get unique stages
                                  const stages = Array.from(
                                    new Set(
                                      currentResult.data
                                        .filter(item => item?.Category === 'ECL By Stage')
                                        .map(item => item?.Stage)
                                    )
                                  );
                                  
                                  return stages.map(stage => {
                                    const stageData = currentResult.data.filter(
                                      item => item?.Stage === stage && item?.Category === 'ECL By Stage'
                                    );
                                    
                                    if (stageData.length === 0) return null;
                                    
                                    return (
                                      <div key={`stage-${stage}`} className="border rounded-md overflow-hidden">
                                        <div className="bg-muted p-2">
                                          <h4 className="font-medium">Stage {stage}</h4>
                                        </div>
                                        <Table>
                                          <TableHeader>
                                            <TableRow>
                                              <TableHead>Category</TableHead>
                                              <TableHead>Field</TableHead>
                                              <TableHead>Value</TableHead>
                                            </TableRow>
                                          </TableHeader>
                                          <TableBody>
                                            {stageData.map((item, index) => (
                                              <TableRow key={index}>
                                                <TableCell>ECL</TableCell>
                                                <TableCell>{item.Field}</TableCell>
                                                <TableCell className="font-medium">{item.Value}</TableCell>
                                              </TableRow>
                                            ))}
                                          </TableBody>
                                        </Table>
                                      </div>
                                    );
                                  });
                                })()}
                              </div>
                            </ScrollArea>
                          </TabsContent>
                        )}
                      </Tabs>
                    )}
                  </div>
                </div>
              ) : (
                <div className="flex flex-col items-center justify-center h-[400px] border rounded-lg">
                  <div className="text-muted-foreground">
                    Select a result to view details
                  </div>
                </div>
              )}
            </div>
          </div>
        </TabsContent>
        
        <TabsContent value="combined">
          <div className="space-y-6">
            <div className="flex justify-between items-center">
              <div>
                <h2 className="text-lg font-semibold mb-1">Combined Results</h2>
                <p className="text-sm text-muted-foreground">
                  View and download the final processed data in Excel format
                </p>
              </div>
              <Button 
                variant="outline" 
                size="sm" 
                onClick={onDownloadResults}
                className="flex items-center gap-1 border-yellow-400 bg-white text-black hover:bg-yellow-50"
              >
                <Download className="h-4 w-4" />
                <span>Download Excel</span>
              </Button>
            </div>
            
            {results.length > 0 ? (
              <div className="border rounded-lg overflow-hidden">
                <div className="flex justify-between items-center p-3 bg-muted border-b">
                  <Button 
                    variant="outline" 
                    size="sm" 
                    className="py-1 h-8 bg-yellow-400 hover:bg-yellow-500 border-none text-black"
                  >
                    Combined View
                  </Button>
                  <div className="text-sm text-muted-foreground">
                    {results.filter(r => r.data).flatMap(r => r.data || []).length} rows
                  </div>
                </div>
                
                <ScrollArea className="h-[650px]">
                  <Table>
                    <TableHeader className="bg-muted/70 sticky top-0">
                      <TableRow>
                        <TableHead className="font-semibold text-black">Category</TableHead>
                        <TableHead className="font-semibold text-black">Stage</TableHead>
                        <TableHead className="font-semibold text-black">Field</TableHead>
                        <TableHead className="font-semibold text-black">Value</TableHead>
                        <TableHead className="font-semibold text-black">Source</TableHead>
                      </TableRow>
                    </TableHeader>
                    <TableBody>
                      {results
                        .filter(result => result.status === 'success' && result.data)
                        .flatMap((result, resultIndex) => 
                          (result.data || []).map((item, itemIndex) => (
                            <TableRow key={`${resultIndex}-${itemIndex}`}>
                              <TableCell>
                                {item.Category === 'ECL By Stage' ? 'ECL' : item.Category}
                              </TableCell>
                              <TableCell>{item.Stage}</TableCell>
                              <TableCell>{item.Field}</TableCell>
                              <TableCell>{item.Value}</TableCell>
                              <TableCell>{result.fileName} - {result.promptName}</TableCell>
                            </TableRow>
                          ))
                        )
                      }
                    </TableBody>
                  </Table>
                </ScrollArea>
              </div>
            ) : (
              <div className="border rounded-lg p-12 text-center">
                <p className="text-muted-foreground">No results available yet.</p>
                <p className="text-sm text-muted-foreground mt-1">Process files with prompts to see combined results.</p>
              </div>
            )}
          </div>
        </TabsContent>
      </div>
    </Tabs>
  );
};

// Helper component for Progress
const Progress = ({ value, className }: { value: number, className?: string }) => {
  return (
    <div className={cn("w-full bg-gray-200 rounded-full h-2.5", className)}>
      <div 
        className="bg-yellow-400 h-2.5 rounded-full" 
        style={{ width: `${value}%` }}
      ></div>
    </div>
  );
};

export default ResultsViewer;

\`\`\`

# dataextract-ey-main\src\components\ThemeProvider.tsx

\`\`\`tsx

"use client";

import * as React from "react";
import { createContext, useContext, useEffect, useState } from "react";

type Theme = "dark" | "light" | "system";

type ThemeProviderProps = {
  children: React.ReactNode;
  defaultTheme?: Theme;
  storageKey?: string;
};

type ThemeProviderState = {
  theme: Theme;
  setTheme: (theme: Theme) => void;
};

const initialState: ThemeProviderState = {
  theme: "system",
  setTheme: () => null,
};

const ThemeProviderContext = createContext<ThemeProviderState>(initialState);

export function ThemeProvider({
  children,
  defaultTheme = "system",
  storageKey = "vite-ui-theme",
  ...props
}: ThemeProviderProps) {
  const [theme, setTheme] = useState<Theme>(
    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme
  );

  useEffect(() => {
    const root = window.document.documentElement;
    root.classList.remove("light", "dark");

    if (theme === "system") {
      const systemTheme = window.matchMedia("(prefers-color-scheme: dark)")
        .matches
        ? "dark"
        : "light";

      root.classList.add(systemTheme);
      return;
    }

    root.classList.add(theme);
  }, [theme]);

  const value = {
    theme,
    setTheme: (theme: Theme) => {
      localStorage.setItem(storageKey, theme);
      setTheme(theme);
    },
  };

  return (
    <ThemeProviderContext.Provider {...props} value={value}>
      {children}
    </ThemeProviderContext.Provider>
  );
}

export const useTheme = () => {
  const context = useContext(ThemeProviderContext);

  if (context === undefined)
    throw new Error("useTheme must be used within a ThemeProvider");

  return context;
};

\`\`\`

# dataextract-ey-main\src\components\ThemeToggle.tsx

\`\`\`tsx

import { Moon, Sun } from "lucide-react";
import { Button } from "@/components/ui/button";
import { useTheme } from "@/components/ThemeProvider";
import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from "@/components/ui/dropdown-menu";

export function ThemeToggle({ className }: { className?: string }) {
  const { setTheme, theme } = useTheme();

  return (
    <div className={className}>
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <Button variant="outline" size="icon" className="rounded-full bg-white dark:bg-yellow-400">
            <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0 dark:text-black" />
            <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100 dark:text-black" />
            <span className="sr-only">Toggle theme</span>
          </Button>
        </DropdownMenuTrigger>
        <DropdownMenuContent align="end">
          <DropdownMenuItem onClick={() => setTheme("light")}>
            Light
          </DropdownMenuItem>
          <DropdownMenuItem onClick={() => setTheme("dark")}>
            Dark
          </DropdownMenuItem>
          <DropdownMenuItem onClick={() => setTheme("system")}>
            System
          </DropdownMenuItem>
        </DropdownMenuContent>
      </DropdownMenu>
    </div>
  );
}

\`\`\`

# dataextract-ey-main\src\components\ui\accordion.tsx

\`\`\`tsx
import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn("border-b", className)}
    {...props}
  />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))

AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }

\`\`\`

# dataextract-ey-main\src\components\ui\alert-dialog.tsx

\`\`\`tsx
import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

const AlertDialog = AlertDialogPrimitive.Root

const AlertDialogTrigger = AlertDialogPrimitive.Trigger

const AlertDialogPortal = AlertDialogPrimitive.Portal

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    />
  </AlertDialogPortal>
))
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName

const AlertDialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
AlertDialogHeader.displayName = "AlertDialogHeader"

const AlertDialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
AlertDialogFooter.displayName = "AlertDialogFooter"

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold", className)}
    {...props}
  />
))
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action
    ref={ref}
    className={cn(buttonVariants(), className)}
    {...props}
  />
))
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    )}
    {...props}
  />
))
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}

\`\`\`

# dataextract-ey-main\src\components\ui\alert.tsx

\`\`\`tsx
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive:
          "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
))
Alert.displayName = "Alert"

const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn("mb-1 font-medium leading-none tracking-tight", className)}
    {...props}
  />
))
AlertTitle.displayName = "AlertTitle"

const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm [&_p]:leading-relaxed", className)}
    {...props}
  />
))
AlertDescription.displayName = "AlertDescription"

export { Alert, AlertTitle, AlertDescription }

\`\`\`

# dataextract-ey-main\src\components\ui\aspect-ratio.tsx

\`\`\`tsx
import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio"

const AspectRatio = AspectRatioPrimitive.Root

export { AspectRatio }

\`\`\`

# dataextract-ey-main\src\components\ui\avatar.tsx

\`\`\`tsx
import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    )}
    {...props}
  />
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image
    ref={ref}
    className={cn("aspect-square h-full w-full", className)}
    {...props}
  />
))
AvatarImage.displayName = AvatarPrimitive.Image.displayName

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn(
      "flex h-full w-full items-center justify-center rounded-full bg-muted",
      className
    )}
    {...props}
  />
))
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName

export { Avatar, AvatarImage, AvatarFallback }

\`\`\`

# dataextract-ey-main\src\components\ui\badge.tsx

\`\`\`tsx
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  )
}

export { Badge, badgeVariants }

\`\`\`

# dataextract-ey-main\src\components\ui\breadcrumb.tsx

\`\`\`tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"

const Breadcrumb = React.forwardRef<
  HTMLElement,
  React.ComponentPropsWithoutRef<"nav"> & {
    separator?: React.ReactNode
  }
>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)
Breadcrumb.displayName = "Breadcrumb"

const BreadcrumbList = React.forwardRef<
  HTMLOListElement,
  React.ComponentPropsWithoutRef<"ol">
>(({ className, ...props }, ref) => (
  <ol
    ref={ref}
    className={cn(
      "flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",
      className
    )}
    {...props}
  />
))
BreadcrumbList.displayName = "BreadcrumbList"

const BreadcrumbItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentPropsWithoutRef<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    className={cn("inline-flex items-center gap-1.5", className)}
    {...props}
  />
))
BreadcrumbItem.displayName = "BreadcrumbItem"

const BreadcrumbLink = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentPropsWithoutRef<"a"> & {
    asChild?: boolean
  }
>(({ asChild, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      className={cn("transition-colors hover:text-foreground", className)}
      {...props}
    />
  )
})
BreadcrumbLink.displayName = "BreadcrumbLink"

const BreadcrumbPage = React.forwardRef<
  HTMLSpanElement,
  React.ComponentPropsWithoutRef<"span">
>(({ className, ...props }, ref) => (
  <span
    ref={ref}
    role="link"
    aria-disabled="true"
    aria-current="page"
    className={cn("font-normal text-foreground", className)}
    {...props}
  />
))
BreadcrumbPage.displayName = "BreadcrumbPage"

const BreadcrumbSeparator = ({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) => (
  <li
    role="presentation"
    aria-hidden="true"
    className={cn("[&>svg]:size-3.5", className)}
    {...props}
  >
    {children ?? <ChevronRight />}
  </li>
)
BreadcrumbSeparator.displayName = "BreadcrumbSeparator"

const BreadcrumbEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    role="presentation"
    aria-hidden="true"
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More</span>
  </span>
)
BreadcrumbEllipsis.displayName = "BreadcrumbElipssis"

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}

\`\`\`

# dataextract-ey-main\src\components\ui\button.tsx

\`\`\`tsx

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-500",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground dark:border-gray-600",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-500",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
        eyOutline: "border border-ey-gray-400 text-white hover:bg-ey-gray-800 hover:border-ey-gray-500 transition-colors",
        eyPrimary: "bg-ey-yellow text-ey-black hover:bg-ey-yellow/90 font-medium transition-colors",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }

\`\`\`

# dataextract-ey-main\src\components\ui\calendar.tsx

\`\`\`tsx
import * as React from "react";
import { ChevronLeft, ChevronRight } from "lucide-react";
import { DayPicker } from "react-day-picker";

import { cn } from "@/lib/utils";
import { buttonVariants } from "@/components/ui/button";

export type CalendarProps = React.ComponentProps<typeof DayPicker>;

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: CalendarProps) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",
        month: "space-y-4",
        caption: "flex justify-center pt-1 relative items-center",
        caption_label: "text-sm font-medium",
        nav: "space-x-1 flex items-center",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-y-1",
        head_row: "flex",
        head_cell:
          "text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",
        day: cn(
          buttonVariants({ variant: "ghost" }),
          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"
        ),
        day_range_end: "day-range-end",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle:
          "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ ..._props }) => <ChevronLeft className="h-4 w-4" />,
        IconRight: ({ ..._props }) => <ChevronRight className="h-4 w-4" />,
      }}
      {...props}
    />
  );
}
Calendar.displayName = "Calendar";

export { Calendar };

\`\`\`

# dataextract-ey-main\src\components\ui\card.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }

\`\`\`

# dataextract-ey-main\src\components\ui\carousel.tsx

\`\`\`tsx
import * as React from "react"
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react"
import { ArrowLeft, ArrowRight } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: "horizontal" | "vertical"
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />")
  }

  return context
}

const Carousel = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & CarouselProps
>(
  (
    {
      orientation = "horizontal",
      opts,
      setApi,
      plugins,
      className,
      children,
      ...props
    },
    ref
  ) => {
    const [carouselRef, api] = useEmblaCarousel(
      {
        ...opts,
        axis: orientation === "horizontal" ? "x" : "y",
      },
      plugins
    )
    const [canScrollPrev, setCanScrollPrev] = React.useState(false)
    const [canScrollNext, setCanScrollNext] = React.useState(false)

    const onSelect = React.useCallback((api: CarouselApi) => {
      if (!api) {
        return
      }

      setCanScrollPrev(api.canScrollPrev())
      setCanScrollNext(api.canScrollNext())
    }, [])

    const scrollPrev = React.useCallback(() => {
      api?.scrollPrev()
    }, [api])

    const scrollNext = React.useCallback(() => {
      api?.scrollNext()
    }, [api])

    const handleKeyDown = React.useCallback(
      (event: React.KeyboardEvent<HTMLDivElement>) => {
        if (event.key === "ArrowLeft") {
          event.preventDefault()
          scrollPrev()
        } else if (event.key === "ArrowRight") {
          event.preventDefault()
          scrollNext()
        }
      },
      [scrollPrev, scrollNext]
    )

    React.useEffect(() => {
      if (!api || !setApi) {
        return
      }

      setApi(api)
    }, [api, setApi])

    React.useEffect(() => {
      if (!api) {
        return
      }

      onSelect(api)
      api.on("reInit", onSelect)
      api.on("select", onSelect)

      return () => {
        api?.off("select", onSelect)
      }
    }, [api, onSelect])

    return (
      <CarouselContext.Provider
        value={{
          carouselRef,
          api: api,
          opts,
          orientation:
            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
          scrollPrev,
          scrollNext,
          canScrollPrev,
          canScrollNext,
        }}
      >
        <div
          ref={ref}
          onKeyDownCapture={handleKeyDown}
          className={cn("relative", className)}
          role="region"
          aria-roledescription="carousel"
          {...props}
        >
          {children}
        </div>
      </CarouselContext.Provider>
    )
  }
)
Carousel.displayName = "Carousel"

const CarouselContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div ref={carouselRef} className="overflow-hidden">
      <div
        ref={ref}
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className
        )}
        {...props}
      />
    </div>
  )
})
CarouselContent.displayName = "CarouselContent"

const CarouselItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { orientation } = useCarousel()

  return (
    <div
      ref={ref}
      role="group"
      aria-roledescription="slide"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className
      )}
      {...props}
    />
  )
})
CarouselItem.displayName = "CarouselItem"

const CarouselPrevious = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute  h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-left-12 top-1/2 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft className="h-4 w-4" />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
})
CarouselPrevious.displayName = "CarouselPrevious"

const CarouselNext = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-right-12 top-1/2 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight className="h-4 w-4" />
      <span className="sr-only">Next slide</span>
    </Button>
  )
})
CarouselNext.displayName = "CarouselNext"

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}

\`\`\`

# dataextract-ey-main\src\components\ui\chart.tsx

\`\`\`tsx
import * as React from "react"
import * as RechartsPrimitive from "recharts"

import { cn } from "@/lib/utils"

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />")
  }

  return context
}

const ChartContainer = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    config: ChartConfig
    children: React.ComponentProps<
      typeof RechartsPrimitive.ResponsiveContainer
    >["children"]
  }
>(({ id, className, children, config, ...props }, ref) => {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-chart={chartId}
        ref={ref}
        className={cn(
          "flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",
          className
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
})
ChartContainer.displayName = "Chart"

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([_, config]) => config.theme || config.color
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join("\n")}
}
`
          )
          .join("\n"),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

const ChartTooltipContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
    React.ComponentProps<"div"> & {
      hideLabel?: boolean
      hideIndicator?: boolean
      indicator?: "line" | "dot" | "dashed"
      nameKey?: string
      labelKey?: string
    }
>(
  (
    {
      active,
      payload,
      className,
      indicator = "dot",
      hideLabel = false,
      hideIndicator = false,
      label,
      labelFormatter,
      labelClassName,
      formatter,
      color,
      nameKey,
      labelKey,
    },
    ref
  ) => {
    const { config } = useChart()

    const tooltipLabel = React.useMemo(() => {
      if (hideLabel || !payload?.length) {
        return null
      }

      const [item] = payload
      const key = `${labelKey || item.dataKey || item.name || "value"}`
      const itemConfig = getPayloadConfigFromPayload(config, item, key)
      const value =
        !labelKey && typeof label === "string"
          ? config[label as keyof typeof config]?.label || label
          : itemConfig?.label

      if (labelFormatter) {
        return (
          <div className={cn("font-medium", labelClassName)}>
            {labelFormatter(value, payload)}
          </div>
        )
      }

      if (!value) {
        return null
      }

      return <div className={cn("font-medium", labelClassName)}>{value}</div>
    }, [
      label,
      labelFormatter,
      payload,
      hideLabel,
      labelClassName,
      config,
      labelKey,
    ])

    if (!active || !payload?.length) {
      return null
    }

    const nestLabel = payload.length === 1 && indicator !== "dot"

    return (
      <div
        ref={ref}
        className={cn(
          "grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",
          className
        )}
      >
        {!nestLabel ? tooltipLabel : null}
        <div className="grid gap-1.5">
          {payload.map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`
            const itemConfig = getPayloadConfigFromPayload(config, item, key)
            const indicatorColor = color || item.payload.fill || item.color

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",
                  indicator === "dot" && "items-center"
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn(
                            "shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",
                            {
                              "h-2.5 w-2.5": indicator === "dot",
                              "w-1": indicator === "line",
                              "w-0 border-[1.5px] border-dashed bg-transparent":
                                indicator === "dashed",
                              "my-0.5": nestLabel && indicator === "dashed",
                            }
                          )}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center"
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">
                          {itemConfig?.label || item.name}
                        </span>
                      </div>
                      {item.value && (
                        <span className="font-mono font-medium tabular-nums text-foreground">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            )
          })}
        </div>
      </div>
    )
  }
)
ChartTooltipContent.displayName = "ChartTooltip"

const ChartLegend = RechartsPrimitive.Legend

const ChartLegendContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> &
    Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
      hideIcon?: boolean
      nameKey?: string
    }
>(
  (
    { className, hideIcon = false, payload, verticalAlign = "bottom", nameKey },
    ref
  ) => {
    const { config } = useChart()

    if (!payload?.length) {
      return null
    }

    return (
      <div
        ref={ref}
        className={cn(
          "flex items-center justify-center gap-4",
          verticalAlign === "top" ? "pb-3" : "pt-3",
          className
        )}
      >
        {payload.map((item) => {
          const key = `${nameKey || item.dataKey || "value"}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)

          return (
            <div
              key={item.value}
              className={cn(
                "flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"
              )}
            >
              {itemConfig?.icon && !hideIcon ? (
                <itemConfig.icon />
              ) : (
                <div
                  className="h-2 w-2 shrink-0 rounded-[2px]"
                  style={{
                    backgroundColor: item.color,
                  }}
                />
              )}
              {itemConfig?.label}
            </div>
          )
        })}
      </div>
    )
  }
)
ChartLegendContent.displayName = "ChartLegend"

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}

\`\`\`

# dataextract-ey-main\src\components\ui\checkbox.tsx

\`\`\`tsx
import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }

\`\`\`

# dataextract-ey-main\src\components\ui\collapsible.tsx

\`\`\`tsx
import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

const Collapsible = CollapsiblePrimitive.Root

const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger

const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent

export { Collapsible, CollapsibleTrigger, CollapsibleContent }

\`\`\`

# dataextract-ey-main\src\components\ui\command.tsx

\`\`\`tsx
import * as React from "react"
import { type DialogProps } from "@radix-ui/react-dialog"
import { Command as CommandPrimitive } from "cmdk"
import { Search } from "lucide-react"

import { cn } from "@/lib/utils"
import { Dialog, DialogContent } from "@/components/ui/dialog"

const Command = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive>
>(({ className, ...props }, ref) => (
  <CommandPrimitive
    ref={ref}
    className={cn(
      "flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",
      className
    )}
    {...props}
  />
))
Command.displayName = CommandPrimitive.displayName

interface CommandDialogProps extends DialogProps {}

const CommandDialog = ({ children, ...props }: CommandDialogProps) => {
  return (
    <Dialog {...props}>
      <DialogContent className="overflow-hidden p-0 shadow-lg">
        <Command className="[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

const CommandInput = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Input>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
>(({ className, ...props }, ref) => (
  <div className="flex items-center border-b px-3" cmdk-input-wrapper="">
    <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
    <CommandPrimitive.Input
      ref={ref}
      className={cn(
        "flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    />
  </div>
))

CommandInput.displayName = CommandPrimitive.Input.displayName

const CommandList = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.List
    ref={ref}
    className={cn("max-h-[300px] overflow-y-auto overflow-x-hidden", className)}
    {...props}
  />
))

CommandList.displayName = CommandPrimitive.List.displayName

const CommandEmpty = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Empty>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>
>((props, ref) => (
  <CommandPrimitive.Empty
    ref={ref}
    className="py-6 text-center text-sm"
    {...props}
  />
))

CommandEmpty.displayName = CommandPrimitive.Empty.displayName

const CommandGroup = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Group>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Group
    ref={ref}
    className={cn(
      "overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",
      className
    )}
    {...props}
  />
))

CommandGroup.displayName = CommandPrimitive.Group.displayName

const CommandSeparator = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 h-px bg-border", className)}
    {...props}
  />
))
CommandSeparator.displayName = CommandPrimitive.Separator.displayName

const CommandItem = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",
      className
    )}
    {...props}
  />
))

CommandItem.displayName = CommandPrimitive.Item.displayName

const CommandShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
CommandShortcut.displayName = "CommandShortcut"

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}

\`\`\`

# dataextract-ey-main\src\components\ui\context-menu.tsx

\`\`\`tsx
import * as React from "react"
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const ContextMenu = ContextMenuPrimitive.Root

const ContextMenuTrigger = ContextMenuPrimitive.Trigger

const ContextMenuGroup = ContextMenuPrimitive.Group

const ContextMenuPortal = ContextMenuPrimitive.Portal

const ContextMenuSub = ContextMenuPrimitive.Sub

const ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup

const ContextMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <ContextMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </ContextMenuPrimitive.SubTrigger>
))
ContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName

const ContextMenuSubContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
ContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName

const ContextMenuContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Portal>
    <ContextMenuPrimitive.Content
      ref={ref}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </ContextMenuPrimitive.Portal>
))
ContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName

const ContextMenuItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName

const ContextMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <ContextMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.CheckboxItem>
))
ContextMenuCheckboxItem.displayName =
  ContextMenuPrimitive.CheckboxItem.displayName

const ContextMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <ContextMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.RadioItem>
))
ContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName

const ContextMenuLabel = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold text-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName

const ContextMenuSeparator = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-border", className)}
    {...props}
  />
))
ContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName

const ContextMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
ContextMenuShortcut.displayName = "ContextMenuShortcut"

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}

\`\`\`

# dataextract-ey-main\src\components\ui\dialog.tsx

\`\`\`tsx
import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}

\`\`\`

# dataextract-ey-main\src\components\ui\drawer.tsx

\`\`\`tsx
import * as React from "react"
import { Drawer as DrawerPrimitive } from "vaul"

import { cn } from "@/lib/utils"

const Drawer = ({
  shouldScaleBackground = true,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (
  <DrawerPrimitive.Root
    shouldScaleBackground={shouldScaleBackground}
    {...props}
  />
)
Drawer.displayName = "Drawer"

const DrawerTrigger = DrawerPrimitive.Trigger

const DrawerPortal = DrawerPrimitive.Portal

const DrawerClose = DrawerPrimitive.Close

const DrawerOverlay = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Overlay
    ref={ref}
    className={cn("fixed inset-0 z-50 bg-black/80", className)}
    {...props}
  />
))
DrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName

const DrawerContent = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DrawerPortal>
    <DrawerOverlay />
    <DrawerPrimitive.Content
      ref={ref}
      className={cn(
        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",
        className
      )}
      {...props}
    >
      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted" />
      {children}
    </DrawerPrimitive.Content>
  </DrawerPortal>
))
DrawerContent.displayName = "DrawerContent"

const DrawerHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}
    {...props}
  />
)
DrawerHeader.displayName = "DrawerHeader"

const DrawerFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("mt-auto flex flex-col gap-2 p-4", className)}
    {...props}
  />
)
DrawerFooter.displayName = "DrawerFooter"

const DrawerTitle = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DrawerTitle.displayName = DrawerPrimitive.Title.displayName

const DrawerDescription = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DrawerDescription.displayName = DrawerPrimitive.Description.displayName

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}

\`\`\`

# dataextract-ey-main\src\components\ui\dropdown-menu.tsx

\`\`\`tsx
import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const DropdownMenu = DropdownMenuPrimitive.Root

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger

const DropdownMenuGroup = DropdownMenuPrimitive.Group

const DropdownMenuPortal = DropdownMenuPrimitive.Portal

const DropdownMenuSub = DropdownMenuPrimitive.Sub

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </DropdownMenuPrimitive.SubTrigger>
))
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
))
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
))
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  )
}
DropdownMenuShortcut.displayName = "DropdownMenuShortcut"

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
}

\`\`\`

# dataextract-ey-main\src\components\ui\form.tsx

\`\`\`tsx
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  ControllerProps,
  FieldPath,
  FieldValues,
  FormProvider,
  useFormContext,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState, formState } = useFormContext()

  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn("space-y-2", className)} {...props} />
    </FormItemContext.Provider>
  )
})
FormItem.displayName = "FormItem"

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField()

  return (
    <Label
      ref={ref}
      className={cn(error && "text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
})
FormLabel.displayName = "FormLabel"

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
})
FormControl.displayName = "FormControl"

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField()

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn("text-sm text-muted-foreground", className)}
      {...props}
    />
  )
})
FormDescription.displayName = "FormDescription"

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message) : children

  if (!body) {
    return null
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn("text-sm font-medium text-destructive", className)}
      {...props}
    >
      {body}
    </p>
  )
})
FormMessage.displayName = "FormMessage"

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}

\`\`\`

# dataextract-ey-main\src\components\ui\hover-card.tsx

\`\`\`tsx
import * as React from "react"
import * as HoverCardPrimitive from "@radix-ui/react-hover-card"

import { cn } from "@/lib/utils"

const HoverCard = HoverCardPrimitive.Root

const HoverCardTrigger = HoverCardPrimitive.Trigger

const HoverCardContent = React.forwardRef<
  React.ElementRef<typeof HoverCardPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <HoverCardPrimitive.Content
    ref={ref}
    align={align}
    sideOffset={sideOffset}
    className={cn(
      "z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
HoverCardContent.displayName = HoverCardPrimitive.Content.displayName

export { HoverCard, HoverCardTrigger, HoverCardContent }

\`\`\`

# dataextract-ey-main\src\components\ui\input-otp.tsx

\`\`\`tsx
import * as React from "react"
import { OTPInput, OTPInputContext } from "input-otp"
import { Dot } from "lucide-react"

import { cn } from "@/lib/utils"

const InputOTP = React.forwardRef<
  React.ElementRef<typeof OTPInput>,
  React.ComponentPropsWithoutRef<typeof OTPInput>
>(({ className, containerClassName, ...props }, ref) => (
  <OTPInput
    ref={ref}
    containerClassName={cn(
      "flex items-center gap-2 has-[:disabled]:opacity-50",
      containerClassName
    )}
    className={cn("disabled:cursor-not-allowed", className)}
    {...props}
  />
))
InputOTP.displayName = "InputOTP"

const InputOTPGroup = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("flex items-center", className)} {...props} />
))
InputOTPGroup.displayName = "InputOTPGroup"

const InputOTPSlot = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div"> & { index: number }
>(({ index, className, ...props }, ref) => {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]

  return (
    <div
      ref={ref}
      className={cn(
        "relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",
        isActive && "z-10 ring-2 ring-ring ring-offset-background",
        className
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="h-4 w-px animate-caret-blink bg-foreground duration-1000" />
        </div>
      )}
    </div>
  )
})
InputOTPSlot.displayName = "InputOTPSlot"

const InputOTPSeparator = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ ...props }, ref) => (
  <div ref={ref} role="separator" {...props}>
    <Dot />
  </div>
))
InputOTPSeparator.displayName = "InputOTPSeparator"

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }

\`\`\`

# dataextract-ey-main\src\components\ui\input.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }

\`\`\`

# dataextract-ey-main\src\components\ui\label.tsx

\`\`\`tsx
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }

\`\`\`

# dataextract-ey-main\src\components\ui\menubar.tsx

\`\`\`tsx
import * as React from "react"
import * as MenubarPrimitive from "@radix-ui/react-menubar"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const MenubarMenu = MenubarPrimitive.Menu

const MenubarGroup = MenubarPrimitive.Group

const MenubarPortal = MenubarPrimitive.Portal

const MenubarSub = MenubarPrimitive.Sub

const MenubarRadioGroup = MenubarPrimitive.RadioGroup

const Menubar = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Root
    ref={ref}
    className={cn(
      "flex h-10 items-center space-x-1 rounded-md border bg-background p-1",
      className
    )}
    {...props}
  />
))
Menubar.displayName = MenubarPrimitive.Root.displayName

const MenubarTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      className
    )}
    {...props}
  />
))
MenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName

const MenubarSubTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <MenubarPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </MenubarPrimitive.SubTrigger>
))
MenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName

const MenubarSubContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
MenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName

const MenubarContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>
>(
  (
    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },
    ref
  ) => (
    <MenubarPrimitive.Portal>
      <MenubarPrimitive.Content
        ref={ref}
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
          className
        )}
        {...props}
      />
    </MenubarPrimitive.Portal>
  )
)
MenubarContent.displayName = MenubarPrimitive.Content.displayName

const MenubarItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarItem.displayName = MenubarPrimitive.Item.displayName

const MenubarCheckboxItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <MenubarPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.CheckboxItem>
))
MenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName

const MenubarRadioItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <MenubarPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.RadioItem>
))
MenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName

const MenubarLabel = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarLabel.displayName = MenubarPrimitive.Label.displayName

const MenubarSeparator = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
MenubarSeparator.displayName = MenubarPrimitive.Separator.displayName

const MenubarShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
MenubarShortcut.displayname = "MenubarShortcut"

export {
  Menubar,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarItem,
  MenubarSeparator,
  MenubarLabel,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarPortal,
  MenubarSubContent,
  MenubarSubTrigger,
  MenubarGroup,
  MenubarSub,
  MenubarShortcut,
}

\`\`\`

# dataextract-ey-main\src\components\ui\navigation-menu.tsx

\`\`\`tsx
import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const NavigationMenu = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Root
    ref={ref}
    className={cn(
      "relative z-10 flex max-w-max flex-1 items-center justify-center",
      className
    )}
    {...props}
  >
    {children}
    <NavigationMenuViewport />
  </NavigationMenuPrimitive.Root>
))
NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName

const NavigationMenuList = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.List
    ref={ref}
    className={cn(
      "group flex flex-1 list-none items-center justify-center space-x-1",
      className
    )}
    {...props}
  />
))
NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName

const NavigationMenuItem = NavigationMenuPrimitive.Item

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50"
)

const NavigationMenuTrigger = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Trigger
    ref={ref}
    className={cn(navigationMenuTriggerStyle(), "group", className)}
    {...props}
  >
    {children}{" "}
    <ChevronDown
      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"
      aria-hidden="true"
    />
  </NavigationMenuPrimitive.Trigger>
))
NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName

const NavigationMenuContent = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Content
    ref={ref}
    className={cn(
      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",
      className
    )}
    {...props}
  />
))
NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName

const NavigationMenuLink = NavigationMenuPrimitive.Link

const NavigationMenuViewport = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
>(({ className, ...props }, ref) => (
  <div className={cn("absolute left-0 top-full flex justify-center")}>
    <NavigationMenuPrimitive.Viewport
      className={cn(
        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",
        className
      )}
      ref={ref}
      {...props}
    />
  </div>
))
NavigationMenuViewport.displayName =
  NavigationMenuPrimitive.Viewport.displayName

const NavigationMenuIndicator = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Indicator
    ref={ref}
    className={cn(
      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",
      className
    )}
    {...props}
  >
    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md" />
  </NavigationMenuPrimitive.Indicator>
))
NavigationMenuIndicator.displayName =
  NavigationMenuPrimitive.Indicator.displayName

export {
  navigationMenuTriggerStyle,
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
}

\`\`\`

# dataextract-ey-main\src\components\ui\pagination.tsx

\`\`\`tsx
import * as React from "react"
import { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"
import { ButtonProps, buttonVariants } from "@/components/ui/button"

const Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn("mx-auto flex w-full justify-center", className)}
    {...props}
  />
)
Pagination.displayName = "Pagination"

const PaginationContent = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    className={cn("flex flex-row items-center gap-1", className)}
    {...props}
  />
))
PaginationContent.displayName = "PaginationContent"

const PaginationItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li ref={ref} className={cn("", className)} {...props} />
))
PaginationItem.displayName = "PaginationItem"

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<ButtonProps, "size"> &
  React.ComponentProps<"a">

const PaginationLink = ({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) => (
  <a
    aria-current={isActive ? "page" : undefined}
    className={cn(
      buttonVariants({
        variant: isActive ? "outline" : "ghost",
        size,
      }),
      className
    )}
    {...props}
  />
)
PaginationLink.displayName = "PaginationLink"

const PaginationPrevious = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to previous page"
    size="default"
    className={cn("gap-1 pl-2.5", className)}
    {...props}
  >
    <ChevronLeft className="h-4 w-4" />
    <span>Previous</span>
  </PaginationLink>
)
PaginationPrevious.displayName = "PaginationPrevious"

const PaginationNext = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to next page"
    size="default"
    className={cn("gap-1 pr-2.5", className)}
    {...props}
  >
    <span>Next</span>
    <ChevronRight className="h-4 w-4" />
  </PaginationLink>
)
PaginationNext.displayName = "PaginationNext"

const PaginationEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    aria-hidden
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More pages</span>
  </span>
)
PaginationEllipsis.displayName = "PaginationEllipsis"

export {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
}

\`\`\`

# dataextract-ey-main\src\components\ui\popover.tsx

\`\`\`tsx
import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

const Popover = PopoverPrimitive.Root

const PopoverTrigger = PopoverPrimitive.Trigger

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
))
PopoverContent.displayName = PopoverPrimitive.Content.displayName

export { Popover, PopoverTrigger, PopoverContent }

\`\`\`

# dataextract-ey-main\src\components\ui\progress.tsx

\`\`\`tsx

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

interface ProgressProps extends React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root> {
  indicatorClassName?: string;
}

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  ProgressProps
>(({ className, value, indicatorClassName, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-4 w-full overflow-hidden rounded-full bg-secondary",
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className={cn(
        "h-full w-full flex-1 bg-primary transition-all",
        indicatorClassName
      )}
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }

\`\`\`

# dataextract-ey-main\src\components\ui\radio-group.tsx

\`\`\`tsx
import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Root
      className={cn("grid gap-2", className)}
      {...props}
      ref={ref}
    />
  )
})
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
})
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName

export { RadioGroup, RadioGroupItem }

\`\`\`

# dataextract-ey-main\src\components\ui\resizable.tsx

\`\`\`tsx
import { GripVertical } from "lucide-react"
import * as ResizablePrimitive from "react-resizable-panels"

import { cn } from "@/lib/utils"

const ResizablePanelGroup = ({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (
  <ResizablePrimitive.PanelGroup
    className={cn(
      "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
      className
    )}
    {...props}
  />
)

const ResizablePanel = ResizablePrimitive.Panel

const ResizableHandle = ({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) => (
  <ResizablePrimitive.PanelResizeHandle
    className={cn(
      "relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
      className
    )}
    {...props}
  >
    {withHandle && (
      <div className="z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border">
        <GripVertical className="h-2.5 w-2.5" />
      </div>
    )}
  </ResizablePrimitive.PanelResizeHandle>
)

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }

\`\`\`

# dataextract-ey-main\src\components\ui\scroll-area.tsx

\`\`\`tsx
import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root
    ref={ref}
    className={cn("relative overflow-hidden", className)}
    {...props}
  >
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">
      {children}
    </ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
))
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName

const ScrollBar = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
>(({ className, orientation = "vertical", ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      "flex touch-none select-none transition-colors",
      orientation === "vertical" &&
        "h-full w-2.5 border-l border-l-transparent p-[1px]",
      orientation === "horizontal" &&
        "h-2.5 flex-col border-t border-t-transparent p-[1px]",
      className
    )}
    {...props}
  >
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
))
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName

export { ScrollArea, ScrollBar }

\`\`\`

# dataextract-ey-main\src\components\ui\select.tsx

\`\`\`tsx
import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}

\`\`\`

# dataextract-ey-main\src\components\ui\separator.tsx

\`\`\`tsx
import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }

\`\`\`

# dataextract-ey-main\src\components\ui\sheet.tsx

\`\`\`tsx
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"
import * as React from "react"

import { cn } from "@/lib/utils"

const Sheet = SheetPrimitive.Root

const SheetTrigger = SheetPrimitive.Trigger

const SheetClose = SheetPrimitive.Close

const SheetPortal = SheetPrimitive.Portal

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName

const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom:
          "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right:
          "inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
)

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
  VariantProps<typeof sheetVariants> { }

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(({ side = "right", className, children, ...props }, ref) => (
  <SheetPortal>
    <SheetOverlay />
    <SheetPrimitive.Content
      ref={ref}
      className={cn(sheetVariants({ side }), className)}
      {...props}
    >
      {children}
      <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </SheetPrimitive.Close>
    </SheetPrimitive.Content>
  </SheetPortal>
))
SheetContent.displayName = SheetPrimitive.Content.displayName

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
SheetHeader.displayName = "SheetHeader"

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
SheetFooter.displayName = "SheetFooter"

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold text-foreground", className)}
    {...props}
  />
))
SheetTitle.displayName = SheetPrimitive.Title.displayName

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
SheetDescription.displayName = SheetPrimitive.Description.displayName

export {
  Sheet, SheetClose,
  SheetContent, SheetDescription, SheetFooter, SheetHeader, SheetOverlay, SheetPortal, SheetTitle, SheetTrigger
}


\`\`\`

# dataextract-ey-main\src\components\ui\sidebar.tsx

\`\`\`tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { VariantProps, cva } from "class-variance-authority"
import { PanelLeft } from "lucide-react"

import { useIsMobile } from "@/hooks/use-mobile"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Separator } from "@/components/ui/separator"
import { Sheet, SheetContent } from "@/components/ui/sheet"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip"

const SIDEBAR_COOKIE_NAME = "sidebar:state"
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = "16rem"
const SIDEBAR_WIDTH_MOBILE = "18rem"
const SIDEBAR_WIDTH_ICON = "3rem"
const SIDEBAR_KEYBOARD_SHORTCUT = "b"

type SidebarContext = {
  state: "expanded" | "collapsed"
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContext | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.")
  }

  return context
}

const SidebarProvider = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    defaultOpen?: boolean
    open?: boolean
    onOpenChange?: (open: boolean) => void
  }
>(
  (
    {
      defaultOpen = true,
      open: openProp,
      onOpenChange: setOpenProp,
      className,
      style,
      children,
      ...props
    },
    ref
  ) => {
    const isMobile = useIsMobile()
    const [openMobile, setOpenMobile] = React.useState(false)

    // This is the internal state of the sidebar.
    // We use openProp and setOpenProp for control from outside the component.
    const [_open, _setOpen] = React.useState(defaultOpen)
    const open = openProp ?? _open
    const setOpen = React.useCallback(
      (value: boolean | ((value: boolean) => boolean)) => {
        const openState = typeof value === "function" ? value(open) : value
        if (setOpenProp) {
          setOpenProp(openState)
        } else {
          _setOpen(openState)
        }

        // This sets the cookie to keep the sidebar state.
        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
      },
      [setOpenProp, open]
    )

    // Helper to toggle the sidebar.
    const toggleSidebar = React.useCallback(() => {
      return isMobile
        ? setOpenMobile((open) => !open)
        : setOpen((open) => !open)
    }, [isMobile, setOpen, setOpenMobile])

    // Adds a keyboard shortcut to toggle the sidebar.
    React.useEffect(() => {
      const handleKeyDown = (event: KeyboardEvent) => {
        if (
          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
          (event.metaKey || event.ctrlKey)
        ) {
          event.preventDefault()
          toggleSidebar()
        }
      }

      window.addEventListener("keydown", handleKeyDown)
      return () => window.removeEventListener("keydown", handleKeyDown)
    }, [toggleSidebar])

    // We add a state so that we can do data-state="expanded" or "collapsed".
    // This makes it easier to style the sidebar with Tailwind classes.
    const state = open ? "expanded" : "collapsed"

    const contextValue = React.useMemo<SidebarContext>(
      () => ({
        state,
        open,
        setOpen,
        isMobile,
        openMobile,
        setOpenMobile,
        toggleSidebar,
      }),
      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]
    )

    return (
      <SidebarContext.Provider value={contextValue}>
        <TooltipProvider delayDuration={0}>
          <div
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH,
                "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
                ...style,
              } as React.CSSProperties
            }
            className={cn(
              "group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",
              className
            )}
            ref={ref}
            {...props}
          >
            {children}
          </div>
        </TooltipProvider>
      </SidebarContext.Provider>
    )
  }
)
SidebarProvider.displayName = "SidebarProvider"

const Sidebar = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    side?: "left" | "right"
    variant?: "sidebar" | "floating" | "inset"
    collapsible?: "offcanvas" | "icon" | "none"
  }
>(
  (
    {
      side = "left",
      variant = "sidebar",
      collapsible = "offcanvas",
      className,
      children,
      ...props
    },
    ref
  ) => {
    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

    if (collapsible === "none") {
      return (
        <div
          className={cn(
            "flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",
            className
          )}
          ref={ref}
          {...props}
        >
          {children}
        </div>
      )
    }

    if (isMobile) {
      return (
        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
          <SheetContent
            data-sidebar="sidebar"
            data-mobile="true"
            className="w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden"
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
              } as React.CSSProperties
            }
            side={side}
          >
            <div className="flex h-full w-full flex-col">{children}</div>
          </SheetContent>
        </Sheet>
      )
    }

    return (
      <div
        ref={ref}
        className="group peer hidden md:block text-sidebar-foreground"
        data-state={state}
        data-collapsible={state === "collapsed" ? collapsible : ""}
        data-variant={variant}
        data-side={side}
      >
        {/* This is what handles the sidebar gap on desktop */}
        <div
          className={cn(
            "duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear",
            "group-data-[collapsible=offcanvas]:w-0",
            "group-data-[side=right]:rotate-180",
            variant === "floating" || variant === "inset"
              ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon]"
          )}
        />
        <div
          className={cn(
            "duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",
            side === "left"
              ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
              : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
            // Adjust the padding for floating and inset variants.
            variant === "floating" || variant === "inset"
              ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",
            className
          )}
          {...props}
        >
          <div
            data-sidebar="sidebar"
            className="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"
          >
            {children}
          </div>
        </div>
      </div>
    )
  }
)
Sidebar.displayName = "Sidebar"

const SidebarTrigger = React.forwardRef<
  React.ElementRef<typeof Button>,
  React.ComponentProps<typeof Button>
>(({ className, onClick, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      ref={ref}
      data-sidebar="trigger"
      variant="ghost"
      size="icon"
      className={cn("h-7 w-7", className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeft />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
})
SidebarTrigger.displayName = "SidebarTrigger"

const SidebarRail = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button">
>(({ className, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      ref={ref}
      data-sidebar="rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex",
        "[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className
      )}
      {...props}
    />
  )
})
SidebarRail.displayName = "SidebarRail"

const SidebarInset = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"main">
>(({ className, ...props }, ref) => {
  return (
    <main
      ref={ref}
      className={cn(
        "relative flex min-h-svh flex-1 flex-col bg-background",
        "peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",
        className
      )}
      {...props}
    />
  )
})
SidebarInset.displayName = "SidebarInset"

const SidebarInput = React.forwardRef<
  React.ElementRef<typeof Input>,
  React.ComponentProps<typeof Input>
>(({ className, ...props }, ref) => {
  return (
    <Input
      ref={ref}
      data-sidebar="input"
      className={cn(
        "h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",
        className
      )}
      {...props}
    />
  )
})
SidebarInput.displayName = "SidebarInput"

const SidebarHeader = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarHeader.displayName = "SidebarHeader"

const SidebarFooter = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarFooter.displayName = "SidebarFooter"

const SidebarSeparator = React.forwardRef<
  React.ElementRef<typeof Separator>,
  React.ComponentProps<typeof Separator>
>(({ className, ...props }, ref) => {
  return (
    <Separator
      ref={ref}
      data-sidebar="separator"
      className={cn("mx-2 w-auto bg-sidebar-border", className)}
      {...props}
    />
  )
})
SidebarSeparator.displayName = "SidebarSeparator"

const SidebarContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarContent.displayName = "SidebarContent"

const SidebarGroup = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  )
})
SidebarGroup.displayName = "SidebarGroup"

const SidebarGroupLabel = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "div"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-label"
      className={cn(
        "duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupLabel.displayName = "SidebarGroupLabel"

const SidebarGroupAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-action"
      className={cn(
        "absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupAction.displayName = "SidebarGroupAction"

const SidebarGroupContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="group-content"
    className={cn("w-full text-sm", className)}
    {...props}
  />
))
SidebarGroupContent.displayName = "SidebarGroupContent"

const SidebarMenu = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu"
    className={cn("flex w-full min-w-0 flex-col gap-1", className)}
    {...props}
  />
))
SidebarMenu.displayName = "SidebarMenu"

const SidebarMenuItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    data-sidebar="menu-item"
    className={cn("group/menu-item relative", className)}
    {...props}
  />
))
SidebarMenuItem.displayName = "SidebarMenuItem"

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:!p-0",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const SidebarMenuButton = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    isActive?: boolean
    tooltip?: string | React.ComponentProps<typeof TooltipContent>
  } & VariantProps<typeof sidebarMenuButtonVariants>
>(
  (
    {
      asChild = false,
      isActive = false,
      variant = "default",
      size = "default",
      tooltip,
      className,
      ...props
    },
    ref
  ) => {
    const Comp = asChild ? Slot : "button"
    const { isMobile, state } = useSidebar()

    const button = (
      <Comp
        ref={ref}
        data-sidebar="menu-button"
        data-size={size}
        data-active={isActive}
        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
        {...props}
      />
    )

    if (!tooltip) {
      return button
    }

    if (typeof tooltip === "string") {
      tooltip = {
        children: tooltip,
      }
    }

    return (
      <Tooltip>
        <TooltipTrigger asChild>{button}</TooltipTrigger>
        <TooltipContent
          side="right"
          align="center"
          hidden={state !== "collapsed" || isMobile}
          {...tooltip}
        />
      </Tooltip>
    )
  }
)
SidebarMenuButton.displayName = "SidebarMenuButton"

const SidebarMenuAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    showOnHover?: boolean
  }
>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-action"
      className={cn(
        "absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuAction.displayName = "SidebarMenuAction"

const SidebarMenuBadge = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="menu-badge"
    className={cn(
      "absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none",
      "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
      "peer-data-[size=sm]/menu-button:top-1",
      "peer-data-[size=default]/menu-button:top-1.5",
      "peer-data-[size=lg]/menu-button:top-2.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuBadge.displayName = "SidebarMenuBadge"

const SidebarMenuSkeleton = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    showIcon?: boolean
  }
>(({ className, showIcon = false, ...props }, ref) => {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      ref={ref}
      data-sidebar="menu-skeleton"
      className={cn("rounded-md h-8 flex gap-2 px-2 items-center", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 flex-1 max-w-[--skeleton-width]"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  )
})
SidebarMenuSkeleton.displayName = "SidebarMenuSkeleton"

const SidebarMenuSub = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu-sub"
    className={cn(
      "mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuSub.displayName = "SidebarMenuSub"

const SidebarMenuSubItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ ...props }, ref) => <li ref={ref} {...props} />)
SidebarMenuSubItem.displayName = "SidebarMenuSubItem"

const SidebarMenuSubButton = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentProps<"a"> & {
    asChild?: boolean
    size?: "sm" | "md"
    isActive?: boolean
  }
>(({ asChild = false, size = "md", isActive, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuSubButton.displayName = "SidebarMenuSubButton"

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}

\`\`\`

# dataextract-ey-main\src\components\ui\skeleton.tsx

\`\`\`tsx
import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      {...props}
    />
  )
}

export { Skeleton }

\`\`\`

# dataextract-ey-main\src\components\ui\slider.tsx

\`\`\`tsx
import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

const Slider = React.forwardRef<
  React.ElementRef<typeof SliderPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
>(({ className, ...props }, ref) => (
  <SliderPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex w-full touch-none select-none items-center",
      className
    )}
    {...props}
  >
    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-secondary">
      <SliderPrimitive.Range className="absolute h-full bg-primary" />
    </SliderPrimitive.Track>
    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
  </SliderPrimitive.Root>
))
Slider.displayName = SliderPrimitive.Root.displayName

export { Slider }

\`\`\`

# dataextract-ey-main\src\components\ui\sonner.tsx

\`\`\`tsx
import { useTheme } from "next-themes"
import { Toaster as Sonner, toast } from "sonner"

type ToasterProps = React.ComponentProps<typeof Sonner>

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      toastOptions={{
        classNames: {
          toast:
            "group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",
          description: "group-[.toast]:text-muted-foreground",
          actionButton:
            "group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",
          cancelButton:
            "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",
        },
      }}
      {...props}
    />
  )
}

export { Toaster, toast }

\`\`\`

# dataextract-ey-main\src\components\ui\switch.tsx

\`\`\`tsx
import * as React from "react"
import * as SwitchPrimitives from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

const Switch = React.forwardRef<
  React.ElementRef<typeof SwitchPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
>(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
      className
    )}
    {...props}
    ref={ref}
  >
    <SwitchPrimitives.Thumb
      className={cn(
        "pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"
      )}
    />
  </SwitchPrimitives.Root>
))
Switch.displayName = SwitchPrimitives.Root.displayName

export { Switch }

\`\`\`

# dataextract-ey-main\src\components\ui\table.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props}
    />
  </div>
))
Table.displayName = "Table"

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
))
TableHeader.displayName = "TableHeader"

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props}
  />
))
TableBody.displayName = "TableBody"

const TableFooter = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn(
      "border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",
      className
    )}
    {...props}
  />
))
TableFooter.displayName = "TableFooter"

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    )}
    {...props}
  />
))
TableRow.displayName = "TableRow"

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
      className
    )}
    {...props}
  />
))
TableHead.displayName = "TableHead"

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}
    {...props}
  />
))
TableCell.displayName = "TableCell"

const TableCaption = React.forwardRef<
  HTMLTableCaptionElement,
  React.HTMLAttributes<HTMLTableCaptionElement>
>(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn("mt-4 text-sm text-muted-foreground", className)}
    {...props}
  />
))
TableCaption.displayName = "TableCaption"

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}

\`\`\`

# dataextract-ey-main\src\components\ui\tabs.tsx

\`\`\`tsx
import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }

\`\`\`

# dataextract-ey-main\src\components\ui\textarea.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

export interface TextareaProps
  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}

const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, ...props }, ref) => {
    return (
      <textarea
        className={cn(
          "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Textarea.displayName = "Textarea"

export { Textarea }

\`\`\`

# dataextract-ey-main\src\components\ui\toast.tsx

\`\`\`tsx
import * as React from "react"
import * as ToastPrimitives from "@radix-ui/react-toast"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
      className
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
  {
    variants: {
      variant: {
        default: "border bg-background text-foreground",
        destructive:
          "destructive group border-destructive bg-destructive text-destructive-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
      className
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      "absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
      className
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn("text-sm font-semibold", className)}
    {...props}
  />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn("text-sm opacity-90", className)}
    {...props}
  />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}

\`\`\`

# dataextract-ey-main\src\components\ui\toaster.tsx

\`\`\`tsx
import { useToast } from "@/hooks/use-toast"
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from "@/components/ui/toast"

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}

\`\`\`

# dataextract-ey-main\src\components\ui\toggle-group.tsx

\`\`\`tsx
import * as React from "react"
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"
import { type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { toggleVariants } from "@/components/ui/toggle"

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
})

const ToggleGroup = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, children, ...props }, ref) => (
  <ToggleGroupPrimitive.Root
    ref={ref}
    className={cn("flex items-center justify-center gap-1", className)}
    {...props}
  >
    <ToggleGroupContext.Provider value={{ variant, size }}>
      {children}
    </ToggleGroupContext.Provider>
  </ToggleGroupPrimitive.Root>
))

ToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName

const ToggleGroupItem = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &
    VariantProps<typeof toggleVariants>
>(({ className, children, variant, size, ...props }, ref) => {
  const context = React.useContext(ToggleGroupContext)

  return (
    <ToggleGroupPrimitive.Item
      ref={ref}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        className
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  )
})

ToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName

export { ToggleGroup, ToggleGroupItem }

\`\`\`

# dataextract-ey-main\src\components\ui\toggle.tsx

\`\`\`tsx
import * as React from "react"
import * as TogglePrimitive from "@radix-ui/react-toggle"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const toggleVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-10 px-3",
        sm: "h-9 px-2.5",
        lg: "h-11 px-5",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const Toggle = React.forwardRef<
  React.ElementRef<typeof TogglePrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, ...props }, ref) => (
  <TogglePrimitive.Root
    ref={ref}
    className={cn(toggleVariants({ variant, size, className }))}
    {...props}
  />
))

Toggle.displayName = TogglePrimitive.Root.displayName

export { Toggle, toggleVariants }

\`\`\`

# dataextract-ey-main\src\components\ui\tooltip.tsx

\`\`\`tsx
import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }

\`\`\`

# dataextract-ey-main\src\components\ui\use-toast.ts

\`\`\`ts
import { useToast, toast } from "@/hooks/use-toast";

export { useToast, toast };

\`\`\`

# dataextract-ey-main\src\hooks\use-mobile.tsx

\`\`\`tsx
import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}

\`\`\`

# dataextract-ey-main\src\hooks\use-toast.ts

\`\`\`ts
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }

\`\`\`

# dataextract-ey-main\src\index.css

\`\`\`css

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 240 10% 14%;

    --card: 0 0% 100%;
    --card-foreground: 240 10% 14%;

    --popover: 0 0% 100%;
    --popover-foreground: 240 10% 14%;

    --primary: 52 100% 50%;
    --primary-foreground: 0 0% 0%;

    --secondary: 0 0% 96%;
    --secondary-foreground: 240 10% 14%;

    --muted: 240 5% 96%;
    --muted-foreground: 240 3.8% 46.1%;

    --accent: 0 0% 96%;
    --accent-foreground: 240 10% 14%;

    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 100%;

    --border: 240 5.9% 90%;
    --input: 240 5.9% 90%;
    --ring: 52 100% 50%;

    --radius: 0.5rem;

    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }

  .dark {
    --background: 0 0% 28%; /* #474747 - Outer Space */
    --foreground: 0 0% 98%;

    --card: 0 0% 28%;
    --card-foreground: 0 0% 98%;

    --popover: 0 0% 28%;
    --popover-foreground: 0 0% 98%;

    --primary: 52 100% 50%;
    --primary-foreground: 0 0% 0%;

    --secondary: 240 3.7% 15.9%;
    --secondary-foreground: 0 0% 98%;

    --muted: 240 3.7% 15.9%;
    --muted-foreground: 240 5% 64.9%;

    --accent: 240 3.7% 15.9%;
    --accent-foreground: 0 0% 98%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;

    --border: 240 3.7% 15.9%;
    --input: 240 3.7% 15.9%;
    --ring: 52 100% 50%;
    
    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
  }
  
  /* Apply dark mode universally to ensure all elements get the dark background */
  .dark body,
  .dark .bg-white {
    @apply bg-[#474747];
  }
  
  /* Make buttons yellow with black text in dark mode - fixed to avoid circular dependency */
  .dark button[data-state="active"] {
    background-color: #FFE600;
    color: black;
  }
  
  .dark .bg-yellow-400 {
    background-color: #FFE600;
    color: black;
  }
  
  /* Ensure yellow backgrounds always use black text for contrast */
  .bg-yellow-50, 
  .bg-yellow-100, 
  .bg-yellow-200, 
  .bg-yellow-300, 
  .bg-yellow-400, 
  .bg-yellow-500 {
    color: black;
  }
}

@layer components {
  .ey-button {
    @apply bg-ey-yellow hover:bg-ey-yellow/90 text-ey-black font-semibold py-2 px-4 rounded-md transition-colors;
  }
  
  .ey-input {
    @apply border border-ey-gray-400 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-ey-yellow;
  }

  .ey-card {
    @apply bg-white rounded-lg shadow-md p-6 border border-ey-gray-300 hover:shadow-lg transition-shadow dark:bg-background dark:border-ey-gray-700;
  }
}

\`\`\`

# dataextract-ey-main\src\lib\excelUtils.ts

\`\`\`ts

import * as XLSX from 'xlsx';
import { PromptOption } from './types';

// Parse Excel file and extract prompts
export const parseExcelPrompts = async (file: File): Promise<PromptOption[]> => {
  try {
    // Read the Excel file
    const data = await file.arrayBuffer();
    const workbook = XLSX.read(data);
    
    // Get the first worksheet
    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
    
    // Convert the worksheet to JSON
    const jsonData = XLSX.utils.sheet_to_json(worksheet);
    
    // Map the JSON data to PromptOption format
    const prompts: PromptOption[] = jsonData.map((row: any, index) => {
      return {
        id: `custom-${index}`,
        name: row['Prompt Name'] || row['Name'] || `Custom Prompt ${index + 1}`,
        description: row['Description'] || 'Custom prompt from Excel file',
        template: row['Template'] || 'Custom_Template',
        category: row['Category'] || 'Custom'
      };
    });
    
    return prompts;
  } catch (error) {
    console.error('Error parsing Excel file:', error);
    throw new Error('Failed to parse Excel file. Please check the format.');
  }
};

// Generate more realistic extraction results based on prompts
export const generateRealisticResults = (promptName: string) => {
  // Create more realistic data based on prompt name/type
  switch (promptName.toLowerCase()) {
    case 'ecl by stage':
      return [
        { Category: "ECL by Stage", Stage: "Stage 1", Field: "Gross Carrying Amount", Value: "$1,245.67m" },
        { Category: "ECL by Stage", Stage: "Stage 1", Field: "Loss Allowance", Value: "$12.45m" },
        { Category: "ECL by Stage", Stage: "Stage 1", Field: "Coverage Ratio", Value: "1.00%" },
        { Category: "ECL by Stage", Stage: "Stage 2", Field: "Gross Carrying Amount", Value: "$428.91m" },
        { Category: "ECL by Stage", Stage: "Stage 2", Field: "Loss Allowance", Value: "$21.45m" },
        { Category: "ECL by Stage", Stage: "Stage 2", Field: "Coverage Ratio", Value: "5.00%" },
        { Category: "ECL by Stage", Stage: "Stage 3", Field: "Gross Carrying Amount", Value: "$85.34m" },
        { Category: "ECL by Stage", Stage: "Stage 3", Field: "Loss Allowance", Value: "$42.67m" },
        { Category: "ECL by Stage", Stage: "Stage 3", Field: "Coverage Ratio", Value: "50.00%" }
      ];
    case 'management adjustments':
      return [
        { Category: "Management Adjustments", Stage: "N/A", Field: "Economic Uncertainty", Value: "$24.5m" },
        { Category: "Management Adjustments", Stage: "N/A", Field: "Model Limitations", Value: "$12.3m" },
        { Category: "Management Adjustments", Stage: "N/A", Field: "Other Adjustments", Value: "$5.8m" },
        { Category: "Management Adjustments", Stage: "N/A", Field: "Total Overlays", Value: "$42.6m" }
      ];
    case 'scenario weights':
      return [
        { Category: "Scenario Weights", Stage: "N/A", Field: "Baseline", Value: "40%" },
        { Category: "Scenario Weights", Stage: "N/A", Field: "Upside", Value: "30%" },
        { Category: "Scenario Weights", Stage: "N/A", Field: "Downside", Value: "30%" }
      ];
    case 'macro variables':
      return [
        { Category: "Macro Variables", Stage: "Baseline", Field: "GDP Growth", Value: "1.3%" },
        { Category: "Macro Variables", Stage: "Baseline", Field: "Unemployment", Value: "4.2%" },
        { Category: "Macro Variables", Stage: "Baseline", Field: "HPI Growth", Value: "1.8%" },
        { Category: "Macro Variables", Stage: "Upside", Field: "GDP Growth", Value: "2.5%" },
        { Category: "Macro Variables", Stage: "Upside", Field: "Unemployment", Value: "3.7%" },
        { Category: "Macro Variables", Stage: "Upside", Field: "HPI Growth", Value: "3.2%" },
        { Category: "Macro Variables", Stage: "Downside", Field: "GDP Growth", Value: "-0.5%" },
        { Category: "Macro Variables", Stage: "Downside", Field: "Unemployment", Value: "5.8%" },
        { Category: "Macro Variables", Stage: "Downside", Field: "HPI Growth", Value: "-2.1%" }
      ];
    default:
      return [
        { Category: promptName, Stage: "N/A", Field: "Value 1", Value: "$123.45m" },
        { Category: promptName, Stage: "N/A", Field: "Value 2", Value: "$67.89m" },
        { Category: promptName, Stage: "N/A", Field: "Ratio", Value: "55.00%" }
      ];
  }
};

\`\`\`

# dataextract-ey-main\src\lib\types.ts

\`\`\`ts

// Types for the financial data extraction app

export interface UploadedFile {
  id: string;
  name: string;
  size: number;
  type: string;
  lastModified: number;
  status: 'pending' | 'processing' | 'success' | 'error';
  progress?: number;
}

export interface PromptOption {
  id: string;
  name: string;
  description: string;
  template: string;
  category: string;
}

export interface ExtractedData {
  Category: string;
  Stage: string;
  Field: string;
  Value: string;
}

export interface ProcessingResult {
  id: string;
  fileId: string;
  fileName: string;
  promptId: string;
  promptName: string;
  status: 'pending' | 'processing' | 'success' | 'error';
  timestamp: string;
  data?: ExtractedData[];
  notes?: string;
  error?: string;
}

// Mock data for default prompts
export const DEFAULT_PROMPTS: PromptOption[] = [
  {
    id: 'ecl-by-stage',
    name: 'ECL By Stage',
    description: 'Extract Expected Credit Loss data broken down by stages',
    template: 'ECL_By_Stage',
    category: 'Credit Risk'
  },
  {
    id: 'management-adjustments',
    name: 'Management Adjustments',
    description: 'Extract information about management adjustments to ECL',
    template: 'Management_Adjustments',
    category: 'Credit Risk'
  },
  {
    id: 'scenario-weights',
    name: 'Scenario Weights',
    description: 'Extract economic scenario weightings',
    template: 'Scenario_Weights',
    category: 'Economic Scenarios'
  },
  {
    id: 'macro-variables',
    name: 'Macro Variables',
    description: 'Extract macroeconomic variables used in models',
    template: 'Macro_Variables',
    category: 'Economic Scenarios'
  },
  {
    id: 'credit-quality',
    name: 'Credit Quality',
    description: 'Extract credit quality indicators',
    template: 'Credit_Quality',
    category: 'Credit Risk'
  },
  {
    id: 'loan-loss-rate',
    name: 'Loan Loss Rate',
    description: 'Extract loan loss rate data',
    template: 'Loan_Loss_Rate',
    category: 'Credit Risk'
  },
  {
    id: 'staging-criteria',
    name: 'Staging Criteria',
    description: 'Extract criteria used for staging classification',
    template: 'Staging_Criteria',
    category: 'Methodology'
  },
  {
    id: 'sensitivity-analysis',
    name: 'Sensitivity Analysis',
    description: 'Extract sensitivity analysis results',
    template: 'Sensitivity_Analysis',
    category: 'Economic Scenarios'
  }
];

// Mock data for extracted results (for UI demonstration)
export const MOCK_EXTRACTED_DATA: ExtractedData[] = [
  { Category: 'ECL', Stage: 'Stage 1', Field: 'Retail Loans', Value: '125,000,000' },
  { Category: 'ECL', Stage: 'Stage 1', Field: 'Corporate Loans', Value: '372,500,000' },
  { Category: 'ECL', Stage: 'Stage 2', Field: 'Retail Loans', Value: '89,300,000' },
  { Category: 'ECL', Stage: 'Stage 2', Field: 'Corporate Loans', Value: '246,800,000' },
  { Category: 'ECL', Stage: 'Stage 3', Field: 'Retail Loans', Value: '43,200,000' },
  { Category: 'ECL', Stage: 'Stage 3', Field: 'Corporate Loans', Value: '118,500,000' },
  { Category: 'Summary', Stage: 'N/A', Field: 'Total ECL', Value: '995,300,000' },
  { Category: 'Summary', Stage: 'N/A', Field: 'Coverage Ratio', Value: '2.3%' }
];

\`\`\`

# dataextract-ey-main\src\lib\utils.ts

\`\`\`ts

import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

/**
 * Ensures proper text contrast on colored backgrounds
 * @param bgColor - The background color class (e.g., 'bg-yellow-400')
 * @returns string - The appropriate text color class
 */
export function getTextColorForBackground(bgColor: string): string {
  // Yellow backgrounds should always have black text
  if (
    bgColor.includes('yellow') || 
    bgColor.includes('lime') || 
    bgColor.includes('green-300') ||
    bgColor.includes('amber')
  ) {
    return 'text-black';
  }
  
  // Dark backgrounds should have white text
  if (
    bgColor.includes('black') || 
    bgColor.includes('gray-800') || 
    bgColor.includes('gray-900') ||
    bgColor.includes('slate-800') ||
    bgColor.includes('slate-900')
  ) {
    return 'text-white';
  }
  
  // Default - use the current text color
  return '';
}

\`\`\`

# dataextract-ey-main\src\main.tsx

\`\`\`tsx

import { createRoot } from 'react-dom/client'
import App from './App.tsx'
import './index.css'

// Create root and render app
createRoot(document.getElementById("root")!).render(<App />);

\`\`\`

# dataextract-ey-main\src\pages\BankSelection.tsx

\`\`\`tsx

import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Button } from '@/components/ui/button';
import { 
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue
} from '@/components/ui/select';
import { ArrowRight, Check } from 'lucide-react';
import { Checkbox } from '@/components/ui/checkbox';
import { Label } from '@/components/ui/label';

const banks = [
  { id: 'barclays', name: 'Barclays' },
  { id: 'hsbc', name: 'HSBC' },
  { id: 'lloyds', name: 'Lloyds Banking Group' },
  { id: 'natwest', name: 'NatWest Group' },
  { id: 'santander', name: 'Santander UK' },
  { id: 'standard', name: 'Standard Chartered' }
];

const BankSelection = () => {
  const navigate = useNavigate();
  const [selectedBank, setSelectedBank] = useState<string>('');
  const [selectedBanks, setSelectedBanks] = useState<string[]>([]);
  const [enableMultiBanks, setEnableMultiBanks] = useState<boolean>(false);

  // Update selected banks when toggling multi-bank mode
  useEffect(() => {
    if (enableMultiBanks) {
      // If switching to multi-bank mode, initialize with the current selection
      if (selectedBank && !selectedBanks.includes(selectedBank)) {
        setSelectedBanks([selectedBank]);
      }
    } else {
      // If switching to single bank mode, use the first selected bank or empty
      setSelectedBank(selectedBanks.length > 0 ? selectedBanks[0] : '');
    }
  }, [enableMultiBanks]);

  const handleContinue = () => {
    if ((enableMultiBanks && selectedBanks.length > 0) || (!enableMultiBanks && selectedBank)) {
      // Store the selected bank(s) in session storage for use across the application
      sessionStorage.setItem('selectedBank', enableMultiBanks ? selectedBanks[0] : selectedBank);
      sessionStorage.setItem('selectedBanks', JSON.stringify(enableMultiBanks ? selectedBanks : [selectedBank]));
      sessionStorage.setItem('enableMultiBanks', enableMultiBanks.toString());
      navigate('/dashboard');
    }
  };

  const toggleBankSelection = (bankId: string) => {
    setSelectedBanks(prevSelected => {
      if (prevSelected.includes(bankId)) {
        return prevSelected.filter(id => id !== bankId);
      } else {
        return [...prevSelected, bankId];
      }
    });
  };

  // Check if a bank is selected in multi-bank mode
  const isBankSelected = (bankId: string) => {
    return selectedBanks.includes(bankId);
  };

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-ey-black text-white">
      <div className="w-full max-w-md px-6 py-12 text-center">
        <div className="mb-8">
          <div className="flex justify-center mb-6">
            <div className="h-16 w-16 bg-ey-yellow rounded-md"></div>
          </div>
          
          <h1 className="text-4xl font-bold mb-2">AiDEx</h1>
          <p className="text-ey-gray-400">
            AI powered Data Extraction
          </p>
          <p className="text-ey-gray-500 text-sm mt-1">
            Supported by EYQ
          </p>
        </div>
        
        <div className="border border-ey-gray-700 rounded-lg p-6 mb-8">
          <h2 className="text-xl font-semibold mb-6">Select Bank</h2>
          <p className="text-sm text-ey-gray-400 mb-6">
            Choose the bank you want to analyze for data extraction.
          </p>
          
          <div className="space-y-4">
            <div className="flex items-center space-x-3 mt-4 mb-4 p-3 bg-ey-gray-800/50 rounded-md">
              <Checkbox 
                id="enableMultiBanks" 
                checked={enableMultiBanks} 
                onCheckedChange={(checked) => setEnableMultiBanks(checked as boolean)}
                className="data-[state=checked]:bg-ey-yellow data-[state=checked]:text-black"
              />
              <Label htmlFor="enableMultiBanks" className="text-sm cursor-pointer">
                Enable multi-bank analysis & comparison
              </Label>
            </div>

            {enableMultiBanks ? (
              // Multi-bank selection UI
              <div className="space-y-2">
                <label className="text-sm font-medium mb-1 block text-left">
                  Financial Institutions
                </label>
                <div className="border border-ey-gray-600 bg-ey-black text-white rounded-md p-1">
                  <div className="space-y-1">
                    {banks.map(bank => (
                      <div 
                        key={bank.id}
                        onClick={() => toggleBankSelection(bank.id)}
                        className={`flex items-center justify-between p-3 rounded-md cursor-pointer transition-colors ${
                          isBankSelected(bank.id) ? 'bg-ey-yellow/20 border border-ey-yellow' : 'hover:bg-ey-gray-800'
                        }`}
                      >
                        <span className="text-sm">{bank.name}</span>
                        {isBankSelected(bank.id) && (
                          <Check className="h-4 w-4 text-ey-yellow" />
                        )}
                      </div>
                    ))}
                  </div>
                </div>
                {selectedBanks.length === 0 && (
                  <p className="text-xs text-ey-yellow mt-1">Please select at least one bank</p>
                )}
              </div>
            ) : (
              // Single bank selection UI
              <div className="text-left">
                <label className="text-sm font-medium mb-1 block">
                  Financial Institution
                </label>
                <Select onValueChange={setSelectedBank} value={selectedBank}>
                  <SelectTrigger className="w-full border-ey-gray-600 bg-ey-black text-white">
                    <SelectValue placeholder="Select a bank" />
                  </SelectTrigger>
                  <SelectContent className="bg-ey-black text-white border-ey-gray-700">
                    {banks.map(bank => (
                      <SelectItem key={bank.id} value={bank.id} className="hover:bg-ey-gray-800">
                        {bank.name}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
            )}
            
            <Button 
              onClick={handleContinue}
              disabled={enableMultiBanks ? selectedBanks.length === 0 : !selectedBank}
              className="w-full bg-ey-yellow hover:bg-ey-yellow/90 text-ey-black font-medium mt-6"
            >
              Continue to Dashboard
              <ArrowRight className="ml-2 h-4 w-4" />
            </Button>
          </div>
        </div>
        
        <div className="text-xs text-ey-gray-500">
          <p>© {new Date().getFullYear()} EY | A better working world</p>
        </div>
      </div>
    </div>
  );
};

export default BankSelection;

\`\`\`

# dataextract-ey-main\src\pages\Dashboard.tsx

\`\`\`tsx
import { useState } from 'react';
import { Tabs, TabsContent } from '@/components/ui/tabs';
import { useToast } from '@/hooks/use-toast';
import { UploadedFile, PromptOption, ProcessingResult } from '@/lib/types';
import { generateRealisticResults } from '@/lib/excelUtils';
import TabNavigation from '@/components/dashboard/TabNavigation';
import UploadTab from '@/components/dashboard/UploadTab';
import PromptsTab from '@/components/dashboard/PromptsTab';
import ResultsTab from '@/components/dashboard/ResultsTab';
import CombinedTab from '@/components/dashboard/CombinedTab';
import SideBySideTab from '@/components/dashboard/SideBySideTab';
import Footer from '@/components/dashboard/Footer';
import { Button } from '@/components/ui/button';

const Dashboard = () => {
  const [uploadedFiles, setUploadedFiles] = useState<UploadedFile[]>([]);
  const [selectedPrompts, setSelectedPrompts] = useState<PromptOption[]>([]);
  const [results, setResults] = useState<ProcessingResult[]>([]);
  const [isProcessing, setIsProcessing] = useState(false);
  const [processingStep, setProcessingStep] = useState('');
  const [processingProgress, setProcessingProgress] = useState(0);
  const [activeTab, setActiveTab] = useState('upload');
  const { toast } = useToast();
  const selectedBank = sessionStorage.getItem('selectedBank') || 'barclays';

  // Handle uploaded files
  const handleFilesUploaded = (files: UploadedFile[]) => {
    setUploadedFiles(files);
  };

  // Handle prompt selection
  const handlePromptSelected = (prompts: PromptOption[]) => {
    setSelectedPrompts(prompts);
    if (prompts.length > 0) {
      toast({
        title: "Prompts Selected",
        description: `${prompts.length} extraction ${prompts.length === 1 ? 'prompt' : 'prompts'} selected`,
      });
    }
  };

  // Simulate the processing function
  const processFiles = async () => {
    if (uploadedFiles.length === 0) {
      toast({
        title: "No files to process",
        description: "Please upload at least one PDF file.",
        variant: "destructive",
      });
      return;
    }

    if (selectedPrompts.length === 0) {
      toast({
        title: "No prompts selected",
        description: "Please select at least one extraction prompt.",
        variant: "destructive",
      });
      return;
    }

    // Start processing
    setIsProcessing(true);
    setProcessingStep('Initializing extraction process...');
    setProcessingProgress(0);
    setActiveTab('results');
    
    // Generate a unique session ID
    const sessionId = Date.now().toString(); 

    try {
      // We assume `uploadedFiles` now contains the metadata returned 
      // by `/api/upload` (handled by UploadTab). 
      // We directly call `/api/process`.

      const processResponse = await fetch('http://localhost:5000/api/process', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          files: uploadedFiles, // Send the metadata we already have
          prompts: selectedPrompts,
          sessionId: sessionId // Use the generated session ID
        })
      });

      if (!processResponse.ok) {
          const errorData = await processResponse.json();
          throw new Error(errorData.error || `Processing failed with status: ${processResponse.status}`);
      }

      const processData = await processResponse.json();
      
      // Update results
      setResults(processData.results);
      setIsProcessing(false);
      
      toast({
        title: "Processing Complete",
        description: `Processed ${uploadedFiles.length} files with ${selectedPrompts.length} prompts`,
      });

      // Optionally, you might want to start polling /api/status/<sessionId> here
      // if the processing is long-running, instead of expecting
      // immediate results. For now, we assume /api/process returns
      // the final results directly as per your Python code.

    } catch (error) {
      setIsProcessing(false);
      console.error("Processing Error:", error); // Log the error
      toast({
        title: "Processing Error",
        description: error instanceof Error ? error.message : "An unknown error occurred during processing.",
        variant: "destructive",
      });
    }
  };

  // Simulate downloading results
  const handleDownloadResults = () => {
    toast({
      title: "Downloading Results",
      description: "Your results would download as an Excel file in a real implementation.",
    });
  };

  // Reset everything
  const handleReset = () => {
    setUploadedFiles([]);
    setSelectedPrompts([]);
    setResults([]);
    setActiveTab('upload');
    toast({
      title: "Reset Complete",
      description: "All files and prompts have been cleared.",
    });
  };

  // Navigate to the next tab
  const goToNextTab = () => {
    if (activeTab === 'upload') setActiveTab('prompts');
    else if (activeTab === 'prompts') {
      processFiles();
    }
  };

  // Go back to previous tab
  const goToPreviousTab = () => {
    if (activeTab === 'prompts') setActiveTab('upload');
    else if (activeTab === 'results') setActiveTab('prompts');
  };
  
  return (
    <div className="min-h-screen flex flex-col bg-white">
      {/* Bank indicator */}
      <div className="bg-yellow-400 text-black py-1 px-4 text-sm flex justify-between">
        <div>
          Selected Bank: <span className="font-semibold">{selectedBank.charAt(0).toUpperCase() + selectedBank.slice(1)}</span>
        </div>
        <Button 
          variant="link" 
          size="sm" 
          onClick={() => window.location.href = '/'}
          className="h-auto p-0 text-black underline text-xs"
        >
          Change
        </Button>
      </div>
      
      {/* Tabs header */}
      <TabNavigation activeTab={activeTab} setActiveTab={setActiveTab} />

      {/* Main Content */}
      <main className="flex-grow container mx-auto px-4 py-6">
        <Tabs value={activeTab}>
          <TabsContent value="upload" className="space-y-6">
            <UploadTab 
              onFilesUploaded={handleFilesUploaded}
              uploadedFiles={uploadedFiles}
              goToNextTab={goToNextTab}
            />
          </TabsContent>
          
          <TabsContent value="prompts" className="space-y-6">
            <div className="flex flex-col space-y-4">
              <PromptsTab 
                onPromptSelected={handlePromptSelected}
                isProcessing={isProcessing}
              />
              
              <div className="flex justify-between mt-4">
                <Button 
                  onClick={goToPreviousTab}
                  variant="outline"
                >
                  Back to Upload
                </Button>
                
                <Button 
                  onClick={processFiles}
                  disabled={isProcessing || selectedPrompts.length === 0}
                  className="bg-yellow-400 hover:bg-yellow-500 text-black"
                >
                  Process Files
                </Button>
              </div>
            </div>
          </TabsContent>
          
          <TabsContent value="results" className="space-y-6">
            <ResultsTab 
              results={results}
              onDownloadResults={handleDownloadResults}
              isProcessing={isProcessing}
              processingProgress={processingProgress}
              processingStep={processingStep}
            />
          </TabsContent>
          
          <TabsContent value="combined" className="space-y-6">
            <CombinedTab 
              results={results} 
              onDownloadResults={handleDownloadResults} 
            />
          </TabsContent>

          <TabsContent value="sidebyside" className="space-y-6">
            <SideBySideTab results={results} />
          </TabsContent>
        </Tabs>
      </main>
      
      {/* Footer */}
      <Footer />
    </div>
  );
};

export default Dashboard;

\`\`\`

# dataextract-ey-main\src\pages\Index.tsx

\`\`\`tsx

import { useState } from 'react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { UploadedFile, PromptOption, ProcessingResult } from '@/lib/types';
import { Button } from '@/components/ui/button';
import FileUploader from '@/components/FileUploader';
import PromptSelector from '@/components/PromptSelector';
import ResultsViewer from '@/components/ResultsViewer';
import { useToast } from '@/hooks/use-toast';
import { Download, Upload, FileText, FileSpreadsheet } from 'lucide-react';
import { generateRealisticResults } from '@/lib/excelUtils';

const Index = () => {
  const [uploadedFiles, setUploadedFiles] = useState<UploadedFile[]>([]);
  const [selectedPrompts, setSelectedPrompts] = useState<PromptOption[]>([]);
  const [results, setResults] = useState<ProcessingResult[]>([]);
  const [isProcessing, setIsProcessing] = useState(false);
  const [processingStep, setProcessingStep] = useState('');
  const [processingProgress, setProcessingProgress] = useState(0);
  const [activeTab, setActiveTab] = useState('upload');
  const { toast } = useToast();

  // Handle uploaded files
  const handleFilesUploaded = (files: UploadedFile[]) => {
    setUploadedFiles(files);
  };

  // Handle prompt selection
  const handlePromptSelected = (prompts: PromptOption[]) => {
    setSelectedPrompts(prompts);
    if (prompts.length > 0) {
      toast({
        title: "Prompts Selected",
        description: `${prompts.length} extraction ${prompts.length === 1 ? 'prompt' : 'prompts'} selected`,
      });
    }
  };

  // Simulate the processing function
  const processFiles = async () => {
    if (uploadedFiles.length === 0) {
      toast({
        title: "No files to process",
        description: "Please upload at least one PDF file.",
        variant: "destructive",
      });
      return;
    }

    if (selectedPrompts.length === 0) {
      toast({
        title: "No prompts selected",
        description: "Please select at least one extraction prompt.",
        variant: "destructive",
      });
      return;
    }

    // Start processing
    setIsProcessing(true);
    setProcessingStep('Initializing extraction process...');
    setProcessingProgress(5);
    setActiveTab('results');

    const newResults: ProcessingResult[] = [];

    // Simulate processing for each file and prompt
    let completedItems = 0;
    const totalItems = uploadedFiles.length * selectedPrompts.length;

    for (const file of uploadedFiles) {
      // Simulate parsing the file
      setProcessingStep(`Parsing ${file.name}...`);
      await new Promise(resolve => setTimeout(resolve, 1000));
      setProcessingProgress(10 + (completedItems / totalItems) * 30);

      // For each prompt, create a result
      for (const prompt of selectedPrompts) {
        setProcessingStep(`Extracting ${prompt.name} from ${file.name}...`);
        
        // Simulate API request delay
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // Create a result with either success or random error
        const isSuccess = Math.random() > 0.05; // 95% success rate for demo
        
        const result: ProcessingResult = {
          id: `result-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
          fileId: file.id,
          fileName: file.name,
          promptId: prompt.id,
          promptName: prompt.name,
          status: isSuccess ? 'success' : 'error',
          timestamp: new Date().toISOString(),
          data: isSuccess ? generateRealisticResults(prompt.name) : undefined,
          notes: isSuccess 
            ? `Extraction completed successfully for ${prompt.name}.` 
            : undefined,
          error: isSuccess 
            ? undefined 
            : "Could not find relevant information in the document or the format was not recognized."
        };
        
        newResults.push(result);
        completedItems++;
        setProcessingProgress(10 + (completedItems / totalItems) * 80);
      }
    }

    // Final processing step
    setProcessingStep('Finalizing results...');
    await new Promise(resolve => setTimeout(resolve, 1000));
    setProcessingProgress(100);

    // Update results and finish processing
    setResults([...results, ...newResults]);
    setIsProcessing(false);
    
    toast({
      title: "Processing Complete",
      description: `Processed ${uploadedFiles.length} files with ${selectedPrompts.length} prompts`,
      variant: "default",
    });
  };

  // Simulate downloading results
  const handleDownloadResults = () => {
    toast({
      title: "Downloading Results",
      description: "Your results would download as an Excel file in a real implementation.",
    });
  };

  // Reset everything
  const handleReset = () => {
    setUploadedFiles([]);
    setSelectedPrompts([]);
    setResults([]);
    setActiveTab('upload');
    toast({
      title: "Reset Complete",
      description: "All files and prompts have been cleared.",
    });
  };

  // Navigate to the next tab
  const goToNextTab = () => {
    if (activeTab === 'upload') setActiveTab('prompts');
    else if (activeTab === 'prompts') {
      processFiles();
    }
  };

  // Go back to previous tab
  const goToPreviousTab = () => {
    if (activeTab === 'prompts') setActiveTab('upload');
    else if (activeTab === 'results') setActiveTab('prompts');
  };

  return (
    <div className="min-h-screen flex flex-col bg-white">
      {/* Tabs header */}
      <div className="border-b">
        <div className="container mx-auto px-4">
          <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
            <TabsList className="grid grid-cols-4 w-full max-w-2xl mx-auto my-4">
              <TabsTrigger 
                value="upload" 
                className={activeTab === 'upload' ? 'bg-yellow-400 text-black' : ''}
              >
                <Upload className="h-4 w-4 mr-2" />
                Upload
              </TabsTrigger>
              <TabsTrigger 
                value="prompts" 
                className={activeTab === 'prompts' ? 'bg-yellow-400 text-black' : ''}
              >
                <FileText className="h-4 w-4 mr-2" />
                Prompts
              </TabsTrigger>
              <TabsTrigger 
                value="results" 
                className={activeTab === 'results' ? 'bg-yellow-400 text-black' : ''}
              >
                <FileSpreadsheet className="h-4 w-4 mr-2" />
                Results
              </TabsTrigger>
              <TabsTrigger 
                value="combined" 
                className={activeTab === 'combined' ? 'bg-yellow-400 text-black' : ''}
              >
                <Download className="h-4 w-4 mr-2" />
                Combined
              </TabsTrigger>
            </TabsList>
          </Tabs>
        </div>
      </div>

      {/* Main Content */}
      <main className="flex-grow container mx-auto px-4 py-6">
        <Tabs value={activeTab}>
          {/* Upload Tab */}
          <TabsContent value="upload" className="space-y-6">
            <div className="grid grid-cols-1 gap-6">
              <FileUploader 
                onFilesUploaded={handleFilesUploaded}
                acceptedFileTypes={['.pdf']}
              />
              
              <div className="flex justify-end">
                <Button 
                  onClick={goToNextTab} 
                  disabled={uploadedFiles.length === 0}
                  className="bg-yellow-400 hover:bg-yellow-500 text-black"
                >
                  Next: Select Prompts
                </Button>
              </div>
            </div>
          </TabsContent>
          
          {/* Prompts Tab */}
          <TabsContent value="prompts" className="space-y-6">
            <PromptSelector 
              onPromptSelected={handlePromptSelected} 
              disabled={isProcessing}
            />
          </TabsContent>
          
          {/* Results Tab */}
          <TabsContent value="results" className="space-y-6">
            <ResultsViewer 
              results={results}
              onDownloadResults={handleDownloadResults}
              isProcessing={isProcessing}
              processingProgress={processingProgress}
              processingStep={processingStep}
            />
          </TabsContent>
          
          {/* Combined Tab */}
          <TabsContent value="combined" className="space-y-6">
            <div className="space-y-6">
              <div className="flex justify-between items-center">
                <div>
                  <h2 className="text-lg font-semibold mb-1">IFRS9 Combined Results</h2>
                  <p className="text-sm text-muted-foreground">
                    View and download the final processed IFRS9 data in Excel format
                  </p>
                </div>
                <Button 
                  variant="outline" 
                  size="sm" 
                  onClick={handleDownloadResults}
                  className="flex items-center gap-1 border-yellow-400 bg-white text-black hover:bg-yellow-50"
                >
                  <Download className="h-4 w-4" />
                  <span>Download Excel</span>
                </Button>
              </div>
              
              <div className="border rounded-lg overflow-hidden">
                <div className="flex justify-between items-center p-3 bg-muted border-b">
                  <Button 
                    variant="outline" 
                    size="sm" 
                    className="py-1 h-8 bg-yellow-400 hover:bg-yellow-500 border-none text-black"
                  >
                    Combined View
                  </Button>
                  <div className="text-sm text-muted-foreground">
                    28 rows
                  </div>
                </div>
                
                <div className="h-[500px] overflow-y-auto">
                  <table className="w-full text-sm">
                    <thead className="bg-muted/70 sticky top-0">
                      <tr>
                        <th className="p-3 text-left font-semibold text-black">Category</th>
                        <th className="p-3 text-left font-semibold text-black">Stage</th>
                        <th className="p-3 text-left font-semibold text-black">Field</th>
                        <th className="p-3 text-left font-semibold text-black">Value</th>
                        <th className="p-3 text-left font-semibold text-black">Source</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 1</td>
                        <td className="p-3">Gross Carrying Amount</td>
                        <td className="p-3">$1,029.66m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 1</td>
                        <td className="p-3">Loss Allowance</td>
                        <td className="p-3">$12.64m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 1</td>
                        <td className="p-3">Coverage Ratio</td>
                        <td className="p-3">0.94%</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 2</td>
                        <td className="p-3">Gross Carrying Amount</td>
                        <td className="p-3">$502.11m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 2</td>
                        <td className="p-3">Loss Allowance</td>
                        <td className="p-3">$20.71m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 2</td>
                        <td className="p-3">Coverage Ratio</td>
                        <td className="p-3">6.35%</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </TabsContent>
        </Tabs>
      </main>
      
      {/* Footer */}
      <footer className="bg-gray-100 border-t mt-auto py-4">
        <div className="container mx-auto px-4">
          <div className="flex justify-between items-center text-sm text-muted-foreground">
            <div>IFRS9 Data Extraction Tool</div>
            <div>© {new Date().getFullYear()} Barclays Financial Services</div>
          </div>
        </div>
      </footer>
    </div>
  );
};

export default Index;

\`\`\`

# dataextract-ey-main\src\pages\NotFound.tsx

\`\`\`tsx
import { useLocation } from "react-router-dom";
import { useEffect } from "react";

const NotFound = () => {
  const location = useLocation();

  useEffect(() => {
    console.error(
      "404 Error: User attempted to access non-existent route:",
      location.pathname
    );
  }, [location.pathname]);

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <div className="text-center">
        <h1 className="text-4xl font-bold mb-4">404</h1>
        <p className="text-xl text-gray-600 mb-4">Oops! Page not found</p>
        <a href="/" className="text-blue-500 hover:text-blue-700 underline">
          Return to Home
        </a>
      </div>
    </div>
  );
};

export default NotFound;

\`\`\`

# dataextract-ey-main\src\vite-env.d.ts

\`\`\`ts
/// <reference types="vite/client" />

\`\`\`

# dataextract-ey-main\tailwind.config.ts

\`\`\`ts

import type { Config } from "tailwindcss";

export default {
	darkMode: ["class"],
	content: [
		"./pages/**/*.{ts,tsx}",
		"./components/**/*.{ts,tsx}",
		"./app/**/*.{ts,tsx}",
		"./src/**/*.{ts,tsx}",
	],
	prefix: "",
	theme: {
		container: {
			center: true,
			padding: '2rem',
			screens: {
				'2xl': '1400px'
			}
		},
		extend: {
			colors: {
				border: 'hsl(var(--border))',
				input: 'hsl(var(--input))',
				ring: 'hsl(var(--ring))',
				background: 'hsl(var(--background))',
				foreground: 'hsl(var(--foreground))',
				primary: {
					DEFAULT: 'hsl(var(--primary))',
					foreground: 'hsl(var(--primary-foreground))'
				},
				secondary: {
					DEFAULT: 'hsl(var(--secondary))',
					foreground: 'hsl(var(--secondary-foreground))'
				},
				destructive: {
					DEFAULT: 'hsl(var(--destructive))',
					foreground: 'hsl(var(--destructive-foreground))'
				},
				muted: {
					DEFAULT: 'hsl(var(--muted))',
					foreground: 'hsl(var(--muted-foreground))'
				},
				accent: {
					DEFAULT: 'hsl(var(--accent))',
					foreground: 'hsl(var(--accent-foreground))'
				},
				popover: {
					DEFAULT: 'hsl(var(--popover))',
					foreground: 'hsl(var(--popover-foreground))'
				},
				card: {
					DEFAULT: 'hsl(var(--card))',
					foreground: 'hsl(var(--card-foreground))'
				},
				sidebar: {
					DEFAULT: 'hsl(var(--sidebar-background))',
					foreground: 'hsl(var(--sidebar-foreground))',
					primary: 'hsl(var(--sidebar-primary))',
					'primary-foreground': 'hsl(var(--sidebar-primary-foreground))',
					accent: 'hsl(var(--sidebar-accent))',
					'accent-foreground': 'hsl(var(--sidebar-accent-foreground))',
					border: 'hsl(var(--sidebar-border))',
					ring: 'hsl(var(--sidebar-ring))'
				},
				ey: {
					black: '#000000',
					yellow: '#FFE600',
					white: '#FFFFFF',
					gray: {
						100: '#F6F6F7',
						200: '#F1F1F1', 
						300: '#EAEAEA',
						400: '#C8C8C9',
						500: '#9F9EA1',
						600: '#8A898C',
						700: '#555555',
						800: '#403E43',
						900: '#221F26'
					}
				}
			},
			borderRadius: {
				lg: 'var(--radius)',
				md: 'calc(var(--radius) - 2px)',
				sm: 'calc(var(--radius) - 4px)'
			},
			keyframes: {
				'accordion-down': {
					from: {
						height: '0'
					},
					to: {
						height: 'var(--radix-accordion-content-height)'
					}
				},
				'accordion-up': {
					from: {
						height: 'var(--radix-accordion-content-height)'
					},
					to: {
						height: '0'
					}
				},
				'pulse-gentle': {
					'0%, 100%': { opacity: '1' },
					'50%': { opacity: '0.7' }
				},
				'fade-in': {
					'0%': { opacity: '0' },
					'100%': { opacity: '1' }
				},
				'slide-up': {
					'0%': { transform: 'translateY(20px)', opacity: '0' },
					'100%': { transform: 'translateY(0)', opacity: '1' }
				},
				'float-1': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-5px)' }
				},
				'float-2': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-7px)' }
				},
				'float-3': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-4px)' }
				},
				'float-4': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-6px)' }
				},
				'float-5': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-3px)' }
				},
				'float-6': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-5px)' }
				},
				'float-7': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-4px)' }
				},
				'float-8': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-6px)' }
				},
				'page-transition-in': {
					'0%': { transform: 'translateX(20px)', opacity: '0' },
					'100%': { transform: 'translateX(0)', opacity: '1' }
				},
				'page-transition-out': {
					'0%': { transform: 'translateX(0)', opacity: '1' },
					'100%': { transform: 'translateX(-20px)', opacity: '0' }
				}
			},
			animation: {
				'accordion-down': 'accordion-down 0.2s ease-out',
				'accordion-up': 'accordion-up 0.2s ease-out',
				'pulse-gentle': 'pulse-gentle 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
				'fade-in': 'fade-in 0.6s ease-in-out',
				'slide-up': 'slide-up 0.6s ease-out',
				'float-1': 'float-1 3s ease-in-out infinite',
				'float-2': 'float-2 3.2s ease-in-out infinite 0.1s',
				'float-3': 'float-3 2.8s ease-in-out infinite 0.2s',
				'float-4': 'float-4 3.5s ease-in-out infinite 0.3s',
				'float-5': 'float-5 2.9s ease-in-out infinite 0.4s',
				'float-6': 'float-6 3.1s ease-in-out infinite 0.5s',
				'float-7': 'float-7 3.3s ease-in-out infinite 0.6s',
				'float-8': 'float-8 3.0s ease-in-out infinite 0.7s',
				'page-transition-in': 'page-transition-in 0.3s ease-out',
				'page-transition-out': 'page-transition-out 0.3s ease-out'
			}
		}
	},
	plugins: [require("tailwindcss-animate")],
} satisfies Config;

\`\`\`

# dataextract-ey-main\tsconfig.app.json

\`\`\`json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": false,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noImplicitAny": false,
    "noFallthroughCasesInSwitch": false,

    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"]
}

\`\`\`

# dataextract-ey-main\tsconfig.json

\`\`\`json
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ],
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    },
    "noImplicitAny": false,
    "noUnusedParameters": false,
    "skipLibCheck": true,
    "allowJs": true,
    "noUnusedLocals": false,
    "strictNullChecks": false
  }
}

\`\`\`

# dataextract-ey-main\tsconfig.node.json

\`\`\`json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["vite.config.ts"]
}

\`\`\`

# dataextract-ey-main\vite.config.ts

\`\`\`ts
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react-swc";
import path from "path";
import { componentTagger } from "lovable-tagger";

// https://vitejs.dev/config/
export default defineConfig(({ mode }) => ({
  server: {
    host: "::",
    port: 8080,
  },
  plugins: [
    react(),
    mode === 'development' &&
    componentTagger(),
  ].filter(Boolean),
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
}));

\`\`\`

# EY_DataExtract.py

\`\`\`py
#!/usr/bin/env python3
"""
IFRS9 Data Extraction API Server

This Flask API server processes IFRS9 PDFs, extracts data using a custom LLM and embedding system,
and returns results in JSON format for the frontend application.
"""

import os
import json
import re
import shutil
import time
import traceback
import tempfile
from datetime import datetime
from typing import List, Tuple, Optional, Dict, Any
from flask import Flask, request, jsonify, send_file
from flask_cors import CORS
from werkzeug.utils import secure_filename
import uuid

import requests
import pandas as pd
import openpyxl
from dotenv import load_dotenv
import nest_asyncio

import concurrent.futures
from functools import partial
from io import BytesIO

from langchain_community.vectorstores import Chroma
from langchain.schema import Document
from chromadb.api.types import EmbeddingFunction
from llama_index.readers.llama_parse import LlamaParse

# Apply nest_asyncio to allow nested event loops
nest_asyncio.apply()

# Initialize Flask app
app = Flask(__name__)
CORS(app)  # Enable CORS for frontend communication

# =============================================================================
# Configuration and Global Constants
# =============================================================================
ENV_PATH = os.path.join(os.path.dirname(__file__), "ATT27768.env")
load_dotenv(ENV_PATH)

LLAMA_PARSE_API_KEY = os.getenv("LLAMA_PARSE_API_KEY")
if not LLAMA_PARSE_API_KEY:
    raise ValueError("LLAMA_PARSE_API_KEY not found in .env file.")

EYQ_INCUBATOR_KEY = os.getenv("EYQ_INCUBATOR_KEY")
EYQ_BASE_URL = "https://eyq-incubator.europe.fabric.ey.com/eyq/eu/api"
EYQ_CHAT_MODEL = "gpt-4o"
EYQ_EMBEDDING_MODEL = "text-embedding-3-large"
EYQ_API_VERSION = "2023-05-15"
AUTH_HEADER_NAME = "api-key"
USE_BEARER = False

# Use temporary directories for web server
TEMP_DIR = tempfile.gettempdir()
PERSIST_DIRECTORY = os.path.join(TEMP_DIR, 'ifrs9_chroma')
UPLOAD_FOLDER = os.path.join(TEMP_DIR, 'ifrs9_uploads')
OUTPUT_DIRECTORY = os.path.join(TEMP_DIR, 'ifrs9_outputs')
BACKUP_FOLDER = os.path.join(TEMP_DIR, 'ifrs9_backup')

# Create directories
for directory in [PERSIST_DIRECTORY, UPLOAD_FOLDER, OUTPUT_DIRECTORY, BACKUP_FOLDER]:
    os.makedirs(directory, exist_ok=True)

# Thresholds
PAGE_THRESHOLD = 150
CHAR_THRESHOLD = 1_000_000  # Maximum characters per chunk

# Allowed file extensions
ALLOWED_EXTENSIONS = {'pdf'}

# Store processing status
processing_status = {}


# =============================================================================
# Utility Functions (same as original)
# =============================================================================
def allowed_file(filename):
    return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS


def create_backup_folder(src_folder: str, dest_folder: str) -> None:
    """Create backup folder with retry logic for concurrent access."""
    os.makedirs(dest_folder, exist_ok=True)
    timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')

    for attempt in range(5):
        try:
            dest_path = os.path.join(dest_folder, f".chromadb_{timestamp}_{attempt}")
            shutil.copytree(src_folder, dest_path)
            print(f"Backup created at: {dest_path}")
            return
        except FileExistsError:
            print(f"Backup folder {dest_path} already exists, trying another name")
            continue

    print("Warning: Could not create backup folder, proceeding without backup")


def clean_ocr_text(text: str) -> str:
    replacements = {
        '': '6', '': '5', '': '7', '': '4', '': '3',
        '': '0', '': '9', '': '8', '': '1', '': '2',
        '': '', '': '.', '': '0', '|': ' ', '\n': ' ',
        ' S': ' 5', ' I': ' 1', ' O': ' 0', ' B': ' 8'
    }
    for garbled, replacement in replacements.items():
        text = text.replace(garbled, replacement)
    return text


def standardize_json_structure(prompt_str: str) -> str:
    """Standardize JSON structure in prompts to prevent parsing issues."""
    json_match = re.search(r'\{.*\}', prompt_str, re.DOTALL)
    if not json_match:
        return prompt_str

    try:
        json_template = json_match.group(0)
        fixed_template = (json_template
                          .replace('" ', '"')
                          .replace(' "', '"')
                          )
        fixed_template = re.sub(r'}\s*{', '},{', fixed_template)
        fixed_template = re.sub(r'"\s*{', '",{', fixed_template)
        return prompt_str.replace(json_template, fixed_template)
    except Exception as e:
        print(f"Warning: Could not standardize JSON in prompt: {e}")
        return prompt_str


def split_content_by_chars(content: str, char_threshold: int) -> List[str]:
    if len(content) <= char_threshold:
        return [content]
    chunks = []
    start = 0
    while start < len(content):
        end = min(start + char_threshold, len(content))
        break_point = content.rfind('\n', start, end)
        if break_point == -1:
            break_point = content.rfind(' ', start, end)
        if break_point == -1 or break_point <= start:
            break_point = end
        chunks.append(content[start:break_point])
        start = break_point + 1
    return chunks


def flatten_json_to_rows(json_data):
    """Flatten nested JSON into a list of rows for Excel, handling various JSON structures."""
    rows = []

    if isinstance(json_data, str):
        return [{"Category": "Error", "Stage": "N/A", "Field": "Response", "Value": json_data}]

    if isinstance(json_data, dict) and all(not isinstance(val, dict) for val in json_data.values()):
        for key, value in json_data.items():
            rows.append({
                "Category": "Main",
                "Stage": "N/A",
                "Field": key,
                "Value": str(value)
            })
        return rows

    if not isinstance(json_data, dict):
        return [{"Category": "Error", "Stage": "N/A", "Field": "Response", "Value": str(json_data)}]

    for category, content in json_data.items():
        if isinstance(content, dict):
            for field, value in content.items():
                if isinstance(value, dict):
                    for subfield, subvalue in value.items():
                        rows.append({
                            "Category": category,
                            "Stage": field,
                            "Field": subfield,
                            "Value": str(subvalue)
                        })
                else:
                    rows.append({
                        "Category": category,
                        "Stage": "N/A",
                        "Field": field,
                        "Value": str(value)
                    })
        else:
            rows.append({
                "Category": "Summary",
                "Stage": "N/A",
                "Field": category,
                "Value": str(content)
            })

    return rows


def merge_json_responses(responses: List[dict]) -> dict:
    """Merge multiple JSON responses, prioritizing non-N/A values."""
    if not responses:
        return {}

    if len(responses) == 1:
        return responses[0]

    merged = {}

    for response in responses:
        if not isinstance(response, dict):
            continue

        for category, content in response.items():
            if category not in merged:
                merged[category] = content
            else:
                if isinstance(content, dict) and isinstance(merged[category], dict):
                    for stage, stage_content in content.items():
                        if stage not in merged[category]:
                            merged[category][stage] = stage_content
                        else:
                            if isinstance(stage_content, dict) and isinstance(merged[category][stage], dict):
                                for field, value in stage_content.items():
                                    existing_val = merged[category][stage].get(field, "N/A")
                                    if existing_val == "N/A" and value != "N/A":
                                        merged[category][stage][field] = value
                            elif isinstance(merged[category], dict):
                                existing_val = merged[category].get(stage, "N/A")
                                if existing_val == "N/A" and stage_content != "N/A":
                                    merged[category][stage] = stage_content
                else:
                    existing_val = merged.get(category, "N/A")
                    if existing_val == "N/A" and content != "N/A":
                        merged[category] = content

    return merged


def count_na_values(json_data: dict) -> int:
    count = 0
    if not isinstance(json_data, dict):
        return 0

    for cat_key, cat_value in json_data.items():
        if isinstance(cat_value, dict):
            for stage_key, stage_value in cat_value.items():
                if isinstance(stage_value, dict):
                    for field_key, field_value in stage_value.items():
                        if str(field_value).strip() == "N/A":
                            count += 1
                elif str(stage_value).strip() == "N/A":
                    count += 1
        elif str(cat_value).strip() == "N/A":
            count += 1
    return count


def all_values_na(json_data):
    """Check if all values in the JSON data are 'N/A'"""
    if not isinstance(json_data, dict):
        return str(json_data).strip() == "N/A"

    if all(not isinstance(val, dict) for val in json_data.values()):
        return all(str(val).strip() == "N/A" for val in json_data.values())

    for category in json_data:
        if isinstance(json_data[category], dict):
            for stage in json_data[category]:
                if isinstance(json_data[category][stage], dict):
                    for field in json_data[category][stage]:
                        if str(json_data[category][stage][field]).strip() != "N/A":
                            return False
                elif str(json_data[category][stage]).strip() != "N/A":
                    return False
        elif str(json_data[category]).strip() != "N/A":
            return False

    return True


def enhance_ecl_prompt(original_prompt: str) -> str:
    """Enhance any ECL-related prompt to focus extraction on credit risk data."""
    if not original_prompt or not any(term in original_prompt.lower() for term in
                                      ["ecl", "stage", "impairment", "credit risk"]):
        return original_prompt

    json_pattern = r'(\{[^{]*"[^"]+"\s*:\s*\{[^}]*\}[^}]*\})'
    json_match = re.search(json_pattern, original_prompt, re.DOTALL)
    json_structure = json_match.group(0) if json_match else ""

    enhanced_prompt = f"""
I need to extract credit risk stage data from this financial report. Focus specifically on:

1. Tables showing loan quality or credit risk metrics
2. Sections with ECL (Expected Credit Loss) data
3. Information broken down by Stage 1, Stage 2, and Stage 3
4. Values for: ECL/provisions, gross exposures/balances, and coverage ratios

For clarity: Stage 1 is performing, Stage 2 is significantly increased risk, Stage 3 is credit-impaired.

First, scan the document for sections containing phrases like "credit quality", "loan impairment", "ECL", "credit risk" or tables with "Stage 1/2/3" headers.

{original_prompt}

IMPORTANT EXTRACTION TIPS:
- Values should be in millions (£m or $m)
- Coverage ratios are typically percentages (%)
- Look for the most recent reporting period data
- If a value is not found, use "N/A" rather than making an estimate
"""

    return enhanced_prompt


# =============================================================================
# Custom Classes (same as original)
# =============================================================================
class EYQEmbeddings(EmbeddingFunction):
    def __init__(self, model: str, api_key: str, api_base: str, api_version: str,
                 auth_header_name: str = "Authorization", use_bearer: bool = True):
        self.model = model
        self.api_key = api_key
        self.api_base = api_base
        self.api_version = api_version
        self.auth_header_name = auth_header_name
        self.use_bearer = use_bearer
        self.session = requests.Session()

    def __call__(self, inputs: List[str]) -> List[List[float]]:
        headers = {"Content-Type": "application/json",
                   self.auth_header_name: f"Bearer {self.api_key}" if self.use_bearer else self.api_key}
        embeddings = []
        for text in inputs:
            payload = {"input": text}  # Simplified payload for EYQ
            endpoint = f"{self.api_base}/openai/deployments/{self.model}/embeddings?api-version={self.api_version}"
            try:
                response = self.session.post(endpoint, headers=headers, json=payload, timeout=30)
                response.raise_for_status()  # Raise HTTPError for bad responses
                data = response.json()
                embeddings.append(data["data"][0]["embedding"])
            except requests.exceptions.RequestException as e:
                print(f"Embedding request failed: {e}")
                print(f"Response: {response.text if 'response' in locals() else 'No response'}")
                raise
        return embeddings

    def embed_documents(self, texts: List[str]) -> List[List[float]]:
        return self.__call__(texts)

    def embed_query(self, text: str) -> List[float]:
        return self.__call__([text])[0]


class EYQChat:
    def __init__(self, deployment_name: str, api_key: str, api_base: str, api_version: str,
                 temperature: float = 0, verbose: bool = False):
        self.deployment_name = deployment_name
        self.api_key = api_key
        self.api_base = api_base
        self.api_version = api_version
        self.temperature = temperature
        self.verbose = verbose
        self.session = requests.Session()

    def __call__(self, messages: List[Dict[str, str]], retries: int = 3, delay: int = 2, **kwargs) -> str:
        headers = {AUTH_HEADER_NAME: self.api_key, "Content-Type": "application/json"}
        payload = {"messages": messages, "temperature": self.temperature, **kwargs}  # Added model and kwargs
        endpoint = f"{self.api_base}/openai/deployments/{self.deployment_name}/chat/completions?api-version={self.api_version}"

        timeout = kwargs.get('timeout', 60)

        if self.verbose:
            print(f"Sending request to {endpoint} with headers: {headers}")
            print(f"Payload: {json.dumps(payload, indent=2)}")

        for attempt in range(retries):
            try:
                response = self.session.post(endpoint, headers=headers, json=payload, timeout=timeout)
                response.raise_for_status()  # Raise HTTPError for bad responses
                return response.json()["choices"][0]["message"]["content"]
            except requests.exceptions.RequestException as e:
                print(f"Chat request failed: {response.status_code} - {response.text}")
                if attempt < retries - 1:
                    sleep_time = delay * (2 ** attempt)
                    print(f"Attempt {attempt + 1}/{retries} failed: {e}. Retrying in {sleep_time} seconds...")
                    time.sleep(sleep_time)
                else:
                    raise Exception(f"Failed after {retries} attempts: {e}")
            except Exception as e:
                print(f"An unexpected error occurred: {e}")
                raise


class IFRS9Processor:
    def __init__(self, embedding: EYQEmbeddings, chat_model: str, incubator_key: str):
        self.embedding = embedding
        self.chat_model = chat_model
        self.incubator_key = incubator_key
        # Ensure Chroma client is initialized correctly
        # self.chroma_client = Chroma(
        #     persist_directory=PERSIST_DIRECTORY,
        #     embedding_function=embedding,
        #     collection_name='IFRS9'
        # )
        self.parser = LlamaParse(api_key=LLAMA_PARSE_API_KEY, result_type="markdown", verbose=True, gpt_4o_mode=True)
        self.total_prompts_run = 0
        self.total_successful_results = 0
        self.total_failed_results = 0

    def load_single_document(self, file_path: str, company_name: str, debug: bool = False,
                             retries: int = 3, delay: int = 5) -> List[Document]:
        if not os.path.exists(file_path) or not os.access(file_path, os.R_OK):
            print(f"Error: File {file_path} does not exist or is not readable")
            return []
        for attempt in range(retries):
            try:
                print(f"Attempt {attempt + 1}/{retries}: Parsing {file_path} with LlamaParse...")
                documents = self.parser.load_data(file_path)
                if not documents:
                    print(f"Warning: No content extracted from {file_path}")
                    return []
                docs = [
                    Document(page_content=doc.text,
                             metadata={"source": os.path.basename(file_path), "page": i, "name": company_name})
                    for i, doc in enumerate(documents)
                ]
                if debug:
                    print(f"Loaded {len(docs)} pages.")
                    # for i, d in enumerate(docs):
                    #     print(f"Page {i}: {d.page_content[:500]}...")
                return docs
            except Exception as e:
                print(f"Attempt {attempt + 1}/{retries} - Error parsing {file_path}: {e}")
                print(traceback.format_exc())
                if attempt < retries - 1:
                    time.sleep(delay * (2 ** attempt))
                else:
                    print(f"Failed to parse {file_path} after {retries} attempts")
                    return []
        return []  # Should not be reached, but added for safety

    def create_embedding_pdf(self, pdf_path: str, company_name: str, debug: bool = False):
        docs = self.load_single_document(pdf_path, company_name, debug=debug)
        if not docs:
            print(f"Skipping embedding creation for {pdf_path}")
            return None
        print(f"Loaded {len(docs)} pages from {pdf_path}")
        try:
            vectordb = Chroma.from_documents(
                docs,
                embedding=self.embedding,
                persist_directory=PERSIST_DIRECTORY,
                collection_name='IFRS9'
            )
            print("Embeddings created and persisted")
            return vectordb
        except Exception as e:
            print(f"Error creating embeddings: {e}")
            print(traceback.format_exc())
            return None

    def llm_extract_field(self, content: str, prompt: str) -> str:
        llm = EYQChat(
            deployment_name=self.chat_model,
            api_key=self.incubator_key,
            api_base=EYQ_BASE_URL,
            api_version=EYQ_API_VERSION,
            verbose=True
        )
        full_prompt = (
            f"{prompt}\n\nHere is the content, please extract the information based on the prompt. Only provide the JSON output. Do not add any introductory text or explanations. \n\nFull Document Content:\n{content}\n"
            "Return ONLY the result as a JSON string. If a value is not found, use 'N/A'."
        )
        messages = [{"role": "user", "content": full_prompt}]
        return llm(messages, timeout=180)  # Increased timeout

    def process_content_chunk(self, content: str, company: str, prompt_str: str, part_name: str, debug: bool = False):
        """Process a chunk of content and extract JSON data with improved error handling."""
        if debug:
            print(f"Processing {part_name} for {company}: {content[:500]}...")

        json_str = "Not found"  # Initialize json_str
        try:
            response = self.llm_extract_field(content, prompt_str)
            print(f"LLM response for {company} ({part_name}): {response[:500]}...")  # Print only first 500 chars

            # Try to find JSON within \`\`\`json ... \`\`\` or as a standalone { ... }
            json_match = re.search(r'\`\`\`json\s*(.*?)\s*\`\`\`', response, re.DOTALL)
            if json_match:
                json_str = json_match.group(1).strip()
            else:
                json_match = re.search(r'(\{.*\})', response, re.DOTALL)
                if json_match:
                    json_str = json_match.group(0).strip()
                else:
                    raise ValueError("No valid JSON structure found in response")

            # Clean up potential issues
            json_str = json_str.replace('\\n', '\n').replace('\\"', '"')
            json_str = re.sub(r'(?<!")N/A(?!")', '"N/A"', json_str)  # Ensure N/A is quoted

            notes_start = response.find('**Note:') if '**Note:' in response else len(response)
            notes = response[notes_start:].strip() if notes_start < len(response) else "No notes provided"

            json_response = json.loads(json_str)

            if not isinstance(json_response, dict):
                raise ValueError(f"JSON response is not a dictionary: {type(json_response)}")

            flattened_data = flatten_json_to_rows(json_response)

            return json_response, notes, flattened_data

        except json.JSONDecodeError as e:
            print(f"JSON parsing error for {company} ({part_name}): {e}")
            print(f"Problematic JSON string: {json_str}")
            return None, f"Failed to parse JSON response: {e}", [
                {"Category": "Error", "Stage": "N/A", "Field": "N/A", "Value": f"JSON Parse Error: {e}"}]

        except Exception as e:
            print(f"Error processing response for {company} ({part_name}): {str(e)}")
            print(f"Full response (first 500 chars): {response[:500] if 'response' in locals() else 'No response'}")
            print(traceback.format_exc())
            return None, f"Error: {str(e)}", [
                {"Category": "Error", "Stage": "N/A", "Field": "N/A", "Value": f"Processing Error: {e}"}]

    def process_pdf_part(self, docs: List[Document], company: str, prompt_str: str,
                         part_name: str, debug: bool = False) -> Tuple[Optional[dict], str, List[dict]]:
        """Process a subset of PDF documents and handle character limits."""
        full_content = "\n\n".join(doc.page_content for doc in docs)
        cleaned = clean_ocr_text(full_content)

        if len(cleaned) > CHAR_THRESHOLD:
            print(f"{company} ({part_name}) content exceeds limit ({len(cleaned)} chars), splitting into chunks...")
            chunks = split_content_by_chars(cleaned, CHAR_THRESHOLD)
            print(f"Created {len(chunks)} chunks for {company} ({part_name})")

            valid_responses = []
            valid_notes = []
            valid_data = []

            for i, chunk in enumerate(chunks):
                chunk_name = f"{part_name} Chunk {i + 1}"
                print(f"\n{'=' * 50}\nPROCESSING {chunk_name} ({len(chunk) // 1000}K chars)\n{'=' * 50}")

                try:
                    res_json, notes, flat_data = self.process_content_chunk(
                        chunk, company, prompt_str, chunk_name, debug
                    )

                    if res_json is not None:
                        na_count = count_na_values(res_json)
                        total_fields = sum(
                            len(stage_value) if isinstance(stage_value, dict) else 1
                            for cat_value in res_json.values() if isinstance(cat_value, dict)
                            for stage_value in cat_value.values()
                        ) or len(res_json)  # Handle flat JSONs

                        print(
                            f"SUCCESS: {chunk_name} returned valid JSON with {na_count} N/A values out of {total_fields} fields")
                        print(f"Structure: {list(res_json.keys())}")
                        valid_responses.append(res_json)
                        valid_notes.append(notes)
                        if flat_data:  # Only add if not empty
                            valid_data.extend(flat_data)  # Use extend for list of lists
                    else:
                        print(f"FAILURE: {chunk_name} did not return valid JSON")
                except Exception as e:
                    print(f"ERROR processing {chunk_name}: {e}")
                    print(traceback.format_exc())

            if not valid_responses:
                print(f"No valid responses from any chunk in {part_name}")
                return None, f"All chunks failed to produce valid JSON for {part_name}", [
                    {"Category": "Error", "Stage": "N/A", "Field": "N/A", "Value": "No valid data extracted"}
                ]

            merged_response = merge_json_responses(valid_responses)
            combined_notes = "\n\n".join([f"--- Notes from {part_name} Chunk {i + 1} ---\n{note}"
                                          for i, note in enumerate(valid_notes)])

            # Flatten the *merged* response for final data
            flattened_data = flatten_json_to_rows(merged_response)

            print(f"Successfully merged {len(valid_responses)} responses for {part_name}")
            return merged_response, combined_notes, flattened_data
        else:
            return self.process_content_chunk(cleaned, company, prompt_str, part_name, debug)

    def find_relevant_sections(self, docs: List[Document]) -> List[List[Document]]:
        """Find sections of the document relevant to ECL/credit risk data across any bank report."""
        keywords = [
            "credit risk", "expected credit loss", "ecl", "loan impairment",
            "stage 1", "stage 2", "stage 3", "provision", "credit quality",
            "coverage ratio", "loan to value", "ltv", "impairment allowance",
            "credit-impaired", "performing", "non-performing", "significant increase"
        ]

        keyword_pages = []
        keyword_found_info = {}

        for i, doc in enumerate(docs):
            content = doc.page_content.lower()
            found_keywords = []

            for keyword in keywords:
                if keyword in content:
                    found_keywords.append(keyword)

            if found_keywords:
                keyword_pages.append(i)
                keyword_found_info[i] = found_keywords
                # print(f"DEBUG: Page {i} contains keywords: {', '.join(found_keywords)}")

        section_chunks = []
        if keyword_pages:
            print(f"Found {len(keyword_pages)} pages with ECL-related content")

            page_groups = []
            if not keyword_pages:  # Handle case where no keywords are found
                print("No keyword pages found, returning empty list.")
                return []

            current_group = [keyword_pages[0]]

            for i in range(1, len(keyword_pages)):
                if keyword_pages[i] <= keyword_pages[i - 1] + 3:
                    current_group.append(keyword_pages[i])
                else:
                    page_groups.append(current_group)
                    current_group = [keyword_pages[i]]

            if current_group:
                page_groups.append(current_group)

            context_size = 2

            for group in page_groups:
                start = max(0, min(group) - context_size)
                end = min(len(docs), max(group) + context_size + 1)
                section_chunks.append(docs[start:end])

        if not section_chunks:
            print("No specific ECL content found - creating standard chunks")
            chunk_size = max(1, len(docs) // 10)  # Ensure chunk_size > 0
            if chunk_size == 0 and len(docs) > 0: chunk_size = 1
            if chunk_size > 0:
                section_chunks = [docs[i:i + chunk_size] for i in range(0, len(docs), chunk_size)]
            else:
                section_chunks = [docs] if docs else []

        for chunk_idx, chunk in enumerate(section_chunks):
            start_page = chunk[0].metadata['page']
            end_page = chunk[-1].metadata['page']
            chunk_keywords = set()
            for page_idx in range(start_page, end_page + 1):
                if page_idx in keyword_found_info:
                    chunk_keywords.update(keyword_found_info[page_idx])

            print(
                f"DEBUG: Chunk {chunk_idx + 1} (pages {start_page}-{end_page}) contains keywords: {', '.join(chunk_keywords)}")

        return section_chunks

    def process_single_file_prompt(self, file_path: str, company: str, prompt_template: str,
                                   prompt_name: str, session_id: str, debug: bool = False):
        """Process a single file with a single prompt."""
        try:
            # Update status
            if session_id in processing_status:
                processing_status[session_id]['current_file'] = os.path.basename(file_path)
                processing_status[session_id]['current_prompt'] = prompt_name
                processing_status[session_id]['step'] = f'Processing {prompt_name} from {os.path.basename(file_path)}'

            # Load documents
            docs = self.load_single_document(file_path, company, debug=debug)
            if not docs:
                return {
                    "status": "error",
                    "error": "Failed to load document",
                    "data": [],
                    "notes": "Could not parse PDF file"
                }

            num_pages = len(docs)
            print(f"PDF for {company} has {num_pages} pages")

            # Enhance ECL-related prompts
            if "ecl" in prompt_name.lower() or "stage" in prompt_name.lower():
                prompt_template = enhance_ecl_prompt(prompt_template)

            # Process based on document size
            if num_pages >= PAGE_THRESHOLD:
                print(f"Document has {num_pages} pages, exceeding threshold {PAGE_THRESHOLD}. Using chunking.")
                if "ecl" in prompt_name.lower() or "stage" in prompt_name.lower() or "credit" in prompt_template.lower():
                    print(f"Using ECL-targeted document chunking for {company} ({num_pages} pages)")
                    parts = self.find_relevant_sections(docs)
                else:
                    if num_pages > 200:
                        chunk_size = num_pages // 10
                    else:
                        chunk_size = num_pages // 3
                    parts = [docs[i:i + chunk_size] for i in range(0, num_pages, chunk_size)]

                if not parts:
                    return {
                        "status": "error",
                        "error": "Document chunking resulted in no parts.",
                        "data": [],
                        "notes": "Failed to create document parts for processing."
                    }

                valid_json_responses = []
                valid_notes = []
                all_flattened_data = []

                for i, part_docs in enumerate(parts):
                    part_name = f"Part {i + 1}"
                    json_response, notes, flattened_data = self.process_pdf_part(
                        part_docs, company, prompt_template, part_name, debug
                    )
                    if json_response is not None:
                        valid_json_responses.append(json_response)
                        valid_notes.append(f"--- Notes from {part_name} ---\n{notes}")
                        if flattened_data:
                            all_flattened_data.extend(flattened_data)

                if valid_json_responses:
                    if len(valid_json_responses) == 1:
                        json_response = valid_json_responses[0]
                        notes = valid_notes[0]
                        # We use all_flattened_data which contains data from all successful chunks
                    else:
                        merged_response = merge_json_responses(valid_json_responses)
                        combined_notes = "\n\n".join(valid_notes)
                        # Flatten the merged response for a consolidated view
                        all_flattened_data = flatten_json_to_rows(merged_response)
                        json_response = merged_response
                        notes = combined_notes

                    return {
                        "status": "success",
                        "data": all_flattened_data,  # Return the combined flattened data
                        "notes": notes
                    }
                else:
                    return {
                        "status": "error",
                        "error": "No valid results from document",
                        "data": [],
                        "notes": "Failed to extract data from any part of the document"
                    }
            else:
                # Single processing for smaller documents
                print(f"Document has {num_pages} pages. Processing as a single unit.")
                full_content = "\n\n".join([doc.page_content for doc in docs])
                cleaned_content = clean_ocr_text(full_content)

                json_response, notes, flattened_data = self.process_content_chunk(
                    cleaned_content, company, prompt_template, "Full Content", debug
                )

                if json_response and not all_values_na(json_response):
                    return {
                        "status": "success",
                        "data": flattened_data,
                        "notes": notes
                    }
                else:
                    return {
                        "status": "error",
                        "error": "All extracted values are 'N/A' or no data extracted",
                        "data": flattened_data or [],  # Return empty if None
                        "notes": "Extraction likely failed - all values returned as N/A or no data found."
                    }

        except Exception as e:  # Catch exceptions for the whole function
            print(f"Critical Error processing {company} for prompt {prompt_name}: {str(e)}")
            print(traceback.format_exc())
            return {
                "status": "error",
                "error": str(e),
                "data": [],
                "notes": f"Error: {str(e)}\n{traceback.format_exc()}"
            }


# =============================================================================
# Flask API Routes
# =============================================================================

@app.route('/api/health', methods=['GET'])
def health_check():
    """Health check endpoint."""
    return jsonify({
        "status": "healthy",
        "service": "IFRS9 Data Extraction API",
        "version": "1.0.0"
    })


@app.route('/api/upload', methods=['POST'])
def upload_files():
    """Handle file uploads."""
    try:
        if 'files' not in request.files:
            return jsonify({"error": "No files provided"}), 400

        files = request.files.getlist('files')
        uploaded_files = []

        for file in files:
            if file and allowed_file(file.filename):
                filename = secure_filename(file.filename)
                # Generate unique filename
                unique_filename = f"{uuid.uuid4()}_{filename}"
                filepath = os.path.join(UPLOAD_FOLDER, unique_filename)
                file.save(filepath)

                # Get file info
                file_stats = os.stat(filepath)
                uploaded_files.append({
                    "id": unique_filename,
                    "name": filename,
                    "size": file_stats.st_size,
                    "type": "application/pdf",
                    "lastModified": int(file_stats.st_mtime * 1000),
                    "status": "success",
                    "progress": 100
                })

        return jsonify({
            "status": "success",
            "files": uploaded_files
        })

    except Exception as e:
        print(traceback.format_exc())
        return jsonify({"error": str(e)}), 500


@app.route('/api/process', methods=['POST'])
def process_files():
    """Process files with selected prompts."""
    try:
        data = request.json
        files = data.get('files', [])
        prompts = data.get('prompts', [])
        session_id = data.get('sessionId', str(uuid.uuid4()))

        if not files or not prompts:
            return jsonify({"error": "Files and prompts are required"}), 400

        # Initialize processing status
        processing_status[session_id] = {
            "status": "processing",
            "progress": 0,
            "step": "Initializing...",
            "total_items": len(files) * len(prompts),
            "completed_items": 0,
            "results": []
        }

        # Initialize processor
        embedding = EYQEmbeddings(
            model=EYQ_EMBEDDING_MODEL,
            api_key=EYQ_INCUBATOR_KEY,
            api_base=EYQ_BASE_URL,
            api_version=EYQ_API_VERSION,
            auth_header_name=AUTH_HEADER_NAME,
            use_bearer=USE_BEARER
        )
        processor = IFRS9Processor(embedding, EYQ_CHAT_MODEL, EYQ_INCUBATOR_KEY)

        results = []
        completed = 0

        for file_info in files:
            file_path = os.path.join(UPLOAD_FOLDER, file_info['id'])

            if not os.path.exists(file_path):
                print(f"Warning: File {file_path} not found for processing.")
                continue

            for prompt in prompts:
                completed += 1
                # Update processing status
                processing_status[session_id][
                    'step'] = f"Extracting {prompt['name']} from {file_info['name']} ({completed}/{processing_status[session_id]['total_items']})"
                processing_status[session_id]['progress'] = int(
                    (completed / processing_status[session_id]['total_items']) * 100)

                print(f"Starting: {processing_status[session_id]['step']}")

                # Process the file with the prompt
                result = processor.process_single_file_prompt(
                    file_path,
                    file_info['name'].replace('.pdf', ''),
                    prompt.get('template', prompt['name']),
                    prompt['name'],
                    session_id,
                    debug=True  # Enable debug logging
                )

                # Create result object
                processing_result = {
                    "id": f"result-{uuid.uuid4()}",
                    "fileId": file_info['id'],
                    "fileName": file_info['name'],
                    "promptId": prompt.get('id', 'N/A'),
                    "promptName": prompt['name'],
                    "status": result['status'],
                    "timestamp": datetime.now().isoformat(),
                    "data": result.get('data', []),
                    "notes": result.get('notes', ''),
                    "error": result.get('error', None)
                }

                results.append(processing_result)

                # Update processing status
                processing_status[session_id]['results'].append(processing_result)
                processing_status[session_id]['completed_items'] = completed
                print(f"Finished: {processing_status[session_id]['step']} - Status: {result['status']}")

        # Mark processing as complete
        processing_status[session_id]['status'] = 'complete'
        processing_status[session_id]['progress'] = 100
        processing_status[session_id]['step'] = 'Processing complete'
        print("Processing complete for session:", session_id)

        return jsonify({
            "status": "success",
            "sessionId": session_id,
            "results": results
        })

    except Exception as e:
        print(traceback.format_exc())
        session_id = data.get('sessionId', 'unknown')
        if session_id in processing_status:
            processing_status[session_id]['status'] = 'error'
            processing_status[session_id]['step'] = f'Error: {str(e)}'
        return jsonify({"error": str(e), "trace": traceback.format_exc()}), 500


@app.route('/api/status/<session_id>', methods=['GET'])
def get_processing_status(session_id):
    """Get processing status for a session."""
    if session_id not in processing_status:
        return jsonify({"error": "Session not found"}), 404

    return jsonify(processing_status[session_id])


@app.route('/api/download/<session_id>', methods=['GET'])
def download_results(session_id):
    """Download results as Excel file."""
    try:
        if session_id not in processing_status:
            return jsonify({"error": "Session not found"}), 404

        results = processing_status[session_id].get('results', [])
        if not results:
            return jsonify({"error": "No results to download"}), 400

        # Create Excel file in memory
        output = BytesIO()
        with pd.ExcelWriter(output, engine='openpyxl') as writer:
            all_data = []
            summary_data = []

            for result in results:
                summary_data.append({
                    "File": result['fileName'],
                    "Prompt": result['promptName'],
                    "Status": result['status'],
                    "Timestamp": result['timestamp'],
                    "Error": result.get('error', 'N/A')
                })

                if result['status'] == 'success' and result.get('data'):
                    for item in result['data']:
                        all_data.append({
                            "Category": item.get('Category', 'N/A'),
                            "Stage": item.get('Stage', 'N/A'),
                            "Field": item.get('Field', 'N/A'),
                            "Value": item.get('Value', 'N/A'),
                            "Source": f"{result['fileName']} - {result['promptName']}"
                        })

            # Create DataFrames
            df_summary = pd.DataFrame(summary_data)
            df_combined = pd.DataFrame(all_data)

            # Write to Excel
            df_summary.to_excel(writer, sheet_name="Summary", index=False)
            df_combined.to_excel(writer, sheet_name="Combined Results", index=False)

        output.seek(0)

        # Generate filename
        timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
        filename = f"IFRS9_Results_{timestamp}.xlsx"

        return send_file(
            output,
            mimetype='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
            as_attachment=True,
            download_name=filename
        )

    except Exception as e:
        print(traceback.format_exc())
        return jsonify({"error": str(e)}), 500


@app.route('/api/prompts/load', methods=['POST'])
def load_prompts_from_excel():
    """Load prompts from Excel file."""
    try:
        if 'file' not in request.files:
            return jsonify({"error": "No file provided"}), 400

        file = request.files['file']
        if not file or not file.filename.endswith(('.xlsx', '.xls')):
            return jsonify({"error": "Invalid file format"}), 400

        # Read Excel file
        df = pd.read_excel(file)

        # Validate columns
        required_columns = ['Bank', 'PromptName', 'PromptText']
        if not all(col in df.columns for col in required_columns):
            missing = [col for col in required_columns if col not in df.columns]
            return jsonify({"error": f"Missing required columns: {', '.join(missing)}"}), 400

        # Extract prompts for the requested bank
        bank = request.form.get('bank', None)  # Get bank from form data
        if not bank:
            return jsonify({"error": "Bank name not provided"}), 400

        bank_prompts = df[df['Bank'].str.lower() == bank.lower()]

        if bank_prompts.empty:
            return jsonify({"error": f"No prompts found for bank: {bank}"}), 404

        prompts = []
        for _, row in bank_prompts.iterrows():
            prompts.append({
                "id": f"custom-{uuid.uuid4()}",
                "name": row['PromptName'],
                "description": f"Custom prompt for {bank}",
                "template": row['PromptText'],
                "category": "Custom"
            })

        return jsonify({
            "status": "success",
            "prompts": prompts
        })

    except Exception as e:
        print(traceback.format_exc())
        return jsonify({"error": str(e)}), 500


@app.route('/api/prompts/default/<bank>', methods=['GET'])
def get_default_prompts(bank):
    """Get default prompts for a specific bank."""
    # This would normally load from your CSV file
    # For now, returning a sample set
    default_prompts = {
        "barclays": [
            {
                "id": "ecl-by-stage",
                "name": "ECL By Stage",
                "description": "Extract ECL values, gross exposures and coverage ratios by product category and stage.",
                "template": "Extract IFRS9 ECL data by stage...",
                "category": "Credit Risk"
            },
            {
                "id": "management-adjustments",
                "name": "Management Adjustments",
                "description": "Extract economic uncertainty adjustments, other adjustments, and total management adjustments.",
                "template": "Extract management adjustments...",
                "category": "Credit Risk"
            },
            {
                "id": "scenario-weights",
                "name": "Scenario Weights",
                "description": "Extract probability weights assigned to Upside, Baseline, and Downside scenarios.",
                "template": "Extract scenario weights...",
                "category": "Economic Scenarios"
            },
            {
                "id": "macro-variables",
                "name": "Macro Variables",
                "description": "Extract GDP, unemployment, HPI, and bank rate variables for forecast years.",
                "template": "Extract macroeconomic variables...",
                "category": "Economic Scenarios"
            }
        ]
    }

    prompts = default_prompts.get(bank.lower(), [])
    return jsonify({
        "status": "success",
        "prompts": prompts
    })


@app.route('/api/cleanup/<session_id>', methods=['DELETE'])
def cleanup_session(session_id):
    """Clean up session data and temporary files."""
    try:
        # Remove processing status
        if session_id in processing_status:
            del processing_status[session_id]

        # Clean up uploaded files (optional)
        # Be cautious here, ensure you don't delete files needed elsewhere
        # You might want to implement a more robust cleanup strategy (e.g., based on age)

        return jsonify({"status": "success"})

    except Exception as e:
        print(traceback.format_exc())
        return jsonify({"error": str(e)}), 500


# =============================================================================
# Error Handlers
# =============================================================================

@app.errorhandler(404)
def not_found(error):
    return jsonify({"error": "Endpoint not found"}), 404


@app.errorhandler(500)
def internal_error(error):
    print(traceback.format_exc())
    return jsonify({"error": "Internal server error", "details": str(error)}), 500


# =============================================================================
# Main Entry Point
# =============================================================================

if __name__ == '__main__':
    # Run the Flask app
    app.run(
        host='0.0.0.0',
        port=5000,
        debug=True,  # Set to False in production
        threaded=True
    )
\`\`\`

# EY_FinSight_Prompts3.csv

\`\`\`csv
Bank,PromptName,PromptText
HSBC,Scenario ECL,"Given the full document content provided, extract the Reported ECL, Central scenario, Upside scenario , Downside scenario , Downside 2 scenario  ECL (Provisions)  for the following categories: Retail analysis and Wholesale analysis, as reported for the latest period presented in the document. Focus specifically on sections titled ""Wholesale and retail sensitivity analysis"" within the document, as these sections contain the detailed breakdown of Reported ECL, Central scenario, Upside scenario , Downside scenario , Downside 2 scenario by category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each category (Reported ECL, Central scenario, Upside scenario , Downside scenario , Downside 2 scenario), expressed in �m.
4. Locate and extract the data directly from sections titled ""Wholesale and retail sensitivity analysis"". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. ""Retail & Business Banking"" is split into Mortgages,EDB - Credit Cards, EDB - Other as separate rows within the table. validate totals against provided aggregates where possible.
7. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers. 
8. Return the result as a JSON string with the following structure:
   {
       ""Wholesale analysis"": {
       ""Reported ECL "": {""ECL"": ""<value>""},
       ""Central scenario "": {""ECL"": ""<value>""},
       ""Upside scenario "": {""ECL"": ""<value>""}
       ""Downside scenario "": {""ECL"": ""<value>""}
       ""Downside 2 scenario "": {""ECL"": ""<value>""}
     },
       ""Retail analysis"": {
       ""Reported ECL "": {""ECL"": ""<value>""},
       ""Central scenario "": {""ECL"": ""<value>""},
       ""Upside scenario "": {""ECL"": ""<value>""}
       ""Downside scenario "": {""ECL"": ""<value>""}
       ""Downside 2 scenario "": {""ECL"": ""<value>""}   
   },
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
HSBC,Scenario Weight,"Given the full document content provided, extract the scenario weight for the  Central scenario, Upside scenario , Downside scenario , Downside 2 scenario  as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       ""Scenario weights %"": {

       ""Central "": {""Weight"": ""<value>""},
       ""Upside "": {""Weight"": ""<value>""}
       ""Downside "": {""Weight"": ""<value>""}
       ""Downside 2  "": {""Weight"": ""<value>""}
     }
   }"
Santander,Scenario ECL,"Given the full document content provided, extract the Upside, Base case, Downside 1, Downside 2 and Weighted ECL (Provisions) and Balance (Exposure) for the following categories: Retail & Business Banking, Mortgages, Consumer Finance, Corporate & Commercial Banking and Corporate Centre , as reported for the latest period presented in the document. Focus specifically on sections titled ""Scenario sensitivity"" within the document, as these sections contain the detailed breakdown of Upside, Base case, Downside 1, Downside 2 and Weighted by category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each category (Retail & Business Banking, Mortgages, Consumer Finance, Corporate & Commercial Banking and Corporate Centre), expressed in �m.
2. Balance refers to the Exposure for each stage and category, expressed in �m.
4. Locate and extract the data directly from sections titled ""Scenario sensitivity"". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. ""Retail & Business Banking"" is split into Mortgages,EDB - Credit Cards, EDB - Other as separate rows within the table. validate totals against provided aggregates where possible.
7. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers. 
8. Return the result as a JSON string with the following structure:
   {
       ""Retail & Business Banking"": {
       ""Upside"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Base"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     },
""Mortgages"": {
       ""Upside"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Base"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     },
     "" Consumer Finance"": {
       ""Upside"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Base"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     },
     "" Corporate & Commercial Banking "": {
       ""Upside"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Base"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     },
     "" Corporate Centre "": {
       ""Upside"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Base"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     },
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Santander,Scenario Weight,"Given the full document content provided, extract the scenario weight for the  Upside , Base case , Downside 1 , Downside 2 scenario  as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       ""Scenario weights %"": {

       ""Upside "": {""Weight"": ""<value>""},
       ""Base case "": {""Weight"": ""<value>""}
       ""Downside 1"": {""Weight"": ""<value>""}
       ""Downside 2  "": {""Weight"": ""<value>""}
     }
   }"
Nationwide,Scenario ECL,"Given the full document content provided, extract the Upside scenario  , Base case scenario , Downside scenario , Severe Downside  scenario and reported Provisions  for the following categories: Residential mortgages, Consumer banking � credit cards , Consumer banking � personal loans and overdraft, Commercial lending, as reported for the latest period presented in the document. Focus specifically on sections titled ""ECL under 100% weighted scenarios "" within the document, as these sections contain the detailed breakdown of Upside scenario  , Base case scenario , Downside scenario , Severe Downside  scenario and reported Provisions. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each category (Residential mortgages, Consumer banking � credit cards , Consumer banking � personal loans and overdraft, Commercial lending), expressed in �m.
4. Locate and extract the data directly from sections titled ""ECL under 100% weighted scenarios "". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.

7. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers. 
8. Return the result as a JSON string with the following structure:
   {
       ""Residential mortgages "": {
       ""Upside scenario"": {""ECL"": ""<value>""},
       ""Base case scenario"": {""ECL"": ""<value>""},
       ""Downside scenario"": {""ECL"": ""<value>""}
       ""Severe Downside scenario"": {""ECL"": ""<value>""}
       ""Reported provisions"": {""ECL"": ""<value>""}
     },
       ""Consumer banking � credit cards "": {
       ""Upside scenario"": {""ECL"": ""<value>""},
       ""Base case scenario"": {""ECL"": ""<value>""},
       ""Downside scenario"": {""ECL"": ""<value>""}
       ""Severe Downside scenario"": {""ECL"": ""<value>""}
       ""Reported provisions"": {""ECL"": ""<value>""}
     },
       ""Consumer banking � personal loans and overdraft "": {
       ""Upside scenario"": {""ECL"": ""<value>""},
       ""Base case scenario"": {""ECL"": ""<value>""},
       ""Downside scenario"": {""ECL"": ""<value>""}
       ""Severe Downside scenario"": {""ECL"": ""<value>""}
       ""Reported provisions"": {""ECL"": ""<value>""}
     },
       ""Commercial lending "": {
       ""Upside scenario"": {""ECL"": ""<value>""},
       ""Base case scenario"": {""ECL"": ""<value>""},
       ""Downside scenario"": {""ECL"": ""<value>""}
       ""Severe Downside scenario"": {""ECL"": ""<value>""}
       ""Reported provisions"": {""ECL"": ""<value>""}
     },
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Nationwide,Scenario Weight,"Given the full document content provided, extract the Scenario probability weighting (%)  for the  Upside scenario  , Base case scenario , Downside scenario , Severe Downside  scenario  as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       ""Scenario weights %"": {
       ""Upside scenario "": {""Weight"": ""<value>""},
       ""Base case scenario"": {""Weight"": ""<value>""}
       ""Downside scenario"": {""Weight"": ""<value>""}
       ""Severe Downside scenario  "": {""Weight"": ""<value>""}
     }
   }"
VMUK,Scenario ECL,"Given the full document content provided extract the Upside, Base, Downside, Severe Downside, and Probability Weighted impairment provisions for the following categories: Mortgages, Unsecured Lending � Cards, Unsecured Lending � Personal Loans and Overdrafts, and Business Lending, as reported for the latest period presented. Focus specifically on the table titled ""Economic scenarios"" under the section ""The calculation of the Group�s impairment provision,"" which contains the detailed breakdown of Upside, Base, Downside, Severe Downside, and Probability Weighted modelled provisions. Use the following guidelines:

Locate and extract the data directly from the ""Economic scenarios"" table. The table provides the latest period data, so use only that period�s data. For the ""Unsecured"" category, break down the data into subcategories ""Cards"" and ""Personal loans and overdrafts"" as provided.
If OCR errors or inconsistencies are detected (e.g., totals not aligning with category sums), adjust values to align with totals or logical consistency, and note adjustments.
Show only on balance sheet numbers (the table does not indicate off balance sheet numbers, so this is assumed to be on balance sheet).
Return the result as a JSON string with the following structure:  
{
    ""Mortgages"": {
        ""Upside"": {""Impairment Provisions"": ""<value>""},
        ""Base"": {""Impairment Provisions"": ""<value>""},
        ""Downside"": {""Impairment Provisions"": ""<value>""},
        ""Severe Downside"": {""Impairment Provisions"": ""<value>""},
        ""Probability Weighted"": {""Impairment Provisions"": ""<value>""}
    },
    ""Unsecured Lending � Cards"": {
        ""Upside"": {""Impairment Provisions"": ""<value>""},
        ""Base"": {""Impairment Provisions"": ""<value>""},
        ""Downside"": {""Impairment Provisions"": ""<value>""},
        ""Severe Downside"": {""Impairment Provisions"": ""<value>""},
        ""Probability Weighted"": {""Impairment Provisions"": ""<value>""}
    },
    ""Unsecured Lending � Personal Loans and Overdrafts"": {
        ""Upside"": {""Impairment Provisions"": ""<value>""},
        ""Base"": {""Impairment Provisions"": ""<value>""},
        ""Downside"": {""Impairment Provisions"": ""<value>""},
        ""Severe Downside"": {""Impairment Provisions"": ""<value>""},
        ""Probability Weighted"": {""Impairment Provisions"": ""<value>""}
    },
    ""Business Lending"": {
        ""Upside"": {""Impairment Provisions"": ""<value>""},
        ""Base"": {""Impairment Provisions"": ""<value>""},
        ""Downside"": {""Impairment Provisions"": ""<value>""},
        ""Severe Downside"": {""Impairment Provisions"": ""<value>""},
        ""Probability Weighted"": {""Impairment Provisions"": ""<value>""}
    }
}
Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m).
Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated totals), and validation against totals if applicable.
If the required data is not found, state that the information is unavailable and explain why (e.g., missing section, lack of scenario breakdown)."
VMUK,Scenario Weight,"Given the full document content provided  extract the scenario probability weightings (%) for the Upside, Base, Downside, and Severe Downside scenarios as reported for the latest period presented i nthe document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
{
    ""Scenario weights %"": {
        ""Upside"": {""Weight"": ""<value>""},
        ""Base"": {""Weight"": ""<value>""},
        ""Downside"": {""Weight"": ""<value>""},
        ""Severe Downside"": {""Weight"": ""<value>""}
    }
}"
NWG,Scenario ECL,"Given the full document content provided, extract the Moderate Upside Scenario, Base Scenario, Moderate Downside Scenario, Extreme Downside Scenario, and Actual Stage 1 and Stage 2 modelled ECL for the following categories: Mortgages, Unsecured Lending, Business Lending � Property, and Business Lending � Non-Property, as reported for the latest period presented in the table . Focus specifically on the table titled ""Measuring uncertainty and ECL sensitivity analysis (audited),"" which contains the detailed breakdown of Stage 1 and Stage 2 modelled ECL under the Base Scenario, Moderate Upside Scenario, Moderate Downside Scenario, Extreme Downside Scenario, and Actual values. Use the following guidelines:

Locate and extract the data directly from the ""Measuring uncertainty and ECL sensitivity analysis (audited)"" table. The table provides the latest period data, so use only that period�s data. For the ""Retail Banking - unsecured"" category, use the total ECL provided (do not break down into subcategories like Cards or Personal Loans and Overdrafts, as the table does not provide this breakdown). For ""Business Lending,"" break down the data into ""Property"" and ""Non-Property"" subcategories as provided (using ""Non-personal - property"" and ""Non-personal - non-property"").
If OCR errors or inconsistencies are detected (e.g., totals not aligning with category sums), adjust values to align with totals or logical consistency, and note adjustments.
Show only on balance sheet numbers (the table does not indicate off balance sheet numbers, so this is assumed to be on balance sheet).
Return the result as a JSON string with the following structure:
{
    ""Mortgages"": {
        ""Moderate Upside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Base Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Moderate Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Extreme Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Actual"": {""Stage 1 and Stage 2 ECL"": ""<value>""}
    },
    ""Unsecured Lending"": {
        ""Moderate Upside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Base Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Moderate Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Extreme Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Actual"": {""Stage 1 and Stage 2 ECL"": ""<value>""}
    },
    ""Business Lending � Property"": {
        ""Moderate Upside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Base Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Moderate Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Extreme Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Actual"": {""Stage 1 and Stage 2 ECL"": ""<value>""}
    },
    ""Business Lending � Non-Property"": {
        ""Moderate Upside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Base Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Moderate Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Extreme Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Actual"": {""Stage 1 and Stage 2 ECL"": ""<value>""}
    }
}
Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m).
Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated totals), and validation against totals if applicable.
If the required data is not found, state that the information is unavailable and explain why (e.g., missing section, lack of scenario breakdown)."
NWG,Scenario Weight,"Given the full document content provided, extract the scenario probability weightings (%) for the Moderate Upside Scenario, Base Scenario, Moderate Downside Scenario, and Extreme Downside Scenario as reported in the document. Use the following guidelines:

Search the document for a section or table that provides the scenario probability weightings for the scenarios labeled as ""Moderate Upside Scenario,"" ""Base Scenario,"" ""Moderate Downside Scenario,"" and ""Extreme Downside Scenario"" (as used in the ""Measuring uncertainty and ECL sensitivity analysis (audited)"" table). If the weightings are not found in the document, note that they are unavailable and refer to any previously provided data (e.g., a ""Scenario"" table with weightings for these scenarios).
Return the result as a JSON string with the following structure:
{
    ""Scenario weights %"": {
        ""Moderate Upside Scenario"": {""Weight"": ""<value>""},
        ""Base Scenario"": {""Weight"": ""<value>""},
        ""Moderate Downside Scenario"": {""Weight"": ""<value>""},
        ""Extreme Downside Scenario"": {""Weight"": ""<value>""}
    }
}
Express the weights as percentage strings without the '%' symbol (e.g., ""10"" for 10%).
Include a note after the JSON detailing the data source (e.g., specific table or section) and any adjustments made if applicable. If the weightings are not found in the document, explicitly state this and reference any previously provided data (e.g., a ""Scenario"" table with weightings: Upside 10%, Base 55%, Downside 20%, Severe Downside 15%) that may align with the scenarios after adjusting for terminology differences.
If the required data is not found, state that the information is unavailable and explain why (e.g., missing table, lack of scenario weights)."
LBG,Scenario ECL,"Given the full document content provided , extract the Upside, Base, Downside, Severe Downside, and Probability-weighted ECL provisions for the following categories: UK Mortgages, Credit cards, Other Retail, and Commercial Banking, as reported for the latest period presented in the document. Focus specifically on the table titled ""Total expected credit loss allowance sensitivity to economic assumptions � statutory and underlying basis"", as this table contains the detailed breakdown of Upside, Base, Downside, Severe Downside, and Probability-weighted ECL provisions. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each category (UK Mortgages, Credit cards, Other Retail, Commercial Banking), expressed in �m.
2. Locate and extract the data  from the table titled ""Total expected credit loss allowance sensitivity to economic assumptions � statutory and underlying basis"" . Use the latest period presented,""
3. If OCR errors or inconsistencies are detected (e.g., totals not aligning with category sums), adjust values to align with totals or logical consistency, and note adjustments.
4. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers.
5. Return the result as a JSON string with the following structure:
   {
       ""UK Mortgages"": {
           ""Upside"": {""ECL"": ""<value>""},
           ""Base"": {""ECL"": ""<value>""},
           ""Downside"": {""ECL"": ""<value>""},
           ""Severe Downside"": {""ECL"": ""<value>""},
           ""Probability-weighted"": {""ECL"": ""<value>""}
       },
       ""Credit cards"": {
           ""Upside"": {""ECL"": ""<value>""},
           ""Base"": {""ECL"": ""<value>""},
           ""Downside"": {""ECL"": ""<value>""},
           ""Severe Downside"": {""ECL"": ""<value>""},
           ""Probability-weighted"": {""ECL"": ""<value>""}
       },
       ""Other Retail"": {
           ""Upside"": {""ECL"": ""<value>""},
           ""Base"": {""ECL"": ""<value>""},
           ""Downside"": {""ECL"": ""<value>""},
           ""Severe Downside"": {""ECL"": ""<value>""},
           ""Probability-weighted"": {""ECL"": ""<value>""}
       },
       ""Commercial Banking"": {
           ""Upside"": {""ECL"": ""<value>""},
           ""Base"": {""ECL"": ""<value>""},
           ""Downside"": {""ECL"": ""<value>""},
           ""Severe Downside"": {""ECL"": ""<value>""},
           ""Probability-weighted"": {""ECL"": ""<value>""}
       },
       ""Other"": {
           ""Upside"": {""ECL"": ""<value>""},
           ""Base"": {""ECL"": ""<value>""},
           ""Downside"": {""ECL"": ""<value>""},
           ""Severe Downside"": {""ECL"": ""<value>""},
           ""Probability-weighted"": {""ECL"": ""<value>""}
       },
   }

6. Express monetary values in �m (millions) as strings without commas (e.g., ""1064"" for �1,064m).
7. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated totals), and validation against totals if applicable.
8. If the required data is not found, state that the information is unavailable and explain why (e.g., missing section, lack of scenario breakdown)."
LBG,Scenario Weight,"Given the full document content provided, extract the scenario probability weightings (%) for the **Upside**, **Base**, **Downside**, and **Severe Downside** scenarios as reported in the document. Use the following guidelines:

1. Search the document for a section or table that provides the scenario probability weightings, focusing on the ""Risk management"" section . If the weightings are not found in the document, note that they are unavailable and refer to any previously provided data (e.g., a ""Scenario"" table with weightings for these scenarios).
2. Return the result as a JSON string with the following structure:

   {
       ""Scenario weights %"": {
           ""Upside"": {""Weight"": ""<value>""},
           ""Base"": {""Weight"": ""<value>""},
           ""Downside"": {""Weight"": ""<value>""},
           ""Severe Downside"": {""Weight"": ""<value>""}
       }
   }
Express the weights as percentage strings without the '%' symbol (e.g., ""10"" for 10%).
Include a note after the JSON detailing the data source (e.g., specific table or section) and any adjustments made if applicable. If the weightings are not found in the document, explicitly state this and reference any previously provided data (e.g., a ""Scenario"" table with weightings: Upside 10%, Base 55%, Downside 20%, Severe Downside 15%) that may align with the scenarios after adjusting for terminology differences.
If the required data is not found, state that the information is unavailable and explain why (e.g., missing table, lack of scenario weights)."
Principality,IFRS9 Data by Stage,"Given the full document content provided, extract the Gross loan balance,Loss allowance,by stage as well as total. Use the following guidelines:''is the ratio of Loss allowance to Gross loan balance (expressed as a percentage) for each stage and category. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.  Focus on sections titled:  "" Provision for impairment losses"" For Stage 2, use the total values (e.g., 'Stage 2 total' or sum of subcategories like up to date, 1-30 DPD, >30 DPD) unless otherwise specified. If subcategories are present, sum them for Gross loan balance and Loss allowance and recalculate  if table percentages are inconsistent.  Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").  Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.  If you don't know the answer, just say that you don�t know, don�t try to make up an answer.  Extract data for the following portfolios: Group,,,,. Output the result as a JSON string with the following structure :
   {
     'Group': {
       'Stage 1': {'Loss allowance': '<value>', 'Gross loan balance': '<value>', 'Coverage': '<value>'},
       'Stage 2': {'Loss allowance': '<value>', 'Gross loan balance': '<value>', 'Coverage': '<value>'},
       'Stage 3': {'Loss allowance': '<value>', 'Gross loan balance': '<value>', 'Coverage': '<value>'}
     }
   } 
"
Principality,Arrears Rates,"Given the full document content provided, extract the payment due status for the following categories:Group, as reported for the latest period presented in the document.Focus specifically on tables that  ""provides further information on the first and second charge retail loans secured on residential property by payment due status:"" within the document, as these sections contain the detailed breakdown of Gross exposure by payment due status. Use the following guidelines:
1. Locate and extract the data directly from tables that ""provides further information on the first and second charge retail loans secured on residential property by payment due status: "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. 
2. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
3. Return the result as a JSON string with the following structure:
   {
     ""Group"": {
       ""Current"": {""Balance"": ""<value>""},
       ""Past due up to 3 months"": {""Balance"": ""<value>""},
       ""Past due 3 months up to 6 months"": {""Balance"": ""<value>""},
       ""Past due 6 months up to 12 months"":{""Balance"": ""<value>""},
       ""Past due over 12 months "": {""Balance"": ""<value>""},
       ""Possessions "": {""Balance"": ""<value>""},
     }
   }
4. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
5. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
6. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Coventry,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (Provisions), Balance (Gross Balances), and Coverage (Provisions as a % of total balance) for the following categories: Group, as reported for the latest period presented in the document. Focus specifically on tables labeled ""Movements in gross exposure and ECL provision"" within the document, as these tables contain the detailed breakdown of Provisions and Gross Balances by stage and category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each stage (1, 2, 3) and category (Group), expressed in �m.
2. Balance refers to the gross balances for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables titled""""Movements in gross exposure and ECL provision"". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. For Stage 2, use the total values (e.g., ""Stage 2 total"" or sum of subcategories like up to date, Not past due, Past due) unless otherwise specified. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Return the result as a JSON string with the following structure:
   {
     ""Group"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
   }
7. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
8. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
9. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Leeds,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (Impairment loss provision), Balance (Gross exposure ) and Coverage (Provision 
coverage) for the following categories: Retail mortgages and Loan commitments, as reported for the latest period presented in the document. Focus specifically on tables that  ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions"" within the document, as these tables contain the detailed breakdown of Impairment loss provision, Gross exposure and Provision coverage by stage and category. Use the following guidelines:

1. ECL refers to Impairment loss provision on credit exposures for each stage (1, 2, 3) and category (Retail mortgages and Loan commitments), expressed in �m.
2. Balance refers to the Gross exposure for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables that ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. For Stage 2, use the total values (e.g., ""Stage 2 total"" or sum of subcategories like Stage 2 and <30 days past due, Stage 2 and 30+ days past due ) unless otherwise specified.  For Stage 3, use the total values (e.g., ""Stage 3 total"" or sum of subcategories like Stage 3 and <90 days past due, Stage 3 and 90+ days past due ) unless otherwise specified If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Return the result as a JSON string with the following structure:
   {
     ""Retail mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Loan commitments"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
   }
8. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
9. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
10. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Leeds,Arrears Rates,"Given the full document content provided, extract the Stage 1, Stage 2 and Stage 3 days past due for the following categories:Retail mortgages and Loan commitments, as reported for the latest period presented in the document.Focus specifically on tables that  ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions"" within the document, as these tables contain the detailed breakdown of Impairment loss provision, Gross exposure and Provision coverage by stage and category. Use the following guidelines:

1. ECL refers to Impairment loss provision on credit exposures for each stage (1, 2, 3) and category (Retail mortgages and Loan commitments), expressed in �m.
2. Balance refers to the Gross exposure for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables that ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. 
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Return the result as a JSON string with the following structure:
   {
     ""Retail mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2 and <30 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2 and 30+ days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3 and <90 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3 and 90+ days past due "": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Loan commitments"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2 and <30 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2 and 30+ days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3 and <90 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3 and 90+ days past due "": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
   }
4. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
5. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
6. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Nationwide,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (Provisions), Balance (Gross Balances), and Coverage (Provisions as a % of total balance) for the following categories: Owner-occupied, buy-to-let and legacy, Overdrawn current accounts, Personal Loans and Credit Cards, as reported for the latest period presented in the document. Focus specifically on tables labeled ""Consumer banking product and staging analysis""and ""Residential mortgages staging analysis"" within the document, as these tables contain the detailed breakdown of Provisions, Gross Balances and Provisions as a % of total balance by stage and category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each stage (1, 2, 3) and category (Owner-occupied, buy-to-let and legacy, Overdrawn current accounts, Personal Loans and Credit Cards), expressed in �m.
2. Balance refers to the gross balances for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables titled""Consumer banking product and staging analysis""and ""Residential mortgages staging analysis"". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. For Stage 2, use the total values (e.g., ""Stage 2 total"" or sum of subcategories like up to date, 1-30 DPD, >30 DPD) unless otherwise specified. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Assume ""Unsecured"" is split into Overdrawn current accounts, Personal Loans and Credit Cards as separate rowa within the table, and validate totals against provided aggregates where possible.
7. Return the result as a JSON string with the following structure:
   {
     ""Owner-occupied"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Buy-to-let and legacy"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Overdrawn current accounts"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Personal loans"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
     ""Credit cards"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
   }
8. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
9. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
10. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Santander,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (Provisions), Balance (Exposures), and Coverage  (Coverage Ratio) for the following categories: Mortgages,EDB - Credit Cards, EDB - Other, Consumer Finance, Corporate & Commercial Banking and Corporate Centre , as reported for the latest period presented in the document. Focus specifically on tables labeled ""Credit quality"" within the document, as these tables contain the detailed breakdown of ECL, Exposure and Coverage Ratio by stage and category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each stage (1, 2, 3) and category (Mortgages,EDB - Credit Cards, EDB - Other, Consumer Finance, Corporate & Commercial Banking and Corporate Centre), expressed in �m.
2. Balance refers to the Exposure for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables titled""Credit quality"""". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. ""Retail & Business Banking"" is split into Mortgages,EDB - Credit Cards, EDB - Other as separate rows within the table. validate totals against provided aggregates where possible.
7. If both on balance sheet and off balance sheet numvbers are present, show only the on balance shete numbers. 
8. Return the result as a JSON string with the following structure:
   {
     ""Mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""EDB - Credit Cards"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""EDB - Other"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     "" Consumer Finance"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
     "" Corporate & Commercial Banking "": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
     "" Corporate Centre "": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Skipton,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (Loss allowance), Balance (Gross carrying amount) for the following categories: Residential mortgages, Other lending and Commercial mortgages, as reported for the latest period presented in the document. Focus specifically on tables that provide ""information on movements in the gross carrying amount"" and ""information on movements in the impairment loss allowance"" within the document, as these tables contain the detailed breakdown of Loss allowance and Gross carrying amount by stage and category. Use the following guidelines:

1. ECL refers to Loss allowance on credit exposures for each stage (1, 2, 3) and category (Residential mortgages, Other lending and Commercial mortgages), expressed in �m.
2. Balance refers to the Gross carrying amount for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables that provide ""information on movements in the gross carrying amount"" and ""information on movements in the impairment loss allowance"" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. If both Group and Society numbers are presented, provide results for the Group. 
7. Return the result as a JSON string with the following structure:
   {
     ""Residential mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Commercial mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Other lending"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
   }
8. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
9. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
10. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Skipton,Arrears Rates,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 days past due for the following categories: Residential mortgages, Other lending and Commercial mortgages, as reported for the latest period presented in the document. Focus specifically on tables that provide ""loans and advances by payment due status"" within the document, as these tables contain the detailed breakdown of days past due by stage and category. Use the following guidelines:

1. Locate and extract the data directly from tables that provide ""loans and advances by payment due status"" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.
2. If both Group and Society numbers are presented, provide results for the Group. 
3. Return the result as a JSON string with the following structure:
   {
     ""Residential mortgages"": {
       ""Stage 1"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 2"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 3"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" }
     },
     ""Commercial mortgages"": {
       ""Stage 1"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 2"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 3"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" }
     },
     ""Other lending"": {
       ""Stage 1"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 2"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 3"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" }
     },
   }
4. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
5. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
6. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
VMUK,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 Expected Credit Loss (ECL), Balance (gross loans and advances), and Coverage (provision-to-loan ratio) for the following categories: Mortgages, Cards, Loans and Overdrafts, and Business, as reported for the latest period presented in the document. Focus specifically on tables labeled ""Gross loans and advances (1) ECL and coverage"" within the document, as these tables contain the detailed breakdown of ECL, Balance, and Coverage by stage and category. Use the following guidelines:

1. ECL refers to impairment provisions on credit exposures for each stage (1, 2, 3) and category (Mortgages, Cards, Loans and Overdrafts, Business), expressed in �m.
2. Balance refers to the gross loans and advances for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables titled ""Gross loans and advances (1) ECL and coverage."" If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. For Stage 2, use the total values (e.g., ""Stage 2 - total"" or sum of subcategories like 0 DPD, <30 DPD, >30 DPD) unless otherwise specified. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Assume ""Unsecured"" is split into ""Cards"" and ""Loans and Overdrafts"" as separate columns within the table, and validate totals against provided aggregates where possible.
7. Return the result as a JSON string with the following structure:
   {
     ""Mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Cards"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Loans and Overdrafts"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Business"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
   }
8. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
9. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
10. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Yorkshire,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (ECL), Balance (Gross exposure ) and Coverage (Coverage) for the following categories: Retail mortgages and Loan commitments, as reported for the latest period presented in the document. Focus specifically on tables titled  ""Staging and POCI"" within the document, as these tables contain the detailed breakdown of ECL, Gross exposure and Coverage by stage and category. Use the following guidelines:

1. ECL for each stage (1, 2, 3) and category (Retail mortgages and Loan commitments), expressed in �m.
2. Balance refers to the Gross exposure for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables that ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. 
5. Return the result as a JSON string with the following structure:
   {
     ""Group"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
   }
8. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
9. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
10. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Yorkshire,Arrears Rates,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 Balance (Gross exposure ) for the following categories: Group, as reported for the latest period presented in the document. Focus specifically on tables titled  ""Staging and POCI"" within the document, as these tables contain the detailed breakdown of  Gross exposure . Use the following guidelines:

2. Balance refers to the Gross exposure for each stage and category, expressed in �m.
4. Locate and extract the data directly from tables that ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. 
6. Return the result as a JSON string with the following structure:
   {
     ""Group"": {
       ""Stage 1"": {""Balance"": ""<value>""},
       ""Stage 2"": {""Balance"": ""<value>""},
       ""Less than 30 days past due"": {""Balance"": ""<value>""},
       ""More than 30 days past due"": {"" ""Balance"": ""<value>""},
       ""Stage 3"": {"" ""Balance"": ""<value>""},
       ""Less than 30 days past due"": {""Balance"": ""<value>""},
       ""30-90 days past due"": {""Balance"": ""<value>""}'
       ""More than 90 days past due"": {""Balance"": ""<value>""}'
     }
   }
4. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
5. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
6. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Leeds,Scenario ECL,"""Given the full document content provided, extract the Reported ECL, Central scenario, Upside scenario , Downside scenario , Alternative Downside scenario  ECL (Provisions)  for the following categories: Retail mortgages and Loan commitments, as reported for the latest period presented in the document. Focus specifically on sections titled """"Critical accounting estimates and judgements"""" within the document, as these sections contain the detailed breakdown of Reported ECL, Central scenario, Upside scenario , Downside scenario , Alternative Downside scenario by category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each category (Reported ECL, Central scenario, Upside scenario , Downside scenario , Alternative Downside scenario), expressed in �m.
4. Locate and extract the data directly from sections titled """"Critical accounting estimates and judgements"""". If multiple periods are present, identify the latest period by the most recent date (e.g., """"As at [date]"""") or context (e.g., """"current period"""" vs. """"prior period""""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. If cannot find the data by category, show the aggregate numbers. validate totals against provided aggregates where possible.
7. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers.
8. Return the result as a JSON string with the following structure:
   {
       """"Retail mortgages"""": {
       """"Reported ECL """": {""""ECL"""": """"<value>""""},
       """"Central scenario """": {""""ECL"""": """"<value>""""},
       """"Upside scenario """": {""""ECL"""": """"<value>""""},
       """"Downside scenario """": {""""ECL"""": """"<value>""""},
       """"Alternative Downside scenario """": {""""ECL"""": """"<value>""""}
     },
       """"Loan commitments"""": {
       """"Reported ECL """": {""""ECL"""": """"<value>""""},
       """"Central scenario """": {""""ECL"""": """"<value>""""},
       """"Upside scenario """": {""""ECL"""": """"<value>""""},
       """"Downside scenario """": {""""ECL"""": """"<value>""""},
       """"Alternative Downside scenario """": {""""ECL"""": """"<value>""""}  
   },
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., """"52370"""" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., """"0.84%"""").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."""
Leeds,Scenario Weight,"""Given the full document content provided, extract the scenario weight for the  Central scenario, Upside scenario , Downside scenario , Alternative Downside scenario  as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       """"Scenario weights %"""": {

       """"Central """": {""""Weight"""": """"<value>""""},
       """"Upside """": {""""Weight"""": """"<value>""""}
       """"Downside """": {""""Weight"""": """"<value>""""}
       """"Alternative Downside  """": {""""Weight"""": """"<value>""""}
     }
   }"""
Coventry,Scenario ECL,"Given the full document content provided, extract the Weighted average ECL, Base scenario ECL, Upside scenario ECL, Downside scenario ECL, and Severe downside scenario ECL (Provisions) for the category **Retail analysis** (representing the total mortgage portfolio ECL), as reported for the latest period (31 December 2024) presented in the document. Focus specifically on tables within the section titled **""14. Impairment on loans and advances to customers""**, particularly the table on **page 156 under ""31 December 2024 Scenarios"" showing ""Total ECL (�m)"" by scenario** OR the table on **page 155 showing ""IFRS 9 provision �m"" for 31 December 2024**. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each scenario category (Weighted average, Base, Upside, Downside, Severe downside), expressed in �m.
2. Locate and extract the data directly from the specified tables. The table on page 156 (""31 December 2024 Scenarios"") is the preferred source for ""Total ECL (�m)"". If this specific breakdown is not found, the table on page 155 (""IFRS 9 provision �m"" for 31 December 2024 scenarios) can be used.
3. If OCR errors or inconsistencies are detected (e.g., unclear ECL values), prioritize values that align with totals or logical consistency if possible, and note adjustments.
4. As Coventry Building Society's primary business is retail mortgages and savings, ""Retail analysis"" will represent the total portfolio ECLs. ""Wholesale analysis"" is not expected to be detailed in the same manner for scenario ECLs.
5. If both on balance sheet and off balance sheet numbers are present for these specific scenario ECLs, show only the on balance sheet numbers. (Note: For Coventry, the ECL tables referenced are typically aggregated).
6. Return the result as a JSON string with the following structure. If ""Wholesale analysis"" data is not found for scenario ECLs, provide an empty object for it.
   {
       ""Wholesale analysis"": {},
       ""Retail analysis"": {
           ""Weighted average ECL"": {""ECL"": ""<value>""},
           ""Base scenario ECL"": {""ECL"": ""<value>""},
           ""Upside scenario ECL"": {""ECL"": ""<value>""},
           ""Downside scenario ECL"": {""ECL"": ""<value>""},
           ""Severe downside scenario ECL"": {""ECL"": ""<value>""}
       }
   }
7. Express monetary values in �m (millions) as strings without commas (e.g., ""24.3"" for �24.3m).
8. Include a note after the JSON detailing the data source (e.g., specific table and page number), any adjustments made due to OCR errors or inconsistencies, and state that ""Retail analysis"" represents the total portfolio for Coventry Building Society as per the available scenario ECL breakdown.
9. If you don't know the answer for a specific value, use ""null"" or state that the specific breakdown is not available. Do not try to make up an answer."
Coventry,Scenario Weight,"""Given the full document content provided, extract the scenario weight for the  Central scenario, Upside scenario , Downside scenario , Alternative Downside scenario  as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       """"Scenario weights %"""": {

       """"Central """": {""""Weight"""": """"<value>""""},
       """"Upside """": {""""Weight"""": """"<value>""""}
       """"Downside """": {""""Weight"""": """"<value>""""}
       """"Alternative Downside  """": {""""Weight"""": """"<value>""""}
     }
   }"""

\`\`\`

# EY_FinSight_V5.py

\`\`\`py
#!/usr/bin/env python3
"""
Optimized IFRS9 Automation Script

This script processes IFRS9 PDFs, extracts data using a custom LLM and embedding system,
and writes results to Excel files. The code is optimized for performance, efficiency, and clarity.
"""

import os
import json
import re
import shutil
import time
import traceback
from datetime import datetime
from typing import List, Tuple, Optional, Dict, Any

import requests
import pandas as pd
import openpyxl
from dotenv import load_dotenv
import nest_asyncio

import concurrent.futures
from functools import partial

from langchain_community.vectorstores import Chroma
from langchain.schema import Document
from chromadb.api.types import EmbeddingFunction
from llama_index.readers.llama_parse import LlamaParse

# Apply nest_asyncio to allow nested event loops
nest_asyncio.apply()

# =============================================================================
# Configuration and Global Constants
# =============================================================================
ENV_PATH = os.path.join(os.path.dirname(__file__), "ATT27768.env")
load_dotenv(ENV_PATH)

LLAMA_PARSE_API_KEY = os.getenv("LLAMA_PARSE_API_KEY")
if not LLAMA_PARSE_API_KEY:
    raise ValueError("LLAMA_PARSE_API_KEY not found in .env file.")

EYQ_INCUBATOR_KEY = os.getenv("EYQ_INCUBATOR_KEY")
EYQ_BASE_URL = "https://eyq-incubator.europe.fabric.ey.com/eyq/eu/api"
EYQ_CHAT_MODEL = "gpt-4o"
EYQ_EMBEDDING_MODEL = "text-embedding-3-large"
EYQ_API_VERSION = "2023-05-15"
AUTH_HEADER_NAME = "api-key"
USE_BEARER = False

PERSIST_DIRECTORY = './IFRS9/.chroma'
SOURCE_DIRECTORY = os.path.abspath("./IFRS9/reports")
BACKUP_FOLDER = "./IFRS9/backup"
OUTPUT_DIRECTORY = os.path.abspath("./IFRS9/outputs")

# Thresholds
PAGE_THRESHOLD = 150
CHAR_THRESHOLD = 1_000_000  # Maximum characters per chunk

# Ensure output directory exists
os.makedirs(OUTPUT_DIRECTORY, exist_ok=True)


# =============================================================================
# Utility Functions
# =============================================================================
def create_backup_folder(src_folder: str, dest_folder: str) -> None:
    """Create backup folder with retry logic for concurrent access."""
    os.makedirs(dest_folder, exist_ok=True)
    timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')

    # Try multiple timestamps if needed
    for attempt in range(5):  # Try up to 5 different timestamps
        try:
            dest_path = os.path.join(dest_folder, f".chromadb_{timestamp}_{attempt}")
            shutil.copytree(src_folder, dest_path)
            print(f"Backup created at: {dest_path}")
            return
        except FileExistsError:
            print(f"Backup folder {dest_path} already exists, trying another name")
            continue

    # If all attempts fail, continue without backup
    print("Warning: Could not create backup folder, proceeding without backup")


def clean_ocr_text(text: str) -> str:
    replacements = {
        '': '6', '': '5', '': '7', '': '4', '': '3',
        '': '0', '': '9', '': '8', '': '1', '': '2',
        '': '', '': '.', '': '0', '|': ' ', '\n': ' ',
        ' S': ' 5', ' I': ' 1', ' O': ' 0', ' B': ' 8'
    }
    for garbled, replacement in replacements.items():
        text = text.replace(garbled, replacement)
    return text


def standardize_json_structure(prompt_str: str) -> str:
    """Standardize JSON structure in prompts to prevent parsing issues."""
    # Look for JSON structure in the prompt
    json_match = re.search(r'\{.*\}', prompt_str, re.DOTALL)
    if not json_match:
        return prompt_str

    try:
        # Extract JSON template
        json_template = json_match.group(0)

        # Fix common issues
        fixed_template = (json_template
                          .replace('" ', '"')  # Remove extra spaces in keys
                          .replace(' "', '"')
                          )

        # Try to ensure valid JSON by fixing missing commas
        # This is a best-effort approach
        fixed_template = re.sub(r'}\s*{', '},{', fixed_template)
        fixed_template = re.sub(r'"\s*{', '",{', fixed_template)

        # Return the prompt with the fixed template
        return prompt_str.replace(json_template, fixed_template)
    except Exception as e:
        print(f"Warning: Could not standardize JSON in prompt: {e}")
        return prompt_str  # Return original if fixing fails


def split_content_by_chars(content: str, char_threshold: int) -> List[str]:
    if len(content) <= char_threshold:
        return [content]
    chunks = []
    start = 0
    while start < len(content):
        end = min(start + char_threshold, len(content))
        # Try to find a natural break
        break_point = content.rfind('\n', start, end)
        if break_point == -1:
            break_point = content.rfind(' ', start, end)
        if break_point == -1 or break_point <= start:
            break_point = end
        chunks.append(content[start:break_point])
        start = break_point + 1
    return chunks


def flatten_json_to_rows(json_data):
    """Flatten nested JSON into a list of rows for Excel, handling various JSON structures."""
    rows = []

    # Handle string input (possibly incorrectly returned text)
    if isinstance(json_data, str):
        return [{"Category": "Error", "Stage": "N/A", "Field": "Response", "Value": json_data}]

    # Handle flat structures (like Writeoff Policy and ECL Methodology)
    if all(not isinstance(val, dict) for val in json_data.values()):
        for key, value in json_data.items():
            rows.append({
                "Category": "Main",
                "Stage": "N/A",
                "Field": key,
                "Value": str(value)
            })
        return rows

    # Handle single-level nesting
    for category, content in json_data.items():
        if isinstance(content, dict):
            for field, value in content.items():
                if isinstance(value, dict):
                    # Handle double nesting
                    for subfield, subvalue in value.items():
                        rows.append({
                            "Category": category,
                            "Stage": field,
                            "Field": subfield,
                            "Value": str(subvalue)
                        })
                else:
                    # Handle single nesting
                    rows.append({
                        "Category": category,
                        "Stage": "N/A",
                        "Field": field,
                        "Value": str(value)
                    })
        else:
            # Handle direct value
            rows.append({
                "Category": "Summary",
                "Stage": "N/A",
                "Field": category,
                "Value": str(content)
            })

    return rows


def diagnose_json_merge(json_responses: List[dict]) -> None:
    """
    Print diagnostic information about JSON responses to help debug merge issues.
    """
    print(f"\n=== MERGE DIAGNOSTICS ({len(json_responses)} responses) ===")

    if not json_responses:
        print("No responses to merge!")
        return

    for i, resp in enumerate(json_responses):
        print(f"Response #{i + 1}:")
        if not isinstance(resp, dict):
            print(f"  NOT A DICTIONARY: {type(resp)}")
            continue

        print(f"  Top-level keys: {list(resp.keys())}")

        # Count N/A values
        na_count = 0
        total_values = 0

        for category, content in resp.items():
            if isinstance(content, dict):
                for stage, stage_content in content.items():
                    if isinstance(stage_content, dict):
                        for field, value in stage_content.items():
                            total_values += 1
                            if value == "N/A":
                                na_count += 1
                    else:
                        total_values += 1
                        if stage_content == "N/A":
                            na_count += 1
            else:
                total_values += 1
                if content == "N/A":
                    na_count += 1

        print(f"  N/A values: {na_count}/{total_values} ({na_count / total_values * 100:.1f}%)")

    print("=== END DIAGNOSTICS ===\n")


def merge_json_responses(responses: List[dict]) -> dict:
    """
    Merge multiple JSON responses, prioritizing non-N/A values.
    Handles empty lists and None values gracefully.
    """
    if not responses:
        return {}  # Return empty dict if no responses

    # If we only have one response, return it directly
    if len(responses) == 1:
        return responses[0]

    merged = {}

    for response in responses:
        if not isinstance(response, dict):
            continue  # Skip non-dictionary responses

        for category, content in response.items():
            if category not in merged:
                merged[category] = content
            else:
                if isinstance(content, dict):
                    for stage, stage_content in content.items():
                        if stage not in merged[category]:
                            merged[category][stage] = stage_content
                        else:
                            if isinstance(stage_content, dict):
                                for field, value in stage_content.items():
                                    existing_val = merged[category][stage].get(field, "N/A")
                                    # Only replace if we have a non-N/A value and existing is N/A
                                    if existing_val == "N/A" and value != "N/A":
                                        merged[category][stage][field] = value
                            else:
                                existing_val = merged[category].get(stage, "N/A")
                                if existing_val == "N/A" and stage_content != "N/A":
                                    merged[category][stage] = stage_content
                else:
                    existing_val = merged.get(category, "N/A")
                    if existing_val == "N/A" and content != "N/A":
                        merged[category] = content

    return merged


def count_na_values(json_data: dict) -> int:
    return sum(
        1 for cat in json_data.values()
        for stage in cat.values()
        for value in stage.values()
        if value == "N/A"
    )


def all_values_na(json_data):
    """Check if all values in the JSON data are 'N/A'"""
    # Handle flat structures
    if all(not isinstance(val, dict) for val in json_data.values()):
        return all(str(val).strip() == "N/A" for val in json_data.values())

    # Handle nested structures
    for category in json_data:
        if isinstance(json_data[category], dict):
            for stage in json_data[category]:
                if isinstance(json_data[category][stage], dict):
                    for field in json_data[category][stage]:
                        if str(json_data[category][stage][field]).strip() != "N/A":
                            return False
                elif str(json_data[category][stage]).strip() != "N/A":
                    return False
        elif str(json_data[category]).strip() != "N/A":
            return False

    return True


def extract_field_from_prompt(prompt: Any) -> str:
    """Extract the prompt name or field from the JSON string in the prompt."""
    # Handle non-string inputs
    if not isinstance(prompt, str):
        print(f"Warning: prompt is not a string but {type(prompt)}")
        return "unknown"
    # First try to find the prompt type from standard naming patterns
    if "ECL_By_Stage" in prompt:
        return "ECL_By_Stage"
    elif "Management_Adjustments" in prompt:
        return "Management_Adjustments"
    elif "Scenario_Weights" in prompt:
        return "Scenario_Weights"
    elif "Macro_Variables" in prompt:
        return "Macro_Variables"
    elif "Credit_Quality" in prompt:
        return "Credit_Quality"
    elif "Loan_Loss_Rate" in prompt:
        return "Loan_Loss_Rate"
    elif "Staging_Criteria" in prompt:
        return "Staging_Criteria"
    elif "Sensitivity_Analysis" in prompt:
        return "Sensitivity_Analysis"

    # If not found through standard patterns, try JSON parsing as a fallback
    try:
        json_match = re.search(r'\{.*?\}', prompt)
        if json_match:
            json_str = json_match.group(0)
            json_obj = json.loads(json_str.replace('x', '"x"'))
            return list(json_obj.keys())[0]
    except Exception as e:
        pass

    return "unknown"


def write_to_excel(data: List[Dict[str, str]], notes: str, output_file: str) -> None:
    with pd.ExcelWriter(output_file, engine="xlsxwriter") as writer:
        pd.DataFrame(data).to_excel(writer, index=False, sheet_name="IFRS9 Data")
        pd.DataFrame({"Notes": [notes]}).to_excel(writer, index=False, sheet_name="Notes")
    print(f"Data written to {output_file}")


# Combine all outputs in one single file
# Find this function in your EY_FinSight.py file
def combine_excel_outputs(results, output_file):
    """Combine all results into a single Excel workbook with improved sheet naming"""
    workbook = openpyxl.Workbook()
    # Remove default sheet
    if "Sheet" in workbook.sheetnames:
        workbook.remove(workbook["Sheet"])

    print("Creating combined Excel file with standardized sheet names...")

    # Add summary sheet
    summary = workbook.create_sheet("Summary")
    summary.append(["Bank", "Report", "Prompt", "Status", "Timestamp", "File"])

    row = 2

    # Extract year from bank or company name if available
    def extract_year_from_name(name):
        """Extract year from bank, company, or file name."""
        # Look for patterns like FY21, FY22, etc.
        year_match = re.search(r'FY(\d{2})', name)
        if year_match:
            return "20" + year_match.group(1)  # Convert FY21 to 2021

        # Look for patterns like 2021, 2022, etc.
        direct_year_match = re.search(r'20(\d{2})', name)
        if direct_year_match:
            return "20" + direct_year_match.group(1)

        return None

    for bank, bank_data in results.items():
        for company, company_data in bank_data.items():
            # Extract year from company name if available
            year = extract_year_from_name(company)

            for prompt_name, prompt_result in company_data.items():
                summary.append([
                    bank,
                    company,
                    prompt_name,
                    prompt_result["status"],
                    prompt_result["timestamp"],
                    prompt_result.get("file", "N/A")
                ])

                # Create detailed sheet for each successful extraction
                if prompt_result["status"] == "Success" and "data" in prompt_result:
                    # Create shorter sheet name
                    bank_short = bank[:3].upper()  # First 3 letters of bank name

                    # Extract the last part of the prompt name (after the last underscore)
                    prompt_parts = prompt_name.split('_')
                    prompt_short = prompt_parts[-1][:8] if len(prompt_parts) > 1 else prompt_name[:8]

                    # Combine for a short, meaningful sheet name that includes the year if available
                    if year:
                        sheet_name = f"{bank_short}_{prompt_short}_{year}"
                    else:
                        sheet_name = f"{bank_short}_{prompt_short}"

                    # Handle duplicates by adding a number
                    original_name = sheet_name
                    counter = 1
                    while sheet_name in workbook.sheetnames:
                        sheet_name = f"{original_name}_{counter}"[:31]
                        counter += 1

                    detail_sheet = workbook.create_sheet(sheet_name)

                    # Add headers
                    detail_sheet.append(["Category", "Stage", "Field", "Value"])

                    # Add data
                    for item in prompt_result["data"]:
                        detail_sheet.append([
                            item.get("Category", "N/A"),
                            item.get("Stage", "N/A"),
                            item.get("Field", "N/A"),
                            item.get("Value", "N/A")
                        ])

                    # Add notes
                    if "notes" in prompt_result and prompt_result["notes"]:
                        detail_sheet.append([])
                        detail_sheet.append(["Notes", "", "", ""])
                        detail_sheet.append([prompt_result["notes"], "", "", ""])

                row += 1

    # Save the workbook
    try:
        workbook.save(output_file)
        print(f"Combined results saved to {output_file}")
        return True
    except Exception as e:
        print(f"Error saving combined results: {e}")
        return False


# =============================================================================
# Custom Classes
# =============================================================================
class EYQEmbeddings(EmbeddingFunction):
    def __init__(self, model: str, api_key: str, api_base: str, api_version: str,
                 auth_header_name: str = "Authorization", use_bearer: bool = True):
        self.model = model
        self.api_key = api_key
        self.api_base = api_base
        self.api_version = api_version
        self.auth_header_name = auth_header_name
        self.use_bearer = use_bearer
        self.session = requests.Session()

    def __call__(self, inputs: List[str]) -> List[List[float]]:
        headers = {"Content-Type": "application/json",
                   self.auth_header_name: f"Bearer {self.api_key}" if self.use_bearer else self.api_key}
        embeddings = []
        for text in inputs:
            payload = {"model": self.model, "input": text, "api_version": self.api_version}
            endpoint = f"{self.api_base}/openai/deployments/{self.model}/embeddings"
            response = self.session.post(endpoint, headers=headers, json=payload, timeout=30)
            if response.ok:
                data = response.json()
                embeddings.append(data["data"][0]["embedding"])
            else:
                raise Exception(f"Embedding request failed: {response.text}")
        return embeddings

    def embed_documents(self, texts: List[str]) -> List[List[float]]:
        return self.__call__(texts)

    def embed_query(self, text: str) -> List[float]:
        return self.__call__([text])[0]


class EYQChat:
    def __init__(self, deployment_name: str, api_key: str, api_base: str, api_version: str,
                 temperature: float = 0, verbose: bool = False):
        self.deployment_name = deployment_name
        self.api_key = api_key
        self.api_base = api_base
        self.api_version = api_version
        self.temperature = temperature
        self.verbose = verbose
        self.session = requests.Session()

    def __call__(self, messages: List[Dict[str, str]], retries: int = 3, delay: int = 2, **kwargs) -> str:
        headers = {AUTH_HEADER_NAME: self.api_key, "Content-Type": "application/json"}
        payload = {"model": self.deployment_name, "messages": messages, "temperature": self.temperature}
        endpoint = f"{self.api_base}/openai/deployments/{self.deployment_name}/chat/completions"

        # Increase timeout for larger documents
        timeout = kwargs.get('timeout', 60)  # Default to 60 seconds instead of 30

        if self.verbose:
            print(f"Sending request to {endpoint} with headers: {headers}")

        for attempt in range(retries):
            try:
                response = self.session.post(endpoint, headers=headers, json=payload, timeout=timeout)
                if response.ok:
                    return response.json()["choices"][0]["message"]["content"]
                else:
                    raise Exception(f"Chat request failed: {response.status_code} - {response.text}")
            except Exception as e:
                if attempt < retries - 1:
                    print(
                        f"Attempt {attempt + 1}/{retries} failed: {e}. Retrying in {delay * (2 ** attempt)} seconds...")
                    time.sleep(delay * (2 ** attempt))
                else:
                    raise Exception(f"Failed after {retries} attempts: {e}")


def enhance_ecl_prompt(original_prompt: str) -> str:
    """Enhance any ECL-related prompt to focus extraction on credit risk data."""
    # Only enhance if it looks like an ECL-related prompt
    if not original_prompt or not any(term in original_prompt.lower() for term in
                                      ["ecl", "stage", "impairment", "credit risk"]):
        return original_prompt

    # Keep any existing JSON structure from the original prompt
    json_pattern = r'(\{[^{]*"[^"]+"\s*:\s*\{[^}]*\}[^}]*\})'
    json_match = re.search(json_pattern, original_prompt, re.DOTALL)
    json_structure = json_match.group(0) if json_match else ""

    # Enhanced instruction that works with any existing structure
    enhanced_prompt = f"""
I need to extract credit risk stage data from this financial report. Focus specifically on:

1. Tables showing loan quality or credit risk metrics
2. Sections with ECL (Expected Credit Loss) data
3. Information broken down by Stage 1, Stage 2, and Stage 3
4. Values for: ECL/provisions, gross exposures/balances, and coverage ratios

For clarity: Stage 1 is performing, Stage 2 is significantly increased risk, Stage 3 is credit-impaired.

First, scan the document for sections containing phrases like "credit quality", "loan impairment", "ECL", "credit risk" or tables with "Stage 1/2/3" headers.

{original_prompt}

IMPORTANT EXTRACTION TIPS:
- Values should be in millions (£m or $m)
- Coverage ratios are typically percentages (%)
- Look for the most recent reporting period data
- If a value is not found, use "N/A" rather than making an estimate
"""

    return enhanced_prompt


class IFRS9Processor:
    def __init__(self, embedding: EYQEmbeddings, chat_model: str, incubator_key: str):
        self.embedding = embedding
        self.chat_model = chat_model
        self.incubator_key = incubator_key
        self.chroma_client = Chroma(
            persist_directory=PERSIST_DIRECTORY,
            embedding_function=embedding,
            collection_name='IFRS9'
        )
        self.parser = LlamaParse(api_key=LLAMA_PARSE_API_KEY, result_type="markdown", verbose=True)
        self.total_prompts_run = 0
        self.total_successful_results = 0
        self.total_failed_results = 0

    def load_single_document(self, file_path: str, company_name: str, debug: bool = False,
                             retries: int = 3, delay: int = 5) -> List[Document]:
        if not os.path.exists(file_path) or not os.access(file_path, os.R_OK):
            print(f"Error: File {file_path} does not exist or is not readable")
            return []
        for attempt in range(retries):
            try:
                documents = self.parser.load_data(file_path)
                if not documents:
                    print(f"Warning: No content extracted from {file_path}")
                    return []
                docs = [
                    Document(page_content=doc.text,
                             metadata={"source": os.path.basename(file_path), "page": i, "name": company_name})
                    for i, doc in enumerate(documents)
                ]
                if debug:
                    for i, d in enumerate(docs):
                        print(f"Page {i}: {d.page_content[:500]}...")
                return docs
            except Exception as e:
                print(f"Attempt {attempt + 1}/{retries} - Error parsing {file_path}: {e}")
                print(traceback.format_exc())
                time.sleep(delay)
        print(f"Failed to parse {file_path} after {retries} attempts")
        return []

    def create_embedding_pdf(self, pdf_path: str, company_name: str, debug: bool = False):
        docs = self.load_single_document(pdf_path, company_name, debug=debug)
        if not docs:
            print(f"Skipping embedding creation for {pdf_path}")
            return None
        print(f"Loaded {len(docs)} pages from {pdf_path}")
        vectordb = Chroma.from_documents(
            docs,
            embedding=self.embedding,
            persist_directory=PERSIST_DIRECTORY,
            collection_name='IFRS9'
        )
        print("Embeddings created and persisted")
        return vectordb

    def llm_extract_field(self, content: str, prompt: str) -> str:
        llm = EYQChat(
            deployment_name=self.chat_model,
            api_key=self.incubator_key,
            api_base=EYQ_BASE_URL,
            api_version=EYQ_API_VERSION,
            verbose=True
        )
        full_prompt = (
            f"{prompt}\nFull Document Content:\n{content}\n"
            "Return the result as a JSON string with the field populated. If not found, return 'N/A'."
        )
        messages = [{"role": "user", "content": full_prompt}]
        return llm(messages)

    def process_content_chunk(self, content: str, company: str, prompt_str: str, part_name: str, debug: bool = False):
        """Process a chunk of content and extract JSON data with improved error handling."""
        if debug:
            print(f"Processing {part_name} for {company}: {content[:1000]}...")

        response = self.llm_extract_field(content, prompt_str)
        print(f"LLM response for {company} ({part_name}): {response}")

        try:
            # First try to find JSON blocks in the markdown format
            json_match = re.search(r'\`\`\`json\s*(.*?)\s*\`\`\`', response, re.DOTALL)
            if json_match:
                json_str = json_match.group(1).strip()
            else:
                # Try to find JSON within braces
                json_match = re.search(r'\{.*\}', response, re.DOTALL)
                if json_match:
                    json_str = json_match.group(0).strip()
                else:
                    raise ValueError("No valid JSON found in response")

            # Extract notes if present
            notes_start = response.find('**Note:') if '**Note:' in response else len(response)
            notes = response[notes_start:].strip() if notes_start < len(response) else "No notes provided"

            # Parse JSON and validate
            json_response = json.loads(json_str)

            # ADD THIS DEBUGGING LINE HERE:
            print(f"DEBUG: Categories found in response: {list(json_response.keys())}")

            # Ensure we have a valid dictionary
            if not isinstance(json_response, dict):
                raise ValueError(f"JSON response is not a dictionary: {type(json_response)}")

            # Flatten the JSON structure for Excel
            flattened_data = flatten_json_to_rows(json_response)

            return json_response, notes, flattened_data

        except json.JSONDecodeError as e:
            print(f"JSON parsing error for {company} ({part_name}): {e}")
            print(f"Problematic JSON string: {json_str if 'json_str' in locals() else 'Not found'}")
            return None, f"Failed to parse JSON response: {e}", [
                {"Category": "Error", "Stage": "N/A", "Field": "N/A", "Value": "Error"}]

        except Exception as e:
            print(f"Error processing response for {company} ({part_name}): {str(e)}")
            print(f"Full response: {response}")
            return None, f"Error: {str(e)}", [{"Category": "Error", "Stage": "N/A", "Field": "N/A", "Value": "Error"}]

    def process_pdf_part(self, docs: List[Document], company: str, prompt_str: str,
                         part_name: str, debug: bool = False) -> Tuple[Optional[dict], str, List[dict]]:
        """
        Process a subset of PDF documents and handle character limits.
        Returns merged results from chunks if content is split.
        """
        full_content = "\n\n".join(doc.page_content for doc in docs)
        cleaned = clean_ocr_text(full_content)

        if len(cleaned) > CHAR_THRESHOLD:
            print(f"{company} ({part_name}) content exceeds limit ({len(cleaned)} chars), splitting into chunks...")
            chunks = split_content_by_chars(cleaned, CHAR_THRESHOLD)
            print(f"Created {len(chunks)} chunks for {company} ({part_name})")

            # Track valid responses, their notes, and counts of N/A values
            valid_responses = []
            valid_notes = []
            valid_data = []

            # Process each chunk
            for i, chunk in enumerate(chunks):
                chunk_name = f"{part_name} Chunk {i + 1}"
                print(f"\n{'=' * 50}\nPROCESSING {chunk_name} ({len(chunk) // 1000}K chars)\n{'=' * 50}")

                try:
                    res_json, notes, flat_data = self.process_content_chunk(
                        chunk, company, prompt_str, chunk_name, debug
                    )

                    # Enhanced logging for response quality
                    if res_json is not None:
                        na_count = count_na_values(res_json)
                        total_fields = sum(
                            len(stage) for cat in res_json.values()
                            for stage in cat.values() if isinstance(stage, dict)
                        )
                        print(
                            f"SUCCESS: {chunk_name} returned valid JSON with {na_count} N/A values out of {total_fields} fields")
                        print(f"Structure: {list(res_json.keys())}")
                        valid_responses.append(res_json)
                        valid_notes.append(notes)
                        valid_data.append(flat_data)
                    else:
                        print(f"FAILURE: {chunk_name} did not return valid JSON")
                except Exception as e:
                    print(f"ERROR processing {chunk_name}: {e}")

                except Exception as e:
                    print(f"Error processing {chunk_name}: {e}")
                    # Continue with other chunks even if one fails

            # Check if we have any valid results
            if not valid_responses:
                print(f"No valid responses from any chunk in {part_name}")
                return None, f"All chunks failed to produce valid JSON for {part_name}", [
                    {"Category": "Error", "Stage": "N/A", "Field": "N/A", "Value": "No valid data extracted"}
                ]

            # Merge the valid responses
            merged_response = merge_json_responses(valid_responses)
            combined_notes = "\n\n".join([f"--- Notes from {part_name} Chunk {i + 1} ---\n{note}"
                                          for i, note in enumerate(valid_notes)])

            # Generate flattened data from the merged response
            flattened_data = flatten_json_to_rows(merged_response)

            # Log success
            print(f"Successfully merged {len(valid_responses)} responses for {part_name}")
            return merged_response, combined_notes, flattened_data
        else:
            # Content is small enough to process in one go
            return self.process_content_chunk(cleaned, company, prompt_str, part_name, debug)

    def find_table_sections(docs: List[Document], keywords: List[str]) -> List[List[Document]]:
        """Find sections of the document containing specific keywords and return them as chunks."""
        table_sections = []
        current_section = []
        in_section = False
        window_size = 3  # Pages to include before and after keyword matches

        # First pass: mark pages that contain keywords
        keyword_pages = set()
        for i, doc in enumerate(docs):
            if any(keyword.lower() in doc.page_content.lower() for keyword in keywords):
                # Add the page index and surrounding pages within window
                for j in range(max(0, i - window_size), min(len(docs), i + window_size + 1)):
                    keyword_pages.add(j)

        # Now group continuous sections
        if keyword_pages:
            current_group = []
            sorted_pages = sorted(keyword_pages)

            for i in range(len(sorted_pages)):
                if i > 0 and sorted_pages[i] > sorted_pages[i - 1] + 1:
                    # Break in continuity
                    if current_group:
                        table_sections.append([docs[j] for j in current_group])
                    current_group = [sorted_pages[i]]
                else:
                    current_group.append(sorted_pages[i])

            # Add the last group
            if current_group:
                table_sections.append([docs[j] for j in current_group])

        # If no sections found, return a sensible fallback
        if not table_sections:
            print("No keyword sections found, returning whole document in chunks")
            chunk_size = 20  # Smaller chunks for better processing
            for i in range(0, len(docs), chunk_size):
                end = min(i + chunk_size, len(docs))
                table_sections.append(docs[i:end])

        return table_sections

    def find_relevant_sections(self, docs: List[Document]) -> List[List[Document]]:
        """Find sections of the document relevant to ECL/credit risk data across any bank report."""
        # ECL-related keywords that appear in most bank reports
        keywords = [
            "credit risk", "expected credit loss", "ecl", "loan impairment",
            "stage 1", "stage 2", "stage 3", "provision", "credit quality",
            "coverage ratio", "loan to value", "ltv", "impairment allowance",
            "credit-impaired", "performing", "non-performing", "significant increase"
        ]

        # First pass: identify pages with keywords
        keyword_pages = []
        keyword_found_info = {}  # For debugging

        # Debug: Print what keywords are found on which pages
        for i, doc in enumerate(docs):
            content = doc.page_content.lower()
            found_keywords = []  # Track which keywords found

            for keyword in keywords:
                if keyword in content:
                    found_keywords.append(keyword)

            if found_keywords:
                keyword_pages.append(i)
                keyword_found_info[i] = found_keywords
                print(f"DEBUG: Page {i} contains keywords: {', '.join(found_keywords)}")

        # If we found relevant pages, create chunks around them
        section_chunks = []
        if keyword_pages:
            print(f"Found {len(keyword_pages)} pages with ECL-related content")

            # Group consecutive pages
            page_groups = []
            current_group = [keyword_pages[0]]

            for i in range(1, len(keyword_pages)):
                # If pages are consecutive or close (within 2 pages)
                if keyword_pages[i] <= keyword_pages[i - 1] + 3:
                    current_group.append(keyword_pages[i])
                else:
                    page_groups.append(current_group)
                    current_group = [keyword_pages[i]]

            # Add the last group
            if current_group:
                page_groups.append(current_group)

            # Create document chunks with context (include surrounding pages)
            context_size = 2  # pages before/after to include for context

            for group in page_groups:
                start = max(0, min(group) - context_size)
                end = min(len(docs), max(group) + context_size + 1)
                section_chunks.append(docs[start:end])

        # Fallback: create smaller, regular chunks if no keywords found
        if not section_chunks:
            print("No specific ECL content found - creating standard chunks")
            chunk_size = min(20, len(docs) // 10 + 1)  # Create reasonably sized chunks
            section_chunks = [docs[i:i + chunk_size] for i in range(0, len(docs), chunk_size)]

        # Debug: Print information about each chunk
        for chunk_idx, chunk in enumerate(section_chunks):
            start_page = chunk[0].metadata['page']
            end_page = chunk[-1].metadata['page']
            chunk_keywords = set()
            for page_idx in range(start_page, end_page + 1):
                if page_idx in keyword_found_info:
                    chunk_keywords.update(keyword_found_info[page_idx])

            print(
                f"DEBUG: Chunk {chunk_idx + 1} (pages {start_page}-{end_page}) contains keywords: {', '.join(chunk_keywords)}")

        return section_chunks

    def ingest_pdfs(self, debug: bool = False) -> List[str]:
        collection = self.chroma_client  # Already loaded
        existing_sources = {meta['source'] for meta in collection.get(include=['metadatas'])['metadatas']
                            if 'source' in meta}
        pdf_files = [f for f in os.listdir(SOURCE_DIRECTORY) if f.endswith(".pdf")]
        if not pdf_files:
            print(f"No PDFs found in {SOURCE_DIRECTORY}")
            return []
        ingested = []
        for pdf_file in pdf_files:
            pdf_path = os.path.join(SOURCE_DIRECTORY, pdf_file)
            company = os.path.splitext(pdf_file)[0]
            if pdf_file in existing_sources:
                print(f"Embeddings exist for {pdf_file}, skipping")
                ingested.append(company)
                continue
            if not os.path.exists(pdf_path):
                print(f"File {pdf_path} missing, skipping")
                continue
            create_backup_folder(PERSIST_DIRECTORY, BACKUP_FOLDER)
            try:
                vectordb = self.create_embedding_pdf(pdf_path, company, debug)
                if vectordb is None or not self.chroma_client.get(where={"source": pdf_file})['ids']:
                    print(f"No embeddings created for {pdf_file}")
                    continue
                print(f"Ingested {pdf_file} for {company}")
                ingested.append(company)
            except Exception as e:
                print(f"Error ingesting {pdf_file}: {e}")
        return ingested

    def run_automation_script(self, companies, prompts, debug=False, force=False, output_dir=None):
        """Process a list of companies with their respective prompts."""
        start_time = datetime.now()
        print(f"Started at {start_time.strftime('%Y%m%d_%H%M%S')}")

        # Use provided output directory or default
        output_directory = output_dir if output_dir else OUTPUT_DIRECTORY

        results = {}  # Store all results for returning

        for company in companies:
            print(f"Processing company: {company}")
            company_results = {}  # Store results for this company

            pdf_path = os.path.join(SOURCE_DIRECTORY, f"{company}.pdf")
            source_name = f"{company}.pdf"

            # Load documents
            existing = self.chroma_client.get(where={"source": source_name}, include=['documents', 'metadatas'])
            if existing['ids']:
                docs = [Document(page_content=content, metadata=meta)
                        for content, meta in zip(existing['documents'], existing['metadatas'])]
            else:
                if not os.path.exists(pdf_path):
                    print(f"Error: PDF file {pdf_path} does not exist, skipping {company}")
                    continue
                docs = self.load_single_document(pdf_path, company, debug=debug)
                if not docs:
                    print(f"Warning: No content loaded for {company}, skipping prompt processing")
                    continue
                Chroma.from_documents(
                    docs,
                    embedding=self.embedding,
                    persist_directory=PERSIST_DIRECTORY,
                    collection_name='IFRS9'
                )
                print(f"Successfully ingested {source_name} into the database")

            num_pages = len(docs)
            print(f"PDF for {company} has {num_pages} pages")

            for prompt_idx, prompt_entry in enumerate(prompts, 1):
                self.total_prompts_run += 1
                request, prompt_str = prompt_entry

                # Type checking for prompt
                if not isinstance(prompt_str, str):
                    print(f"Warning: prompt is not a string but {type(prompt_str)}, converting to string")
                    prompt_str = str(prompt_str) if prompt_str is not None else ""

                field_name = extract_field_from_prompt(prompt_str)
                print(f"Extracting field '{field_name}' for prompt {prompt_idx}: {request}")

                # STEP 4: Enhance ECL-related prompts
                if "ecl" in field_name.lower() or "stage" in field_name.lower() or "impairment" in prompt_str.lower():
                    original_prompt = prompt_str
                    prompt_str = enhance_ecl_prompt(prompt_str)
                    if prompt_str != original_prompt:
                        print("Enhanced prompt for better ECL data extraction")

                    # ADD THIS DEBUGGING LINE HERE:
                    print(f"DEBUG: Prompt for {company} ({request}): {prompt_str[:300]}...")

                # Generate unique timestamp per prompt
                timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
                output_file = os.path.join(output_directory, f"{company}_{request}_{timestamp}.xlsx")
                error_file = os.path.join(output_directory, f"{company}_{request}_{timestamp}_error.xlsx")

                if not force and (os.path.exists(output_file) or os.path.exists(error_file)):
                    print(f"Output already exists for '{company}' prompt {request}, skipping")
                    company_results[request] = {
                        "status": "Skipped",
                        "timestamp": timestamp,
                        "file": output_file if os.path.exists(output_file) else error_file
                    }
                    continue

                try:
                    # STEP 5: Intelligent document chunking
                    if num_pages >= PAGE_THRESHOLD:
                        # Use intelligent section finding for ECL related prompts
                        if "ecl" in field_name.lower() or "stage" in field_name.lower() or "credit" in prompt_str.lower():
                            print(f"Using ECL-targeted document chunking for {company} ({num_pages} pages)")
                            parts = self.find_relevant_sections(docs)
                            print(f"Created {len(parts)} targeted chunks")
                        else:
                            # Standard chunking for non-ECL prompts
                            if num_pages > 200:
                                print(f"Extra large PDF detected ({num_pages} pages), using 10 smaller chunks")
                                chunk_size = num_pages // 10
                                parts = [docs[i:i + chunk_size] for i in range(0, num_pages, chunk_size)]
                            else:
                                print(f"Large PDF detected ({num_pages} pages), using standard 3-part chunking")
                                chunk_size = num_pages // 3
                                parts = [docs[:chunk_size], docs[chunk_size:2 * chunk_size], docs[2 * chunk_size:]]

                        # Process each part and collect results
                        valid_json_responses = []
                        valid_notes = []

                        for i, part_docs in enumerate(parts):
                            part_name = f"Part {i + 1}"
                            print(f"\n{'=' * 30}\nProcessing {part_name} ({len(part_docs)} pages)\n{'=' * 30}")

                            # Process with longer timeout for ECL data
                            try:
                                # For ECL data, use longer timeout
                                timeout = 60 if "ecl" in field_name.lower() else 30
                                json_response, notes, flattened_data = self.process_pdf_part(
                                    part_docs, company, prompt_str, part_name, debug
                                )

                                # ADD THIS DEBUGGING BLOCK HERE:
                                if json_response is not None:
                                    # Save raw JSON for debugging
                                    debug_file = os.path.join(output_directory, f"debug_{company}_{request}_{part_name.replace(' ', '_')}.json")
                                    try:
                                        with open(debug_file, "w") as f:
                                            json.dump(json_response, f, indent=2)
                                        print(f"DEBUG: Saved raw JSON from {part_name} to {debug_file}")
                                    except Exception as e:
                                        print(f"DEBUG: Failed to save JSON debug file: {str(e)}")

                                if json_response is not None:
                                    valid_json_responses.append(json_response)
                                    valid_notes.append(f"--- Notes from {part_name} ---\n{notes}")
                                    print(f"✅ Valid result from {part_name}")
                                else:
                                    print(f"No valid result from {part_name}")
                            except Exception as e:
                                print(f"⚠️ Error processing {part_name}: {str(e)}")
                                continue

                        # Handle successful parts
                        if valid_json_responses:
                            if len(valid_json_responses) == 1:
                                # Only one valid response
                                json_response = valid_json_responses[0]
                                notes = valid_notes[0]
                                flattened_data = flatten_json_to_rows(json_response)
                            else:
                                # Try to merge multiple responses
                                try:
                                    merged_response = merge_json_responses(valid_json_responses)
                                    combined_notes = "\n\n".join(valid_notes)

                                    # ADD THIS DEBUGGING BLOCK HERE:
                                    debug_file = os.path.join(output_directory,
                                                              f"debug_{company}_{request}_merged.json")
                                    try:
                                        with open(debug_file, "w") as f:
                                            json.dump(merged_response, f, indent=2)
                                        print(f"DEBUG: Saved merged JSON to {debug_file}")
                                    except Exception as e:
                                        print(f"DEBUG: Failed to save merged JSON debug file: {str(e)}")

                                    flattened_data = flatten_json_to_rows(merged_response)
                                    json_response = merged_response
                                    notes = combined_notes
                                    print(f"Successfully merged {len(valid_json_responses)} responses")
                                except Exception as e:
                                    # If merging fails, use the response with the most data
                                    print(f"Error merging responses: {e}, using best single response")
                                    best_idx = 0
                                    max_fields = 0

                                    for i, resp in enumerate(valid_json_responses):
                                        num_fields = sum(
                                            len(stage) for cat in resp.values()
                                            for stage in cat.values() if isinstance(stage, dict)
                                        )
                                        if num_fields > max_fields:
                                            max_fields = num_fields
                                            best_idx = i

                                    json_response = valid_json_responses[best_idx]
                                    notes = valid_notes[
                                                best_idx] + "\n\nNOTE: Selected best individual response - merge failed"
                                    flattened_data = flatten_json_to_rows(json_response)
                        else:
                            raise ValueError("No valid results from any part of the document")

                    else:
                        # Single processing for smaller documents
                        full_content = "\n\n".join([doc.page_content for doc in docs])
                        cleaned_content = clean_ocr_text(full_content)

                        if len(cleaned_content) > CHAR_THRESHOLD:
                            # Handle long content by splitting
                            chunks = split_content_by_chars(cleaned_content, CHAR_THRESHOLD)
                            chunk_results = []

                            for i, chunk in enumerate(chunks):
                                chunk_name = f"Chunk {i + 1}"
                                result = self.process_content_chunk(chunk, company, prompt_str, chunk_name, debug)
                                if result[0] is not None:
                                    chunk_results.append(result)

                            if not chunk_results:
                                raise ValueError("No valid results from any chunk")

                            if len(chunk_results) == 1:
                                json_response, notes, flattened_data = chunk_results[0]
                            else:
                                # Find the chunk with fewest N/A values
                                scored_chunks = [
                                    (res, notes, data, count_na_values(res))
                                    for res, notes, data in chunk_results
                                ]
                                best_chunk = min(scored_chunks, key=lambda x: x[3])
                                json_response, notes, flattened_data, _ = best_chunk
                        else:
                            # Process directly if under threshold
                            json_response, notes, flattened_data = self.process_content_chunk(
                                cleaned_content, company, prompt_str, "Full Content", debug
                            )

                    # Check if all values are N/A
                    if json_response and all_values_na(json_response):
                        raise ValueError("All extracted values are 'N/A', extraction likely failed")

                    # Write to Excel and store results
                    write_to_excel(flattened_data, notes, output_file)
                    self.total_successful_results += 1

                    company_results[request] = {
                        "status": "Success",
                        "timestamp": timestamp,
                        "file": output_file,
                        "data": flattened_data,
                        "notes": notes
                    }

                except Exception as e:
                    # STEP 6: Improved error handling
                    print(f"Error processing {company} for prompt {request}: {str(e)}")

                    # Check if it's an ECL-related prompt
                    is_ecl_prompt = any(term in field_name.lower() for term in ["ecl", "stage", "impairment"])

                    if is_ecl_prompt:
                        # Create informative fallback for ECL prompts
                        fallback_data = [
                            {"Category": "ERROR", "Stage": "N/A", "Field": "Error Type",
                             "Value": "Extraction failed: " + str(e)},
                            {"Category": "ACTION NEEDED", "Stage": "N/A", "Field": "Required Action",
                             "Value": "Manual extraction recommended - review document pages with ECL tables"}
                        ]

                        # Add helpful instructions
                        error_notes = (
                            f"ERROR EXTRACTING ECL DATA FOR {company}: {str(e)}\n\n"
                            f"The system attempted to process ECL data but encountered errors.\n\n"
                            f"TROUBLESHOOTING TIPS:\n"
                            f"1. Check pages with Stage 1, 2, 3 information\n"
                            f"2. Look for credit quality or loan tables\n"
                            f"3. Try adjusting chunk size if tables are split across pages\n\n"
                            f"Technical error details:\n{traceback.format_exc()}"
                        )

                        # Still create an informative output file
                        write_to_excel(fallback_data, error_notes, error_file)
                    else:
                        # Standard error handling for non-ECL prompts
                        error_data = [{"Category": "Error", "Stage": "N/A", "Field": field_name, "Value": str(e)}]
                        error_notes = f"Error: {str(e)}\n{traceback.format_exc()}"
                        write_to_excel(error_data, error_notes, error_file)

                    self.total_failed_results += 1

                    company_results[request] = {
                        "status": "Error",
                        "timestamp": timestamp,
                        "file": error_file,
                        "data": fallback_data if is_ecl_prompt else error_data,
                        "notes": error_notes,
                        "error": str(e)
                    }

                # Clean up any variables that might use a lot of memory
                if 'json_response' in locals():
                    del json_response
                if 'flattened_data' in locals():
                    del flattened_data
                if 'full_content' in locals():
                    del full_content
                if 'cleaned_content' in locals():
                    del cleaned_content

            # Store results for this company
            results[company] = company_results

            # Clear docs after all prompts for this company
            del docs

        end_time = datetime.now()
        duration = end_time - start_time
        success_rate = self.total_successful_results / self.total_prompts_run if self.total_prompts_run > 0 else 0
        print(f"Run Summary: {self.total_prompts_run} prompts, {self.total_successful_results} successes, "
              f"{self.total_failed_results} failures, {success_rate:.2%} success rate")

        return results


# Load Prompts from a csv and not directly in python as Grant so badly wanted... XD

def load_prompts_from_csv(csv_path):
    """
    Load bank-specific prompts from a CSV file and ensure proper formatting.
    """
    try:
        # Handle different encodings
        try:
            df = pd.read_csv(csv_path, encoding='utf-8')
        except UnicodeDecodeError:
            df = pd.read_csv(csv_path, encoding='cp1252')

        # Validate columns
        required_columns = ['Bank', 'PromptName', 'PromptText']
        if not all(col in df.columns for col in required_columns):
            missing = [col for col in required_columns if col not in df.columns]
            print(f"CSV {csv_path} is missing required columns: {', '.join(missing)}")
            return {}

        # Clean and format prompts
        for i, row in df.iterrows():
            # Handle NaN values
            for col in df.columns:
                if pd.isna(row[col]):
                    df.at[i, col] = ""

            # Ensure PromptText is a string
            if not isinstance(row['PromptText'], str):
                df.at[i, 'PromptText'] = str(row['PromptText'])

            # Fix specific issues in Santander prompts
            if 'Santander' in str(row['Bank']) and 'IFRS9 Data by Stage' in str(row['PromptName']):
                text = df.at[i, 'PromptText']
                # Fix JSON structure
                text = text.replace('}\n     "', '},\n     "')
                text = text.replace('" ', '"').replace(' "', '"')
                df.at[i, 'PromptText'] = text

        # Organize prompts by bank
        bank_prompts = {}
        for _, row in df.iterrows():
            bank = row['Bank']
            prompt_name = row['PromptName']
            prompt_text = row['PromptText']

            if bank not in bank_prompts:
                bank_prompts[bank] = []

            bank_prompts[bank].append((prompt_name, prompt_text))

        return bank_prompts

    except Exception as e:
        print(f"Error loading prompts from {csv_path}: {e}")
        print(traceback.format_exc())
        return {}


def process_bank(processor, bank, prompts, debug=False, force=False):
    """Process a single bank and its prompts"""
    print(f"Processing {bank} with {len(prompts)} prompts")

    # Find PDFs for this bank
    bank_pdfs = [f for f in os.listdir(SOURCE_DIRECTORY)
                 if f.endswith('.pdf') and bank.lower() in f.lower()]

    if not bank_pdfs:
        print(f"No PDF files found for {bank}, skipping.")
        return None

    # Ingest PDFs for this bank
    companies = processor.ingest_pdfs(debug=debug)

    # Filter companies to only those matching this bank
    bank_companies = [c for c in companies if bank.lower() in c.lower()]

    if bank_companies:
        bank_results = processor.run_automation_script(bank_companies, prompts, debug=debug, force=force)
        return bank_results
    else:
        print(f"No companies successfully ingested for {bank}, skipping.")
        return None


# =============================================================================
# Main Execution
# =============================================================================
def main():
    # Configuration
    CSV_PROMPTS_PATH = os.path.join(os.path.dirname(__file__), "EY_FinSight_Prompts3.csv")
    #CSV_PROMPTS_PATH = "C:/Users/BM754JC/Benchmarking/EY_FinSight_Prompts3.csv"  # Update with actual path
    PROCESS_ALL_BANKS = True  # Set to False to process only specific banks
    TARGET_BANKS = ["Barclays"]  # Only used if PROCESS_ALL_BANKS is False
    MAX_WORKERS = 3  # Number of banks to process in parallel

    embedding = EYQEmbeddings(
        model=EYQ_EMBEDDING_MODEL,
        api_key=EYQ_INCUBATOR_KEY,
        api_base=EYQ_BASE_URL,
        api_version=EYQ_API_VERSION,
        auth_header_name=AUTH_HEADER_NAME,
        use_bearer=USE_BEARER
    )
    processor = IFRS9Processor(embedding, EYQ_CHAT_MODEL, EYQ_INCUBATOR_KEY)

    # Load prompts from CSV
    bank_prompts = load_prompts_from_csv(CSV_PROMPTS_PATH)
    if not bank_prompts:
        print("Error: No prompts loaded from CSV. Please check the CSV file and try again.")
        return  # Exit if no prompts are found

    # Determine which banks to process
    banks_to_process = list(bank_prompts.keys()) if PROCESS_ALL_BANKS else TARGET_BANKS
    banks_to_process = [b for b in banks_to_process if b in bank_prompts]

    print(f"Processing the following banks: {', '.join(banks_to_process)}")

    # Process banks in parallel and collect results
    all_results = {}
    with concurrent.futures.ThreadPoolExecutor(max_workers=MAX_WORKERS) as executor:
        # Create a mapping of futures to banks
        future_to_bank = {
            executor.submit(process_bank, processor, bank, bank_prompts[bank], False, False): bank
            for bank in banks_to_process
        }

        # Process results as they complete
        for future in concurrent.futures.as_completed(future_to_bank):
            bank = future_to_bank[future]
            try:
                bank_results = future.result()
                if bank_results:
                    all_results[bank] = bank_results
                    print(f"Successfully processed {bank}")
                else:
                    print(f"No results for {bank}")
            except Exception as e:
                print(f"Error processing {bank}: {e}")
                print(traceback.format_exc())

    # Combine all results into a single Excel file if we have any
    if all_results:
        timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
        combined_output = os.path.join(OUTPUT_DIRECTORY, f"IFRS9_Combined_Results_{timestamp}.xlsx")
        combine_excel_outputs(all_results, combined_output)
    else:
        print("No results to combine into a workbook.")


if __name__ == '__main__':
    main()

\`\`\`

# IFRS9\.chroma\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\data_level0.bin

This is a binary file of the type: Binary

# IFRS9\.chroma\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\header.bin

This is a binary file of the type: Binary

# IFRS9\.chroma\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\length.bin

This is a binary file of the type: Binary

# IFRS9\.chroma\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\link_lists.bin

\`\`\`bin

\`\`\`

# IFRS9\.chroma\chroma.sqlite3

This is a binary file of the type: Binary

# IFRS9\backup\.chromadb_20250523_144457_0\chroma.sqlite3

This is a binary file of the type: Binary

# IFRS9\backup\.chromadb_20250523_144759_0\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\data_level0.bin

This is a binary file of the type: Binary

# IFRS9\backup\.chromadb_20250523_144759_0\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\header.bin

This is a binary file of the type: Binary

# IFRS9\backup\.chromadb_20250523_144759_0\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\length.bin

This is a binary file of the type: Binary

# IFRS9\backup\.chromadb_20250523_144759_0\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\link_lists.bin

\`\`\`bin

\`\`\`

# IFRS9\backup\.chromadb_20250523_144759_0\chroma.sqlite3

This is a binary file of the type: Binary

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_IFRS9 Data by Stage_Part_5.json

\`\`\`json
{
  "Mortgages": {
    "Stage 1": {
      "ECL": "10",
      "Balance": "157268",
      "Coverage": "0.01%"
    },
    "Stage 2": {
      "ECL": "84",
      "Balance": "16973",
      "Coverage": "0.50%"
    },
    "Stage 3": {
      "ECL": "78",
      "Balance": "1785",
      "Coverage": "4.37%"
    }
  },
  "EDB - Credit Cards": {
    "Stage 1": {
      "ECL": "N/A",
      "Balance": "2271",
      "Coverage": "N/A"
    },
    "Stage 2": {
      "ECL": "N/A",
      "Balance": "454",
      "Coverage": "N/A"
    },
    "Stage 3": {
      "ECL": "N/A",
      "Balance": "49",
      "Coverage": "N/A"
    }
  },
  "EDB - Other": {
    "Stage 1": {
      "ECL": "N/A",
      "Balance": "N/A",
      "Coverage": "N/A"
    },
    "Stage 2": {
      "ECL": "N/A",
      "Balance": "N/A",
      "Coverage": "N/A"
    },
    "Stage 3": {
      "ECL": "N/A",
      "Balance": "N/A",
      "Coverage": "N/A"
    }
  },
  "Consumer Finance": {
    "Stage 1": {
      "ECL": "25",
      "Balance": "4389",
      "Coverage": "0.57%"
    },
    "Stage 2": {
      "ECL": "16",
      "Balance": "334",
      "Coverage": "4.79%"
    },
    "Stage 3": {
      "ECL": "27",
      "Balance": "36",
      "Coverage": "75.00%"
    }
  },
  "Corporate & Commercial Banking": {
    "Stage 1": {
      "ECL": "73",
      "Balance": "23023",
      "Coverage": "0.32%"
    },
    "Stage 2": {
      "ECL": "85",
      "Balance": "2568",
      "Coverage": "3.31%"
    },
    "Stage 3": {
      "ECL": "184",
      "Balance": "716",
      "Coverage": "25.70%"
    }
  },
  "Corporate Centre": {
    "Stage 1": {
      "ECL": "N/A",
      "Balance": "N/A",
      "Coverage": "N/A"
    },
    "Stage 2": {
      "ECL": "N/A",
      "Balance": "N/A",
      "Coverage": "N/A"
    },
    "Stage 3": {
      "ECL": "N/A",
      "Balance": "N/A",
      "Coverage": "N/A"
    }
  }
}
\`\`\`

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario ECL_Part_5.json

\`\`\`json
{
  "Retail & Business Banking": {
    "Upside": {
      "ECL": "380",
      "Balance": "196732"
    },
    "Base": {
      "ECL": "403",
      "Balance": "196732"
    },
    "Downside 1": {
      "ECL": "517",
      "Balance": "196732"
    },
    "Downside 2": {
      "ECL": "1051",
      "Balance": "196732"
    },
    "Weighted": {
      "ECL": "458",
      "Balance": "196732"
    }
  },
  "Mortgages": {
    "Upside": {
      "ECL": "112",
      "Balance": "176026"
    },
    "Base": {
      "ECL": "128",
      "Balance": "176026"
    },
    "Downside 1": {
      "ECL": "218",
      "Balance": "176026"
    },
    "Downside 2": {
      "ECL": "705",
      "Balance": "176026"
    },
    "Weighted": {
      "ECL": "172",
      "Balance": "176026"
    }
  },
  "Consumer Finance": {
    "Upside": {
      "ECL": "67",
      "Balance": "4759"
    },
    "Base": {
      "ECL": "68",
      "Balance": "4759"
    },
    "Downside 1": {
      "ECL": "69",
      "Balance": "4759"
    },
    "Downside 2": {
      "ECL": "70",
      "Balance": "4759"
    },
    "Weighted": {
      "ECL": "69",
      "Balance": "4759"
    }
  },
  "Corporate & Commercial Banking": {
    "Upside": {
      "ECL": "294",
      "Balance": "26307"
    },
    "Base": {
      "ECL": "303",
      "Balance": "26307"
    },
    "Downside 1": {
      "ECL": "335",
      "Balance": "26307"
    },
    "Downside 2": {
      "ECL": "403",
      "Balance": "26307"
    },
    "Weighted": {
      "ECL": "342",
      "Balance": "26307"
    }
  },
  "Corporate Centre": {
    "Upside": {
      "ECL": "N/A",
      "Balance": "56062"
    },
    "Base": {
      "ECL": "N/A",
      "Balance": "56062"
    },
    "Downside 1": {
      "ECL": "N/A",
      "Balance": "56062"
    },
    "Downside 2": {
      "ECL": "N/A",
      "Balance": "56062"
    },
    "Weighted": {
      "ECL": "N/A",
      "Balance": "56062"
    }
  }
}
\`\`\`

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_merged.json

\`\`\`json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "15"
    },
    "Base case ": {
      "Weight": "50"
    },
    "Downside 1": {
      "Weight": "25"
    },
    "Downside 2  ": {
      "Weight": "10"
    }
  }
}
\`\`\`

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_1.json

\`\`\`json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
\`\`\`

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_2.json

\`\`\`json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
\`\`\`

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_3.json

\`\`\`json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "15"
    },
    "Base case ": {
      "Weight": "50"
    },
    "Downside 1": {
      "Weight": "25"
    },
    "Downside 2  ": {
      "Weight": "10"
    }
  }
}
\`\`\`

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_4.json

\`\`\`json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
\`\`\`

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_5.json

\`\`\`json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
\`\`\`

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_6.json

\`\`\`json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
\`\`\`

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_7.json

\`\`\`json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
\`\`\`

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_8.json

\`\`\`json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
\`\`\`

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_9.json

\`\`\`json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
\`\`\`

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_10.json

\`\`\`json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
\`\`\`

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_11.json

\`\`\`json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
\`\`\`

# IFRS9\outputs\IFRS9_Combined_Results_20250523_145155.xlsx

This is a binary file of the type: Excel Spreadsheet

# IFRS9\outputs\Santander UK plc 2024 Annual Report_IFRS9 Data by Stage_20250523_145123.xlsx

This is a binary file of the type: Excel Spreadsheet

# IFRS9\outputs\Santander UK plc 2024 Annual Report_Scenario ECL_20250523_145024.xlsx

This is a binary file of the type: Excel Spreadsheet

# IFRS9\outputs\Santander UK plc 2024 Annual Report_Scenario Weight_20250523_145055.xlsx

This is a binary file of the type: Excel Spreadsheet

# IFRS9\reports\Barclays-Bank-UK-Annual-Report-2024.pdf

This is a binary file of the type: PDF

# IFRS9\reports\Postman-win64-Setup.exe

This is a binary file of the type: Executable

# IFRS9\reports\Santander UK plc 2024 Annual Report.pdf

This is a binary file of the type: PDF

# minimal_requirements.txt

\`\`\`txt
langchain==0.3.20
langchain-openai==0.3.8
langchain-community==0.3.19
langchain-core==0.3.43
python-dotenv==1.0.0
chromadb==0.4.18
tabula-py==2.9.0
pandas==2.1.1
numpy==1.26.4
PyPDF2==3.0.1
httpx==0.28.1
jsonpointer==2.4
jsonschema==4.19.1
MarkupSafe==2.1.3
marshmallow==3.20.1
networkx==3.3
openai==1.66.0
ipykernel==6.29.5
jedi==0.19.2
\`\`\`

# missing_packages.txt

\`\`\`txt
jsonschema-specifications==2023.7.1
xmltodict==0.13.0
networkx==3.3
nibabel==5.2.1
httpx==0.28.1
jedi==0.19.2
onnxruntime==1.16.0
opentelemetry-api==1.30.0
overrides==7.4.0
packaging==23.2
Pillow==10.0.1
pyparsing==3.1.2
pydantic==2.10.6
pygments==2.16.1
tenacity==8.2.3
tokenizers==0.14.0
tqdm==4.66.1
typing_extensions==4.12.2
urllib3==2.0.6
wrapt==1.17.2
llama-index
\`\`\`

# requirements_minimal.txt

\`\`\`txt
langchain==0.3.20
langchain-openai==0.3.8
python-dotenv==1.0.0
chromadb==0.4.18
tabula-py==2.9.0
pandas==2.1.1
numpy==1.26.4
PyPDF2==3.0.1
httpx==0.28.1
\`\`\`

# requirements.txt

\`\`\`txt
aiohttp==3.8.5
aiosignal==1.3.1
altair==5.1.2
annotated-types==0.7.0
anyio==3.7.1
asgiref==3.8.1
asttokens==3.0.0
async-timeout==4.0.3
attrs==23.1.0
azure-core==1.29.4
backoff==2.2.1
bcrypt==4.0.1
blinker==1.6.2
cachetools==5.3.1
certifi==2023.7.22
charset-normalizer==3.3.0
chroma-hnswlib==0.7.3
chromadb==0.4.18
ci-info==0.3.0
click==8.1.7
cloudpickle==3.1.1
colorama==0.4.6
coloredlogs==15.0.1
comm==0.2.2
configobj==5.0.8
configparser==7.0.0
dataclasses-json==0.6.1
debugpy==1.8.13
decorator==5.2.1
Deprecated==1.2.18
distro==1.9.0
durationpy==0.9
etelemetry==0.3.1
executing==2.2.0
fastapi==0.103.2
filelock==3.12.4
fitz==0.0.1.dev2
flatbuffers==23.5.26
frozenlist==1.4.0
fsspec==2023.9.2
gitdb==4.0.10
GitPython==3.1.37
google-auth==2.38.0
googleapis-common-protos
greenlet==3.0.0
grpcio==1.71.0
h11==0.14.0
httpcore==1.0.7
httplib2==0.22.0
httptools==0.6.0
httpx==0.28.1
httpx-sse==0.4.0
huggingface-hub==0.16.4
humanfriendly==10.0
idna==3.4
importlib-metadata==6.8.0
importlib-resources==6.1.0
ipykernel==6.29.5
ipython==8.34.0
isodate==0.6.1
jedi==0.19.2
Jinja2==3.1.2
jiter==0.9.0
jpype1==1.5.2
jsonpatch==1.33
jsonpointer==2.4
jsonschema==4.19.1
jsonschema-specifications==2023.7.1
jupyter_client==8.6.3
jupyter_core==5.7.2
kubernetes==32.0.1
langchain==0.3.20
langchain-community==0.3.19
langchain-core==0.3.43
langchain-openai==0.3.8
langchain-text-splitters==0.3.6
langsmith==0.3.13
looseversion==1.3.0
lxml==5.2.2
markdown-it-py==3.0.0
MarkupSafe==2.1.3
marshmallow==3.20.1
matplotlib-inline==0.1.7
mdurl==0.1.2
mmh3==5.1.0
monotonic==1.6
mpmath==1.3.0
multidict==6.0.4
mypy-extensions==1.0.0
nest-asyncio==1.6.0
networkx==3.3
nibabel==5.2.1
nipype==1.8.6
numpy==1.26.4
oauthlib==3.2.2
onnxruntime>=1.17.0
openai==1.66.0
opentelemetry-api==1.30.0
opentelemetry-exporter-otlp-proto-common==1.30.0
opentelemetry-exporter-otlp-proto-grpc==1.30.0
opentelemetry-instrumentation==0.51b0
opentelemetry-instrumentation-asgi==0.51b0
opentelemetry-instrumentation-fastapi==0.51b0
opentelemetry-proto
opentelemetry-sdk==1.30.0
opentelemetry-semantic-conventions==0.51b0
opentelemetry-util-http==0.51b0
orjson==3.10.15
overrides==7.4.0
packaging==23.2
pandas==2.1.1
parso==0.8.4
pathlib==1.0.1
Pillow==10.0.1
platformdirs==4.3.6
posthog==3.0.2
prompt_toolkit==3.0.50
protobuf
prov==2.0.1
psutil==7.0.0
pulsar-client>=3.4.0
pure_eval==0.2.3
pyarrow==13.0.0
pyasn1==0.6.1
pyasn1_modules==0.4.1
pydantic==2.10.6
pydantic-settings==2.8.1
pydantic_core==2.27.2
pydeck==0.8.1b0
pydot==2.0.0
Pygments==2.16.1
pyparsing==3.1.2
pypdf==3.16.2
PyPDF2==3.0.1
PyPika==0.48.9
pyreadline3==3.4.1
python-dateutil==2.8.2
python-dotenv==1.0.0
pytz==2023.3.post1
pywin32==309
pyxnat==1.6.2
PyYAML==6.0.1
pyzmq==26.2.1
rdflib==6.3.2
referencing==0.30.2
regex==2023.10.3
requests==2.31.0
requests-oauthlib==2.0.0
requests-toolbelt==1.0.0
rich==13.6.0
rpds-py==0.10.4
rsa==4.9
scipy==1.13.1
simplejson==3.19.2
six==1.16.0
smmap==5.0.1
sniffio==1.3.0
spyder-kernels==3.0.3
SQLAlchemy==2.0.21
stack-data==0.6.3
starlette==0.27.0
streamlit
sympy==1.12
tabula==1.0.5
tabula-py==2.9.3
tenacity==8.2.3
tiktoken==0.9.0
tokenizers==0.14.0
toml==0.10.2
toolz==0.12.0
tornado==6.3.3
tqdm==4.66.1
traitlets==5.14.3
traits==6.3.2
typer==0.9.0
typing-inspect==0.9.0
typing_extensions==4.12.2
tzdata==2023.3
tzlocal==5.1
urllib3==2.0.6
uvicorn==0.23.2
validators==0.22.0
watchdog==3.0.0
watchfiles==0.20.0
wcwidth==0.2.13
websocket-client==1.8.0
websockets==11.0.3
wrapt==1.17.2
XlsxWriter==3.2.0
yarl==1.9.2
zipp==3.17.0
zstandard==0.23.0
onnxruntime==1.16.3
openpyxl
llama-index

\`\`\`

# V6.py

\`\`\`py
#!/usr/bin/env python3
"""
Interactive IFRS9 Automation Script - User Upload Version

This script allows users to upload individual PDFs for IFRS9 data extraction,
rather than batch processing from a folder. It provides a user-friendly interface
for single document processing with bank-specific prompts.
"""

import os
import json
import re
import shutil
import time
import traceback
from datetime import datetime
from typing import List, Tuple, Optional, Dict, Any
import tkinter as tk
from tkinter import filedialog, messagebox, ttk
import threading

import requests
import pandas as pd
import openpyxl
from dotenv import load_dotenv
import nest_asyncio

from langchain_community.vectorstores import Chroma
from langchain.schema import Document
from chromadb.api.types import EmbeddingFunction
from llama_index.readers.llama_parse import LlamaParse

# Apply nest_asyncio to allow nested event loops
nest_asyncio.apply()

# =============================================================================
# Configuration and Global Constants
# =============================================================================
ENV_PATH = os.path.join(os.path.dirname(__file__), "ATT27768.env")
load_dotenv(ENV_PATH)

LLAMA_PARSE_API_KEY = os.getenv("LLAMA_PARSE_API_KEY")
if not LLAMA_PARSE_API_KEY:
    raise ValueError("LLAMA_PARSE_API_KEY not found in .env file.")

EYQ_INCUBATOR_KEY = os.getenv("EYQ_INCUBATOR_KEY")
EYQ_BASE_URL = "https://eyq-incubator.europe.fabric.ey.com/eyq/eu/api"
EYQ_CHAT_MODEL = "gpt-4o"
EYQ_EMBEDDING_MODEL = "text-embedding-3-large"
EYQ_API_VERSION = "2023-05-15"
AUTH_HEADER_NAME = "api-key"
USE_BEARER = False

# Create temp directories for single file processing
TEMP_DIRECTORY = './temp_processing'
PERSIST_DIRECTORY = './temp_processing/.chroma'
OUTPUT_DIRECTORY = './outputs'

# Create directories if they don't exist
for directory in [TEMP_DIRECTORY, OUTPUT_DIRECTORY]:
    os.makedirs(directory, exist_ok=True)

# Thresholds
PAGE_THRESHOLD = 150
CHAR_THRESHOLD = 1_000_000


# =============================================================================
# Import all utility functions from original code
# =============================================================================

def clean_ocr_text(text: str) -> str:
    replacements = {
        '': '6', '': '5', '': '7', '': '4', '': '3',
        '': '0', '': '9', '': '8', '': '1', '': '2',
        '': '', '': '.', '': '0', '|': ' ', '\n': ' ',
        ' S': ' 5', ' I': ' 1', ' O': ' 0', ' B': ' 8'
    }
    for garbled, replacement in replacements.items():
        text = text.replace(garbled, replacement)
    return text


def split_content_by_chars(content: str, char_threshold: int) -> List[str]:
    if len(content) <= char_threshold:
        return [content]
    chunks = []
    start = 0
    while start < len(content):
        end = min(start + char_threshold, len(content))
        break_point = content.rfind('\n', start, end)
        if break_point == -1:
            break_point = content.rfind(' ', start, end)
        if break_point == -1 or break_point <= start:
            break_point = end
        chunks.append(content[start:break_point])
        start = break_point + 1
    return chunks


def flatten_json_to_rows(json_data):
    """Flatten nested JSON into a list of rows for Excel."""
    rows = []

    if isinstance(json_data, str):
        return [{"Category": "Error", "Stage": "N/A", "Field": "Response", "Value": json_data}]

    if all(not isinstance(val, dict) for val in json_data.values()):
        for key, value in json_data.items():
            rows.append({
                "Category": "Main",
                "Stage": "N/A",
                "Field": key,
                "Value": str(value)
            })
        return rows

    for category, content in json_data.items():
        if isinstance(content, dict):
            for field, value in content.items():
                if isinstance(value, dict):
                    for subfield, subvalue in value.items():
                        rows.append({
                            "Category": category,
                            "Stage": field,
                            "Field": subfield,
                            "Value": str(subvalue)
                        })
                else:
                    rows.append({
                        "Category": category,
                        "Stage": "N/A",
                        "Field": field,
                        "Value": str(value)
                    })
        else:
            rows.append({
                "Category": "Summary",
                "Stage": "N/A",
                "Field": category,
                "Value": str(content)
            })

    return rows


def write_to_excel(data: List[Dict[str, str]], notes: str, output_file: str) -> None:
    with pd.ExcelWriter(output_file, engine="xlsxwriter") as writer:
        pd.DataFrame(data).to_excel(writer, index=False, sheet_name="IFRS9 Data")
        pd.DataFrame({"Notes": [notes]}).to_excel(writer, index=False, sheet_name="Notes")
    print(f"Data written to {output_file}")


# =============================================================================
# Custom Classes (copied from original)
# =============================================================================

class EYQEmbeddings(EmbeddingFunction):
    def __init__(self, model: str, api_key: str, api_base: str, api_version: str,
                 auth_header_name: str = "Authorization", use_bearer: bool = True):
        self.model = model
        self.api_key = api_key
        self.api_base = api_base
        self.api_version = api_version
        self.auth_header_name = auth_header_name
        self.use_bearer = use_bearer
        self.session = requests.Session()

    def __call__(self, inputs: List[str]) -> List[List[float]]:
        headers = {"Content-Type": "application/json",
                   self.auth_header_name: f"Bearer {self.api_key}" if self.use_bearer else self.api_key}
        embeddings = []
        for text in inputs:
            payload = {"model": self.model, "input": text, "api_version": self.api_version}
            endpoint = f"{self.api_base}/openai/deployments/{self.model}/embeddings"
            response = self.session.post(endpoint, headers=headers, json=payload, timeout=30)
            if response.ok:
                data = response.json()
                embeddings.append(data["data"][0]["embedding"])
            else:
                raise Exception(f"Embedding request failed: {response.text}")
        return embeddings

    def embed_documents(self, texts: List[str]) -> List[List[float]]:
        return self.__call__(texts)

    def embed_query(self, text: str) -> List[float]:
        return self.__call__([text])[0]


class EYQChat:
    def __init__(self, deployment_name: str, api_key: str, api_base: str, api_version: str,
                 temperature: float = 0, verbose: bool = False):
        self.deployment_name = deployment_name
        self.api_key = api_key
        self.api_base = api_base
        self.api_version = api_version
        self.temperature = temperature
        self.verbose = verbose
        self.session = requests.Session()

    def __call__(self, messages: List[Dict[str, str]], retries: int = 3, delay: int = 2, **kwargs) -> str:
        headers = {AUTH_HEADER_NAME: self.api_key, "Content-Type": "application/json"}
        payload = {"model": self.deployment_name, "messages": messages, "temperature": self.temperature}
        endpoint = f"{self.api_base}/openai/deployments/{self.deployment_name}/chat/completions"
        timeout = kwargs.get('timeout', 60)

        for attempt in range(retries):
            try:
                response = self.session.post(endpoint, headers=headers, json=payload, timeout=timeout)
                if response.ok:
                    return response.json()["choices"][0]["message"]["content"]
                else:
                    raise Exception(f"Chat request failed: {response.status_code} - {response.text}")
            except Exception as e:
                if attempt < retries - 1:
                    print(
                        f"Attempt {attempt + 1}/{retries} failed: {e}. Retrying in {delay * (2 ** attempt)} seconds...")
                    time.sleep(delay * (2 ** attempt))
                else:
                    raise Exception(f"Failed after {retries} attempts: {e}")


# =============================================================================
# Interactive PDF Processor Class
# =============================================================================

class InteractivePDFProcessor:
    def __init__(self):
        self.embedding = EYQEmbeddings(
            model=EYQ_EMBEDDING_MODEL,
            api_key=EYQ_INCUBATOR_KEY,
            api_base=EYQ_BASE_URL,
            api_version=EYQ_API_VERSION,
            auth_header_name=AUTH_HEADER_NAME,
            use_bearer=USE_BEARER
        )
        self.parser = LlamaParse(api_key=LLAMA_PARSE_API_KEY, result_type="markdown", verbose=True)
        self.chat_model = EYQChat(
            deployment_name=EYQ_CHAT_MODEL,
            api_key=EYQ_INCUBATOR_KEY,
            api_base=EYQ_BASE_URL,
            api_version=EYQ_API_VERSION,
            verbose=True
        )

        # Load available prompts
        self.load_prompts()

    def load_prompts(self):
        """Load prompts from CSV file"""
        csv_path = os.path.join(os.path.dirname(__file__), "EY_FinSight_Prompts3.csv")
        try:
            df = pd.read_csv(csv_path, encoding='utf-8')
            self.bank_prompts = {}

            for _, row in df.iterrows():
                bank = row['Bank']
                prompt_name = row['PromptName']
                prompt_text = row['PromptText']

                if bank not in self.bank_prompts:
                    self.bank_prompts[bank] = []
                self.bank_prompts[bank].append((prompt_name, prompt_text))

            print(f"Loaded prompts for banks: {list(self.bank_prompts.keys())}")

        except Exception as e:
            print(f"Error loading prompts: {e}")
            self.bank_prompts = {}

    def parse_pdf(self, pdf_path: str) -> List[Document]:
        """Parse a PDF file and return Document objects"""
        try:
            documents = self.parser.load_data(pdf_path)
            if not documents:
                return []

            docs = [
                Document(
                    page_content=doc.text,
                    metadata={
                        "source": os.path.basename(pdf_path),
                        "page": i,
                        "name": os.path.splitext(os.path.basename(pdf_path))[0]
                    }
                )
                for i, doc in enumerate(documents)
            ]
            return docs

        except Exception as e:
            print(f"Error parsing PDF: {e}")
            return []

    def process_with_prompt(self, docs: List[Document], prompt_text: str, company_name: str) -> Dict:
        """Process documents with a specific prompt"""
        try:
            # Combine all document content
            full_content = "\n\n".join([doc.page_content for doc in docs])
            cleaned_content = clean_ocr_text(full_content)

            # Handle large content by splitting if necessary
            if len(cleaned_content) > CHAR_THRESHOLD:
                chunks = split_content_by_chars(cleaned_content, CHAR_THRESHOLD)
                print(f"Content split into {len(chunks)} chunks")

                # Process first chunk for now (can be enhanced to process all chunks)
                content_to_process = chunks[0]
                print("Processing first chunk only for demonstration")
            else:
                content_to_process = cleaned_content

            # Create the full prompt
            full_prompt = (
                f"{prompt_text}\n\n"
                f"Document Content:\n{content_to_process}\n\n"
                "Return the result as a JSON string with the field populated. "
                "If information is not found, return 'N/A' for that field."
            )

            messages = [{"role": "user", "content": full_prompt}]
            response = self.chat_model(messages)

            # Parse the response
            try:
                # Look for JSON in response
                json_match = re.search(r'\`\`\`json\s*(.*?)\s*\`\`\`', response, re.DOTALL)
                if json_match:
                    json_str = json_match.group(1).strip()
                else:
                    json_match = re.search(r'\{.*\}', response, re.DOTALL)
                    if json_match:
                        json_str = json_match.group(0).strip()
                    else:
                        raise ValueError("No valid JSON found in response")

                json_response = json.loads(json_str)
                flattened_data = flatten_json_to_rows(json_response)

                return {
                    "success": True,
                    "data": flattened_data,
                    "notes": f"Processed {len(docs)} pages successfully",
                    "raw_response": response
                }

            except Exception as e:
                return {
                    "success": False,
                    "error": f"JSON parsing error: {e}",
                    "raw_response": response
                }

        except Exception as e:
            return {
                "success": False,
                "error": f"Processing error: {e}",
                "raw_response": ""
            }


# =============================================================================
# GUI Application
# =============================================================================

class FinSightGUI:
    def __init__(self, root):
        self.root = root
        self.root.title("EY FinSight - Interactive PDF Processor")
        self.root.geometry("800x600")

        self.processor = InteractivePDFProcessor()
        self.current_pdf_path = None
        self.processed_docs = None

        self.setup_gui()

    def setup_gui(self):
        # Create main frame
        main_frame = ttk.Frame(self.root, padding="10")
        main_frame.grid(row=0, column=0, sticky=(tk.W, tk.E, tk.N, tk.S))

        # Configure grid weights
        self.root.columnconfigure(0, weight=1)
        self.root.rowconfigure(0, weight=1)
        main_frame.columnconfigure(1, weight=1)

        # PDF Upload Section
        ttk.Label(main_frame, text="Step 1: Upload PDF", font=('Arial', 12, 'bold')).grid(row=0, column=0, columnspan=2,
                                                                                          sticky=tk.W, pady=(0, 10))

        ttk.Button(main_frame, text="Select PDF File", command=self.select_pdf).grid(row=1, column=0, sticky=tk.W)

        self.pdf_label = ttk.Label(main_frame, text="No PDF selected", foreground="gray")
        self.pdf_label.grid(row=1, column=1, sticky=tk.W, padx=(10, 0))

        # Bank Selection
        ttk.Label(main_frame, text="Step 2: Select Bank", font=('Arial', 12, 'bold')).grid(row=2, column=0,
                                                                                           columnspan=2, sticky=tk.W,
                                                                                           pady=(20, 10))

        self.bank_var = tk.StringVar()
        self.bank_combo = ttk.Combobox(main_frame, textvariable=self.bank_var, width=30)
        self.bank_combo['values'] = list(self.processor.bank_prompts.keys()) if self.processor.bank_prompts else []
        self.bank_combo.grid(row=3, column=0, columnspan=2, sticky=tk.W)
        self.bank_combo.bind('<<ComboboxSelected>>', self.on_bank_selected)

        # Prompt Selection
        ttk.Label(main_frame, text="Step 3: Select Prompt", font=('Arial', 12, 'bold')).grid(row=4, column=0,
                                                                                             columnspan=2, sticky=tk.W,
                                                                                             pady=(20, 10))

        self.prompt_var = tk.StringVar()
        self.prompt_combo = ttk.Combobox(main_frame, textvariable=self.prompt_var, width=50)
        self.prompt_combo.grid(row=5, column=0, columnspan=2, sticky=tk.W)

        # Process Button
        self.process_button = ttk.Button(main_frame, text="Process PDF", command=self.process_pdf, state='disabled')
        self.process_button.grid(row=6, column=0, columnspan=2, pady=(20, 10))

        # Progress Bar
        self.progress = ttk.Progressbar(main_frame, mode='indeterminate')
        self.progress.grid(row=7, column=0, columnspan=2, sticky=(tk.W, tk.E), pady=(10, 0))

        # Status Label
        self.status_label = ttk.Label(main_frame, text="Ready", foreground="green")
        self.status_label.grid(row=8, column=0, columnspan=2, sticky=tk.W, pady=(10, 0))

        # Results Text Area
        ttk.Label(main_frame, text="Results:", font=('Arial', 12, 'bold')).grid(row=9, column=0, columnspan=2,
                                                                                sticky=tk.W, pady=(20, 10))

        # Create frame for text area and scrollbar
        text_frame = ttk.Frame(main_frame)
        text_frame.grid(row=10, column=0, columnspan=2, sticky=(tk.W, tk.E, tk.N, tk.S), pady=(0, 10))
        text_frame.columnconfigure(0, weight=1)
        text_frame.rowconfigure(0, weight=1)

        self.results_text = tk.Text(text_frame, height=15, width=80, wrap=tk.WORD)
        scrollbar = ttk.Scrollbar(text_frame, orient=tk.VERTICAL, command=self.results_text.yview)
        self.results_text.configure(yscrollcommand=scrollbar.set)

        self.results_text.grid(row=0, column=0, sticky=(tk.W, tk.E, tk.N, tk.S))
        scrollbar.grid(row=0, column=1, sticky=(tk.N, tk.S))

        # Configure main frame row weight for text area
        main_frame.rowconfigure(10, weight=1)

        # Export Button
        self.export_button = ttk.Button(main_frame, text="Export to Excel", command=self.export_results,
                                        state='disabled')
        self.export_button.grid(row=11, column=0, columnspan=2, pady=(10, 0))

        self.last_result = None

    def select_pdf(self):
        file_path = filedialog.askopenfilename(
            title="Select PDF file",
            filetypes=[("PDF files", "*.pdf"), ("All files", "*.*")]
        )

        if file_path:
            self.current_pdf_path = file_path
            filename = os.path.basename(file_path)
            self.pdf_label.config(text=f"Selected: {filename}", foreground="black")
            self.update_process_button_state()

    def on_bank_selected(self, event):
        selected_bank = self.bank_var.get()
        if selected_bank in self.processor.bank_prompts:
            prompts = self.processor.bank_prompts[selected_bank]
            self.prompt_combo['values'] = [prompt[0] for prompt in prompts]  # Just the names
            self.prompt_var.set('')  # Clear selection
        self.update_process_button_state()

    def update_process_button_state(self):
        if (self.current_pdf_path and
                self.bank_var.get() and
                self.prompt_var.get()):
            self.process_button.config(state='normal')
        else:
            self.process_button.config(state='disabled')

    def process_pdf(self):
        if not self.current_pdf_path or not self.bank_var.get() or not self.prompt_var.get():
            messagebox.showerror("Error", "Please select PDF, bank, and prompt")
            return

        # Start processing in a separate thread
        threading.Thread(target=self._process_pdf_thread, daemon=True).start()

    def _process_pdf_thread(self):
        try:
            # Update UI in main thread
            self.root.after(0, self._start_processing)

            # Parse PDF
            company_name = os.path.splitext(os.path.basename(self.current_pdf_path))[0]
            docs = self.processor.parse_pdf(self.current_pdf_path)

            if not docs:
                self.root.after(0, lambda: self._show_error("Failed to parse PDF"))
                return

            # Get selected prompt text
            selected_bank = self.bank_var.get()
            selected_prompt_name = self.prompt_var.get()

            prompt_text = None
            for prompt_name, prompt_content in self.processor.bank_prompts[selected_bank]:
                if prompt_name == selected_prompt_name:
                    prompt_text = prompt_content
                    break

            if not prompt_text:
                self.root.after(0, lambda: self._show_error("Prompt not found"))
                return

            # Process with prompt
            result = self.processor.process_with_prompt(docs, prompt_text, company_name)

            # Update UI with results
            self.root.after(0, lambda: self._show_results(result))

        except Exception as e:
            self.root.after(0, lambda: self._show_error(f"Processing error: {e}"))

    def _start_processing(self):
        self.progress.start()
        self.status_label.config(text="Processing PDF...", foreground="blue")
        self.process_button.config(state='disabled')
        self.export_button.config(state='disabled')

    def _show_error(self, error_msg):
        self.progress.stop()
        self.status_label.config(text=f"Error: {error_msg}", foreground="red")
        self.process_button.config(state='normal')
        self.results_text.delete(1.0, tk.END)
        self.results_text.insert(tk.END, f"Error: {error_msg}")

    def _show_results(self, result):
        self.progress.stop()
        self.process_button.config(state='normal')
        self.last_result = result

        if result['success']:
            self.status_label.config(text="Processing completed successfully", foreground="green")
            self.export_button.config(state='normal')

            # Display results
            self.results_text.delete(1.0, tk.END)
            self.results_text.insert(tk.END, f"Processing completed successfully!\n\n")
            self.results_text.insert(tk.END, f"Extracted {len(result['data'])} data points:\n\n")

            for item in result['data']:
                self.results_text.insert(tk.END,
                                         f"Category: {item.get('Category', 'N/A')}\n"
                                         f"Stage: {item.get('Stage', 'N/A')}\n"
                                         f"Field: {item.get('Field', 'N/A')}\n"
                                         f"Value: {item.get('Value', 'N/A')}\n"
                                         f"{'-' * 50}\n"
                                         )
        else:
            self.status_label.config(text="Processing failed", foreground="red")
            self.results_text.delete(1.0, tk.END)
            self.results_text.insert(tk.END, f"Processing failed:\n{result['error']}\n\n")
            if result['raw_response']:
                self.results_text.insert(tk.END, f"Raw response:\n{result['raw_response']}")

    def export_results(self):
        if not self.last_result or not self.last_result['success']:
            messagebox.showerror("Error", "No successful results to export")
            return

        # Ask user where to save
        save_path = filedialog.asksaveasfilename(
            title="Save Excel file",
            defaultextension=".xlsx",
            filetypes=[("Excel files", "*.xlsx"), ("All files", "*.*")]
        )

        if save_path:
            try:
                write_to_excel(
                    self.last_result['data'],
                    self.last_result['notes'],
                    save_path
                )
                messagebox.showinfo("Success", f"Results exported to {save_path}")
            except Exception as e:
                messagebox.showerror("Error", f"Failed to export: {e}")


# =============================================================================
# Main Execution
# =============================================================================

def main():
    """Run the interactive GUI application"""
    root = tk.Tk()
    app = FinSightGUI(root)
    root.mainloop()


if __name__ == '__main__':
    main()
\`\`\`


```

# dataextract-ey-main\.gitignore

```
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

```

# dataextract-ey-main\codebase_front.md

```md
# .gitignore

\`\`\`
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

\`\`\`

# codebase_frontend.md

\`\`\`md
# .gitignore

\`\`\`
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

\`\`\`

# components.json

\`\`\`json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "src/index.css",
    "baseColor": "slate",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  }
}
\`\`\`

# eslint.config.js

\`\`\`js
import js from "@eslint/js";
import globals from "globals";
import reactHooks from "eslint-plugin-react-hooks";
import reactRefresh from "eslint-plugin-react-refresh";
import tseslint from "typescript-eslint";

export default tseslint.config(
  { ignores: ["dist"] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ["**/*.{ts,tsx}"],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      "react-hooks": reactHooks,
      "react-refresh": reactRefresh,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      "react-refresh/only-export-components": [
        "warn",
        { allowConstantExport: true },
      ],
      "@typescript-eslint/no-unused-vars": "off",
    },
  }
);

\`\`\`

# index.html

\`\`\`html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>finscope-data-miner</title>
    <meta name="description" content="Lovable Generated Project" />
    <meta name="author" content="Lovable" />

    <meta property="og:title" content="finscope-data-miner" />
    <meta property="og:description" content="Lovable Generated Project" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  </head>

  <body>
    <div id="root"></div>
    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

\`\`\`

# package.json

\`\`\`json
{
  "name": "vite_react_shadcn_ts",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "build:dev": "vite build --mode development",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@hookform/resolvers": "^3.9.0",
    "@radix-ui/react-accordion": "^1.2.0",
    "@radix-ui/react-alert-dialog": "^1.1.1",
    "@radix-ui/react-aspect-ratio": "^1.1.0",
    "@radix-ui/react-avatar": "^1.1.0",
    "@radix-ui/react-checkbox": "^1.1.1",
    "@radix-ui/react-collapsible": "^1.1.0",
    "@radix-ui/react-context-menu": "^2.2.1",
    "@radix-ui/react-dialog": "^1.1.2",
    "@radix-ui/react-dropdown-menu": "^2.1.1",
    "@radix-ui/react-hover-card": "^1.1.1",
    "@radix-ui/react-label": "^2.1.0",
    "@radix-ui/react-menubar": "^1.1.1",
    "@radix-ui/react-navigation-menu": "^1.2.0",
    "@radix-ui/react-popover": "^1.1.1",
    "@radix-ui/react-progress": "^1.1.0",
    "@radix-ui/react-radio-group": "^1.2.0",
    "@radix-ui/react-scroll-area": "^1.1.0",
    "@radix-ui/react-select": "^2.1.1",
    "@radix-ui/react-separator": "^1.1.0",
    "@radix-ui/react-slider": "^1.2.0",
    "@radix-ui/react-slot": "^1.1.0",
    "@radix-ui/react-switch": "^1.1.0",
    "@radix-ui/react-tabs": "^1.1.0",
    "@radix-ui/react-toast": "^1.2.1",
    "@radix-ui/react-toggle": "^1.1.0",
    "@radix-ui/react-toggle-group": "^1.1.0",
    "@radix-ui/react-tooltip": "^1.1.4",
    "@tanstack/react-query": "^5.56.2",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.0.0",
    "date-fns": "^3.6.0",
    "embla-carousel-react": "^8.3.0",
    "framer-motion": "^12.10.5",
    "input-otp": "^1.2.4",
    "lucide-react": "^0.462.0",
    "next-themes": "^0.3.0",
    "pdfjs-dist": "^3.10.111",
    "react": "^18.3.1",
    "react-day-picker": "^8.10.1",
    "react-dom": "^18.3.1",
    "react-hook-form": "^7.53.0",
    "react-resizable-panels": "^2.1.3",
    "react-router-dom": "^6.26.2",
    "recharts": "^2.12.7",
    "sonner": "^1.5.0",
    "tailwind-merge": "^2.5.2",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^0.9.3",
    "xlsx": "^0.18.5",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@eslint/js": "^9.9.0",
    "@tailwindcss/typography": "^0.5.15",
    "@types/node": "^22.5.5",
    "@types/react": "^18.3.3",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react-swc": "^3.5.0",
    "autoprefixer": "^10.4.20",
    "eslint": "^9.9.0",
    "eslint-plugin-react-hooks": "^5.1.0-rc.0",
    "eslint-plugin-react-refresh": "^0.4.9",
    "globals": "^15.9.0",
    "lovable-tagger": "^1.1.7",
    "postcss": "^8.4.47",
    "tailwindcss": "^3.4.11",
    "typescript": "^5.5.3",
    "typescript-eslint": "^8.0.1",
    "vite": "^5.4.1"
  }
}

\`\`\`

# postcss.config.js

\`\`\`js
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}

\`\`\`

# public\favicon.ico

This is a binary file of the type: Binary

# public\placeholder.svg

This is a file of the type: SVG Image

# public\robots.txt

\`\`\`txt
User-agent: Googlebot
Allow: /

User-agent: Bingbot
Allow: /

User-agent: Twitterbot
Allow: /

User-agent: facebookexternalhit
Allow: /

User-agent: *
Allow: /

\`\`\`

# README.md

\`\`\`md
# Welcome to your Lovable project

## Project info

**URL**: https://lovable.dev/projects/f1c52b0c-481b-4d58-84cf-5beb28959f75

## How can I edit this code?

There are several ways of editing your application.

**Use Lovable**

Simply visit the [Lovable Project](https://lovable.dev/projects/f1c52b0c-481b-4d58-84cf-5beb28959f75) and start prompting.

Changes made via Lovable will be committed automatically to this repo.

**Use your preferred IDE**

If you want to work locally using your own IDE, you can clone this repo and push changes. Pushed changes will also be reflected in Lovable.

The only requirement is having Node.js & npm installed - [install with nvm](https://github.com/nvm-sh/nvm#installing-and-updating)

Follow these steps:

\`\`\`sh
# Step 1: Clone the repository using the project's Git URL.
git clone <YOUR_GIT_URL>

# Step 2: Navigate to the project directory.
cd <YOUR_PROJECT_NAME>

# Step 3: Install the necessary dependencies.
npm i

# Step 4: Start the development server with auto-reloading and an instant preview.
npm run dev
\`\`\`

**Edit a file directly in GitHub**

- Navigate to the desired file(s).
- Click the "Edit" button (pencil icon) at the top right of the file view.
- Make your changes and commit the changes.

**Use GitHub Codespaces**

- Navigate to the main page of your repository.
- Click on the "Code" button (green button) near the top right.
- Select the "Codespaces" tab.
- Click on "New codespace" to launch a new Codespace environment.
- Edit files directly within the Codespace and commit and push your changes once you're done.

## What technologies are used for this project?

This project is built with:

- Vite
- TypeScript
- React
- shadcn-ui
- Tailwind CSS

## How can I deploy this project?

Simply open [Lovable](https://lovable.dev/projects/f1c52b0c-481b-4d58-84cf-5beb28959f75) and click on Share -> Publish.

## Can I connect a custom domain to my Lovable project?

Yes, you can!

To connect a domain, navigate to Project > Settings > Domains and click Connect Domain.

Read more here: [Setting up a custom domain](https://docs.lovable.dev/tips-tricks/custom-domain#step-by-step-guide)

\`\`\`

# src\App.css

\`\`\`css
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}

\`\`\`

# src\App.tsx

\`\`\`tsx

import { Toaster } from "@/components/ui/toaster";
import { Toaster as Sonner } from "@/components/ui/sonner";
import { TooltipProvider } from "@/components/ui/tooltip";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { BrowserRouter, Routes, Route, useLocation } from "react-router-dom";
import { AnimatePresence, motion } from "framer-motion";
import IntroScreen from "./components/IntroScreen";
import Dashboard from "./pages/Dashboard";
import BankSelection from "./pages/BankSelection";
import NotFound from "./pages/NotFound";
import { ThemeProvider } from "./components/ThemeProvider";
import { ThemeToggle } from "./components/ThemeToggle";

const queryClient = new QueryClient();

// Simple, elegant fade transition
const pageVariants = {
  initial: {
    opacity: 0
  },
  in: {
    opacity: 1
  },
  out: {
    opacity: 0
  }
};

// Smooth, quick transition
const pageTransition = {
  duration: 0.3,
  ease: "easeInOut"
};

// Animation wrapper component with elegant transitions
const AnimatedRoutes = () => {
  const location = useLocation();
  
  return (
    <AnimatePresence mode="wait">
      <motion.div
        key={location.pathname}
        initial="initial"
        animate="in"
        exit="out"
        variants={pageVariants}
        transition={pageTransition}
        className="w-full min-h-screen"
      >
        {/* Theme toggle positioned in header instead of fixed position */}
        <Routes location={location}>
          <Route path="/" element={<IntroScreen />} />
          <Route path="/select-bank" element={<BankSelection />} />
          <Route path="/dashboard" element={<Dashboard />} />
          <Route path="*" element={<NotFound />} />
        </Routes>
      </motion.div>
    </AnimatePresence>
  );
};

const App = () => (
  <QueryClientProvider client={queryClient}>
    <ThemeProvider defaultTheme="light">
      <TooltipProvider>
        <Toaster />
        <Sonner />
        <BrowserRouter>
          <AnimatedRoutes />
        </BrowserRouter>
      </TooltipProvider>
    </ThemeProvider>
  </QueryClientProvider>
);

export default App;

\`\`\`

# src\components\dashboard\CombinedTab.tsx

\`\`\`tsx

import { Button } from '@/components/ui/button';
import { ProcessingResult } from '@/lib/types';
import { Download } from 'lucide-react';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';

interface CombinedTabProps {
  results: ProcessingResult[];
  onDownloadResults: () => void;
}

const CombinedTab = ({ results, onDownloadResults }: CombinedTabProps) => {
  // Extract unique data entries from all results
  const combinedData = results
    .filter(result => result.status === 'success' && result.data)
    .flatMap(result => {
      return result.data?.map(item => ({
        ...item,
        Source: `${result.fileName} - ${result.promptName}`
      })) || [];
    });

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h2 className="text-lg font-semibold mb-1">Combined Results</h2>
          <p className="text-sm text-muted-foreground">
            View and download the final processed data in Excel format
          </p>
        </div>
        <Button 
          variant="outline" 
          size="sm" 
          onClick={onDownloadResults}
          className="flex items-center gap-1 border-yellow-400 bg-white text-black hover:bg-yellow-50"
        >
          <Download className="h-4 w-4" />
          <span>Download Excel</span>
        </Button>
      </div>
      
      {combinedData.length > 0 ? (
        <div className="border rounded-lg overflow-hidden">
          <div className="flex justify-between items-center p-3 bg-muted border-b">
            <Button 
              variant="outline" 
              size="sm" 
              className="py-1 h-8 bg-yellow-400 hover:bg-yellow-500 border-none text-black"
            >
              Combined View
            </Button>
            <div className="text-sm text-muted-foreground">
              {combinedData.length} rows
            </div>
          </div>
          
          {/* Increased the height from 500px to 650px for larger view */}
          <ScrollArea className="h-[650px]">
            <Table>
              <TableHeader className="bg-muted/70 sticky top-0">
                <TableRow>
                  <TableHead className="font-semibold text-black">Category</TableHead>
                  <TableHead className="font-semibold text-black">Stage</TableHead>
                  <TableHead className="font-semibold text-black">Field</TableHead>
                  <TableHead className="font-semibold text-black">Value</TableHead>
                  <TableHead className="font-semibold text-black">Source</TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {combinedData.map((item, index) => (
                  <TableRow key={index}>
                    <TableCell>{item.Category === 'ECL By Stage' ? 'ECL' : item.Category}</TableCell>
                    <TableCell>{item.Stage}</TableCell>
                    <TableCell>{item.Field}</TableCell>
                    <TableCell>{item.Value}</TableCell>
                    <TableCell>{item.Source}</TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </ScrollArea>
        </div>
      ) : (
        <div className="border rounded-lg p-12 text-center">
          <p className="text-muted-foreground">No results available yet.</p>
          <p className="text-sm text-muted-foreground mt-1">Process files with prompts to see combined results.</p>
        </div>
      )}
    </div>
  );
};

export default CombinedTab;

\`\`\`

# src\components\dashboard\Footer.tsx

\`\`\`tsx

const Footer = () => {
  return (
    <footer className="bg-gray-100 border-t mt-auto py-4">
      <div className="container mx-auto px-4">
        <div className="flex justify-between items-center text-sm text-muted-foreground">
          <div>AiDEx - AI powered Data Extraction</div>
          <div>© {new Date().getFullYear()} Barclays Financial Services</div>
        </div>
      </div>
    </footer>
  );
};

export default Footer;

\`\`\`

# src\components\dashboard\PromptsTab.tsx

\`\`\`tsx

import PromptSelector from '@/components/PromptSelector';
import PromptDescriptions from '@/components/PromptDescriptions';
import { PromptOption } from '@/lib/types';
import { useCallback } from 'react';

interface PromptsTabProps {
  onPromptSelected: (prompts: PromptOption[]) => void;
  isProcessing: boolean;
  selectedPrompts?: PromptOption[];
}

const PromptsTab = ({ onPromptSelected, isProcessing, selectedPrompts = [] }: PromptsTabProps) => {
  // Use a callback to avoid setState during render
  const handlePromptSelected = useCallback((prompts: PromptOption[]) => {
    onPromptSelected(prompts);
  }, [onPromptSelected]);

  return (
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div>
        <PromptSelector 
          onPromptSelected={handlePromptSelected}
          disabled={isProcessing}
          selectedPrompts={selectedPrompts}
        />
      </div>
      <div>
        <PromptDescriptions />
      </div>
    </div>
  );
};

export default PromptsTab;

\`\`\`

# src\components\dashboard\ResultsTab.tsx

\`\`\`tsx

import ResultsViewer from '@/components/ResultsViewer';
import { ProcessingResult } from '@/lib/types';

interface ResultsTabProps {
  results: ProcessingResult[];
  onDownloadResults: () => void;
  isProcessing: boolean;
  processingProgress: number;
  processingStep: string;
}

const ResultsTab = ({ 
  results, 
  onDownloadResults, 
  isProcessing, 
  processingProgress, 
  processingStep 
}: ResultsTabProps) => {
  // Calculate total files and processed files from the results
  const uniqueFileIds = new Set(results.map(r => r.fileId));
  const totalFiles = isProcessing ? Math.max(1, uniqueFileIds.size) : uniqueFileIds.size;
  const processedFiles = isProcessing && processingProgress >= 100 ? totalFiles : uniqueFileIds.size;
  
  return (
    <ResultsViewer 
      results={results}
      onDownloadResults={onDownloadResults}
      isProcessing={isProcessing}
      processingProgress={processingProgress}
      processingStep={processingStep}
      totalFiles={totalFiles}
      processedFiles={processedFiles}
    />
  );
};

export default ResultsTab;

\`\`\`

# src\components\dashboard\SideBySideTab.tsx

\`\`\`tsx

import { useState, useEffect } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Button } from '@/components/ui/button';
import { RefreshCw } from 'lucide-react';
import { ProcessingResult } from '@/lib/types';
import PDFViewer from '@/components/PDFViewer';

interface SideBySideTabProps {
  results: ProcessingResult[];
}

const SideBySideTab = ({ results }: SideBySideTabProps) => {
  const [selectedFile, setSelectedFile] = useState<File | null>(null);
  const [selectedResult, setSelectedResult] = useState<ProcessingResult | null>(
    results.length > 0 ? results[0] : null
  );
  const [retryCounter, setRetryCounter] = useState(0);
  const [pdfFiles, setPdfFiles] = useState<Map<string, File>>(new Map());

  // Group results by file
  const resultsByFile: Record<string, ProcessingResult[]> = results.reduce((acc, result) => {
    if (!result) return acc;
    if (!acc[result.fileId]) {
      acc[result.fileId] = [];
    }
    acc[result.fileId].push(result);
    return acc;
  }, {} as Record<string, ProcessingResult[]>);

  // Get unique file names
  const uniqueFiles = Object.entries(resultsByFile).map(([_, fileResults]) => {
    return fileResults[0];
  });

  // Create an improved dummy PDF file with better formatting - same as in UploadTab
  const createDummyPDF = (fileName: string): File => {
    // This is a higher quality PDF with better formatting
    const base64PDF = `JVBERi0xLjcKJeTjz9IKMSAwIG9iago8PC9UeXBlL0NhdGFsb2cvUGFnZXMgMiAwIFIvTGFuZyhqYS1KUCkgL1N0cnVjdFRyZWVSb290IDIxIDAgUi9NYXJrSW5mbzw8L01hcmtlZCB0cnVlPj4vTWV0YWRhdGEgNTggMCBSL1ZpZXdlclByZWZlcmVuY2VzIDU5IDAgUj4+CmVuZG9iagoyIDAgb2JqCjw8L1R5cGUvUGFnZXMvQ291bnQgMS9LaWRzWyAzIDAgUl0gPj4KZW5kb2JqCjMgMCBvYmoKPDwvVHlwZS9QYWdlL1BhcmVudCAyIDAgUi9SZXNvdXJjZXM8PC9YT2JqZWN0PDwvSW1hZ2U1IDUgMCBSL0ltYWdlNyA3IDAgUj4+L0ZvbnQ8PC9GMSAxMSAwIFIvRjIgMTMgMCBSL0YzIDE1IDAgUi9GNCAxNyAwIFI+Pi9FeHRHU3RhdGU8PC9HUzcgNyAwIFIvR1M4IDggMCBSPj4vUHJvY1NldFsvUERGL1RleHQvSW1hZ2VCL0ltYWdlQy9JbWFnZUldID4+L01lZGlhQm94WyAwIDAgNTk1LjMyIDg0MS45Ml0gL0NvbnRlbnRzIDQgMCBSL0dyb3VwPDwvVHlwZS9Hcm91cC9TL1RyYW5zcGFyZW5jeS9DUy9EZXZpY2VSR0I+Pi9UYWJzL1MvU3RydWN0UGFyZW50cyAwPj4KZW5kb2JqCjQgMCBvYmoKPDwvRmlsdGVyL0ZsYXRlRGVjb2RlL0xlbmd0aCAxOTA4Pj4Kc3RyZWFtCnictVnbkps4EH3nK3Q5uwo1urHB43gnpHBiy4iL12vv5mErD4MsMBXGBXgr+4d8XDeSuRgwdpKtmiqEkOg+3af7yHy7It9olr6TM87oNb2JxYGqM8qTrCCxgD8CBS3oi0xyEYn0nIooAynMaM5SciW/ZCknb7Oz8w8kE2QinkYHcq2iI8lj8g0awW+p/HuWvvAYBp6wPDqQmNIF/Emf4BFRamDNBHklMTzNNQIqwC4JjI9T+FeSh39MegVj9CjN0E6jBQWnISVqwXOaJCALfodFnBZCo89FivXlErBTYAa841mSJ+mJ8MmzDDC+1QxuJ+pEefBHzJKMJwcS8cN+RtVs8+NPwBa7wOxpt3i8eXn4gfrju8Ct3h1CLx1G7+7QuH+Anj4Oj90XgfmrOOye/WwO+1npeI7ukDsFrrjcHUbyGU0IvkZTp8pfa33pwsb7UuC1gYs8QdNq5jYZxNYzX+/oDXrTTOA+WCzCnJEUJrhA7q0wC3JE4ZPNH3W1mROL04h1Qhim4OKmdhPbAcrTIiVvdZ2z9DC6dAA+UFw4bjA2/P54g+1+PB6NvEvn2Ld6u+pBE9ufjI39wUg/D3F6aoLBHLScFLLJksm+xM/JXCNYM4YeBicJvc8rC7PSK5G6Tjv4i8Wt4wcj63q1ut6qhlggOcgcUYk20WXJHC7Vdu4wSnOEeQrmJpnDxKBkOgLS5kS2KQdTqUHmsHxhnB+GlaEggPm4bDq/rUlUvUjrx4i2DXDjo1hMBHxkDMsODMexmsHZeqXN9+VqKDEpPJhKkDs18A6kTGPycPv00ADXRkNEvF8xRdspeH8QLGfr3wE5KQCh7y/xziq8IATdLe3z1ZPvu9Po0L7ls/lyTA8s1zwx6/aipdyGvrI4SDx7E9cNeGdf3b2et7BfIxgBybl5YQzMoNsqSZS1h9HbCI1zdw6HpcT9hdiBBEcHkiFgY5YXSkAVGjuvamNUrSYyeUp1Gp7oicxolhfyuTsloXNpDRzuTLnjDifqveWQivUky2PkpeB7hFRdRV6wVbyrzLMCHqxUUW/HGQj7VEwIMEOZoVUbVZnWxp4Ge1mCstY3VHkOkUW4dPZVtSvdX51rXq4tUPhM+cyjdAlOM9g0E66NuugYnUCMr9311TxRn51l90OwvcFq4KKw1pQ42gAsntdgwrqmJ/Brl2P82jZQYzOUFO5LqPYvzc/bhpy+N3ubZnfVAJ+pDaKZIL/lQzdTDstKjB6gXjcr9bY9Dru6QF3Ac415RwleFebeUxGlPB5fd9/9gl3oQonA7eUXarKL9KhHka22R4CleLvNYlSY7UgVW3LQmKcd90zcqJPJCcCdiX/62fXPrcdJLJssALwbnztejx93ndtvHcpGx7ocwX8aSO00vRdTTBZeQni3WjjEIb58LMeQO4e/aBMFLTHvizWssNRIkltzmJJCH0nP7ci+co6Pmvr8M/awR8FFekLNDNcymoI7JlvzZquAKc9MsJQHx2+6m8t7oG0zG6S6uCW3cTAdOUfmznGcN6ZM0tyhr7RT4BqKFeBhcMXHwRptklv0KiDZLewprKkKtjTGpuq+d8ctsrGXbnVTB59DE8vjXIXlnJNsKqTqdfqL85PVLBHZU4DUfHWUt1sW5wnXHS2HlQ3GZghWyMvKZYLEf+XimTTHD0te3mdpeML10Xf6TrC3XRu6pksPUrQX1cUQN1hAQGF2aL8feZNFhbq2JIA06UM2wUuTBPjuDAIpPRAVVIQHKJ6Juo5E54bc70m2kUWNSYk8I3cSoNt90tKkmwkLiRLIpGq41cQE9+QrPQzp21JAcDdAA1J8jFWqKOlnQSsj225Yu4R/2EOWWtheOD6IQn8wCdptq5bU90v8l/zAiThahUZBNYzgdGZG3CKqTDehjCfYbIGluBVteMXWN2z/ut6wrSINS+4X6PcYwXVPrZ/IXEU452MocU826M76xG7j6W0B5qAjUYxc/DVJdXOXt6JKbAA2C1+r3ELS+J6T6rRfILmcZCphP+Z9hd8/0QPecIxS/CIRfJ7X97hoRc82nLdXLo1wHtdx998hmVxJynrA01ulvqjjjCUJeEXepU6NJXrW18vtdcbYI80CeXcogFNWJctyyDFxKHcWO76Zawsfpzjrx0ffQTWGusezbCs3v/49v87ZF8X+2O23cr7cyi2fLdBjrm6/K9A/vTLv1bHfdcDhqy+FhdLD8YQN5O+1fwEqNfLlCmVuZHN0cmVhbQplbmRvYmoKMjEgMCBvYmoKPDwvVHlwZS9TdHJ1Y3RUcmVlUm9vdC9QYXJlbnRUcmVlID0gNiAwIFIgL0sgPSA1MCAwIFIvSURUcmVlID0gNTEgMCBSID4+CmVuZG9iagoyMiAwIG9iago8PC9UeXBlL0ZvbnQvU3VidHlwZS9UcnVlVHlwZS9OYW1lL0YxL0Jhc2VGb250L0JDREVFRStDYWxpYnJpL0VuY29kaW5nL1dpbkFuc2lFbmNvZGluZy9Gb250RGVzY3JpcHRvciAyMyAwIFIvRmlyc3RDaGFyIDMyL0xhc3RDaGFyIDg0L1dpZHRocyA1MyAwIFI+PgplbmRvYmoKMjMgMCBvYmoKPDwvVHlwZS9Gb250RGVzY3JpcHRvci9Gb250TmFtZS9CQ0RFRUUrQ2FsaWJyaS9GbGFncyAzMi9JdGFsaWNBbmdsZSAwL0FzY2VudCA3NTAvRGVzY2VudCAtMjUwL0NhcEhlaWdodCA3NTAvQXZnV2lkdGggNTIxL01heFdpZHRoIDE3NDMvRm9udFdlaWdodCA0MDAvWEhlaWdodCAyNTAvU3RlbVYgNTIvRm9udEJCb3hbIC01MDMgLTI1MCAxMjQwIDc1MF0gL0ZvbnRGaWxlMiA1MiAwIFI+PgplbmRvYmoKNTMgMCBvYmoKWyAyMjYgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDY0MyAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCA3MTUgMCA2NjIgMCAwIDAgNTQ0XSAKZW5kb2JqCjUwIDAgb2JqCjw8L1R5cGUvU3RydWN0RWxlbS9TL1Jvb3QvUC11dGlsKFRpdGxlKS9LWzQ5IDAgUl0gL1BnIDMgMCBSID4+CmVuZG9iago0OSAwIG9iago8PC9UeXBlL1N0cnVjdEVsZW0vUy9UaXRsZS9QLXV0aWwoSGVhZGluZzEpL0tbNDggMCBSXSAvUGcgMyAwIFIgPj4KZW5kb2JqCjQ4IDAgb2JqCjw8L1R5cGUvU3RydWN0RWxlbS9TL0hlYWRpbmcxL1AvNTAgMCBSL0tbMF0gL1BnIDMgMCBSID4+CmVuZG9iago1MSAwIG9iago8PC9OYW1lcygibG9hbiIpID4+CmVuZG9iago2IDAgb2JqCjw8L051bXMgWzAgWyA0OCAwIFJdIF0gPj4KZW5kb2JqCnhyZWYKMSA0CjAwMDAwMDAwMTAgNjU1MzUgZiAKMDAwMDAwMDAxNSAwMDAwMCBuIAowMDAwMDAwMTgxIDAwMDAwIG4gCjAwMDAwMDAyMzggMDAwMDAgbiAKMTEgMgowMDAwMDAwMDAwIDAwMDAwIGYgCjAwMDAwMDAwMDAgMDAwMDAgZiAKMjEgNAowMDAwMDAyMzMwIDAwMDAwIG4gCjAwMDAwMDI0MTggMDAwMDAgbiAKMDAwMDAwMjU5NSAwMDAwMCBuIAowMDAwMDAyODU4IDAwMDAwIG4gCjQ4IDMKMDAwMDAwMzA3NyAwMDAwMCBuIAowMDAwMDAzMDAwIDAwMDAwIG4gCjAwMDAwMDI5MzUgMDAwMDAgbiAKNTAgMQowMDAwMDAyODY1IDAwMDAwIG4gCjUyIDIKMDAwMDAwMDAwMCAwMDAwMCBmIAowMDAwMDAwMDAwIDAwMDAwIGYgCnRyYWlsZXIKPDwvU2l6ZSA1NS9Sb290IDEgMCBSL0luZm8gMjAgMCBSL0lEWzwyRTA1NzM5MkZDM0JCMTQxQjNDNDkzODNBODY4NDg5OD48MkUwNTczOTJGQzNCQjE0MUIzQzQ5MzgzQTg2ODQ4OTg+XSA+PgpzdGFydHhyZWYKMzE0NQolJUVPRgo=`;
    
    try {
      // Convert base64 to blob
      const binaryString = window.atob(base64PDF);
      const len = binaryString.length;
      const bytes = new Uint8Array(len);
      for (let i = 0; i < len; i++) {
        bytes[i] = binaryString.charCodeAt(i);
      }
      
      // Create a blob from the binary data
      const pdfBlob = new Blob([bytes.buffer], { type: 'application/pdf' });
      
      // Create a File object from the blob
      const file = new File([pdfBlob], fileName, { type: 'application/pdf' });
      
      // Store the file in our map
      const updatedFiles = new Map(pdfFiles);
      updatedFiles.set(fileName, file);
      setPdfFiles(updatedFiles);
      
      console.log("Created higher-quality PDF file:", file.name, file.size, "bytes");
      return file;
    } catch (error) {
      console.error("Error creating PDF file:", error);
      // Create a minimal fallback PDF
      const minimalPDF = 'JVBERi0xLjAKMSAwIG9iago8PC9UeXBlL0NhdGFsb2cvUGFnZXMgMiAwIFI+PgplbmRvYmoKMiAwIG9iago8PC9UeXBlL1BhZ2VzL0tpZHNbMyAwIFJdL0NvdW50IDE+PgplbmRvYmoKMyAwIG9iago8PC9UeXBlL1BhZ2UvTWVkaWFCb3hbMCAwIDMgM10+PgplbmRvYmoKdHJhaWxlcgo8PC9Sb290IDEgMCBSPj4K';
      const fallbackBytes = Uint8Array.from(window.atob(minimalPDF), c => c.charCodeAt(0));
      const fallbackBlob = new Blob([fallbackBytes], { type: 'application/pdf' });
      return new File([fallbackBlob], fileName, { type: 'application/pdf' });
    }
  };

  // Initialize PDFs when component mounts
  useEffect(() => {
    if (results.length === 0) {
      setSelectedFile(null);
      setSelectedResult(null);
      return;
    }

    // Initialize PDFs for all files
    const newPdfFiles = new Map();
    
    uniqueFiles.forEach(fileInfo => {
      const pdfFile = createDummyPDF(fileInfo.fileName);
      newPdfFiles.set(fileInfo.fileName, pdfFile);
    });
    
    setPdfFiles(newPdfFiles);
    
    // Set defaults if needed
    if (!selectedResult && results.length > 0) {
      setSelectedResult(results[0]);
    }
    
    // Load the first file by default
    if (uniqueFiles.length > 0) {
      const firstFile = uniqueFiles[0];
      const pdfFile = newPdfFiles.get(firstFile.fileName);
      if (pdfFile) {
        setSelectedFile(pdfFile);
      }
    }
  }, [results, retryCounter]);

  // Handle file selection
  const handleFileSelect = (fileId: string, fileName: string) => {
    console.log("File selected:", fileName);
    
    // Use the already created PDF from our map
    const existingPDF = pdfFiles.get(fileName);
    if (existingPDF) {
      setSelectedFile(existingPDF);
    } else {
      // Create one if it doesn't exist yet
      const newPDF = createDummyPDF(fileName);
      setSelectedFile(newPDF);
    }
    
    // Set the first result from this file as the selected result
    const fileResults = resultsByFile[fileId];
    if (fileResults && fileResults.length > 0) {
      setSelectedResult(fileResults[0]);
    }
  };

  // Handle result selection
  const handleResultSelect = (result: ProcessingResult) => {
    setSelectedResult(result);
    
    // Make sure we have a PDF file for this result
    if (result.fileName) {
      const existingPDF = pdfFiles.get(result.fileName);
      if (existingPDF) {
        setSelectedFile(existingPDF);
      } else {
        const newPDF = createDummyPDF(result.fileName);
        setSelectedFile(newPDF);
      }
    }
  };

  // Handle retry loading
  const handleRetryLoading = () => {
    console.log("Retrying PDF load...");
    setRetryCounter(prev => prev + 1);
    
    // Re-create all PDFs
    if (uniqueFiles.length > 0) {
      const newPdfFiles = new Map();
      
      uniqueFiles.forEach(fileInfo => {
        const pdfFile = createDummyPDF(fileInfo.fileName);
        newPdfFiles.set(fileInfo.fileName, pdfFile);
      });
      
      setPdfFiles(newPdfFiles);
      
      // Refresh the current selection
      if (selectedResult?.fileName) {
        const refreshedPDF = newPdfFiles.get(selectedResult.fileName);
        if (refreshedPDF) {
          setSelectedFile(refreshedPDF);
        }
      }
    }
  };

  // Display a loading message if no results are available
  if (results.length === 0) {
    return (
      <div className="space-y-6">
        <div>
          <h2 className="text-lg font-semibold mb-1">Side by Side Comparison</h2>
          <p className="text-sm text-muted-foreground">Compare extracted data with the original document</p>
        </div>
        
        <Card>
          <CardContent className="flex flex-col items-center justify-center p-12 text-center">
            <div className="text-muted-foreground mb-2">
              No extraction results yet
            </div>
            <div className="text-sm text-muted-foreground">
              Process files to see side by side comparison
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-lg font-semibold mb-1">Side by Side Comparison</h2>
        <p className="text-sm text-muted-foreground">Compare extracted data with the original document</p>
      </div>
      
      <div className="grid grid-cols-1 lg:grid-cols-7 gap-6">
        {/* Left sidebar - File and Result selection */}
        <div className="lg:col-span-2">
          <div className="border rounded-lg overflow-hidden">
            <div className="bg-black text-white p-2 text-sm font-medium">
              Processed Files
            </div>
            <ScrollArea className="h-[600px]">
              <div className="p-2">
                {uniqueFiles.map((fileInfo) => (
                  <div key={fileInfo.fileId} className="mb-4">
                    <div 
                      className="text-sm font-medium p-2 bg-muted cursor-pointer hover:bg-gray-200"
                      onClick={() => handleFileSelect(fileInfo.fileId, fileInfo.fileName)}
                    >
                      {fileInfo.fileName}
                    </div>
                    
                    {resultsByFile[fileInfo.fileId].map(result => {
                      const isSelected = selectedResult?.id === result.id;
                      
                      return (
                        <div 
                          key={result.id}
                          className={`flex items-center justify-between p-2 text-sm rounded-md cursor-pointer ${
                            isSelected ? "bg-yellow-50 border border-yellow-400 text-black" : "hover:bg-muted"
                          }`}
                          onClick={() => handleResultSelect(result)}
                        >
                          <div className="truncate pr-2">{result.promptName}</div>
                        </div>
                      );
                    })}
                  </div>
                ))}
              </div>
            </ScrollArea>
          </div>
        </div>
        
        {/* Center - PDF Viewer */}
        <div className="lg:col-span-2">
          <div className="border rounded-lg overflow-hidden h-full flex flex-col">
            <div className="bg-black text-white p-2 text-sm font-medium">
              Document Preview
            </div>
            <div className="flex-1 flex flex-col bg-white">
              <PDFViewer 
                file={selectedFile}
                className="flex-1"
              />
              
              {/* Retry button */}
              <div className="flex justify-center p-2 bg-white border-t">
                <Button 
                  variant="outline" 
                  size="sm" 
                  className="flex items-center gap-2"
                  onClick={handleRetryLoading}
                >
                  <RefreshCw className="h-4 w-4" />
                  Refresh PDF
                </Button>
              </div>
            </div>
          </div>
        </div>
        
        {/* Right - Extracted Data */}
        <div className="lg:col-span-3">
          <div className="border rounded-lg overflow-hidden h-full flex flex-col">
            <div className="bg-black text-white p-3 flex justify-between items-center">
              <div>
                <div className="font-medium">{selectedResult?.promptName}</div>
                <div className="text-xs text-gray-400">From: {selectedResult?.fileName}</div>
              </div>
            </div>
            
            <div className="p-3 flex-1">
              {selectedResult && selectedResult.status === 'success' && selectedResult.data ? (
                <ScrollArea className="h-[550px]">
                  <Table>
                    <TableHeader className="bg-muted sticky top-0">
                      <TableRow>
                        <TableHead className="font-semibold">Category</TableHead>
                        <TableHead className="font-semibold">Stage</TableHead>
                        <TableHead className="font-semibold">Field</TableHead>
                        <TableHead className="font-semibold">Value</TableHead>
                      </TableRow>
                    </TableHeader>
                    <TableBody>
                      {selectedResult.data.map((item, index) => {
                        if (!item) return null;
                        
                        return (
                          <TableRow key={index}>
                            <TableCell>
                              {item.Category === 'ECL By Stage' ? 'ECL' : item.Category}
                            </TableCell>
                            <TableCell>{item.Stage}</TableCell>
                            <TableCell>{item.Field}</TableCell>
                            <TableCell className="font-medium">{item.Value}</TableCell>
                          </TableRow>
                        );
                      })}
                    </TableBody>
                  </Table>
                </ScrollArea>
              ) : (
                <div className="flex flex-col items-center justify-center h-[550px]">
                  <div className="text-muted-foreground">
                    Select a result to view extracted data
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default SideBySideTab;

\`\`\`

# src\components\dashboard\TabNavigation.tsx

\`\`\`tsx

import { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Upload, FileText, FileSpreadsheet, Download, LayoutPanelLeft } from 'lucide-react';
import { ThemeToggle } from '@/components/ThemeToggle';

interface TabNavigationProps {
  activeTab: string;
  setActiveTab: (value: string) => void;
}

const TabNavigation = ({ activeTab, setActiveTab }: TabNavigationProps) => {
  return (
    <div className="border-b dark:border-gray-700">
      <div className="container mx-auto px-4 flex items-center justify-between">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
          <TabsList className="grid grid-cols-5 w-full max-w-2xl mx-auto my-4">
            <TabsTrigger 
              value="upload" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <Upload className="h-4 w-4 mr-2" />
              Upload
            </TabsTrigger>
            <TabsTrigger 
              value="prompts" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <FileText className="h-4 w-4 mr-2" />
              Prompts
            </TabsTrigger>
            <TabsTrigger 
              value="results" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <FileSpreadsheet className="h-4 w-4 mr-2" />
              Results
            </TabsTrigger>
            <TabsTrigger 
              value="combined" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <Download className="h-4 w-4 mr-2" />
              Combined
            </TabsTrigger>
            <TabsTrigger 
              value="sidebyside" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <LayoutPanelLeft className="h-4 w-4 mr-2" />
              Side by Side
            </TabsTrigger>
          </TabsList>
        </Tabs>
        <ThemeToggle className="mr-4" />
      </div>
    </div>
  );
};

export default TabNavigation;

\`\`\`

# src\components\dashboard\UploadTab.tsx

\`\`\`tsx

import { Button } from '@/components/ui/button';
import FileUploader from '@/components/FileUploader';
import { UploadedFile } from '@/lib/types';
import { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { FileText, Eye, EyeOff } from 'lucide-react';
import PDFViewer from '@/components/PDFViewer';
import { motion } from 'framer-motion';

interface UploadTabProps {
  onFilesUploaded: (files: UploadedFile[]) => void;
  uploadedFiles: UploadedFile[];
  goToNextTab: () => void;
}

const UploadTab = ({ onFilesUploaded, uploadedFiles, goToNextTab }: UploadTabProps) => {
  const [selectedFile, setSelectedFile] = useState<UploadedFile | null>(null);
  const [showPreview, setShowPreview] = useState<boolean>(true);
  const [pdfFile, setPdfFile] = useState<File | null>(null);
  const [actualFiles, setActualFiles] = useState<Map<string, File>>(new Map());

  // Select the first file for preview when files are uploaded
  useEffect(() => {
    if (uploadedFiles.length > 0) {
      // Always select the newest file when a new file is uploaded
      const newestFile = uploadedFiles[uploadedFiles.length - 1];
      setSelectedFile(newestFile);
      const file = actualFiles.get(newestFile.id);
      if (file) {
        setPdfFile(file);
      }
    } else {
      setSelectedFile(null);
      setPdfFile(null);
    }
  }, [uploadedFiles, actualFiles]);

  // Handle files uploaded
  const handleFilesUploaded = (files: UploadedFile[], newActualFiles: Map<string, File>) => {
    // Pass files to parent
    onFilesUploaded(files);
    
    // Store actual File objects
    setActualFiles(newActualFiles);
    
    // If we have files, select the latest one for immediate preview
    if (files.length > 0) {
      const latestFile = files[files.length - 1];
      setSelectedFile(latestFile);
      
      // Set the PDF file for immediate preview
      const fileForPreview = newActualFiles.get(latestFile.id);
      if (fileForPreview) {
        setPdfFile(fileForPreview);
        setShowPreview(true); // Ensure preview is visible
      }
    }
  };

  // Toggle PDF preview visibility
  const togglePreview = () => {
    setShowPreview(!showPreview);
  };

  // Handle file selection
  const handleFileSelection = (file: UploadedFile) => {
    setSelectedFile(file);
    const actualFile = actualFiles.get(file.id);
    if (actualFile) {
      setPdfFile(actualFile);
    }
  };

  return (
    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div className="lg:col-span-1 space-y-6">
        <FileUploader 
          onFilesUploaded={handleFilesUploaded}
          acceptedFileTypes={['.pdf']}
        />
        
        {uploadedFiles.length > 0 && (
          <motion.div 
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ duration: 0.3 }}
            className="border rounded-md"
          >
            <div className="bg-muted p-3 font-medium flex justify-between items-center">
              <div>Uploaded Files ({uploadedFiles.length}/10)</div>
              <Button 
                variant="ghost" 
                size="sm" 
                className="h-8 px-2 text-muted-foreground"
                onClick={togglePreview}
              >
                {showPreview ? <EyeOff className="h-4 w-4 mr-1" /> : <Eye className="h-4 w-4 mr-1" />}
                {showPreview ? "Hide Preview" : "Show Preview"}
              </Button>
            </div>
            <div className="divide-y max-h-[300px] overflow-y-auto">
              {uploadedFiles.map((file) => (
                <motion.div
                  key={file.id}
                  className={`p-3 flex items-center justify-between cursor-pointer hover:bg-muted/50 transition-colors ${selectedFile?.id === file.id ? 'bg-yellow-50 border-l-2 border-yellow-400' : ''}`}
                  onClick={() => handleFileSelection(file)}
                >
                  <div className="flex items-center">
                    <FileText className="h-4 w-4 text-muted-foreground mr-2" />
                    <span className="text-sm font-medium">{file.name}</span>
                  </div>
                  <div className="text-xs text-muted-foreground">
                    {Math.round(file.size / 1024).toLocaleString()} KB
                  </div>
                </motion.div>
              ))}
            </div>
          </motion.div>
        )}
      </div>

      {/* PDF Preview Section - larger size for A4 display */}
      {uploadedFiles.length > 0 && selectedFile && showPreview && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ duration: 0.3 }}
          className="lg:col-span-2"
        >
          <Card className="h-full">
            <CardHeader className="pb-3">
              <CardTitle className="text-base flex items-center justify-between">
                <div className="flex items-center">
                  <FileText className="h-4 w-4 mr-2" />
                  PDF Preview
                </div>
                <div className="text-sm font-normal">
                  {selectedFile.name}
                </div>
              </CardTitle>
            </CardHeader>
            <CardContent className="p-0">
              <div className="bg-muted/30 h-[750px] flex flex-col">
                <PDFViewer file={pdfFile} className="h-full" />
              </div>
            </CardContent>
          </Card>
        </motion.div>
      )}

      <div className="flex justify-end col-span-full">
        <motion.div>
          <Button 
            onClick={goToNextTab} 
            disabled={uploadedFiles.length === 0}
            className="bg-yellow-400 hover:bg-yellow-500 text-black"
          >
            Next: Select Prompts
          </Button>
        </motion.div>
      </div>
    </div>
  );
};

export default UploadTab;

\`\`\`

# src\components\FileUploader.tsx

\`\`\`tsx

import { useState, useRef, useCallback } from 'react';
import { Button } from '@/components/ui/button';
import { UploadedFile } from '@/lib/types';
import { Upload, FileText, X, Check, Loader } from 'lucide-react';
import { Progress } from '@/components/ui/progress';
import { cn } from '@/lib/utils';
import { useToast } from '@/hooks/use-toast';

interface FileUploaderProps {
  onFilesUploaded: (files: UploadedFile[], actualFiles: Map<string, File>) => void;
  acceptedFileTypes?: string[];
  maxFiles?: number;
}

const FileUploader = ({ 
  onFilesUploaded, 
  acceptedFileTypes = ['.pdf'], 
  maxFiles = 10 
}: FileUploaderProps) => {
  const [files, setFiles] = useState<UploadedFile[]>([]);
  const [isDragging, setIsDragging] = useState(false);
  const fileInputRef = useRef<HTMLInputElement>(null);
  const [actualFiles, setActualFiles] = useState<Map<string, File>>(new Map());
  const { toast } = useToast();

  const handleFileSelect = useCallback((selectedFiles: FileList | null) => {
    if (!selectedFiles || selectedFiles.length === 0) return;

    // Check if adding these files would exceed the maximum
    if (files.length + selectedFiles.length > maxFiles) {
      toast({
        title: "Too many files",
        description: `You can upload a maximum of ${maxFiles} files.`,
        variant: "destructive",
      });
      return;
    }

    const newFiles: UploadedFile[] = [];
    const newActualFiles = new Map(actualFiles);
    
    Array.from(selectedFiles).forEach(file => {
      // Check file type
      const fileExtension = `.${file.name.split('.').pop()?.toLowerCase()}`;
      if (!acceptedFileTypes.includes(fileExtension) && !acceptedFileTypes.includes('*')) {
        toast({
          title: "Invalid file type",
          description: `${file.name} is not a supported file type. Please upload ${acceptedFileTypes.join(", ")} files.`,
          variant: "destructive",
        });
        return;
      }
      
      // File is valid, add it to our list
      const fileId = `file-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
      const newFile: UploadedFile = {
        id: fileId,
        name: file.name,
        size: file.size,
        type: file.type,
        lastModified: file.lastModified,
        status: 'success' as const,  // Mark as success immediately for simplicity
        progress: 100,  // Set to 100% immediately
      };
      
      // Store the actual File object in our Map
      newActualFiles.set(fileId, file);
      newFiles.push(newFile);
    });
    
    if (newFiles.length > 0) {
      // Update state in a single batch
      const updatedFiles = [...files, ...newFiles];
      setFiles(updatedFiles);
      setActualFiles(newActualFiles);
      
      // Notify parent component after our state is updated
      setTimeout(() => {
        onFilesUploaded(updatedFiles, newActualFiles);
      }, 0);
    }
  }, [files, actualFiles, maxFiles, acceptedFileTypes, onFilesUploaded, toast]);

  const removeFile = useCallback((id: string) => {
    const updatedFiles = files.filter(file => file.id !== id);
    setFiles(updatedFiles);
    
    // Also remove the actual File object
    const newActualFiles = new Map(actualFiles);
    newActualFiles.delete(id);
    setActualFiles(newActualFiles);
    
    onFilesUploaded(updatedFiles, newActualFiles);
  }, [files, actualFiles, onFilesUploaded]);

  const formatFileSize = (sizeInBytes: number) => {
    if (sizeInBytes < 1024) return `${sizeInBytes} B`;
    else if (sizeInBytes < 1048576) return `${(sizeInBytes / 1024).toFixed(1)} KB`;
    else return `${(sizeInBytes / 1048576).toFixed(1)} MB`;
  };

  const handleDragOver = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(true);
  };

  const handleDragLeave = () => {
    setIsDragging(false);
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(false);
    handleFileSelect(e.dataTransfer.files);
  };

  return (
    <div className="w-full space-y-4">
      {/* File upload area */}
      <div
        className={cn(
          "border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors",
          isDragging ? "border-yellow-400 bg-yellow-50" : "border-muted-foreground/20",
          files.length >= maxFiles && "opacity-50 cursor-not-allowed"
        )}
        onDragOver={handleDragOver}
        onDragLeave={handleDragLeave}
        onDrop={handleDrop}
        onClick={() => files.length < maxFiles && fileInputRef.current?.click()}
      >
        <input
          type="file"
          ref={fileInputRef}
          className="hidden"
          accept={acceptedFileTypes.join(',')}
          multiple
          onChange={(e) => handleFileSelect(e.target.files)}
          disabled={files.length >= maxFiles}
        />
        <div className="flex flex-col items-center justify-center gap-2">
          <Upload className="h-12 w-12 text-muted-foreground" />
          <h3 className="text-lg font-medium">Upload PDF Financial Reports</h3>
          <p className="text-sm text-muted-foreground max-w-md mx-auto">
            Drag and drop files here, or click to browse. We accept PDF files with financial data.
          </p>
          <Button 
            variant="outline"
            className="mt-2"
            disabled={files.length >= maxFiles}
          >
            Select Files
          </Button>
        </div>
      </div>

      {/* File list */}
      {files.length > 0 && (
        <div className="mt-6">
          <h3 className="font-medium mb-2 text-sm">Uploaded Files ({files.length}/{maxFiles})</h3>
          <div className="space-y-2">
            {files.map(file => (
              <div 
                key={file.id} 
                className="flex items-center p-3 bg-muted/30 rounded-md border"
              >
                <FileText className="h-5 w-5 text-muted-foreground mr-3" />
                <div className="flex-1 min-w-0">
                  <div className="flex justify-between">
                    <p className="text-sm font-medium truncate">{file.name}</p>
                    <span className="text-xs text-muted-foreground">{formatFileSize(file.size)}</span>
                  </div>
                  {file.status === 'pending' && (
                    <Progress value={file.progress} className="h-1 mt-1" />
                  )}
                </div>
                <div className="ml-4 flex items-center">
                  {file.status === 'pending' && <Loader className="h-4 w-4 text-muted-foreground animate-spin" />}
                  {file.status === 'success' && <Check className="h-4 w-4 text-green-500" />}
                  {file.status === 'error' && <X className="h-4 w-4 text-destructive" />}
                  <button 
                    onClick={(e) => {
                      e.stopPropagation();
                      removeFile(file.id);
                    }}
                    className="ml-2 text-muted-foreground hover:text-destructive transition-colors"
                  >
                    <X className="h-4 w-4" />
                  </button>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
};

export default FileUploader;

\`\`\`

# src\components\IntroScreen.tsx

\`\`\`tsx
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { useNavigate } from 'react-router-dom';
import { Progress } from '@/components/ui/progress';
import { motion } from 'framer-motion';

const IntroScreen = () => {
  const navigate = useNavigate();
  const [loading, setLoading] = useState(true);
  const [loadingProgress, setLoadingProgress] = useState(0);
  
  useEffect(() => {
    // Simulate progressive loading
    const totalTime = 2000; // 2 seconds
    const intervalTime = 50; // update every 50ms
    const steps = totalTime / intervalTime;
    let currentStep = 0;
    
    const timer = setInterval(() => {
      currentStep += 1;
      const newProgress = Math.min(100, Math.floor((currentStep / steps) * 100));
      setLoadingProgress(newProgress);
      
      if (newProgress >= 100) {
        clearInterval(timer);
        setTimeout(() => setLoading(false), 200);
      }
    }, intervalTime);
    
    return () => clearInterval(timer);
  }, []);

  const handleEnterApp = () => {
    navigate('/select-bank');
  };

  // Animation variants for the logo and letters
  const containerVariants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: {
        delayChildren: 0.3,
        staggerChildren: 0.1
      }
    }
  };

  const letterVariants = {
    hidden: { y: 20, opacity: 0 },
    visible: {
      y: 0,
      opacity: 1,
      transition: {
        type: "spring",
        damping: 12,
        stiffness: 100
      }
    }
  };

  const floatVariants = {
    animate: {
      y: [0, -10, 0],
      transition: {
        duration: 2,
        repeat: Infinity,
        repeatType: "reverse" as const,
        ease: "easeInOut"
      }
    }
  };

  const logoVariants = {
    hidden: { scale: 0.8, opacity: 0 },
    visible: {
      scale: 1,
      opacity: 1,
      transition: {
        type: "spring",
        damping: 12,
        stiffness: 100
      }
    }
  };

  // Combined animation for the logo that includes floating effect
  const logoAnimation = {
    scale: 1,
    opacity: 1,
    y: [0, -8, 0]
  };
  
  // Combined transition for the logo
  const logoTransition = {
    scale: {
      type: "spring",
      damping: 12,
      stiffness: 100
    },
    opacity: {
      type: "spring",
      damping: 12,
      stiffness: 100
    },
    y: {
      duration: 3,
      repeat: Infinity,
      repeatType: "reverse",
      ease: "easeInOut"
    }
  };
  
  const buttonVariants = {
    initial: { scale: 1 },
    hover: { 
      scale: 1.05,
      transition: { type: "spring", stiffness: 400, damping: 10 }
    },
    tap: { scale: 0.95 }
  };

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-ey-black text-white">
      <div className="w-full max-w-md px-6 py-12 text-center">
        <motion.div 
          className="mb-8"
          initial="hidden"
          animate="visible"
          variants={containerVariants}
        >
          <motion.div 
            className="flex justify-center mb-6"
          >
            <motion.div 
              className="h-16 w-16 bg-ey-yellow rounded-md"
              variants={logoVariants}
              initial="hidden"
              animate={logoAnimation}
              transition={logoTransition}
              whileHover={{ scale: 1.05 }}
            ></motion.div>
          </motion.div>
          
          <motion.h1 
            className="text-4xl font-bold mb-2 flex justify-center"
            variants={containerVariants}
          >
            {Array.from("AiDEx").map((letter, index) => (
              <motion.span
                key={index}
                className="inline-block"
                variants={letterVariants}
                custom={index}
                whileHover={floatVariants.animate}
              >
                {letter}
              </motion.span>
            ))}
          </motion.h1>
          
          <motion.p 
            className="text-ey-gray-400"
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.8 }}
          >
            AI powered Data Extraction
          </motion.p>
          
          <motion.p 
            className="text-ey-gray-500 text-sm mt-1"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 1 }}
          >
            Supported by EYQ
          </motion.p>
        </motion.div>
        
        {loading ? (
          <motion.div 
            className="space-y-3"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.5 }}
          >
            <Progress 
              value={loadingProgress} 
              className="h-2" 
              indicatorClassName="bg-ey-yellow" 
            />
            <p className="text-sm text-ey-gray-400 animate-pulse">
              Loading application... {loadingProgress}%
            </p>
          </motion.div>
        ) : (
          <motion.div
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2 }}
          >
            <motion.button
              onClick={handleEnterApp}
              className="w-full bg-ey-yellow hover:bg-ey-yellow/90 text-ey-black font-medium py-2 px-4 rounded"
              variants={buttonVariants}
              initial="initial"
              whileHover="hover"
              whileTap="tap"
            >
              Enter Application
            </motion.button>
          </motion.div>
        )}
        
        <motion.div 
          className="mt-12 text-xs text-ey-gray-500"
          initial={{ opacity: 0 }}
          animate={{ opacity: 0.7 }}
          transition={{ delay: 1.2 }}
        >
          <p>© {new Date().getFullYear()} EY | A better working world</p>
        </motion.div>
      </div>
    </div>
  );
};

export default IntroScreen;

\`\`\`

# src\components\PDFViewer.tsx

\`\`\`tsx

import { useState, useEffect, useRef } from 'react';
import * as pdfjs from 'pdfjs-dist';
import { Button } from '@/components/ui/button';
import { ChevronLeft, ChevronRight, Loader, RefreshCw } from 'lucide-react';
import { ScrollArea } from '@/components/ui/scroll-area';

// Fix worker import
import { GlobalWorkerOptions } from 'pdfjs-dist';

// Set worker source directly
GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.min.js`;

interface PDFViewerProps {
  file: File | null;
  className?: string;
}

const PDFViewer = ({ file, className = '' }: PDFViewerProps) => {
  const [pdfDoc, setPdfDoc] = useState<pdfjs.PDFDocumentProxy | null>(null);
  const [pageNum, setPageNum] = useState(1);
  const [totalPages, setTotalPages] = useState(0);
  const [isLoading, setIsLoading] = useState(false);
  const [renderError, setRenderError] = useState<string | null>(null);
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const [retryCount, setRetryCount] = useState(0); // Track retry attempts
  const containerRef = useRef<HTMLDivElement>(null);

  // Load the PDF when the file changes or when retryCount changes
  useEffect(() => {
    if (!file) {
      setPdfDoc(null);
      return;
    }

    let isMounted = true;
    
    // Reset states
    setIsLoading(true);
    setRenderError(null);
    
    console.log("Starting to load PDF file:", file.name);
    
    // Convert file to array buffer
    const fileReader = new FileReader();
    
    fileReader.onload = async (event) => {
      if (!isMounted) return;
      
      try {
        const arrayBuffer = event.target?.result;
        
        if (!arrayBuffer) {
          setRenderError("Failed to read file");
          setIsLoading(false);
          return;
        }
        
        // Load the PDF document
        const typedArray = new Uint8Array(arrayBuffer as ArrayBuffer);
        
        console.log("Creating PDF loading task");
        const loadingTask = pdfjs.getDocument(typedArray);
        
        loadingTask.promise
          .then(pdf => {
            if (!isMounted) return;
            
            console.log("PDF loaded successfully with", pdf.numPages, "pages");
            setPdfDoc(pdf);
            setTotalPages(pdf.numPages);
            setPageNum(1); // Reset to first page when loading new PDF
            setIsLoading(false);
          })
          .catch(error => {
            if (!isMounted) return;
            
            console.error('Error loading PDF:', error);
            setRenderError(`Error loading PDF: ${error.message}`);
            setIsLoading(false);
          });
      } catch (error: any) {
        if (!isMounted) return;
        
        console.error('Error processing PDF:', error);
        setRenderError(`Error processing PDF: ${error.message}`);
        setIsLoading(false);
      }
    };
    
    fileReader.onerror = () => {
      if (!isMounted) return;
      
      setRenderError("Error reading file");
      setIsLoading(false);
    };
    
    // Start reading the file
    fileReader.readAsArrayBuffer(file);
    
    return () => {
      isMounted = false;
      if (pdfDoc) {
        try {
          pdfDoc.destroy().catch(e => console.error("Error destroying PDF:", e));
        } catch (error) {
          console.error("Error destroying previous PDF:", error);
        }
      }
    };
  }, [file, retryCount]);

  // Render the PDF page
  useEffect(() => {
    if (!pdfDoc || !canvasRef.current) return;

    let isMounted = true;
    
    const renderPage = async () => {
      if (!isMounted) return;
      
      try {
        // Get the page
        console.log("Getting page", pageNum);
        const page = await pdfDoc.getPage(pageNum);
        
        if (!isMounted || !canvasRef.current) return;
        
        const canvas = canvasRef.current;
        const context = canvas.getContext('2d');
        
        if (!context) {
          setRenderError("Could not get canvas context");
          return;
        }
        
        // Calculate scale to fit width
        const containerWidth = containerRef.current?.clientWidth || canvas.parentElement?.clientWidth || 800;
        const viewport = page.getViewport({ scale: 1.0 });
        const scale = Math.min(containerWidth / viewport.width, 1.0); // Limit scale to 1.0 for better quality
        const scaledViewport = page.getViewport({ scale });

        // Set canvas dimensions
        canvas.height = scaledViewport.height;
        canvas.width = scaledViewport.width;
        
        // Improve rendering quality
        context.imageSmoothingEnabled = true;
        context.imageSmoothingQuality = 'high';
        
        // Set background color
        context.fillStyle = '#FFFFFF';
        context.fillRect(0, 0, canvas.width, canvas.height);
        
        // Render the page
        console.log("Rendering page", pageNum, "of PDF");
        const renderContext = {
          canvasContext: context,
          viewport: scaledViewport,
          background: 'rgba(255,255,255,1)',
        };
        
        await page.render(renderContext).promise;
        
        // Add subtle page border
        context.strokeStyle = '#e2e8f0';
        context.lineWidth = 1;
        context.strokeRect(0, 0, canvas.width, canvas.height);
      } catch (error: any) {
        if (isMounted) {
          console.error('Error rendering page:', error);
          setRenderError(`Error rendering page: ${error.message}`);
        }
      }
    };

    renderPage();
    
    return () => {
      isMounted = false;
    };
  }, [pdfDoc, pageNum]);

  // Effect to adjust canvas size when window resizes
  useEffect(() => {
    const handleResize = () => {
      // Re-render the current page to adjust for new container width
      if (pdfDoc) {
        // Simply update pageNum state to trigger re-render effect
        setPageNum(prevPage => prevPage);
      }
    };

    window.addEventListener('resize', handleResize);
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, [pdfDoc]);

  const goToPreviousPage = () => {
    if (pageNum <= 1) return;
    setPageNum(pageNum - 1);
  };

  const goToNextPage = () => {
    if (pageNum >= totalPages) return;
    setPageNum(pageNum + 1);
  };

  // Create a simple PDF retry button
  const handleRetry = () => {
    if (!file) return;
    setRetryCount(retryCount + 1); // Increment retry count to trigger useEffect
    setIsLoading(true);
    setRenderError(null);
  };

  return (
    <div className={`flex flex-col h-full ${className}`}>
      <ScrollArea className="flex-1 h-full bg-gray-50">
        <div ref={containerRef} className="flex justify-center p-4">
          {isLoading ? (
            <div className="flex flex-col items-center justify-center h-64 w-full">
              <Loader className="h-8 w-8 animate-spin text-yellow-400 mb-4" />
              <div className="text-muted-foreground">
                Loading PDF...
              </div>
            </div>
          ) : renderError ? (
            <div className="flex flex-col items-center justify-center h-64 w-full">
              <div className="text-red-500 mb-4">{renderError}</div>
              <Button 
                variant="outline" 
                size="sm"
                onClick={handleRetry}
                className="flex items-center gap-2"
              >
                <RefreshCw className="h-4 w-4" />
                Retry Loading PDF
              </Button>
            </div>
          ) : !pdfDoc ? (
            <div className="flex items-center justify-center h-64 w-full">
              <div className="text-center">
                <div className="text-muted-foreground mb-2">No PDF selected</div>
                <div className="text-xs text-muted-foreground">Upload a PDF document to view it here</div>
              </div>
            </div>
          ) : (
            <div className="relative shadow-lg bg-white rounded-lg p-1">
              <canvas ref={canvasRef} className="relative z-10 rounded-lg" />
            </div>
          )}
        </div>
      </ScrollArea>

      {pdfDoc && (
        <div className="p-2 border-t bg-white flex justify-between items-center">
          <div className="text-sm text-gray-600 truncate max-w-[150px]">
            {file?.name || "Document"}
          </div>
          <div className="flex items-center space-x-2">
            <Button
              variant="outline"
              size="icon"
              className="h-8 w-8"
              disabled={pageNum === 1}
              onClick={goToPreviousPage}
            >
              <ChevronLeft className="h-4 w-4" />
            </Button>
            <span className="text-sm font-medium min-w-[50px] text-center">
              {pageNum} / {totalPages}
            </span>
            <Button
              variant="outline"
              size="icon"
              className="h-8 w-8"
              disabled={pageNum === totalPages}
              onClick={goToNextPage}
            >
              <ChevronRight className="h-4 w-4" />
            </Button>
          </div>
        </div>
      )}
    </div>
  );
};

export default PDFViewer;

\`\`\`

# src\components\ProcessingStatus.tsx

\`\`\`tsx

import { Card, CardContent } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { cn } from "@/lib/utils";
import { Loader } from "lucide-react";

interface ProcessingStatusProps {
  isProcessing: boolean;
  progress: number;
  currentStep: string;
  totalFiles?: number;
  processedFiles?: number;
  className?: string;
}

const ProcessingStatus = ({
  isProcessing,
  progress,
  currentStep,
  totalFiles = 1,
  processedFiles = 0,
  className
}: ProcessingStatusProps) => {
  if (!isProcessing) return null;

  return (
    <Card className={cn("border-yellow-400 bg-yellow-50", className)}>
      <CardContent className="p-4 space-y-3">
        <div className="flex items-center justify-between">
          <div>
            <div className="flex items-center text-sm">
              <span className="font-medium text-black">Processing</span>
              <span className="ml-2 text-black/70">{processedFiles}/{totalFiles} files</span>
            </div>
            <p className="text-xs text-black/70">Extracting financial data from reports</p>
          </div>
          <Loader className="h-4 w-4 text-yellow-500 animate-spin" />
        </div>
        
        <div className="space-y-2">
          <div className="text-sm font-medium text-black">{currentStep}</div>
          <div className="relative">
            <Progress 
              value={progress} 
              className="h-2" 
              indicatorClassName="bg-yellow-400" 
            />
            <div className="absolute right-0 top-0 -mt-5 text-xs font-medium text-black">
              {progress.toFixed(1)}%
            </div>
          </div>
          <div className="text-xs text-black/70">
            Processing financial data, please wait...
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

export default ProcessingStatus;

\`\`\`

# src\components\PromptDescriptions.tsx

\`\`\`tsx

import { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from "@/components/ui/accordion";
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { Building, FileText, BookOpen, Activity, BarChart4, Scale } from "lucide-react";
import { useEffect, useState } from "react";

interface Prompt {
  bank: string;
  description: string;
}

interface PromptCategory {
  id: string;
  title: string;
  icon: JSX.Element;
  description: string;
  prompts: Prompt[];
}

const PromptDescriptions = () => {
  const [selectedBank, setSelectedBank] = useState<string>('barclays');
  const [selectedBanks, setSelectedBanks] = useState<string[]>([]);
  const [enableMultiBanks, setEnableMultiBanks] = useState<boolean>(false);
  
  // Fetch bank selection from session storage
  useEffect(() => {
    const bank = sessionStorage.getItem('selectedBank') || 'barclays';
    const multiBank = sessionStorage.getItem('enableMultiBanks') === 'true';
    const storedBanks = sessionStorage.getItem('selectedBanks');
    const parsedBanks = storedBanks ? JSON.parse(storedBanks) : [bank];
    
    setSelectedBank(bank);
    setSelectedBanks(parsedBanks);
    setEnableMultiBanks(multiBank);
  }, []);
  
  const promptCategories: PromptCategory[] = [
    {
      id: "ecl",
      title: "ECL By Stage",
      icon: <FileText className="h-5 w-5 text-yellow-500" />,
      description: "Extract detailed Expected Credit Loss (ECL) data broken down by stages",
      prompts: [
        { bank: "Barclays", description: "Extract ECL values, gross exposures and coverage ratios by product category and stage." },
        { bank: "Santander", description: "Extract ECL provisions, gross balances and coverage ratios for all business categories." },
        { bank: "VM", description: "Extract Stage 1, 2, and 3 ECL, gross exposure, and coverage ratio information." },
        { bank: "HSBC", description: "Extract ECL values across stages for all loan portfolios." },
        { bank: "Lloyds", description: "Extract ECL values and exposure by stage for retail and commercial portfolios." },
        { bank: "NatWest", description: "Extract ECL metrics by stage across personal and commercial banking." },
        { bank: "Standard", description: "Extract ECL provisions across wholesale and retail banking segments." }
      ]
    },
    {
      id: "adjustments",
      title: "Management Adjustments",
      icon: <Scale className="h-5 w-5 text-yellow-500" />,
      description: "Extract adjustments made by management to ECL models",
      prompts: [
        { bank: "Barclays", description: "Extract economic uncertainty adjustments, other adjustments, and total management adjustments." },
        { bank: "Santander", description: "Extract all information related to management overlays or judgemental adjustments." },
        { bank: "HSBC", description: "Extract management adjustments related to economic uncertainty." },
        { bank: "Lloyds", description: "Extract post-model adjustments and management overlays." },
        { bank: "NatWest", description: "Extract in-model and post-model management adjustments." },
        { bank: "Standard", description: "Extract management overlay amounts by portfolio segment." }
      ]
    },
    {
      id: "scenarios",
      title: "Scenario Weights",
      icon: <BarChart4 className="h-5 w-5 text-yellow-500" />,
      description: "Extract scenario probability weights used in IFRS 9 ECL calculations",
      prompts: [
        { bank: "Barclays", description: "Extract probability weights assigned to Upside, Baseline, and Downside scenarios." },
        { bank: "Santander", description: "Extract forward-looking economic scenarios used in IFRS 9 ECL framework." },
        { bank: "HSBC", description: "Extract scenario weightings for Central, Upside and Downside scenarios." },
        { bank: "Lloyds", description: "Extract Base, Upside, and Downside scenario probability weights." },
        { bank: "NatWest", description: "Extract Base, Upside, and Severe downside scenario weights." },
        { bank: "Standard", description: "Extract probability-weighted scenario assumptions." }
      ]
    },
    {
      id: "macro",
      title: "Macro Variables",
      icon: <Activity className="h-5 w-5 text-yellow-500" />,
      description: "Extract macroeconomic variables used in IFRS 9 ECL calculations",
      prompts: [
        { bank: "Barclays", description: "Extract GDP, unemployment, HPI, and bank rate variables for forecast years." },
        { bank: "Santander", description: "Extract macroeconomic variables used in IFRS 9 base case scenario." },
        { bank: "HSBC", description: "Extract key economic inputs for all modeled scenarios." },
        { bank: "Lloyds", description: "Extract UK GDP, unemployment and HPI forecast assumptions." },
        { bank: "NatWest", description: "Extract macroeconomic variables and their five-year outlook." },
        { bank: "Standard", description: "Extract economic factor assumptions across major markets." }
      ]
    },
    {
      id: "other",
      title: "Other Metrics",
      icon: <BookOpen className="h-5 w-5 text-yellow-500" />,
      description: "Extract various credit quality metrics, staging criteria, and sensitivity analyses",
      prompts: [
        { bank: "Barclays", description: "Extract credit quality metrics, staging criteria, and ECL sensitivity analysis." },
        { bank: "Santander", description: "Extract credit and financial metrics by business segment." },
        { bank: "HSBC", description: "Extract staging criteria and significant increase in credit risk (SICR) thresholds." },
        { bank: "Lloyds", description: "Extract credit quality metrics and sensitivity analysis results." },
        { bank: "NatWest", description: "Extract credit risk metrics and SICR thresholds by product type." },
        { bank: "Standard", description: "Extract credit quality metrics by geographic region." }
      ]
    }
  ];

  // Filter prompts based on selected bank(s) and multi-bank setting
  const filterPrompts = (prompts: Prompt[]) => {
    if (enableMultiBanks) {
      // In multi-bank mode, filter by selected banks (case-insensitive)
      return prompts.filter(prompt => 
        selectedBanks.some(bank => 
          prompt.bank.toLowerCase() === bank.toLowerCase()
        )
      );
    }
    
    // In single bank mode, filter by selected bank (case-insensitive)
    return prompts.filter(prompt => 
      prompt.bank.toLowerCase() === selectedBank.toLowerCase()
    );
  };

  // Format selected bank names for display
  const formatBankNames = () => {
    if (!enableMultiBanks) {
      return selectedBank.charAt(0).toUpperCase() + selectedBank.slice(1);
    }

    // Convert bank IDs to display names
    const bankDisplayNames = selectedBanks.map(bankId => {
      const capitalizedBank = bankId.charAt(0).toUpperCase() + bankId.slice(1);
      // Handle special cases
      if (bankId.toLowerCase() === 'natwest') return 'NatWest Group';
      if (bankId.toLowerCase() === 'lloyds') return 'Lloyds Banking Group';
      if (bankId.toLowerCase() === 'standard') return 'Standard Chartered';
      return capitalizedBank;
    });

    if (bankDisplayNames.length === 0) return 'no banks';
    if (bankDisplayNames.length === 1) return bankDisplayNames[0];
    if (bankDisplayNames.length === 2) return `${bankDisplayNames[0]} and ${bankDisplayNames[1]}`;
    
    const lastBank = bankDisplayNames.pop();
    return `${bankDisplayNames.join(', ')}, and ${lastBank}`;
  };

  return (
    <Card className="shadow-lg border border-gray-200 hover:shadow-xl transition-shadow dark:border-gray-700">
      <CardHeader className="bg-gradient-to-r from-gray-100 to-white dark:from-gray-800 dark:to-gray-700">
        <CardTitle className="text-lg flex items-center">
          <Building className="mr-2 h-5 w-5 text-yellow-500" />
          Available Extraction Prompts
        </CardTitle>
        <CardDescription className="dark:text-gray-300">
          {enableMultiBanks 
            ? `The system can extract the following types of IFRS9 data from ${selectedBanks.length} bank report${selectedBanks.length !== 1 ? 's' : ''}`
            : `The system can extract the following types of IFRS9 data from ${formatBankNames()} reports`
          }
        </CardDescription>
      </CardHeader>
      <CardContent className="pt-4">
        <Accordion type="single" collapsible className="w-full">
          {promptCategories.map((category) => {
            const filteredPrompts = filterPrompts(category.prompts);
            // Skip categories that have no prompts for the selected bank(s)
            if (filteredPrompts.length === 0) return null;
            
            return (
              <AccordionItem key={category.id} value={category.id} className="border-b border-gray-200 dark:border-gray-700">
                <AccordionTrigger className="hover:bg-gray-50 px-4 py-3 rounded-md dark:hover:bg-gray-800">
                  <div className="flex items-center">
                    {category.icon}
                    <span className="ml-2 font-medium">{category.title}</span>
                  </div>
                </AccordionTrigger>
                <AccordionContent className="px-4 pt-2 pb-4">
                  <p className="text-sm text-gray-600 mb-4 dark:text-gray-400">{category.description}</p>
                  <div className="space-y-3">
                    {filteredPrompts.map((prompt, idx) => (
                      <div key={idx} className="bg-gray-50 p-4 rounded-md border border-gray-200 hover:border-yellow-400 transition-colors dark:bg-gray-800 dark:border-gray-700">
                        <div className="flex items-center mb-2">
                          <div className="w-2 h-2 bg-yellow-400 rounded-full mr-2"></div>
                          <div className="font-medium text-sm">{prompt.bank}</div>
                        </div>
                        <div className="text-xs text-gray-600 pl-4 dark:text-gray-400">{prompt.description}</div>
                      </div>
                    ))}
                  </div>
                </AccordionContent>
              </AccordionItem>
            );
          })}
        </Accordion>
      </CardContent>
      <CardFooter className="bg-gray-50 text-xs text-center py-3 border-t border-gray-200 dark:bg-gray-800 dark:border-gray-700">
        <div className="w-full flex items-center justify-center">
          <span className="text-gray-500 dark:text-gray-400">Supported by</span>
          <span className="font-semibold text-black ml-1 dark:text-white">EYQ</span>
          <span className="text-gray-500 ml-1 dark:text-gray-400">natural language processing</span>
        </div>
      </CardFooter>
    </Card>
  );
};

export default PromptDescriptions;

\`\`\`

# src\components\PromptSelector.tsx

\`\`\`tsx

import { useState, useEffect } from 'react';
import { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/card';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Label } from '@/components/ui/label';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { Check, FileText, Upload } from 'lucide-react';
import { PromptOption, DEFAULT_PROMPTS } from '@/lib/types';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Badge } from '@/components/ui/badge';
import { cn } from '@/lib/utils';
import { parseExcelPrompts } from '@/lib/excelUtils';
import { useToast } from '@/hooks/use-toast';

interface PromptSelectorProps {
  onPromptSelected: (prompts: PromptOption[]) => void;
  disabled?: boolean;
  selectedPrompts?: PromptOption[];
}

const PromptSelector = ({ 
  onPromptSelected, 
  disabled = false,
  selectedPrompts: externalSelectedPrompts = [] 
}: PromptSelectorProps) => {
  const [selectedPrompts, setSelectedPrompts] = useState<PromptOption[]>(externalSelectedPrompts);
  const [customPromptFile, setCustomPromptFile] = useState<File | null>(null);
  const [customPrompts, setCustomPrompts] = useState<PromptOption[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const { toast } = useToast();
  
  // Group prompts by category
  const promptsByCategory: Record<string, PromptOption[]> = DEFAULT_PROMPTS.reduce((acc, prompt) => {
    if (!acc[prompt.category]) {
      acc[prompt.category] = [];
    }
    acc[prompt.category].push(prompt);
    return acc;
  }, {} as Record<string, PromptOption[]>);
  
  // Group custom prompts by category
  const customPromptsByCategory: Record<string, PromptOption[]> = customPrompts.reduce((acc, prompt) => {
    if (!acc[prompt.category]) {
      acc[prompt.category] = [];
    }
    acc[prompt.category].push(prompt);
    return acc;
  }, {} as Record<string, PromptOption[]>);
  
  // Sync with external selected prompts when they change
  useEffect(() => {
    if (externalSelectedPrompts.length > 0) {
      setSelectedPrompts(externalSelectedPrompts);
    }
  }, [externalSelectedPrompts]);
  
  const togglePrompt = (prompt: PromptOption) => {
    if (disabled) return;
    
    const isSelected = selectedPrompts.some(p => p.id === prompt.id);
    
    if (isSelected) {
      setSelectedPrompts(selectedPrompts.filter(p => p.id !== prompt.id));
    } else {
      setSelectedPrompts([...selectedPrompts, prompt]);
    }
  };
  
  const selectAllPrompts = () => {
    if (disabled) return;
    setSelectedPrompts(DEFAULT_PROMPTS);
  };
  
  const deselectAllPrompts = () => {
    if (disabled) return;
    setSelectedPrompts([]);
  };
  
  const handleApply = () => {
    onPromptSelected(selectedPrompts);
  };
  
  const handleCustomPromptUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    if (e.target.files && e.target.files[0]) {
      const file = e.target.files[0];
      setCustomPromptFile(file);
      setIsLoading(true);
      
      try {
        const parsedPrompts = await parseExcelPrompts(file);
        setCustomPrompts(parsedPrompts);
        toast({
          title: "Excel File Processed",
          description: `${parsedPrompts.length} prompts loaded from Excel file`,
        });
      } catch (error) {
        toast({
          title: "Error Processing Excel File",
          description: error instanceof Error ? error.message : "Unknown error occurred",
          variant: "destructive",
        });
      } finally {
        setIsLoading(false);
      }
    }
  };
  
  const useCustomPrompts = () => {
    if (customPrompts.length > 0) {
      setSelectedPrompts(customPrompts);
      onPromptSelected(customPrompts);
      toast({
        title: "Custom Prompts Selected",
        description: `${customPrompts.length} custom prompts will be used for extraction`,
      });
    }
  };

  return (
    <div className="space-y-6">
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Left side - Info */}
        <div className="space-y-4">
          <div>
            <h2 className="text-lg font-semibold mb-1">Select Data to Extract</h2>
            <p className="text-sm text-muted-foreground">
              Choose which financial data points you want to extract from Barclays's uploaded PDFs.
            </p>
          </div>
          
          <div className="bg-muted p-4 rounded-lg border">
            <h3 className="font-medium mb-2">How It Works</h3>
            <p className="text-sm text-muted-foreground">
              Each prompt is designed to extract specific IFRS9 data points from financial reports. Select prompts based on the data you need.
            </p>
          </div>
        </div>

        {/* Right side - Prompt selection */}
        <div>
          <Tabs defaultValue="predefined" className="w-full">
            <TabsList className="grid grid-cols-2 mb-4 w-full">
              <TabsTrigger value="predefined" className="text-sm">Predefined Prompts</TabsTrigger>
              <TabsTrigger value="custom" className="text-sm">Custom Excel Prompts</TabsTrigger>
            </TabsList>
            
            <TabsContent value="predefined">
              <div className="space-y-4">
                <div className="flex justify-between items-center">
                  <div>
                    <span className="text-sm font-medium">
                      {selectedPrompts.length} of {DEFAULT_PROMPTS.length} selected
                    </span>
                  </div>
                  <div className="space-x-2">
                    <Button 
                      variant="outline" 
                      size="sm" 
                      onClick={selectAllPrompts} 
                      disabled={disabled || selectedPrompts.length === DEFAULT_PROMPTS.length}
                    >
                      Select All
                    </Button>
                    <Button 
                      variant="outline" 
                      size="sm" 
                      onClick={deselectAllPrompts} 
                      disabled={disabled || selectedPrompts.length === 0}
                    >
                      Deselect All
                    </Button>
                  </div>
                </div>
                
                <ScrollArea className="h-[350px] pr-4 -mr-4">
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                    {DEFAULT_PROMPTS.map((prompt) => (
                      <div 
                        key={prompt.id}
                        className={cn(
                          "border rounded-md p-3 cursor-pointer transition-all",
                          selectedPrompts.some(p => p.id === prompt.id) 
                            ? "border-yellow-400 bg-yellow-50 text-black" 
                            : "border-border"
                        )}
                        onClick={() => togglePrompt(prompt)}
                      >
                        <div className="flex justify-between">
                          <div className="font-medium text-sm">{prompt.name}</div>
                          {selectedPrompts.some(p => p.id === prompt.id) && (
                            <Check className="h-4 w-4 text-yellow-500" />
                          )}
                        </div>
                        <div className="text-xs text-muted-foreground mt-1">
                          {prompt.description}
                        </div>
                      </div>
                    ))}
                  </div>
                </ScrollArea>
                
                <Button 
                  className="w-full bg-yellow-400 hover:bg-yellow-500 text-black" 
                  onClick={handleApply}
                  disabled={disabled || selectedPrompts.length === 0}
                >
                  Apply Selected Prompts
                </Button>
              </div>
            </TabsContent>
            
            <TabsContent value="custom">
              <div className="space-y-6">
                <div className="bg-muted/50 p-4 rounded-md border">
                  <div className="flex items-start">
                    <FileText className="h-6 w-6 text-muted-foreground mr-3 mt-1" />
                    <div>
                      <h4 className="font-medium text-sm">Excel Prompt File Format</h4>
                      <p className="text-xs text-muted-foreground mt-1">
                        Upload an Excel file with prompts. The file should contain columns for Prompt Name, Description, Template, and Category.
                      </p>
                    </div>
                  </div>
                </div>
                
                <div>
                  <Label htmlFor="promptFile">Upload Prompt Excel File</Label>
                  <div className="mt-2 flex items-center space-x-3">
                    <div className="flex-1 relative">
                      <Input 
                        id="promptFile"
                        type="file" 
                        onChange={handleCustomPromptUpload} 
                        accept=".xlsx,.xls"
                        disabled={disabled || isLoading}
                        className="flex-1"
                      />
                      {isLoading && (
                        <div className="absolute inset-0 flex items-center justify-center bg-white/70">
                          <div className="animate-spin h-5 w-5 border-2 border-yellow-400 border-t-transparent rounded-full"></div>
                        </div>
                      )}
                    </div>
                    <Button 
                      variant="outline"
                      size="icon"
                      disabled={disabled || isLoading}
                      onClick={() => document.getElementById('promptFile')?.click()}
                    >
                      <Upload className="h-4 w-4" />
                    </Button>
                  </div>
                  {customPromptFile && (
                    <div className="mt-2 flex items-center">
                      <FileText className="h-4 w-4 text-yellow-500 mr-2" />
                      <span className="text-sm">{customPromptFile.name}</span>
                      <Badge variant="outline" className="ml-2">
                        {isLoading ? 'Processing...' : `${customPrompts.length} prompts loaded`}
                      </Badge>
                    </div>
                  )}
                </div>
                
                {customPrompts.length > 0 && (
                  <div className="border rounded-md p-4">
                    <h3 className="text-sm font-medium mb-3">Loaded Custom Prompts</h3>
                    <ScrollArea className="h-[150px]">
                      <div className="space-y-2">
                        {Object.entries(customPromptsByCategory).map(([category, prompts]) => (
                          <div key={category} className="mb-3">
                            <h4 className="text-xs font-semibold text-muted-foreground mb-1">{category}</h4>
                            {prompts.map((prompt, idx) => (
                              <div key={idx} className="text-sm py-1 px-2 rounded-sm hover:bg-muted">
                                {prompt.name}
                              </div>
                            ))}
                          </div>
                        ))}
                      </div>
                    </ScrollArea>
                  </div>
                )}
                
                <Button 
                  className="w-full bg-yellow-400 hover:bg-yellow-500 text-black" 
                  disabled={!customPromptFile || disabled || customPrompts.length === 0}
                  onClick={useCustomPrompts}
                >
                  Use Custom Prompts
                </Button>
              </div>
            </TabsContent>
          </Tabs>
        </div>
      </div>
    </div>
  );
};

export default PromptSelector;

\`\`\`

# src\components\ResultsViewer.tsx

\`\`\`tsx

import { useState } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { Button } from '@/components/ui/button';
import { AlertCircle, Check, Download, Loader, Star } from 'lucide-react';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { ProcessingResult } from '@/lib/types';
import { cn } from '@/lib/utils';
import { Badge } from '@/components/ui/badge';
import { ScrollArea } from '@/components/ui/scroll-area';
import ProcessingStatus from './ProcessingStatus';

interface ResultsViewerProps {
  results: ProcessingResult[];
  onDownloadResults: () => void;
  isProcessing?: boolean;
  processingProgress?: number;
  processingStep?: string;
  totalFiles?: number;
  processedFiles?: number;
}

const ResultsViewer = ({ 
  results, 
  onDownloadResults, 
  isProcessing = false, 
  processingProgress = 0, 
  processingStep = '',
  totalFiles = 1,
  processedFiles = 0
}: ResultsViewerProps) => {
  const [selectedResult, setSelectedResult] = useState<string | null>(
    results.length > 0 && results[0] ? results[0].id : null
  );
  const [activeTab, setActiveTab] = useState('results');

  const currentResult = results.find(result => result && result.id === selectedResult);
  
  // Group results by file
  const resultsByFile: Record<string, ProcessingResult[]> = results.reduce((acc, result) => {
    if (!result) return acc;
    if (!acc[result.fileId]) {
      acc[result.fileId] = [];
    }
    acc[result.fileId].push(result);
    return acc;
  }, {} as Record<string, ProcessingResult[]>);

  // Check if the current result has ECL By Stage data
  const isEclByStageCategory = currentResult?.data?.some(item => item?.Category === 'ECL By Stage');
  
  if (results.length === 0 && !isProcessing) {
    return (
      <div className="space-y-6">
        <div>
          <h2 className="text-lg font-semibold mb-1">Extraction Results</h2>
          <p className="text-sm text-muted-foreground">View and download the extracted financial data for Barclays</p>
        </div>
        
        <Card>
          <CardContent className="flex flex-col items-center justify-center p-12 text-center">
            <div className="text-muted-foreground mb-2">
              No extraction results yet
            </div>
            <div className="text-sm text-muted-foreground">
              Process files to see extraction results
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  if (isProcessing) {
    return (
      <div className="space-y-6">
        <div>
          <h2 className="text-lg font-semibold mb-1">Extraction Results</h2>
          <p className="text-sm text-muted-foreground">View and download the extracted financial data for Barclays</p>
        </div>
        
        {/* Processing status */}
        <ProcessingStatus
          isProcessing={isProcessing}
          progress={processingProgress}
          currentStep={processingStep}
          totalFiles={totalFiles}
          processedFiles={processedFiles}
        />
        
        <div className="mt-10">
          <h2 className="text-lg font-semibold mb-6">Extraction Results</h2>
          
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div className="lg:col-span-1">
              <div className="border rounded-lg overflow-hidden">
                <div className="bg-black text-white p-2 text-sm font-medium">
                  Processed Files
                </div>
                <div className="p-2 border-b">
                  <div className="text-sm font-medium p-2 bg-muted rounded">Currently Processing</div>
                </div>
                <div className="p-2">
                  <div className="flex items-center justify-between p-2 text-sm rounded-md hover:bg-muted cursor-pointer">
                    <div className="truncate pr-2">Management Adjustments</div>
                    <div className="flex items-center">
                      <Star className="h-3 w-3 text-yellow-400 fill-yellow-400" />
                    </div>
                  </div>
                  <div className="flex items-center justify-between p-2 text-sm rounded-md hover:bg-muted cursor-pointer">
                    <div className="truncate pr-2">Loan Loss Rate</div>
                    <div className="flex items-center">
                      <Star className="h-3 w-3 text-yellow-400 fill-yellow-400" />
                    </div>
                  </div>
                  <div className="flex items-center justify-between p-2 text-sm rounded-md hover:bg-muted cursor-pointer">
                    <div className="truncate pr-2">Macro Variables</div>
                    <div className="flex items-center">
                      <Star className="h-3 w-3 text-yellow-400 fill-yellow-400" />
                    </div>
                  </div>
                </div>
                <div className="p-2 border-t bg-muted/40">
                  <div className="text-sm font-medium p-2">FY24-Barclays-Results-RA.pdf</div>
                  <div className="flex items-center justify-between p-2 text-sm rounded-md hover:bg-muted cursor-pointer bg-yellow-50 border border-yellow-400">
                    <div className="truncate pr-2 text-black">ECL By Stage</div>
                    <div className="flex items-center">
                      <Star className="h-3 w-3 text-yellow-400 fill-yellow-400" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div className="lg:col-span-2">
              <div className="flex items-center justify-center h-[400px] border rounded-lg">
                <div className="text-center p-8">
                  <div className="flex items-center justify-center mb-4">
                    <div className="animate-spin h-10 w-10 border-4 border-yellow-400 border-t-transparent rounded-full"></div>
                  </div>
                  <h3 className="text-lg font-medium mb-2">Processing Data</h3>
                  <p className="text-sm text-muted-foreground">
                    Extracting information from your documents...
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <Tabs value={activeTab} onValueChange={setActiveTab}>
      <div className="space-y-6">
        <div className="flex justify-between items-center">
          <div>
            <h2 className="text-lg font-semibold mb-1">Extraction Results</h2>
            <p className="text-sm text-muted-foreground">View and download the extracted financial data for Barclays</p>
          </div>
          <Button 
            variant="outline" 
            size="sm" 
            onClick={onDownloadResults}
            className="flex items-center gap-1 border-yellow-400 hover:bg-yellow-50"
          >
            <Download className="h-4 w-4" />
            <span>Download All</span>
          </Button>
        </div>
        
        <TabsList className="grid grid-cols-2 max-w-[400px]">
          <TabsTrigger value="results">Results</TabsTrigger>
          <TabsTrigger value="combined">Combined View</TabsTrigger>
        </TabsList>
        
        <TabsContent value="results" className="space-y-6">
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div className="lg:col-span-1">
              <div className="border rounded-lg overflow-hidden">
                <div className="bg-black text-white p-2 text-sm font-medium">
                  Processed Files
                </div>
                <ScrollArea className="h-[400px]">
                  <div className="p-2">
                    {Object.entries(resultsByFile).map(([fileId, fileResults]) => {
                      const fileInfo = fileResults[0];
                      if (!fileInfo) return null;
                      
                      return (
                        <div key={fileId} className="mb-4">
                          <div className="text-sm font-medium p-2 bg-muted">
                            {fileInfo.fileName}
                          </div>
                          {fileResults.map(result => {
                            if (!result) return null;
                            const isSelected = selectedResult === result.id;
                            
                            return (
                              <div 
                                key={result.id}
                                className={cn(
                                  "flex items-center justify-between p-2 text-sm rounded-md cursor-pointer",
                                  isSelected ? "bg-yellow-50 border border-yellow-400 text-black" : "hover:bg-muted"
                                )}
                                onClick={() => setSelectedResult(result.id)}
                              >
                                <div className="truncate pr-2">{result.promptName}</div>
                                <div className="flex items-center">
                                  <Star className="h-3 w-3 text-yellow-400 fill-yellow-400" />
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      );
                    })}
                  </div>
                </ScrollArea>
              </div>
            </div>
            
            <div className="lg:col-span-2">
              {currentResult ? (
                <div className="border rounded-lg overflow-hidden">
                  <div className="bg-black text-white p-3 flex justify-between items-center">
                    <div>
                      <div className="font-medium">{currentResult.promptName}</div>
                      <div className="text-xs text-gray-400">From: {currentResult.fileName}</div>
                    </div>
                    <Badge 
                      className={cn(
                        "capitalize",
                        currentResult.status === 'success' && "bg-green-500",
                        currentResult.status === 'error' && "bg-destructive",
                        currentResult.status === 'processing' && "bg-amber-500"
                      )}
                    >
                      {currentResult.status}
                    </Badge>
                  </div>
                  
                  <div className="p-3">
                    {currentResult.status === 'processing' && (
                      <div className="flex flex-col items-center justify-center h-[350px] py-8">
                        <Loader className="h-8 w-8 text-yellow-400 animate-spin mb-2" />
                        <div className="text-sm">Processing data extraction...</div>
                      </div>
                    )}
                    
                    {currentResult.status === 'error' && currentResult.error && (
                      <Alert variant="destructive" className="mb-4">
                        <AlertCircle className="h-4 w-4" />
                        <AlertTitle>Error</AlertTitle>
                        <AlertDescription>
                          {currentResult.error}
                        </AlertDescription>
                      </Alert>
                    )}
                    
                    {currentResult.status === 'success' && currentResult.data && (
                      <Tabs defaultValue="table">
                        <TabsList className="mb-4">
                          <TabsTrigger value="table">Table View</TabsTrigger>
                          <TabsTrigger value="json">JSON View</TabsTrigger>
                          {/* Only show By Stage tab for ECL By Stage category */}
                          {isEclByStageCategory && (
                            <TabsTrigger value="by-stage">By Stage</TabsTrigger>
                          )}
                        </TabsList>
                        
                        <TabsContent value="table" className="mt-0">
                          <ScrollArea className="h-[350px]">
                            <Table>
                              <TableHeader className="bg-muted sticky top-0">
                                <TableRow>
                                  <TableHead className="font-semibold">Category</TableHead>
                                  <TableHead className="font-semibold">Stage</TableHead>
                                  <TableHead className="font-semibold">Field</TableHead>
                                  <TableHead className="font-semibold">Value</TableHead>
                                </TableRow>
                              </TableHeader>
                              <TableBody>
                                {currentResult.data.map((item, index) => {
                                  if (!item) return null;
                                  
                                  return (
                                    <TableRow key={index}>
                                      <TableCell>
                                        {item.Category === 'ECL By Stage' ? 'ECL' : item.Category}
                                      </TableCell>
                                      <TableCell>{item.Stage}</TableCell>
                                      <TableCell>{item.Field}</TableCell>
                                      <TableCell className="font-medium">{item.Value}</TableCell>
                                    </TableRow>
                                  );
                                })}
                              </TableBody>
                            </Table>
                          </ScrollArea>
                        </TabsContent>
                        
                        <TabsContent value="json" className="mt-0">
                          <ScrollArea className="h-[350px]">
                            <pre className="bg-muted p-4 rounded-md text-xs overflow-x-auto">
                              {JSON.stringify(currentResult.data, null, 2)}
                            </pre>
                          </ScrollArea>
                        </TabsContent>
                        
                        {/* Only render By Stage content for ECL By Stage category */}
                        {isEclByStageCategory && (
                          <TabsContent value="by-stage" className="mt-0">
                            <ScrollArea className="h-[350px]">
                              <div className="space-y-4">
                                {/* Group data by Stage */}
                                {(() => {
                                  // Get unique stages
                                  const stages = Array.from(
                                    new Set(
                                      currentResult.data
                                        .filter(item => item?.Category === 'ECL By Stage')
                                        .map(item => item?.Stage)
                                    )
                                  );
                                  
                                  return stages.map(stage => {
                                    const stageData = currentResult.data.filter(
                                      item => item?.Stage === stage && item?.Category === 'ECL By Stage'
                                    );
                                    
                                    if (stageData.length === 0) return null;
                                    
                                    return (
                                      <div key={`stage-${stage}`} className="border rounded-md overflow-hidden">
                                        <div className="bg-muted p-2">
                                          <h4 className="font-medium">Stage {stage}</h4>
                                        </div>
                                        <Table>
                                          <TableHeader>
                                            <TableRow>
                                              <TableHead>Category</TableHead>
                                              <TableHead>Field</TableHead>
                                              <TableHead>Value</TableHead>
                                            </TableRow>
                                          </TableHeader>
                                          <TableBody>
                                            {stageData.map((item, index) => (
                                              <TableRow key={index}>
                                                <TableCell>ECL</TableCell>
                                                <TableCell>{item.Field}</TableCell>
                                                <TableCell className="font-medium">{item.Value}</TableCell>
                                              </TableRow>
                                            ))}
                                          </TableBody>
                                        </Table>
                                      </div>
                                    );
                                  });
                                })()}
                              </div>
                            </ScrollArea>
                          </TabsContent>
                        )}
                      </Tabs>
                    )}
                  </div>
                </div>
              ) : (
                <div className="flex flex-col items-center justify-center h-[400px] border rounded-lg">
                  <div className="text-muted-foreground">
                    Select a result to view details
                  </div>
                </div>
              )}
            </div>
          </div>
        </TabsContent>
        
        <TabsContent value="combined">
          <div className="space-y-6">
            <div className="flex justify-between items-center">
              <div>
                <h2 className="text-lg font-semibold mb-1">Combined Results</h2>
                <p className="text-sm text-muted-foreground">
                  View and download the final processed data in Excel format
                </p>
              </div>
              <Button 
                variant="outline" 
                size="sm" 
                onClick={onDownloadResults}
                className="flex items-center gap-1 border-yellow-400 bg-white text-black hover:bg-yellow-50"
              >
                <Download className="h-4 w-4" />
                <span>Download Excel</span>
              </Button>
            </div>
            
            {results.length > 0 ? (
              <div className="border rounded-lg overflow-hidden">
                <div className="flex justify-between items-center p-3 bg-muted border-b">
                  <Button 
                    variant="outline" 
                    size="sm" 
                    className="py-1 h-8 bg-yellow-400 hover:bg-yellow-500 border-none text-black"
                  >
                    Combined View
                  </Button>
                  <div className="text-sm text-muted-foreground">
                    {results.filter(r => r.data).flatMap(r => r.data || []).length} rows
                  </div>
                </div>
                
                <ScrollArea className="h-[650px]">
                  <Table>
                    <TableHeader className="bg-muted/70 sticky top-0">
                      <TableRow>
                        <TableHead className="font-semibold text-black">Category</TableHead>
                        <TableHead className="font-semibold text-black">Stage</TableHead>
                        <TableHead className="font-semibold text-black">Field</TableHead>
                        <TableHead className="font-semibold text-black">Value</TableHead>
                        <TableHead className="font-semibold text-black">Source</TableHead>
                      </TableRow>
                    </TableHeader>
                    <TableBody>
                      {results
                        .filter(result => result.status === 'success' && result.data)
                        .flatMap((result, resultIndex) => 
                          (result.data || []).map((item, itemIndex) => (
                            <TableRow key={`${resultIndex}-${itemIndex}`}>
                              <TableCell>
                                {item.Category === 'ECL By Stage' ? 'ECL' : item.Category}
                              </TableCell>
                              <TableCell>{item.Stage}</TableCell>
                              <TableCell>{item.Field}</TableCell>
                              <TableCell>{item.Value}</TableCell>
                              <TableCell>{result.fileName} - {result.promptName}</TableCell>
                            </TableRow>
                          ))
                        )
                      }
                    </TableBody>
                  </Table>
                </ScrollArea>
              </div>
            ) : (
              <div className="border rounded-lg p-12 text-center">
                <p className="text-muted-foreground">No results available yet.</p>
                <p className="text-sm text-muted-foreground mt-1">Process files with prompts to see combined results.</p>
              </div>
            )}
          </div>
        </TabsContent>
      </div>
    </Tabs>
  );
};

// Helper component for Progress
const Progress = ({ value, className }: { value: number, className?: string }) => {
  return (
    <div className={cn("w-full bg-gray-200 rounded-full h-2.5", className)}>
      <div 
        className="bg-yellow-400 h-2.5 rounded-full" 
        style={{ width: `${value}%` }}
      ></div>
    </div>
  );
};

export default ResultsViewer;

\`\`\`

# src\components\ThemeProvider.tsx

\`\`\`tsx

"use client";

import * as React from "react";
import { createContext, useContext, useEffect, useState } from "react";

type Theme = "dark" | "light" | "system";

type ThemeProviderProps = {
  children: React.ReactNode;
  defaultTheme?: Theme;
  storageKey?: string;
};

type ThemeProviderState = {
  theme: Theme;
  setTheme: (theme: Theme) => void;
};

const initialState: ThemeProviderState = {
  theme: "system",
  setTheme: () => null,
};

const ThemeProviderContext = createContext<ThemeProviderState>(initialState);

export function ThemeProvider({
  children,
  defaultTheme = "system",
  storageKey = "vite-ui-theme",
  ...props
}: ThemeProviderProps) {
  const [theme, setTheme] = useState<Theme>(
    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme
  );

  useEffect(() => {
    const root = window.document.documentElement;
    root.classList.remove("light", "dark");

    if (theme === "system") {
      const systemTheme = window.matchMedia("(prefers-color-scheme: dark)")
        .matches
        ? "dark"
        : "light";

      root.classList.add(systemTheme);
      return;
    }

    root.classList.add(theme);
  }, [theme]);

  const value = {
    theme,
    setTheme: (theme: Theme) => {
      localStorage.setItem(storageKey, theme);
      setTheme(theme);
    },
  };

  return (
    <ThemeProviderContext.Provider {...props} value={value}>
      {children}
    </ThemeProviderContext.Provider>
  );
}

export const useTheme = () => {
  const context = useContext(ThemeProviderContext);

  if (context === undefined)
    throw new Error("useTheme must be used within a ThemeProvider");

  return context;
};

\`\`\`

# src\components\ThemeToggle.tsx

\`\`\`tsx

import { Moon, Sun } from "lucide-react";
import { Button } from "@/components/ui/button";
import { useTheme } from "@/components/ThemeProvider";
import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from "@/components/ui/dropdown-menu";

export function ThemeToggle({ className }: { className?: string }) {
  const { setTheme, theme } = useTheme();

  return (
    <div className={className}>
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <Button variant="outline" size="icon" className="rounded-full bg-white dark:bg-yellow-400">
            <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0 dark:text-black" />
            <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100 dark:text-black" />
            <span className="sr-only">Toggle theme</span>
          </Button>
        </DropdownMenuTrigger>
        <DropdownMenuContent align="end">
          <DropdownMenuItem onClick={() => setTheme("light")}>
            Light
          </DropdownMenuItem>
          <DropdownMenuItem onClick={() => setTheme("dark")}>
            Dark
          </DropdownMenuItem>
          <DropdownMenuItem onClick={() => setTheme("system")}>
            System
          </DropdownMenuItem>
        </DropdownMenuContent>
      </DropdownMenu>
    </div>
  );
}

\`\`\`

# src\components\ui\accordion.tsx

\`\`\`tsx
import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn("border-b", className)}
    {...props}
  />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))

AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }

\`\`\`

# src\components\ui\alert-dialog.tsx

\`\`\`tsx
import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

const AlertDialog = AlertDialogPrimitive.Root

const AlertDialogTrigger = AlertDialogPrimitive.Trigger

const AlertDialogPortal = AlertDialogPrimitive.Portal

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    />
  </AlertDialogPortal>
))
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName

const AlertDialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
AlertDialogHeader.displayName = "AlertDialogHeader"

const AlertDialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
AlertDialogFooter.displayName = "AlertDialogFooter"

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold", className)}
    {...props}
  />
))
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action
    ref={ref}
    className={cn(buttonVariants(), className)}
    {...props}
  />
))
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    )}
    {...props}
  />
))
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}

\`\`\`

# src\components\ui\alert.tsx

\`\`\`tsx
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive:
          "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
))
Alert.displayName = "Alert"

const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn("mb-1 font-medium leading-none tracking-tight", className)}
    {...props}
  />
))
AlertTitle.displayName = "AlertTitle"

const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm [&_p]:leading-relaxed", className)}
    {...props}
  />
))
AlertDescription.displayName = "AlertDescription"

export { Alert, AlertTitle, AlertDescription }

\`\`\`

# src\components\ui\aspect-ratio.tsx

\`\`\`tsx
import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio"

const AspectRatio = AspectRatioPrimitive.Root

export { AspectRatio }

\`\`\`

# src\components\ui\avatar.tsx

\`\`\`tsx
import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    )}
    {...props}
  />
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image
    ref={ref}
    className={cn("aspect-square h-full w-full", className)}
    {...props}
  />
))
AvatarImage.displayName = AvatarPrimitive.Image.displayName

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn(
      "flex h-full w-full items-center justify-center rounded-full bg-muted",
      className
    )}
    {...props}
  />
))
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName

export { Avatar, AvatarImage, AvatarFallback }

\`\`\`

# src\components\ui\badge.tsx

\`\`\`tsx
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  )
}

export { Badge, badgeVariants }

\`\`\`

# src\components\ui\breadcrumb.tsx

\`\`\`tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"

const Breadcrumb = React.forwardRef<
  HTMLElement,
  React.ComponentPropsWithoutRef<"nav"> & {
    separator?: React.ReactNode
  }
>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)
Breadcrumb.displayName = "Breadcrumb"

const BreadcrumbList = React.forwardRef<
  HTMLOListElement,
  React.ComponentPropsWithoutRef<"ol">
>(({ className, ...props }, ref) => (
  <ol
    ref={ref}
    className={cn(
      "flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",
      className
    )}
    {...props}
  />
))
BreadcrumbList.displayName = "BreadcrumbList"

const BreadcrumbItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentPropsWithoutRef<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    className={cn("inline-flex items-center gap-1.5", className)}
    {...props}
  />
))
BreadcrumbItem.displayName = "BreadcrumbItem"

const BreadcrumbLink = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentPropsWithoutRef<"a"> & {
    asChild?: boolean
  }
>(({ asChild, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      className={cn("transition-colors hover:text-foreground", className)}
      {...props}
    />
  )
})
BreadcrumbLink.displayName = "BreadcrumbLink"

const BreadcrumbPage = React.forwardRef<
  HTMLSpanElement,
  React.ComponentPropsWithoutRef<"span">
>(({ className, ...props }, ref) => (
  <span
    ref={ref}
    role="link"
    aria-disabled="true"
    aria-current="page"
    className={cn("font-normal text-foreground", className)}
    {...props}
  />
))
BreadcrumbPage.displayName = "BreadcrumbPage"

const BreadcrumbSeparator = ({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) => (
  <li
    role="presentation"
    aria-hidden="true"
    className={cn("[&>svg]:size-3.5", className)}
    {...props}
  >
    {children ?? <ChevronRight />}
  </li>
)
BreadcrumbSeparator.displayName = "BreadcrumbSeparator"

const BreadcrumbEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    role="presentation"
    aria-hidden="true"
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More</span>
  </span>
)
BreadcrumbEllipsis.displayName = "BreadcrumbElipssis"

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}

\`\`\`

# src\components\ui\button.tsx

\`\`\`tsx

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-500",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground dark:border-gray-600",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-500",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
        eyOutline: "border border-ey-gray-400 text-white hover:bg-ey-gray-800 hover:border-ey-gray-500 transition-colors",
        eyPrimary: "bg-ey-yellow text-ey-black hover:bg-ey-yellow/90 font-medium transition-colors",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }

\`\`\`

# src\components\ui\calendar.tsx

\`\`\`tsx
import * as React from "react";
import { ChevronLeft, ChevronRight } from "lucide-react";
import { DayPicker } from "react-day-picker";

import { cn } from "@/lib/utils";
import { buttonVariants } from "@/components/ui/button";

export type CalendarProps = React.ComponentProps<typeof DayPicker>;

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: CalendarProps) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",
        month: "space-y-4",
        caption: "flex justify-center pt-1 relative items-center",
        caption_label: "text-sm font-medium",
        nav: "space-x-1 flex items-center",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-y-1",
        head_row: "flex",
        head_cell:
          "text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",
        day: cn(
          buttonVariants({ variant: "ghost" }),
          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"
        ),
        day_range_end: "day-range-end",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle:
          "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ ..._props }) => <ChevronLeft className="h-4 w-4" />,
        IconRight: ({ ..._props }) => <ChevronRight className="h-4 w-4" />,
      }}
      {...props}
    />
  );
}
Calendar.displayName = "Calendar";

export { Calendar };

\`\`\`

# src\components\ui\card.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }

\`\`\`

# src\components\ui\carousel.tsx

\`\`\`tsx
import * as React from "react"
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react"
import { ArrowLeft, ArrowRight } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: "horizontal" | "vertical"
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />")
  }

  return context
}

const Carousel = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & CarouselProps
>(
  (
    {
      orientation = "horizontal",
      opts,
      setApi,
      plugins,
      className,
      children,
      ...props
    },
    ref
  ) => {
    const [carouselRef, api] = useEmblaCarousel(
      {
        ...opts,
        axis: orientation === "horizontal" ? "x" : "y",
      },
      plugins
    )
    const [canScrollPrev, setCanScrollPrev] = React.useState(false)
    const [canScrollNext, setCanScrollNext] = React.useState(false)

    const onSelect = React.useCallback((api: CarouselApi) => {
      if (!api) {
        return
      }

      setCanScrollPrev(api.canScrollPrev())
      setCanScrollNext(api.canScrollNext())
    }, [])

    const scrollPrev = React.useCallback(() => {
      api?.scrollPrev()
    }, [api])

    const scrollNext = React.useCallback(() => {
      api?.scrollNext()
    }, [api])

    const handleKeyDown = React.useCallback(
      (event: React.KeyboardEvent<HTMLDivElement>) => {
        if (event.key === "ArrowLeft") {
          event.preventDefault()
          scrollPrev()
        } else if (event.key === "ArrowRight") {
          event.preventDefault()
          scrollNext()
        }
      },
      [scrollPrev, scrollNext]
    )

    React.useEffect(() => {
      if (!api || !setApi) {
        return
      }

      setApi(api)
    }, [api, setApi])

    React.useEffect(() => {
      if (!api) {
        return
      }

      onSelect(api)
      api.on("reInit", onSelect)
      api.on("select", onSelect)

      return () => {
        api?.off("select", onSelect)
      }
    }, [api, onSelect])

    return (
      <CarouselContext.Provider
        value={{
          carouselRef,
          api: api,
          opts,
          orientation:
            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
          scrollPrev,
          scrollNext,
          canScrollPrev,
          canScrollNext,
        }}
      >
        <div
          ref={ref}
          onKeyDownCapture={handleKeyDown}
          className={cn("relative", className)}
          role="region"
          aria-roledescription="carousel"
          {...props}
        >
          {children}
        </div>
      </CarouselContext.Provider>
    )
  }
)
Carousel.displayName = "Carousel"

const CarouselContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div ref={carouselRef} className="overflow-hidden">
      <div
        ref={ref}
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className
        )}
        {...props}
      />
    </div>
  )
})
CarouselContent.displayName = "CarouselContent"

const CarouselItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { orientation } = useCarousel()

  return (
    <div
      ref={ref}
      role="group"
      aria-roledescription="slide"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className
      )}
      {...props}
    />
  )
})
CarouselItem.displayName = "CarouselItem"

const CarouselPrevious = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute  h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-left-12 top-1/2 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft className="h-4 w-4" />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
})
CarouselPrevious.displayName = "CarouselPrevious"

const CarouselNext = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-right-12 top-1/2 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight className="h-4 w-4" />
      <span className="sr-only">Next slide</span>
    </Button>
  )
})
CarouselNext.displayName = "CarouselNext"

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}

\`\`\`

# src\components\ui\chart.tsx

\`\`\`tsx
import * as React from "react"
import * as RechartsPrimitive from "recharts"

import { cn } from "@/lib/utils"

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />")
  }

  return context
}

const ChartContainer = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    config: ChartConfig
    children: React.ComponentProps<
      typeof RechartsPrimitive.ResponsiveContainer
    >["children"]
  }
>(({ id, className, children, config, ...props }, ref) => {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-chart={chartId}
        ref={ref}
        className={cn(
          "flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",
          className
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
})
ChartContainer.displayName = "Chart"

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([_, config]) => config.theme || config.color
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join("\n")}
}
`
          )
          .join("\n"),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

const ChartTooltipContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
    React.ComponentProps<"div"> & {
      hideLabel?: boolean
      hideIndicator?: boolean
      indicator?: "line" | "dot" | "dashed"
      nameKey?: string
      labelKey?: string
    }
>(
  (
    {
      active,
      payload,
      className,
      indicator = "dot",
      hideLabel = false,
      hideIndicator = false,
      label,
      labelFormatter,
      labelClassName,
      formatter,
      color,
      nameKey,
      labelKey,
    },
    ref
  ) => {
    const { config } = useChart()

    const tooltipLabel = React.useMemo(() => {
      if (hideLabel || !payload?.length) {
        return null
      }

      const [item] = payload
      const key = `${labelKey || item.dataKey || item.name || "value"}`
      const itemConfig = getPayloadConfigFromPayload(config, item, key)
      const value =
        !labelKey && typeof label === "string"
          ? config[label as keyof typeof config]?.label || label
          : itemConfig?.label

      if (labelFormatter) {
        return (
          <div className={cn("font-medium", labelClassName)}>
            {labelFormatter(value, payload)}
          </div>
        )
      }

      if (!value) {
        return null
      }

      return <div className={cn("font-medium", labelClassName)}>{value}</div>
    }, [
      label,
      labelFormatter,
      payload,
      hideLabel,
      labelClassName,
      config,
      labelKey,
    ])

    if (!active || !payload?.length) {
      return null
    }

    const nestLabel = payload.length === 1 && indicator !== "dot"

    return (
      <div
        ref={ref}
        className={cn(
          "grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",
          className
        )}
      >
        {!nestLabel ? tooltipLabel : null}
        <div className="grid gap-1.5">
          {payload.map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`
            const itemConfig = getPayloadConfigFromPayload(config, item, key)
            const indicatorColor = color || item.payload.fill || item.color

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",
                  indicator === "dot" && "items-center"
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn(
                            "shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",
                            {
                              "h-2.5 w-2.5": indicator === "dot",
                              "w-1": indicator === "line",
                              "w-0 border-[1.5px] border-dashed bg-transparent":
                                indicator === "dashed",
                              "my-0.5": nestLabel && indicator === "dashed",
                            }
                          )}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center"
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">
                          {itemConfig?.label || item.name}
                        </span>
                      </div>
                      {item.value && (
                        <span className="font-mono font-medium tabular-nums text-foreground">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            )
          })}
        </div>
      </div>
    )
  }
)
ChartTooltipContent.displayName = "ChartTooltip"

const ChartLegend = RechartsPrimitive.Legend

const ChartLegendContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> &
    Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
      hideIcon?: boolean
      nameKey?: string
    }
>(
  (
    { className, hideIcon = false, payload, verticalAlign = "bottom", nameKey },
    ref
  ) => {
    const { config } = useChart()

    if (!payload?.length) {
      return null
    }

    return (
      <div
        ref={ref}
        className={cn(
          "flex items-center justify-center gap-4",
          verticalAlign === "top" ? "pb-3" : "pt-3",
          className
        )}
      >
        {payload.map((item) => {
          const key = `${nameKey || item.dataKey || "value"}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)

          return (
            <div
              key={item.value}
              className={cn(
                "flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"
              )}
            >
              {itemConfig?.icon && !hideIcon ? (
                <itemConfig.icon />
              ) : (
                <div
                  className="h-2 w-2 shrink-0 rounded-[2px]"
                  style={{
                    backgroundColor: item.color,
                  }}
                />
              )}
              {itemConfig?.label}
            </div>
          )
        })}
      </div>
    )
  }
)
ChartLegendContent.displayName = "ChartLegend"

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}

\`\`\`

# src\components\ui\checkbox.tsx

\`\`\`tsx
import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }

\`\`\`

# src\components\ui\collapsible.tsx

\`\`\`tsx
import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

const Collapsible = CollapsiblePrimitive.Root

const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger

const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent

export { Collapsible, CollapsibleTrigger, CollapsibleContent }

\`\`\`

# src\components\ui\command.tsx

\`\`\`tsx
import * as React from "react"
import { type DialogProps } from "@radix-ui/react-dialog"
import { Command as CommandPrimitive } from "cmdk"
import { Search } from "lucide-react"

import { cn } from "@/lib/utils"
import { Dialog, DialogContent } from "@/components/ui/dialog"

const Command = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive>
>(({ className, ...props }, ref) => (
  <CommandPrimitive
    ref={ref}
    className={cn(
      "flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",
      className
    )}
    {...props}
  />
))
Command.displayName = CommandPrimitive.displayName

interface CommandDialogProps extends DialogProps {}

const CommandDialog = ({ children, ...props }: CommandDialogProps) => {
  return (
    <Dialog {...props}>
      <DialogContent className="overflow-hidden p-0 shadow-lg">
        <Command className="[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

const CommandInput = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Input>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
>(({ className, ...props }, ref) => (
  <div className="flex items-center border-b px-3" cmdk-input-wrapper="">
    <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
    <CommandPrimitive.Input
      ref={ref}
      className={cn(
        "flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    />
  </div>
))

CommandInput.displayName = CommandPrimitive.Input.displayName

const CommandList = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.List
    ref={ref}
    className={cn("max-h-[300px] overflow-y-auto overflow-x-hidden", className)}
    {...props}
  />
))

CommandList.displayName = CommandPrimitive.List.displayName

const CommandEmpty = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Empty>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>
>((props, ref) => (
  <CommandPrimitive.Empty
    ref={ref}
    className="py-6 text-center text-sm"
    {...props}
  />
))

CommandEmpty.displayName = CommandPrimitive.Empty.displayName

const CommandGroup = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Group>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Group
    ref={ref}
    className={cn(
      "overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",
      className
    )}
    {...props}
  />
))

CommandGroup.displayName = CommandPrimitive.Group.displayName

const CommandSeparator = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 h-px bg-border", className)}
    {...props}
  />
))
CommandSeparator.displayName = CommandPrimitive.Separator.displayName

const CommandItem = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",
      className
    )}
    {...props}
  />
))

CommandItem.displayName = CommandPrimitive.Item.displayName

const CommandShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
CommandShortcut.displayName = "CommandShortcut"

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}

\`\`\`

# src\components\ui\context-menu.tsx

\`\`\`tsx
import * as React from "react"
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const ContextMenu = ContextMenuPrimitive.Root

const ContextMenuTrigger = ContextMenuPrimitive.Trigger

const ContextMenuGroup = ContextMenuPrimitive.Group

const ContextMenuPortal = ContextMenuPrimitive.Portal

const ContextMenuSub = ContextMenuPrimitive.Sub

const ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup

const ContextMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <ContextMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </ContextMenuPrimitive.SubTrigger>
))
ContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName

const ContextMenuSubContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
ContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName

const ContextMenuContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Portal>
    <ContextMenuPrimitive.Content
      ref={ref}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </ContextMenuPrimitive.Portal>
))
ContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName

const ContextMenuItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName

const ContextMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <ContextMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.CheckboxItem>
))
ContextMenuCheckboxItem.displayName =
  ContextMenuPrimitive.CheckboxItem.displayName

const ContextMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <ContextMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.RadioItem>
))
ContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName

const ContextMenuLabel = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold text-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName

const ContextMenuSeparator = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-border", className)}
    {...props}
  />
))
ContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName

const ContextMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
ContextMenuShortcut.displayName = "ContextMenuShortcut"

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}

\`\`\`

# src\components\ui\dialog.tsx

\`\`\`tsx
import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}

\`\`\`

# src\components\ui\drawer.tsx

\`\`\`tsx
import * as React from "react"
import { Drawer as DrawerPrimitive } from "vaul"

import { cn } from "@/lib/utils"

const Drawer = ({
  shouldScaleBackground = true,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (
  <DrawerPrimitive.Root
    shouldScaleBackground={shouldScaleBackground}
    {...props}
  />
)
Drawer.displayName = "Drawer"

const DrawerTrigger = DrawerPrimitive.Trigger

const DrawerPortal = DrawerPrimitive.Portal

const DrawerClose = DrawerPrimitive.Close

const DrawerOverlay = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Overlay
    ref={ref}
    className={cn("fixed inset-0 z-50 bg-black/80", className)}
    {...props}
  />
))
DrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName

const DrawerContent = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DrawerPortal>
    <DrawerOverlay />
    <DrawerPrimitive.Content
      ref={ref}
      className={cn(
        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",
        className
      )}
      {...props}
    >
      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted" />
      {children}
    </DrawerPrimitive.Content>
  </DrawerPortal>
))
DrawerContent.displayName = "DrawerContent"

const DrawerHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}
    {...props}
  />
)
DrawerHeader.displayName = "DrawerHeader"

const DrawerFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("mt-auto flex flex-col gap-2 p-4", className)}
    {...props}
  />
)
DrawerFooter.displayName = "DrawerFooter"

const DrawerTitle = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DrawerTitle.displayName = DrawerPrimitive.Title.displayName

const DrawerDescription = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DrawerDescription.displayName = DrawerPrimitive.Description.displayName

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}

\`\`\`

# src\components\ui\dropdown-menu.tsx

\`\`\`tsx
import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const DropdownMenu = DropdownMenuPrimitive.Root

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger

const DropdownMenuGroup = DropdownMenuPrimitive.Group

const DropdownMenuPortal = DropdownMenuPrimitive.Portal

const DropdownMenuSub = DropdownMenuPrimitive.Sub

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </DropdownMenuPrimitive.SubTrigger>
))
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
))
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
))
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  )
}
DropdownMenuShortcut.displayName = "DropdownMenuShortcut"

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
}

\`\`\`

# src\components\ui\form.tsx

\`\`\`tsx
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  ControllerProps,
  FieldPath,
  FieldValues,
  FormProvider,
  useFormContext,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState, formState } = useFormContext()

  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn("space-y-2", className)} {...props} />
    </FormItemContext.Provider>
  )
})
FormItem.displayName = "FormItem"

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField()

  return (
    <Label
      ref={ref}
      className={cn(error && "text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
})
FormLabel.displayName = "FormLabel"

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
})
FormControl.displayName = "FormControl"

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField()

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn("text-sm text-muted-foreground", className)}
      {...props}
    />
  )
})
FormDescription.displayName = "FormDescription"

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message) : children

  if (!body) {
    return null
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn("text-sm font-medium text-destructive", className)}
      {...props}
    >
      {body}
    </p>
  )
})
FormMessage.displayName = "FormMessage"

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}

\`\`\`

# src\components\ui\hover-card.tsx

\`\`\`tsx
import * as React from "react"
import * as HoverCardPrimitive from "@radix-ui/react-hover-card"

import { cn } from "@/lib/utils"

const HoverCard = HoverCardPrimitive.Root

const HoverCardTrigger = HoverCardPrimitive.Trigger

const HoverCardContent = React.forwardRef<
  React.ElementRef<typeof HoverCardPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <HoverCardPrimitive.Content
    ref={ref}
    align={align}
    sideOffset={sideOffset}
    className={cn(
      "z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
HoverCardContent.displayName = HoverCardPrimitive.Content.displayName

export { HoverCard, HoverCardTrigger, HoverCardContent }

\`\`\`

# src\components\ui\input-otp.tsx

\`\`\`tsx
import * as React from "react"
import { OTPInput, OTPInputContext } from "input-otp"
import { Dot } from "lucide-react"

import { cn } from "@/lib/utils"

const InputOTP = React.forwardRef<
  React.ElementRef<typeof OTPInput>,
  React.ComponentPropsWithoutRef<typeof OTPInput>
>(({ className, containerClassName, ...props }, ref) => (
  <OTPInput
    ref={ref}
    containerClassName={cn(
      "flex items-center gap-2 has-[:disabled]:opacity-50",
      containerClassName
    )}
    className={cn("disabled:cursor-not-allowed", className)}
    {...props}
  />
))
InputOTP.displayName = "InputOTP"

const InputOTPGroup = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("flex items-center", className)} {...props} />
))
InputOTPGroup.displayName = "InputOTPGroup"

const InputOTPSlot = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div"> & { index: number }
>(({ index, className, ...props }, ref) => {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]

  return (
    <div
      ref={ref}
      className={cn(
        "relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",
        isActive && "z-10 ring-2 ring-ring ring-offset-background",
        className
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="h-4 w-px animate-caret-blink bg-foreground duration-1000" />
        </div>
      )}
    </div>
  )
})
InputOTPSlot.displayName = "InputOTPSlot"

const InputOTPSeparator = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ ...props }, ref) => (
  <div ref={ref} role="separator" {...props}>
    <Dot />
  </div>
))
InputOTPSeparator.displayName = "InputOTPSeparator"

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }

\`\`\`

# src\components\ui\input.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }

\`\`\`

# src\components\ui\label.tsx

\`\`\`tsx
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }

\`\`\`

# src\components\ui\menubar.tsx

\`\`\`tsx
import * as React from "react"
import * as MenubarPrimitive from "@radix-ui/react-menubar"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const MenubarMenu = MenubarPrimitive.Menu

const MenubarGroup = MenubarPrimitive.Group

const MenubarPortal = MenubarPrimitive.Portal

const MenubarSub = MenubarPrimitive.Sub

const MenubarRadioGroup = MenubarPrimitive.RadioGroup

const Menubar = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Root
    ref={ref}
    className={cn(
      "flex h-10 items-center space-x-1 rounded-md border bg-background p-1",
      className
    )}
    {...props}
  />
))
Menubar.displayName = MenubarPrimitive.Root.displayName

const MenubarTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      className
    )}
    {...props}
  />
))
MenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName

const MenubarSubTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <MenubarPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </MenubarPrimitive.SubTrigger>
))
MenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName

const MenubarSubContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
MenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName

const MenubarContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>
>(
  (
    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },
    ref
  ) => (
    <MenubarPrimitive.Portal>
      <MenubarPrimitive.Content
        ref={ref}
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
          className
        )}
        {...props}
      />
    </MenubarPrimitive.Portal>
  )
)
MenubarContent.displayName = MenubarPrimitive.Content.displayName

const MenubarItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarItem.displayName = MenubarPrimitive.Item.displayName

const MenubarCheckboxItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <MenubarPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.CheckboxItem>
))
MenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName

const MenubarRadioItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <MenubarPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.RadioItem>
))
MenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName

const MenubarLabel = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarLabel.displayName = MenubarPrimitive.Label.displayName

const MenubarSeparator = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
MenubarSeparator.displayName = MenubarPrimitive.Separator.displayName

const MenubarShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
MenubarShortcut.displayname = "MenubarShortcut"

export {
  Menubar,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarItem,
  MenubarSeparator,
  MenubarLabel,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarPortal,
  MenubarSubContent,
  MenubarSubTrigger,
  MenubarGroup,
  MenubarSub,
  MenubarShortcut,
}

\`\`\`

# src\components\ui\navigation-menu.tsx

\`\`\`tsx
import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const NavigationMenu = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Root
    ref={ref}
    className={cn(
      "relative z-10 flex max-w-max flex-1 items-center justify-center",
      className
    )}
    {...props}
  >
    {children}
    <NavigationMenuViewport />
  </NavigationMenuPrimitive.Root>
))
NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName

const NavigationMenuList = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.List
    ref={ref}
    className={cn(
      "group flex flex-1 list-none items-center justify-center space-x-1",
      className
    )}
    {...props}
  />
))
NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName

const NavigationMenuItem = NavigationMenuPrimitive.Item

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50"
)

const NavigationMenuTrigger = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Trigger
    ref={ref}
    className={cn(navigationMenuTriggerStyle(), "group", className)}
    {...props}
  >
    {children}{" "}
    <ChevronDown
      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"
      aria-hidden="true"
    />
  </NavigationMenuPrimitive.Trigger>
))
NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName

const NavigationMenuContent = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Content
    ref={ref}
    className={cn(
      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",
      className
    )}
    {...props}
  />
))
NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName

const NavigationMenuLink = NavigationMenuPrimitive.Link

const NavigationMenuViewport = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
>(({ className, ...props }, ref) => (
  <div className={cn("absolute left-0 top-full flex justify-center")}>
    <NavigationMenuPrimitive.Viewport
      className={cn(
        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",
        className
      )}
      ref={ref}
      {...props}
    />
  </div>
))
NavigationMenuViewport.displayName =
  NavigationMenuPrimitive.Viewport.displayName

const NavigationMenuIndicator = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Indicator
    ref={ref}
    className={cn(
      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",
      className
    )}
    {...props}
  >
    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md" />
  </NavigationMenuPrimitive.Indicator>
))
NavigationMenuIndicator.displayName =
  NavigationMenuPrimitive.Indicator.displayName

export {
  navigationMenuTriggerStyle,
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
}

\`\`\`

# src\components\ui\pagination.tsx

\`\`\`tsx
import * as React from "react"
import { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"
import { ButtonProps, buttonVariants } from "@/components/ui/button"

const Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn("mx-auto flex w-full justify-center", className)}
    {...props}
  />
)
Pagination.displayName = "Pagination"

const PaginationContent = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    className={cn("flex flex-row items-center gap-1", className)}
    {...props}
  />
))
PaginationContent.displayName = "PaginationContent"

const PaginationItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li ref={ref} className={cn("", className)} {...props} />
))
PaginationItem.displayName = "PaginationItem"

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<ButtonProps, "size"> &
  React.ComponentProps<"a">

const PaginationLink = ({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) => (
  <a
    aria-current={isActive ? "page" : undefined}
    className={cn(
      buttonVariants({
        variant: isActive ? "outline" : "ghost",
        size,
      }),
      className
    )}
    {...props}
  />
)
PaginationLink.displayName = "PaginationLink"

const PaginationPrevious = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to previous page"
    size="default"
    className={cn("gap-1 pl-2.5", className)}
    {...props}
  >
    <ChevronLeft className="h-4 w-4" />
    <span>Previous</span>
  </PaginationLink>
)
PaginationPrevious.displayName = "PaginationPrevious"

const PaginationNext = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to next page"
    size="default"
    className={cn("gap-1 pr-2.5", className)}
    {...props}
  >
    <span>Next</span>
    <ChevronRight className="h-4 w-4" />
  </PaginationLink>
)
PaginationNext.displayName = "PaginationNext"

const PaginationEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    aria-hidden
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More pages</span>
  </span>
)
PaginationEllipsis.displayName = "PaginationEllipsis"

export {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
}

\`\`\`

# src\components\ui\popover.tsx

\`\`\`tsx
import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

const Popover = PopoverPrimitive.Root

const PopoverTrigger = PopoverPrimitive.Trigger

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
))
PopoverContent.displayName = PopoverPrimitive.Content.displayName

export { Popover, PopoverTrigger, PopoverContent }

\`\`\`

# src\components\ui\progress.tsx

\`\`\`tsx

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

interface ProgressProps extends React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root> {
  indicatorClassName?: string;
}

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  ProgressProps
>(({ className, value, indicatorClassName, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-4 w-full overflow-hidden rounded-full bg-secondary",
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className={cn(
        "h-full w-full flex-1 bg-primary transition-all",
        indicatorClassName
      )}
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }

\`\`\`

# src\components\ui\radio-group.tsx

\`\`\`tsx
import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Root
      className={cn("grid gap-2", className)}
      {...props}
      ref={ref}
    />
  )
})
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
})
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName

export { RadioGroup, RadioGroupItem }

\`\`\`

# src\components\ui\resizable.tsx

\`\`\`tsx
import { GripVertical } from "lucide-react"
import * as ResizablePrimitive from "react-resizable-panels"

import { cn } from "@/lib/utils"

const ResizablePanelGroup = ({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (
  <ResizablePrimitive.PanelGroup
    className={cn(
      "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
      className
    )}
    {...props}
  />
)

const ResizablePanel = ResizablePrimitive.Panel

const ResizableHandle = ({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) => (
  <ResizablePrimitive.PanelResizeHandle
    className={cn(
      "relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
      className
    )}
    {...props}
  >
    {withHandle && (
      <div className="z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border">
        <GripVertical className="h-2.5 w-2.5" />
      </div>
    )}
  </ResizablePrimitive.PanelResizeHandle>
)

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }

\`\`\`

# src\components\ui\scroll-area.tsx

\`\`\`tsx
import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root
    ref={ref}
    className={cn("relative overflow-hidden", className)}
    {...props}
  >
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">
      {children}
    </ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
))
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName

const ScrollBar = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
>(({ className, orientation = "vertical", ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      "flex touch-none select-none transition-colors",
      orientation === "vertical" &&
        "h-full w-2.5 border-l border-l-transparent p-[1px]",
      orientation === "horizontal" &&
        "h-2.5 flex-col border-t border-t-transparent p-[1px]",
      className
    )}
    {...props}
  >
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
))
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName

export { ScrollArea, ScrollBar }

\`\`\`

# src\components\ui\select.tsx

\`\`\`tsx
import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}

\`\`\`

# src\components\ui\separator.tsx

\`\`\`tsx
import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }

\`\`\`

# src\components\ui\sheet.tsx

\`\`\`tsx
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"
import * as React from "react"

import { cn } from "@/lib/utils"

const Sheet = SheetPrimitive.Root

const SheetTrigger = SheetPrimitive.Trigger

const SheetClose = SheetPrimitive.Close

const SheetPortal = SheetPrimitive.Portal

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName

const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom:
          "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right:
          "inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
)

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
  VariantProps<typeof sheetVariants> { }

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(({ side = "right", className, children, ...props }, ref) => (
  <SheetPortal>
    <SheetOverlay />
    <SheetPrimitive.Content
      ref={ref}
      className={cn(sheetVariants({ side }), className)}
      {...props}
    >
      {children}
      <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </SheetPrimitive.Close>
    </SheetPrimitive.Content>
  </SheetPortal>
))
SheetContent.displayName = SheetPrimitive.Content.displayName

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
SheetHeader.displayName = "SheetHeader"

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
SheetFooter.displayName = "SheetFooter"

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold text-foreground", className)}
    {...props}
  />
))
SheetTitle.displayName = SheetPrimitive.Title.displayName

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
SheetDescription.displayName = SheetPrimitive.Description.displayName

export {
  Sheet, SheetClose,
  SheetContent, SheetDescription, SheetFooter, SheetHeader, SheetOverlay, SheetPortal, SheetTitle, SheetTrigger
}


\`\`\`

# src\components\ui\sidebar.tsx

\`\`\`tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { VariantProps, cva } from "class-variance-authority"
import { PanelLeft } from "lucide-react"

import { useIsMobile } from "@/hooks/use-mobile"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Separator } from "@/components/ui/separator"
import { Sheet, SheetContent } from "@/components/ui/sheet"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip"

const SIDEBAR_COOKIE_NAME = "sidebar:state"
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = "16rem"
const SIDEBAR_WIDTH_MOBILE = "18rem"
const SIDEBAR_WIDTH_ICON = "3rem"
const SIDEBAR_KEYBOARD_SHORTCUT = "b"

type SidebarContext = {
  state: "expanded" | "collapsed"
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContext | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.")
  }

  return context
}

const SidebarProvider = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    defaultOpen?: boolean
    open?: boolean
    onOpenChange?: (open: boolean) => void
  }
>(
  (
    {
      defaultOpen = true,
      open: openProp,
      onOpenChange: setOpenProp,
      className,
      style,
      children,
      ...props
    },
    ref
  ) => {
    const isMobile = useIsMobile()
    const [openMobile, setOpenMobile] = React.useState(false)

    // This is the internal state of the sidebar.
    // We use openProp and setOpenProp for control from outside the component.
    const [_open, _setOpen] = React.useState(defaultOpen)
    const open = openProp ?? _open
    const setOpen = React.useCallback(
      (value: boolean | ((value: boolean) => boolean)) => {
        const openState = typeof value === "function" ? value(open) : value
        if (setOpenProp) {
          setOpenProp(openState)
        } else {
          _setOpen(openState)
        }

        // This sets the cookie to keep the sidebar state.
        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
      },
      [setOpenProp, open]
    )

    // Helper to toggle the sidebar.
    const toggleSidebar = React.useCallback(() => {
      return isMobile
        ? setOpenMobile((open) => !open)
        : setOpen((open) => !open)
    }, [isMobile, setOpen, setOpenMobile])

    // Adds a keyboard shortcut to toggle the sidebar.
    React.useEffect(() => {
      const handleKeyDown = (event: KeyboardEvent) => {
        if (
          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
          (event.metaKey || event.ctrlKey)
        ) {
          event.preventDefault()
          toggleSidebar()
        }
      }

      window.addEventListener("keydown", handleKeyDown)
      return () => window.removeEventListener("keydown", handleKeyDown)
    }, [toggleSidebar])

    // We add a state so that we can do data-state="expanded" or "collapsed".
    // This makes it easier to style the sidebar with Tailwind classes.
    const state = open ? "expanded" : "collapsed"

    const contextValue = React.useMemo<SidebarContext>(
      () => ({
        state,
        open,
        setOpen,
        isMobile,
        openMobile,
        setOpenMobile,
        toggleSidebar,
      }),
      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]
    )

    return (
      <SidebarContext.Provider value={contextValue}>
        <TooltipProvider delayDuration={0}>
          <div
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH,
                "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
                ...style,
              } as React.CSSProperties
            }
            className={cn(
              "group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",
              className
            )}
            ref={ref}
            {...props}
          >
            {children}
          </div>
        </TooltipProvider>
      </SidebarContext.Provider>
    )
  }
)
SidebarProvider.displayName = "SidebarProvider"

const Sidebar = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    side?: "left" | "right"
    variant?: "sidebar" | "floating" | "inset"
    collapsible?: "offcanvas" | "icon" | "none"
  }
>(
  (
    {
      side = "left",
      variant = "sidebar",
      collapsible = "offcanvas",
      className,
      children,
      ...props
    },
    ref
  ) => {
    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

    if (collapsible === "none") {
      return (
        <div
          className={cn(
            "flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",
            className
          )}
          ref={ref}
          {...props}
        >
          {children}
        </div>
      )
    }

    if (isMobile) {
      return (
        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
          <SheetContent
            data-sidebar="sidebar"
            data-mobile="true"
            className="w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden"
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
              } as React.CSSProperties
            }
            side={side}
          >
            <div className="flex h-full w-full flex-col">{children}</div>
          </SheetContent>
        </Sheet>
      )
    }

    return (
      <div
        ref={ref}
        className="group peer hidden md:block text-sidebar-foreground"
        data-state={state}
        data-collapsible={state === "collapsed" ? collapsible : ""}
        data-variant={variant}
        data-side={side}
      >
        {/* This is what handles the sidebar gap on desktop */}
        <div
          className={cn(
            "duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear",
            "group-data-[collapsible=offcanvas]:w-0",
            "group-data-[side=right]:rotate-180",
            variant === "floating" || variant === "inset"
              ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon]"
          )}
        />
        <div
          className={cn(
            "duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",
            side === "left"
              ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
              : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
            // Adjust the padding for floating and inset variants.
            variant === "floating" || variant === "inset"
              ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",
            className
          )}
          {...props}
        >
          <div
            data-sidebar="sidebar"
            className="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"
          >
            {children}
          </div>
        </div>
      </div>
    )
  }
)
Sidebar.displayName = "Sidebar"

const SidebarTrigger = React.forwardRef<
  React.ElementRef<typeof Button>,
  React.ComponentProps<typeof Button>
>(({ className, onClick, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      ref={ref}
      data-sidebar="trigger"
      variant="ghost"
      size="icon"
      className={cn("h-7 w-7", className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeft />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
})
SidebarTrigger.displayName = "SidebarTrigger"

const SidebarRail = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button">
>(({ className, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      ref={ref}
      data-sidebar="rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex",
        "[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className
      )}
      {...props}
    />
  )
})
SidebarRail.displayName = "SidebarRail"

const SidebarInset = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"main">
>(({ className, ...props }, ref) => {
  return (
    <main
      ref={ref}
      className={cn(
        "relative flex min-h-svh flex-1 flex-col bg-background",
        "peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",
        className
      )}
      {...props}
    />
  )
})
SidebarInset.displayName = "SidebarInset"

const SidebarInput = React.forwardRef<
  React.ElementRef<typeof Input>,
  React.ComponentProps<typeof Input>
>(({ className, ...props }, ref) => {
  return (
    <Input
      ref={ref}
      data-sidebar="input"
      className={cn(
        "h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",
        className
      )}
      {...props}
    />
  )
})
SidebarInput.displayName = "SidebarInput"

const SidebarHeader = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarHeader.displayName = "SidebarHeader"

const SidebarFooter = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarFooter.displayName = "SidebarFooter"

const SidebarSeparator = React.forwardRef<
  React.ElementRef<typeof Separator>,
  React.ComponentProps<typeof Separator>
>(({ className, ...props }, ref) => {
  return (
    <Separator
      ref={ref}
      data-sidebar="separator"
      className={cn("mx-2 w-auto bg-sidebar-border", className)}
      {...props}
    />
  )
})
SidebarSeparator.displayName = "SidebarSeparator"

const SidebarContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarContent.displayName = "SidebarContent"

const SidebarGroup = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  )
})
SidebarGroup.displayName = "SidebarGroup"

const SidebarGroupLabel = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "div"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-label"
      className={cn(
        "duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupLabel.displayName = "SidebarGroupLabel"

const SidebarGroupAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-action"
      className={cn(
        "absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupAction.displayName = "SidebarGroupAction"

const SidebarGroupContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="group-content"
    className={cn("w-full text-sm", className)}
    {...props}
  />
))
SidebarGroupContent.displayName = "SidebarGroupContent"

const SidebarMenu = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu"
    className={cn("flex w-full min-w-0 flex-col gap-1", className)}
    {...props}
  />
))
SidebarMenu.displayName = "SidebarMenu"

const SidebarMenuItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    data-sidebar="menu-item"
    className={cn("group/menu-item relative", className)}
    {...props}
  />
))
SidebarMenuItem.displayName = "SidebarMenuItem"

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:!p-0",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const SidebarMenuButton = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    isActive?: boolean
    tooltip?: string | React.ComponentProps<typeof TooltipContent>
  } & VariantProps<typeof sidebarMenuButtonVariants>
>(
  (
    {
      asChild = false,
      isActive = false,
      variant = "default",
      size = "default",
      tooltip,
      className,
      ...props
    },
    ref
  ) => {
    const Comp = asChild ? Slot : "button"
    const { isMobile, state } = useSidebar()

    const button = (
      <Comp
        ref={ref}
        data-sidebar="menu-button"
        data-size={size}
        data-active={isActive}
        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
        {...props}
      />
    )

    if (!tooltip) {
      return button
    }

    if (typeof tooltip === "string") {
      tooltip = {
        children: tooltip,
      }
    }

    return (
      <Tooltip>
        <TooltipTrigger asChild>{button}</TooltipTrigger>
        <TooltipContent
          side="right"
          align="center"
          hidden={state !== "collapsed" || isMobile}
          {...tooltip}
        />
      </Tooltip>
    )
  }
)
SidebarMenuButton.displayName = "SidebarMenuButton"

const SidebarMenuAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    showOnHover?: boolean
  }
>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-action"
      className={cn(
        "absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuAction.displayName = "SidebarMenuAction"

const SidebarMenuBadge = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="menu-badge"
    className={cn(
      "absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none",
      "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
      "peer-data-[size=sm]/menu-button:top-1",
      "peer-data-[size=default]/menu-button:top-1.5",
      "peer-data-[size=lg]/menu-button:top-2.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuBadge.displayName = "SidebarMenuBadge"

const SidebarMenuSkeleton = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    showIcon?: boolean
  }
>(({ className, showIcon = false, ...props }, ref) => {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      ref={ref}
      data-sidebar="menu-skeleton"
      className={cn("rounded-md h-8 flex gap-2 px-2 items-center", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 flex-1 max-w-[--skeleton-width]"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  )
})
SidebarMenuSkeleton.displayName = "SidebarMenuSkeleton"

const SidebarMenuSub = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu-sub"
    className={cn(
      "mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuSub.displayName = "SidebarMenuSub"

const SidebarMenuSubItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ ...props }, ref) => <li ref={ref} {...props} />)
SidebarMenuSubItem.displayName = "SidebarMenuSubItem"

const SidebarMenuSubButton = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentProps<"a"> & {
    asChild?: boolean
    size?: "sm" | "md"
    isActive?: boolean
  }
>(({ asChild = false, size = "md", isActive, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuSubButton.displayName = "SidebarMenuSubButton"

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}

\`\`\`

# src\components\ui\skeleton.tsx

\`\`\`tsx
import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      {...props}
    />
  )
}

export { Skeleton }

\`\`\`

# src\components\ui\slider.tsx

\`\`\`tsx
import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

const Slider = React.forwardRef<
  React.ElementRef<typeof SliderPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
>(({ className, ...props }, ref) => (
  <SliderPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex w-full touch-none select-none items-center",
      className
    )}
    {...props}
  >
    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-secondary">
      <SliderPrimitive.Range className="absolute h-full bg-primary" />
    </SliderPrimitive.Track>
    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
  </SliderPrimitive.Root>
))
Slider.displayName = SliderPrimitive.Root.displayName

export { Slider }

\`\`\`

# src\components\ui\sonner.tsx

\`\`\`tsx
import { useTheme } from "next-themes"
import { Toaster as Sonner, toast } from "sonner"

type ToasterProps = React.ComponentProps<typeof Sonner>

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      toastOptions={{
        classNames: {
          toast:
            "group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",
          description: "group-[.toast]:text-muted-foreground",
          actionButton:
            "group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",
          cancelButton:
            "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",
        },
      }}
      {...props}
    />
  )
}

export { Toaster, toast }

\`\`\`

# src\components\ui\switch.tsx

\`\`\`tsx
import * as React from "react"
import * as SwitchPrimitives from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

const Switch = React.forwardRef<
  React.ElementRef<typeof SwitchPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
>(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
      className
    )}
    {...props}
    ref={ref}
  >
    <SwitchPrimitives.Thumb
      className={cn(
        "pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"
      )}
    />
  </SwitchPrimitives.Root>
))
Switch.displayName = SwitchPrimitives.Root.displayName

export { Switch }

\`\`\`

# src\components\ui\table.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props}
    />
  </div>
))
Table.displayName = "Table"

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
))
TableHeader.displayName = "TableHeader"

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props}
  />
))
TableBody.displayName = "TableBody"

const TableFooter = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn(
      "border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",
      className
    )}
    {...props}
  />
))
TableFooter.displayName = "TableFooter"

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    )}
    {...props}
  />
))
TableRow.displayName = "TableRow"

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
      className
    )}
    {...props}
  />
))
TableHead.displayName = "TableHead"

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}
    {...props}
  />
))
TableCell.displayName = "TableCell"

const TableCaption = React.forwardRef<
  HTMLTableCaptionElement,
  React.HTMLAttributes<HTMLTableCaptionElement>
>(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn("mt-4 text-sm text-muted-foreground", className)}
    {...props}
  />
))
TableCaption.displayName = "TableCaption"

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}

\`\`\`

# src\components\ui\tabs.tsx

\`\`\`tsx
import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }

\`\`\`

# src\components\ui\textarea.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

export interface TextareaProps
  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}

const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, ...props }, ref) => {
    return (
      <textarea
        className={cn(
          "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Textarea.displayName = "Textarea"

export { Textarea }

\`\`\`

# src\components\ui\toast.tsx

\`\`\`tsx
import * as React from "react"
import * as ToastPrimitives from "@radix-ui/react-toast"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
      className
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
  {
    variants: {
      variant: {
        default: "border bg-background text-foreground",
        destructive:
          "destructive group border-destructive bg-destructive text-destructive-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
      className
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      "absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
      className
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn("text-sm font-semibold", className)}
    {...props}
  />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn("text-sm opacity-90", className)}
    {...props}
  />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}

\`\`\`

# src\components\ui\toaster.tsx

\`\`\`tsx
import { useToast } from "@/hooks/use-toast"
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from "@/components/ui/toast"

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}

\`\`\`

# src\components\ui\toggle-group.tsx

\`\`\`tsx
import * as React from "react"
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"
import { type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { toggleVariants } from "@/components/ui/toggle"

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
})

const ToggleGroup = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, children, ...props }, ref) => (
  <ToggleGroupPrimitive.Root
    ref={ref}
    className={cn("flex items-center justify-center gap-1", className)}
    {...props}
  >
    <ToggleGroupContext.Provider value={{ variant, size }}>
      {children}
    </ToggleGroupContext.Provider>
  </ToggleGroupPrimitive.Root>
))

ToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName

const ToggleGroupItem = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &
    VariantProps<typeof toggleVariants>
>(({ className, children, variant, size, ...props }, ref) => {
  const context = React.useContext(ToggleGroupContext)

  return (
    <ToggleGroupPrimitive.Item
      ref={ref}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        className
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  )
})

ToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName

export { ToggleGroup, ToggleGroupItem }

\`\`\`

# src\components\ui\toggle.tsx

\`\`\`tsx
import * as React from "react"
import * as TogglePrimitive from "@radix-ui/react-toggle"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const toggleVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-10 px-3",
        sm: "h-9 px-2.5",
        lg: "h-11 px-5",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const Toggle = React.forwardRef<
  React.ElementRef<typeof TogglePrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, ...props }, ref) => (
  <TogglePrimitive.Root
    ref={ref}
    className={cn(toggleVariants({ variant, size, className }))}
    {...props}
  />
))

Toggle.displayName = TogglePrimitive.Root.displayName

export { Toggle, toggleVariants }

\`\`\`

# src\components\ui\tooltip.tsx

\`\`\`tsx
import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }

\`\`\`

# src\components\ui\use-toast.ts

\`\`\`ts
import { useToast, toast } from "@/hooks/use-toast";

export { useToast, toast };

\`\`\`

# src\hooks\use-mobile.tsx

\`\`\`tsx
import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}

\`\`\`

# src\hooks\use-toast.ts

\`\`\`ts
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }

\`\`\`

# src\index.css

\`\`\`css

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 240 10% 14%;

    --card: 0 0% 100%;
    --card-foreground: 240 10% 14%;

    --popover: 0 0% 100%;
    --popover-foreground: 240 10% 14%;

    --primary: 52 100% 50%;
    --primary-foreground: 0 0% 0%;

    --secondary: 0 0% 96%;
    --secondary-foreground: 240 10% 14%;

    --muted: 240 5% 96%;
    --muted-foreground: 240 3.8% 46.1%;

    --accent: 0 0% 96%;
    --accent-foreground: 240 10% 14%;

    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 100%;

    --border: 240 5.9% 90%;
    --input: 240 5.9% 90%;
    --ring: 52 100% 50%;

    --radius: 0.5rem;

    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }

  .dark {
    --background: 0 0% 28%; /* #474747 - Outer Space */
    --foreground: 0 0% 98%;

    --card: 0 0% 28%;
    --card-foreground: 0 0% 98%;

    --popover: 0 0% 28%;
    --popover-foreground: 0 0% 98%;

    --primary: 52 100% 50%;
    --primary-foreground: 0 0% 0%;

    --secondary: 240 3.7% 15.9%;
    --secondary-foreground: 0 0% 98%;

    --muted: 240 3.7% 15.9%;
    --muted-foreground: 240 5% 64.9%;

    --accent: 240 3.7% 15.9%;
    --accent-foreground: 0 0% 98%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;

    --border: 240 3.7% 15.9%;
    --input: 240 3.7% 15.9%;
    --ring: 52 100% 50%;
    
    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
  }
  
  /* Apply dark mode universally to ensure all elements get the dark background */
  .dark body,
  .dark .bg-white {
    @apply bg-[#474747];
  }
  
  /* Make buttons yellow with black text in dark mode - fixed to avoid circular dependency */
  .dark button[data-state="active"] {
    background-color: #FFE600;
    color: black;
  }
  
  .dark .bg-yellow-400 {
    background-color: #FFE600;
    color: black;
  }
  
  /* Ensure yellow backgrounds always use black text for contrast */
  .bg-yellow-50, 
  .bg-yellow-100, 
  .bg-yellow-200, 
  .bg-yellow-300, 
  .bg-yellow-400, 
  .bg-yellow-500 {
    color: black;
  }
}

@layer components {
  .ey-button {
    @apply bg-ey-yellow hover:bg-ey-yellow/90 text-ey-black font-semibold py-2 px-4 rounded-md transition-colors;
  }
  
  .ey-input {
    @apply border border-ey-gray-400 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-ey-yellow;
  }

  .ey-card {
    @apply bg-white rounded-lg shadow-md p-6 border border-ey-gray-300 hover:shadow-lg transition-shadow dark:bg-background dark:border-ey-gray-700;
  }
}

\`\`\`

# src\lib\excelUtils.ts

\`\`\`ts

import * as XLSX from 'xlsx';
import { PromptOption } from './types';

// Parse Excel file and extract prompts
export const parseExcelPrompts = async (file: File): Promise<PromptOption[]> => {
  try {
    // Read the Excel file
    const data = await file.arrayBuffer();
    const workbook = XLSX.read(data);
    
    // Get the first worksheet
    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
    
    // Convert the worksheet to JSON
    const jsonData = XLSX.utils.sheet_to_json(worksheet);
    
    // Map the JSON data to PromptOption format
    const prompts: PromptOption[] = jsonData.map((row: any, index) => {
      return {
        id: `custom-${index}`,
        name: row['Prompt Name'] || row['Name'] || `Custom Prompt ${index + 1}`,
        description: row['Description'] || 'Custom prompt from Excel file',
        template: row['Template'] || 'Custom_Template',
        category: row['Category'] || 'Custom'
      };
    });
    
    return prompts;
  } catch (error) {
    console.error('Error parsing Excel file:', error);
    throw new Error('Failed to parse Excel file. Please check the format.');
  }
};

// Generate more realistic extraction results based on prompts
export const generateRealisticResults = (promptName: string) => {
  // Create more realistic data based on prompt name/type
  switch (promptName.toLowerCase()) {
    case 'ecl by stage':
      return [
        { Category: "ECL by Stage", Stage: "Stage 1", Field: "Gross Carrying Amount", Value: "$1,245.67m" },
        { Category: "ECL by Stage", Stage: "Stage 1", Field: "Loss Allowance", Value: "$12.45m" },
        { Category: "ECL by Stage", Stage: "Stage 1", Field: "Coverage Ratio", Value: "1.00%" },
        { Category: "ECL by Stage", Stage: "Stage 2", Field: "Gross Carrying Amount", Value: "$428.91m" },
        { Category: "ECL by Stage", Stage: "Stage 2", Field: "Loss Allowance", Value: "$21.45m" },
        { Category: "ECL by Stage", Stage: "Stage 2", Field: "Coverage Ratio", Value: "5.00%" },
        { Category: "ECL by Stage", Stage: "Stage 3", Field: "Gross Carrying Amount", Value: "$85.34m" },
        { Category: "ECL by Stage", Stage: "Stage 3", Field: "Loss Allowance", Value: "$42.67m" },
        { Category: "ECL by Stage", Stage: "Stage 3", Field: "Coverage Ratio", Value: "50.00%" }
      ];
    case 'management adjustments':
      return [
        { Category: "Management Adjustments", Stage: "N/A", Field: "Economic Uncertainty", Value: "$24.5m" },
        { Category: "Management Adjustments", Stage: "N/A", Field: "Model Limitations", Value: "$12.3m" },
        { Category: "Management Adjustments", Stage: "N/A", Field: "Other Adjustments", Value: "$5.8m" },
        { Category: "Management Adjustments", Stage: "N/A", Field: "Total Overlays", Value: "$42.6m" }
      ];
    case 'scenario weights':
      return [
        { Category: "Scenario Weights", Stage: "N/A", Field: "Baseline", Value: "40%" },
        { Category: "Scenario Weights", Stage: "N/A", Field: "Upside", Value: "30%" },
        { Category: "Scenario Weights", Stage: "N/A", Field: "Downside", Value: "30%" }
      ];
    case 'macro variables':
      return [
        { Category: "Macro Variables", Stage: "Baseline", Field: "GDP Growth", Value: "1.3%" },
        { Category: "Macro Variables", Stage: "Baseline", Field: "Unemployment", Value: "4.2%" },
        { Category: "Macro Variables", Stage: "Baseline", Field: "HPI Growth", Value: "1.8%" },
        { Category: "Macro Variables", Stage: "Upside", Field: "GDP Growth", Value: "2.5%" },
        { Category: "Macro Variables", Stage: "Upside", Field: "Unemployment", Value: "3.7%" },
        { Category: "Macro Variables", Stage: "Upside", Field: "HPI Growth", Value: "3.2%" },
        { Category: "Macro Variables", Stage: "Downside", Field: "GDP Growth", Value: "-0.5%" },
        { Category: "Macro Variables", Stage: "Downside", Field: "Unemployment", Value: "5.8%" },
        { Category: "Macro Variables", Stage: "Downside", Field: "HPI Growth", Value: "-2.1%" }
      ];
    default:
      return [
        { Category: promptName, Stage: "N/A", Field: "Value 1", Value: "$123.45m" },
        { Category: promptName, Stage: "N/A", Field: "Value 2", Value: "$67.89m" },
        { Category: promptName, Stage: "N/A", Field: "Ratio", Value: "55.00%" }
      ];
  }
};

\`\`\`

# src\lib\types.ts

\`\`\`ts

// Types for the financial data extraction app

export interface UploadedFile {
  id: string;
  name: string;
  size: number;
  type: string;
  lastModified: number;
  status: 'pending' | 'processing' | 'success' | 'error';
  progress?: number;
}

export interface PromptOption {
  id: string;
  name: string;
  description: string;
  template: string;
  category: string;
}

export interface ExtractedData {
  Category: string;
  Stage: string;
  Field: string;
  Value: string;
}

export interface ProcessingResult {
  id: string;
  fileId: string;
  fileName: string;
  promptId: string;
  promptName: string;
  status: 'pending' | 'processing' | 'success' | 'error';
  timestamp: string;
  data?: ExtractedData[];
  notes?: string;
  error?: string;
}

// Mock data for default prompts
export const DEFAULT_PROMPTS: PromptOption[] = [
  {
    id: 'ecl-by-stage',
    name: 'ECL By Stage',
    description: 'Extract Expected Credit Loss data broken down by stages',
    template: 'ECL_By_Stage',
    category: 'Credit Risk'
  },
  {
    id: 'management-adjustments',
    name: 'Management Adjustments',
    description: 'Extract information about management adjustments to ECL',
    template: 'Management_Adjustments',
    category: 'Credit Risk'
  },
  {
    id: 'scenario-weights',
    name: 'Scenario Weights',
    description: 'Extract economic scenario weightings',
    template: 'Scenario_Weights',
    category: 'Economic Scenarios'
  },
  {
    id: 'macro-variables',
    name: 'Macro Variables',
    description: 'Extract macroeconomic variables used in models',
    template: 'Macro_Variables',
    category: 'Economic Scenarios'
  },
  {
    id: 'credit-quality',
    name: 'Credit Quality',
    description: 'Extract credit quality indicators',
    template: 'Credit_Quality',
    category: 'Credit Risk'
  },
  {
    id: 'loan-loss-rate',
    name: 'Loan Loss Rate',
    description: 'Extract loan loss rate data',
    template: 'Loan_Loss_Rate',
    category: 'Credit Risk'
  },
  {
    id: 'staging-criteria',
    name: 'Staging Criteria',
    description: 'Extract criteria used for staging classification',
    template: 'Staging_Criteria',
    category: 'Methodology'
  },
  {
    id: 'sensitivity-analysis',
    name: 'Sensitivity Analysis',
    description: 'Extract sensitivity analysis results',
    template: 'Sensitivity_Analysis',
    category: 'Economic Scenarios'
  }
];

// Mock data for extracted results (for UI demonstration)
export const MOCK_EXTRACTED_DATA: ExtractedData[] = [
  { Category: 'ECL', Stage: 'Stage 1', Field: 'Retail Loans', Value: '125,000,000' },
  { Category: 'ECL', Stage: 'Stage 1', Field: 'Corporate Loans', Value: '372,500,000' },
  { Category: 'ECL', Stage: 'Stage 2', Field: 'Retail Loans', Value: '89,300,000' },
  { Category: 'ECL', Stage: 'Stage 2', Field: 'Corporate Loans', Value: '246,800,000' },
  { Category: 'ECL', Stage: 'Stage 3', Field: 'Retail Loans', Value: '43,200,000' },
  { Category: 'ECL', Stage: 'Stage 3', Field: 'Corporate Loans', Value: '118,500,000' },
  { Category: 'Summary', Stage: 'N/A', Field: 'Total ECL', Value: '995,300,000' },
  { Category: 'Summary', Stage: 'N/A', Field: 'Coverage Ratio', Value: '2.3%' }
];

\`\`\`

# src\lib\utils.ts

\`\`\`ts

import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

/**
 * Ensures proper text contrast on colored backgrounds
 * @param bgColor - The background color class (e.g., 'bg-yellow-400')
 * @returns string - The appropriate text color class
 */
export function getTextColorForBackground(bgColor: string): string {
  // Yellow backgrounds should always have black text
  if (
    bgColor.includes('yellow') || 
    bgColor.includes('lime') || 
    bgColor.includes('green-300') ||
    bgColor.includes('amber')
  ) {
    return 'text-black';
  }
  
  // Dark backgrounds should have white text
  if (
    bgColor.includes('black') || 
    bgColor.includes('gray-800') || 
    bgColor.includes('gray-900') ||
    bgColor.includes('slate-800') ||
    bgColor.includes('slate-900')
  ) {
    return 'text-white';
  }
  
  // Default - use the current text color
  return '';
}

\`\`\`

# src\main.tsx

\`\`\`tsx

import { createRoot } from 'react-dom/client'
import App from './App.tsx'
import './index.css'

// Create root and render app
createRoot(document.getElementById("root")!).render(<App />);

\`\`\`

# src\pages\BankSelection.tsx

\`\`\`tsx

import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Button } from '@/components/ui/button';
import { 
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue
} from '@/components/ui/select';
import { ArrowRight, Check } from 'lucide-react';
import { Checkbox } from '@/components/ui/checkbox';
import { Label } from '@/components/ui/label';

const banks = [
  { id: 'barclays', name: 'Barclays' },
  { id: 'hsbc', name: 'HSBC' },
  { id: 'lloyds', name: 'Lloyds Banking Group' },
  { id: 'natwest', name: 'NatWest Group' },
  { id: 'santander', name: 'Santander UK' },
  { id: 'standard', name: 'Standard Chartered' }
];

const BankSelection = () => {
  const navigate = useNavigate();
  const [selectedBank, setSelectedBank] = useState<string>('');
  const [selectedBanks, setSelectedBanks] = useState<string[]>([]);
  const [enableMultiBanks, setEnableMultiBanks] = useState<boolean>(false);

  // Update selected banks when toggling multi-bank mode
  useEffect(() => {
    if (enableMultiBanks) {
      // If switching to multi-bank mode, initialize with the current selection
      if (selectedBank && !selectedBanks.includes(selectedBank)) {
        setSelectedBanks([selectedBank]);
      }
    } else {
      // If switching to single bank mode, use the first selected bank or empty
      setSelectedBank(selectedBanks.length > 0 ? selectedBanks[0] : '');
    }
  }, [enableMultiBanks]);

  const handleContinue = () => {
    if ((enableMultiBanks && selectedBanks.length > 0) || (!enableMultiBanks && selectedBank)) {
      // Store the selected bank(s) in session storage for use across the application
      sessionStorage.setItem('selectedBank', enableMultiBanks ? selectedBanks[0] : selectedBank);
      sessionStorage.setItem('selectedBanks', JSON.stringify(enableMultiBanks ? selectedBanks : [selectedBank]));
      sessionStorage.setItem('enableMultiBanks', enableMultiBanks.toString());
      navigate('/dashboard');
    }
  };

  const toggleBankSelection = (bankId: string) => {
    setSelectedBanks(prevSelected => {
      if (prevSelected.includes(bankId)) {
        return prevSelected.filter(id => id !== bankId);
      } else {
        return [...prevSelected, bankId];
      }
    });
  };

  // Check if a bank is selected in multi-bank mode
  const isBankSelected = (bankId: string) => {
    return selectedBanks.includes(bankId);
  };

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-ey-black text-white">
      <div className="w-full max-w-md px-6 py-12 text-center">
        <div className="mb-8">
          <div className="flex justify-center mb-6">
            <div className="h-16 w-16 bg-ey-yellow rounded-md"></div>
          </div>
          
          <h1 className="text-4xl font-bold mb-2">AiDEx</h1>
          <p className="text-ey-gray-400">
            AI powered Data Extraction
          </p>
          <p className="text-ey-gray-500 text-sm mt-1">
            Supported by EYQ
          </p>
        </div>
        
        <div className="border border-ey-gray-700 rounded-lg p-6 mb-8">
          <h2 className="text-xl font-semibold mb-6">Select Bank</h2>
          <p className="text-sm text-ey-gray-400 mb-6">
            Choose the bank you want to analyze for data extraction.
          </p>
          
          <div className="space-y-4">
            <div className="flex items-center space-x-3 mt-4 mb-4 p-3 bg-ey-gray-800/50 rounded-md">
              <Checkbox 
                id="enableMultiBanks" 
                checked={enableMultiBanks} 
                onCheckedChange={(checked) => setEnableMultiBanks(checked as boolean)}
                className="data-[state=checked]:bg-ey-yellow data-[state=checked]:text-black"
              />
              <Label htmlFor="enableMultiBanks" className="text-sm cursor-pointer">
                Enable multi-bank analysis & comparison
              </Label>
            </div>

            {enableMultiBanks ? (
              // Multi-bank selection UI
              <div className="space-y-2">
                <label className="text-sm font-medium mb-1 block text-left">
                  Financial Institutions
                </label>
                <div className="border border-ey-gray-600 bg-ey-black text-white rounded-md p-1">
                  <div className="space-y-1">
                    {banks.map(bank => (
                      <div 
                        key={bank.id}
                        onClick={() => toggleBankSelection(bank.id)}
                        className={`flex items-center justify-between p-3 rounded-md cursor-pointer transition-colors ${
                          isBankSelected(bank.id) ? 'bg-ey-yellow/20 border border-ey-yellow' : 'hover:bg-ey-gray-800'
                        }`}
                      >
                        <span className="text-sm">{bank.name}</span>
                        {isBankSelected(bank.id) && (
                          <Check className="h-4 w-4 text-ey-yellow" />
                        )}
                      </div>
                    ))}
                  </div>
                </div>
                {selectedBanks.length === 0 && (
                  <p className="text-xs text-ey-yellow mt-1">Please select at least one bank</p>
                )}
              </div>
            ) : (
              // Single bank selection UI
              <div className="text-left">
                <label className="text-sm font-medium mb-1 block">
                  Financial Institution
                </label>
                <Select onValueChange={setSelectedBank} value={selectedBank}>
                  <SelectTrigger className="w-full border-ey-gray-600 bg-ey-black text-white">
                    <SelectValue placeholder="Select a bank" />
                  </SelectTrigger>
                  <SelectContent className="bg-ey-black text-white border-ey-gray-700">
                    {banks.map(bank => (
                      <SelectItem key={bank.id} value={bank.id} className="hover:bg-ey-gray-800">
                        {bank.name}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
            )}
            
            <Button 
              onClick={handleContinue}
              disabled={enableMultiBanks ? selectedBanks.length === 0 : !selectedBank}
              className="w-full bg-ey-yellow hover:bg-ey-yellow/90 text-ey-black font-medium mt-6"
            >
              Continue to Dashboard
              <ArrowRight className="ml-2 h-4 w-4" />
            </Button>
          </div>
        </div>
        
        <div className="text-xs text-ey-gray-500">
          <p>© {new Date().getFullYear()} EY | A better working world</p>
        </div>
      </div>
    </div>
  );
};

export default BankSelection;

\`\`\`

# src\pages\Dashboard.tsx

\`\`\`tsx
import { useState } from 'react';
import { Tabs, TabsContent } from '@/components/ui/tabs';
import { useToast } from '@/hooks/use-toast';
import { UploadedFile, PromptOption, ProcessingResult } from '@/lib/types';
import { generateRealisticResults } from '@/lib/excelUtils';
import TabNavigation from '@/components/dashboard/TabNavigation';
import UploadTab from '@/components/dashboard/UploadTab';
import PromptsTab from '@/components/dashboard/PromptsTab';
import ResultsTab from '@/components/dashboard/ResultsTab';
import CombinedTab from '@/components/dashboard/CombinedTab';
import SideBySideTab from '@/components/dashboard/SideBySideTab';
import Footer from '@/components/dashboard/Footer';
import { Button } from '@/components/ui/button';

const Dashboard = () => {
  const [uploadedFiles, setUploadedFiles] = useState<UploadedFile[]>([]);
  const [selectedPrompts, setSelectedPrompts] = useState<PromptOption[]>([]);
  const [results, setResults] = useState<ProcessingResult[]>([]);
  const [isProcessing, setIsProcessing] = useState(false);
  const [processingStep, setProcessingStep] = useState('');
  const [processingProgress, setProcessingProgress] = useState(0);
  const [activeTab, setActiveTab] = useState('upload');
  const { toast } = useToast();
  const selectedBank = sessionStorage.getItem('selectedBank') || 'barclays';

  // Handle uploaded files
  const handleFilesUploaded = (files: UploadedFile[]) => {
    setUploadedFiles(files);
  };

  // Handle prompt selection
  const handlePromptSelected = (prompts: PromptOption[]) => {
    setSelectedPrompts(prompts);
    if (prompts.length > 0) {
      toast({
        title: "Prompts Selected",
        description: `${prompts.length} extraction ${prompts.length === 1 ? 'prompt' : 'prompts'} selected`,
      });
    }
  };

  // Simulate the processing function
  const processFiles = async () => {
    if (uploadedFiles.length === 0) {
      toast({
        title: "No files to process",
        description: "Please upload at least one PDF file.",
        variant: "destructive",
      });
      return;
    }

    if (selectedPrompts.length === 0) {
      toast({
        title: "No prompts selected",
        description: "Please select at least one extraction prompt.",
        variant: "destructive",
      });
      return;
    }

    // Start processing
    setIsProcessing(true);
    setProcessingStep('Initializing extraction process...');
    setProcessingProgress(0);
    setActiveTab('results');
    
    // Generate a unique session ID
    const sessionId = Date.now().toString(); 

    try {
      // We assume `uploadedFiles` now contains the metadata returned 
      // by `/api/upload` (handled by UploadTab). 
      // We directly call `/api/process`.

      const processResponse = await fetch('http://localhost:5000/api/process', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          files: uploadedFiles, // Send the metadata we already have
          prompts: selectedPrompts,
          sessionId: sessionId // Use the generated session ID
        })
      });

      if (!processResponse.ok) {
          const errorData = await processResponse.json();
          throw new Error(errorData.error || `Processing failed with status: ${processResponse.status}`);
      }

      const processData = await processResponse.json();
      
      // Update results
      setResults(processData.results);
      setIsProcessing(false);
      
      toast({
        title: "Processing Complete",
        description: `Processed ${uploadedFiles.length} files with ${selectedPrompts.length} prompts`,
      });

      // Optionally, you might want to start polling /api/status/<sessionId> here
      // if the processing is long-running, instead of expecting
      // immediate results. For now, we assume /api/process returns
      // the final results directly as per your Python code.

    } catch (error) {
      setIsProcessing(false);
      console.error("Processing Error:", error); // Log the error
      toast({
        title: "Processing Error",
        description: error instanceof Error ? error.message : "An unknown error occurred during processing.",
        variant: "destructive",
      });
    }
  };

  // Simulate downloading results
  const handleDownloadResults = () => {
    toast({
      title: "Downloading Results",
      description: "Your results would download as an Excel file in a real implementation.",
    });
  };

  // Reset everything
  const handleReset = () => {
    setUploadedFiles([]);
    setSelectedPrompts([]);
    setResults([]);
    setActiveTab('upload');
    toast({
      title: "Reset Complete",
      description: "All files and prompts have been cleared.",
    });
  };

  // Navigate to the next tab
  const goToNextTab = () => {
    if (activeTab === 'upload') setActiveTab('prompts');
    else if (activeTab === 'prompts') {
      processFiles();
    }
  };

  // Go back to previous tab
  const goToPreviousTab = () => {
    if (activeTab === 'prompts') setActiveTab('upload');
    else if (activeTab === 'results') setActiveTab('prompts');
  };
  
  return (
    <div className="min-h-screen flex flex-col bg-white">
      {/* Bank indicator */}
      <div className="bg-yellow-400 text-black py-1 px-4 text-sm flex justify-between">
        <div>
          Selected Bank: <span className="font-semibold">{selectedBank.charAt(0).toUpperCase() + selectedBank.slice(1)}</span>
        </div>
        <Button 
          variant="link" 
          size="sm" 
          onClick={() => window.location.href = '/'}
          className="h-auto p-0 text-black underline text-xs"
        >
          Change
        </Button>
      </div>
      
      {/* Tabs header */}
      <TabNavigation activeTab={activeTab} setActiveTab={setActiveTab} />

      {/* Main Content */}
      <main className="flex-grow container mx-auto px-4 py-6">
        <Tabs value={activeTab}>
          <TabsContent value="upload" className="space-y-6">
            <UploadTab 
              onFilesUploaded={handleFilesUploaded}
              uploadedFiles={uploadedFiles}
              goToNextTab={goToNextTab}
            />
          </TabsContent>
          
          <TabsContent value="prompts" className="space-y-6">
            <div className="flex flex-col space-y-4">
              <PromptsTab 
                onPromptSelected={handlePromptSelected}
                isProcessing={isProcessing}
              />
              
              <div className="flex justify-between mt-4">
                <Button 
                  onClick={goToPreviousTab}
                  variant="outline"
                >
                  Back to Upload
                </Button>
                
                <Button 
                  onClick={processFiles}
                  disabled={isProcessing || selectedPrompts.length === 0}
                  className="bg-yellow-400 hover:bg-yellow-500 text-black"
                >
                  Process Files
                </Button>
              </div>
            </div>
          </TabsContent>
          
          <TabsContent value="results" className="space-y-6">
            <ResultsTab 
              results={results}
              onDownloadResults={handleDownloadResults}
              isProcessing={isProcessing}
              processingProgress={processingProgress}
              processingStep={processingStep}
            />
          </TabsContent>
          
          <TabsContent value="combined" className="space-y-6">
            <CombinedTab 
              results={results} 
              onDownloadResults={handleDownloadResults} 
            />
          </TabsContent>

          <TabsContent value="sidebyside" className="space-y-6">
            <SideBySideTab results={results} />
          </TabsContent>
        </Tabs>
      </main>
      
      {/* Footer */}
      <Footer />
    </div>
  );
};

export default Dashboard;

\`\`\`

# src\pages\Index.tsx

\`\`\`tsx

import { useState } from 'react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { UploadedFile, PromptOption, ProcessingResult } from '@/lib/types';
import { Button } from '@/components/ui/button';
import FileUploader from '@/components/FileUploader';
import PromptSelector from '@/components/PromptSelector';
import ResultsViewer from '@/components/ResultsViewer';
import { useToast } from '@/hooks/use-toast';
import { Download, Upload, FileText, FileSpreadsheet } from 'lucide-react';
import { generateRealisticResults } from '@/lib/excelUtils';

const Index = () => {
  const [uploadedFiles, setUploadedFiles] = useState<UploadedFile[]>([]);
  const [selectedPrompts, setSelectedPrompts] = useState<PromptOption[]>([]);
  const [results, setResults] = useState<ProcessingResult[]>([]);
  const [isProcessing, setIsProcessing] = useState(false);
  const [processingStep, setProcessingStep] = useState('');
  const [processingProgress, setProcessingProgress] = useState(0);
  const [activeTab, setActiveTab] = useState('upload');
  const { toast } = useToast();

  // Handle uploaded files
  const handleFilesUploaded = (files: UploadedFile[]) => {
    setUploadedFiles(files);
  };

  // Handle prompt selection
  const handlePromptSelected = (prompts: PromptOption[]) => {
    setSelectedPrompts(prompts);
    if (prompts.length > 0) {
      toast({
        title: "Prompts Selected",
        description: `${prompts.length} extraction ${prompts.length === 1 ? 'prompt' : 'prompts'} selected`,
      });
    }
  };

  // Simulate the processing function
  const processFiles = async () => {
    if (uploadedFiles.length === 0) {
      toast({
        title: "No files to process",
        description: "Please upload at least one PDF file.",
        variant: "destructive",
      });
      return;
    }

    if (selectedPrompts.length === 0) {
      toast({
        title: "No prompts selected",
        description: "Please select at least one extraction prompt.",
        variant: "destructive",
      });
      return;
    }

    // Start processing
    setIsProcessing(true);
    setProcessingStep('Initializing extraction process...');
    setProcessingProgress(5);
    setActiveTab('results');

    const newResults: ProcessingResult[] = [];

    // Simulate processing for each file and prompt
    let completedItems = 0;
    const totalItems = uploadedFiles.length * selectedPrompts.length;

    for (const file of uploadedFiles) {
      // Simulate parsing the file
      setProcessingStep(`Parsing ${file.name}...`);
      await new Promise(resolve => setTimeout(resolve, 1000));
      setProcessingProgress(10 + (completedItems / totalItems) * 30);

      // For each prompt, create a result
      for (const prompt of selectedPrompts) {
        setProcessingStep(`Extracting ${prompt.name} from ${file.name}...`);
        
        // Simulate API request delay
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // Create a result with either success or random error
        const isSuccess = Math.random() > 0.05; // 95% success rate for demo
        
        const result: ProcessingResult = {
          id: `result-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
          fileId: file.id,
          fileName: file.name,
          promptId: prompt.id,
          promptName: prompt.name,
          status: isSuccess ? 'success' : 'error',
          timestamp: new Date().toISOString(),
          data: isSuccess ? generateRealisticResults(prompt.name) : undefined,
          notes: isSuccess 
            ? `Extraction completed successfully for ${prompt.name}.` 
            : undefined,
          error: isSuccess 
            ? undefined 
            : "Could not find relevant information in the document or the format was not recognized."
        };
        
        newResults.push(result);
        completedItems++;
        setProcessingProgress(10 + (completedItems / totalItems) * 80);
      }
    }

    // Final processing step
    setProcessingStep('Finalizing results...');
    await new Promise(resolve => setTimeout(resolve, 1000));
    setProcessingProgress(100);

    // Update results and finish processing
    setResults([...results, ...newResults]);
    setIsProcessing(false);
    
    toast({
      title: "Processing Complete",
      description: `Processed ${uploadedFiles.length} files with ${selectedPrompts.length} prompts`,
      variant: "default",
    });
  };

  // Simulate downloading results
  const handleDownloadResults = () => {
    toast({
      title: "Downloading Results",
      description: "Your results would download as an Excel file in a real implementation.",
    });
  };

  // Reset everything
  const handleReset = () => {
    setUploadedFiles([]);
    setSelectedPrompts([]);
    setResults([]);
    setActiveTab('upload');
    toast({
      title: "Reset Complete",
      description: "All files and prompts have been cleared.",
    });
  };

  // Navigate to the next tab
  const goToNextTab = () => {
    if (activeTab === 'upload') setActiveTab('prompts');
    else if (activeTab === 'prompts') {
      processFiles();
    }
  };

  // Go back to previous tab
  const goToPreviousTab = () => {
    if (activeTab === 'prompts') setActiveTab('upload');
    else if (activeTab === 'results') setActiveTab('prompts');
  };

  return (
    <div className="min-h-screen flex flex-col bg-white">
      {/* Tabs header */}
      <div className="border-b">
        <div className="container mx-auto px-4">
          <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
            <TabsList className="grid grid-cols-4 w-full max-w-2xl mx-auto my-4">
              <TabsTrigger 
                value="upload" 
                className={activeTab === 'upload' ? 'bg-yellow-400 text-black' : ''}
              >
                <Upload className="h-4 w-4 mr-2" />
                Upload
              </TabsTrigger>
              <TabsTrigger 
                value="prompts" 
                className={activeTab === 'prompts' ? 'bg-yellow-400 text-black' : ''}
              >
                <FileText className="h-4 w-4 mr-2" />
                Prompts
              </TabsTrigger>
              <TabsTrigger 
                value="results" 
                className={activeTab === 'results' ? 'bg-yellow-400 text-black' : ''}
              >
                <FileSpreadsheet className="h-4 w-4 mr-2" />
                Results
              </TabsTrigger>
              <TabsTrigger 
                value="combined" 
                className={activeTab === 'combined' ? 'bg-yellow-400 text-black' : ''}
              >
                <Download className="h-4 w-4 mr-2" />
                Combined
              </TabsTrigger>
            </TabsList>
          </Tabs>
        </div>
      </div>

      {/* Main Content */}
      <main className="flex-grow container mx-auto px-4 py-6">
        <Tabs value={activeTab}>
          {/* Upload Tab */}
          <TabsContent value="upload" className="space-y-6">
            <div className="grid grid-cols-1 gap-6">
              <FileUploader 
                onFilesUploaded={handleFilesUploaded}
                acceptedFileTypes={['.pdf']}
              />
              
              <div className="flex justify-end">
                <Button 
                  onClick={goToNextTab} 
                  disabled={uploadedFiles.length === 0}
                  className="bg-yellow-400 hover:bg-yellow-500 text-black"
                >
                  Next: Select Prompts
                </Button>
              </div>
            </div>
          </TabsContent>
          
          {/* Prompts Tab */}
          <TabsContent value="prompts" className="space-y-6">
            <PromptSelector 
              onPromptSelected={handlePromptSelected} 
              disabled={isProcessing}
            />
          </TabsContent>
          
          {/* Results Tab */}
          <TabsContent value="results" className="space-y-6">
            <ResultsViewer 
              results={results}
              onDownloadResults={handleDownloadResults}
              isProcessing={isProcessing}
              processingProgress={processingProgress}
              processingStep={processingStep}
            />
          </TabsContent>
          
          {/* Combined Tab */}
          <TabsContent value="combined" className="space-y-6">
            <div className="space-y-6">
              <div className="flex justify-between items-center">
                <div>
                  <h2 className="text-lg font-semibold mb-1">IFRS9 Combined Results</h2>
                  <p className="text-sm text-muted-foreground">
                    View and download the final processed IFRS9 data in Excel format
                  </p>
                </div>
                <Button 
                  variant="outline" 
                  size="sm" 
                  onClick={handleDownloadResults}
                  className="flex items-center gap-1 border-yellow-400 bg-white text-black hover:bg-yellow-50"
                >
                  <Download className="h-4 w-4" />
                  <span>Download Excel</span>
                </Button>
              </div>
              
              <div className="border rounded-lg overflow-hidden">
                <div className="flex justify-between items-center p-3 bg-muted border-b">
                  <Button 
                    variant="outline" 
                    size="sm" 
                    className="py-1 h-8 bg-yellow-400 hover:bg-yellow-500 border-none text-black"
                  >
                    Combined View
                  </Button>
                  <div className="text-sm text-muted-foreground">
                    28 rows
                  </div>
                </div>
                
                <div className="h-[500px] overflow-y-auto">
                  <table className="w-full text-sm">
                    <thead className="bg-muted/70 sticky top-0">
                      <tr>
                        <th className="p-3 text-left font-semibold text-black">Category</th>
                        <th className="p-3 text-left font-semibold text-black">Stage</th>
                        <th className="p-3 text-left font-semibold text-black">Field</th>
                        <th className="p-3 text-left font-semibold text-black">Value</th>
                        <th className="p-3 text-left font-semibold text-black">Source</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 1</td>
                        <td className="p-3">Gross Carrying Amount</td>
                        <td className="p-3">$1,029.66m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 1</td>
                        <td className="p-3">Loss Allowance</td>
                        <td className="p-3">$12.64m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 1</td>
                        <td className="p-3">Coverage Ratio</td>
                        <td className="p-3">0.94%</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 2</td>
                        <td className="p-3">Gross Carrying Amount</td>
                        <td className="p-3">$502.11m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 2</td>
                        <td className="p-3">Loss Allowance</td>
                        <td className="p-3">$20.71m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 2</td>
                        <td className="p-3">Coverage Ratio</td>
                        <td className="p-3">6.35%</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </TabsContent>
        </Tabs>
      </main>
      
      {/* Footer */}
      <footer className="bg-gray-100 border-t mt-auto py-4">
        <div className="container mx-auto px-4">
          <div className="flex justify-between items-center text-sm text-muted-foreground">
            <div>IFRS9 Data Extraction Tool</div>
            <div>© {new Date().getFullYear()} Barclays Financial Services</div>
          </div>
        </div>
      </footer>
    </div>
  );
};

export default Index;

\`\`\`

# src\pages\NotFound.tsx

\`\`\`tsx
import { useLocation } from "react-router-dom";
import { useEffect } from "react";

const NotFound = () => {
  const location = useLocation();

  useEffect(() => {
    console.error(
      "404 Error: User attempted to access non-existent route:",
      location.pathname
    );
  }, [location.pathname]);

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <div className="text-center">
        <h1 className="text-4xl font-bold mb-4">404</h1>
        <p className="text-xl text-gray-600 mb-4">Oops! Page not found</p>
        <a href="/" className="text-blue-500 hover:text-blue-700 underline">
          Return to Home
        </a>
      </div>
    </div>
  );
};

export default NotFound;

\`\`\`

# src\vite-env.d.ts

\`\`\`ts
/// <reference types="vite/client" />

\`\`\`

# tailwind.config.ts

\`\`\`ts

import type { Config } from "tailwindcss";

export default {
	darkMode: ["class"],
	content: [
		"./pages/**/*.{ts,tsx}",
		"./components/**/*.{ts,tsx}",
		"./app/**/*.{ts,tsx}",
		"./src/**/*.{ts,tsx}",
	],
	prefix: "",
	theme: {
		container: {
			center: true,
			padding: '2rem',
			screens: {
				'2xl': '1400px'
			}
		},
		extend: {
			colors: {
				border: 'hsl(var(--border))',
				input: 'hsl(var(--input))',
				ring: 'hsl(var(--ring))',
				background: 'hsl(var(--background))',
				foreground: 'hsl(var(--foreground))',
				primary: {
					DEFAULT: 'hsl(var(--primary))',
					foreground: 'hsl(var(--primary-foreground))'
				},
				secondary: {
					DEFAULT: 'hsl(var(--secondary))',
					foreground: 'hsl(var(--secondary-foreground))'
				},
				destructive: {
					DEFAULT: 'hsl(var(--destructive))',
					foreground: 'hsl(var(--destructive-foreground))'
				},
				muted: {
					DEFAULT: 'hsl(var(--muted))',
					foreground: 'hsl(var(--muted-foreground))'
				},
				accent: {
					DEFAULT: 'hsl(var(--accent))',
					foreground: 'hsl(var(--accent-foreground))'
				},
				popover: {
					DEFAULT: 'hsl(var(--popover))',
					foreground: 'hsl(var(--popover-foreground))'
				},
				card: {
					DEFAULT: 'hsl(var(--card))',
					foreground: 'hsl(var(--card-foreground))'
				},
				sidebar: {
					DEFAULT: 'hsl(var(--sidebar-background))',
					foreground: 'hsl(var(--sidebar-foreground))',
					primary: 'hsl(var(--sidebar-primary))',
					'primary-foreground': 'hsl(var(--sidebar-primary-foreground))',
					accent: 'hsl(var(--sidebar-accent))',
					'accent-foreground': 'hsl(var(--sidebar-accent-foreground))',
					border: 'hsl(var(--sidebar-border))',
					ring: 'hsl(var(--sidebar-ring))'
				},
				ey: {
					black: '#000000',
					yellow: '#FFE600',
					white: '#FFFFFF',
					gray: {
						100: '#F6F6F7',
						200: '#F1F1F1', 
						300: '#EAEAEA',
						400: '#C8C8C9',
						500: '#9F9EA1',
						600: '#8A898C',
						700: '#555555',
						800: '#403E43',
						900: '#221F26'
					}
				}
			},
			borderRadius: {
				lg: 'var(--radius)',
				md: 'calc(var(--radius) - 2px)',
				sm: 'calc(var(--radius) - 4px)'
			},
			keyframes: {
				'accordion-down': {
					from: {
						height: '0'
					},
					to: {
						height: 'var(--radix-accordion-content-height)'
					}
				},
				'accordion-up': {
					from: {
						height: 'var(--radix-accordion-content-height)'
					},
					to: {
						height: '0'
					}
				},
				'pulse-gentle': {
					'0%, 100%': { opacity: '1' },
					'50%': { opacity: '0.7' }
				},
				'fade-in': {
					'0%': { opacity: '0' },
					'100%': { opacity: '1' }
				},
				'slide-up': {
					'0%': { transform: 'translateY(20px)', opacity: '0' },
					'100%': { transform: 'translateY(0)', opacity: '1' }
				},
				'float-1': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-5px)' }
				},
				'float-2': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-7px)' }
				},
				'float-3': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-4px)' }
				},
				'float-4': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-6px)' }
				},
				'float-5': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-3px)' }
				},
				'float-6': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-5px)' }
				},
				'float-7': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-4px)' }
				},
				'float-8': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-6px)' }
				},
				'page-transition-in': {
					'0%': { transform: 'translateX(20px)', opacity: '0' },
					'100%': { transform: 'translateX(0)', opacity: '1' }
				},
				'page-transition-out': {
					'0%': { transform: 'translateX(0)', opacity: '1' },
					'100%': { transform: 'translateX(-20px)', opacity: '0' }
				}
			},
			animation: {
				'accordion-down': 'accordion-down 0.2s ease-out',
				'accordion-up': 'accordion-up 0.2s ease-out',
				'pulse-gentle': 'pulse-gentle 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
				'fade-in': 'fade-in 0.6s ease-in-out',
				'slide-up': 'slide-up 0.6s ease-out',
				'float-1': 'float-1 3s ease-in-out infinite',
				'float-2': 'float-2 3.2s ease-in-out infinite 0.1s',
				'float-3': 'float-3 2.8s ease-in-out infinite 0.2s',
				'float-4': 'float-4 3.5s ease-in-out infinite 0.3s',
				'float-5': 'float-5 2.9s ease-in-out infinite 0.4s',
				'float-6': 'float-6 3.1s ease-in-out infinite 0.5s',
				'float-7': 'float-7 3.3s ease-in-out infinite 0.6s',
				'float-8': 'float-8 3.0s ease-in-out infinite 0.7s',
				'page-transition-in': 'page-transition-in 0.3s ease-out',
				'page-transition-out': 'page-transition-out 0.3s ease-out'
			}
		}
	},
	plugins: [require("tailwindcss-animate")],
} satisfies Config;

\`\`\`

# tsconfig.app.json

\`\`\`json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": false,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noImplicitAny": false,
    "noFallthroughCasesInSwitch": false,

    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"]
}

\`\`\`

# tsconfig.json

\`\`\`json
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ],
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    },
    "noImplicitAny": false,
    "noUnusedParameters": false,
    "skipLibCheck": true,
    "allowJs": true,
    "noUnusedLocals": false,
    "strictNullChecks": false
  }
}

\`\`\`

# tsconfig.node.json

\`\`\`json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["vite.config.ts"]
}

\`\`\`

# vite.config.ts

\`\`\`ts
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react-swc";
import path from "path";
import { componentTagger } from "lovable-tagger";

// https://vitejs.dev/config/
export default defineConfig(({ mode }) => ({
  server: {
    host: "::",
    port: 8080,
  },
  plugins: [
    react(),
    mode === 'development' &&
    componentTagger(),
  ].filter(Boolean),
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
}));

\`\`\`


\`\`\`

# components.json

\`\`\`json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "src/index.css",
    "baseColor": "slate",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  }
}
\`\`\`

# eslint.config.js

\`\`\`js
import js from "@eslint/js";
import globals from "globals";
import reactHooks from "eslint-plugin-react-hooks";
import reactRefresh from "eslint-plugin-react-refresh";
import tseslint from "typescript-eslint";

export default tseslint.config(
  { ignores: ["dist"] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ["**/*.{ts,tsx}"],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      "react-hooks": reactHooks,
      "react-refresh": reactRefresh,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      "react-refresh/only-export-components": [
        "warn",
        { allowConstantExport: true },
      ],
      "@typescript-eslint/no-unused-vars": "off",
    },
  }
);

\`\`\`

# index.html

\`\`\`html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>finscope-data-miner</title>
    <meta name="description" content="Lovable Generated Project" />
    <meta name="author" content="Lovable" />

    <meta property="og:title" content="finscope-data-miner" />
    <meta property="og:description" content="Lovable Generated Project" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  </head>

  <body>
    <div id="root"></div>
    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

\`\`\`

# package.json

\`\`\`json
{
  "name": "vite_react_shadcn_ts",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "build:dev": "vite build --mode development",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@hookform/resolvers": "^3.9.0",
    "@radix-ui/react-accordion": "^1.2.0",
    "@radix-ui/react-alert-dialog": "^1.1.1",
    "@radix-ui/react-aspect-ratio": "^1.1.0",
    "@radix-ui/react-avatar": "^1.1.0",
    "@radix-ui/react-checkbox": "^1.1.1",
    "@radix-ui/react-collapsible": "^1.1.0",
    "@radix-ui/react-context-menu": "^2.2.1",
    "@radix-ui/react-dialog": "^1.1.2",
    "@radix-ui/react-dropdown-menu": "^2.1.1",
    "@radix-ui/react-hover-card": "^1.1.1",
    "@radix-ui/react-label": "^2.1.0",
    "@radix-ui/react-menubar": "^1.1.1",
    "@radix-ui/react-navigation-menu": "^1.2.0",
    "@radix-ui/react-popover": "^1.1.1",
    "@radix-ui/react-progress": "^1.1.0",
    "@radix-ui/react-radio-group": "^1.2.0",
    "@radix-ui/react-scroll-area": "^1.1.0",
    "@radix-ui/react-select": "^2.1.1",
    "@radix-ui/react-separator": "^1.1.0",
    "@radix-ui/react-slider": "^1.2.0",
    "@radix-ui/react-slot": "^1.1.0",
    "@radix-ui/react-switch": "^1.1.0",
    "@radix-ui/react-tabs": "^1.1.0",
    "@radix-ui/react-toast": "^1.2.1",
    "@radix-ui/react-toggle": "^1.1.0",
    "@radix-ui/react-toggle-group": "^1.1.0",
    "@radix-ui/react-tooltip": "^1.1.4",
    "@tanstack/react-query": "^5.56.2",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.0.0",
    "date-fns": "^3.6.0",
    "embla-carousel-react": "^8.3.0",
    "framer-motion": "^12.10.5",
    "input-otp": "^1.2.4",
    "lucide-react": "^0.462.0",
    "next-themes": "^0.3.0",
    "pdfjs-dist": "^3.10.111",
    "react": "^18.3.1",
    "react-day-picker": "^8.10.1",
    "react-dom": "^18.3.1",
    "react-hook-form": "^7.53.0",
    "react-resizable-panels": "^2.1.3",
    "react-router-dom": "^6.26.2",
    "recharts": "^2.12.7",
    "sonner": "^1.5.0",
    "tailwind-merge": "^2.5.2",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^0.9.3",
    "xlsx": "^0.18.5",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@eslint/js": "^9.9.0",
    "@tailwindcss/typography": "^0.5.15",
    "@types/node": "^22.5.5",
    "@types/react": "^18.3.3",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react-swc": "^3.5.0",
    "autoprefixer": "^10.4.20",
    "eslint": "^9.9.0",
    "eslint-plugin-react-hooks": "^5.1.0-rc.0",
    "eslint-plugin-react-refresh": "^0.4.9",
    "globals": "^15.9.0",
    "lovable-tagger": "^1.1.7",
    "postcss": "^8.4.47",
    "tailwindcss": "^3.4.11",
    "typescript": "^5.5.3",
    "typescript-eslint": "^8.0.1",
    "vite": "^5.4.1"
  }
}

\`\`\`

# postcss.config.js

\`\`\`js
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}

\`\`\`

# public\favicon.ico

This is a binary file of the type: Binary

# public\placeholder.svg

This is a file of the type: SVG Image

# public\robots.txt

\`\`\`txt
User-agent: Googlebot
Allow: /

User-agent: Bingbot
Allow: /

User-agent: Twitterbot
Allow: /

User-agent: facebookexternalhit
Allow: /

User-agent: *
Allow: /

\`\`\`

# README.md

\`\`\`md
# Welcome to your Lovable project

## Project info

**URL**: https://lovable.dev/projects/f1c52b0c-481b-4d58-84cf-5beb28959f75

## How can I edit this code?

There are several ways of editing your application.

**Use Lovable**

Simply visit the [Lovable Project](https://lovable.dev/projects/f1c52b0c-481b-4d58-84cf-5beb28959f75) and start prompting.

Changes made via Lovable will be committed automatically to this repo.

**Use your preferred IDE**

If you want to work locally using your own IDE, you can clone this repo and push changes. Pushed changes will also be reflected in Lovable.

The only requirement is having Node.js & npm installed - [install with nvm](https://github.com/nvm-sh/nvm#installing-and-updating)

Follow these steps:

\`\`\`sh
# Step 1: Clone the repository using the project's Git URL.
git clone <YOUR_GIT_URL>

# Step 2: Navigate to the project directory.
cd <YOUR_PROJECT_NAME>

# Step 3: Install the necessary dependencies.
npm i

# Step 4: Start the development server with auto-reloading and an instant preview.
npm run dev
\`\`\`

**Edit a file directly in GitHub**

- Navigate to the desired file(s).
- Click the "Edit" button (pencil icon) at the top right of the file view.
- Make your changes and commit the changes.

**Use GitHub Codespaces**

- Navigate to the main page of your repository.
- Click on the "Code" button (green button) near the top right.
- Select the "Codespaces" tab.
- Click on "New codespace" to launch a new Codespace environment.
- Edit files directly within the Codespace and commit and push your changes once you're done.

## What technologies are used for this project?

This project is built with:

- Vite
- TypeScript
- React
- shadcn-ui
- Tailwind CSS

## How can I deploy this project?

Simply open [Lovable](https://lovable.dev/projects/f1c52b0c-481b-4d58-84cf-5beb28959f75) and click on Share -> Publish.

## Can I connect a custom domain to my Lovable project?

Yes, you can!

To connect a domain, navigate to Project > Settings > Domains and click Connect Domain.

Read more here: [Setting up a custom domain](https://docs.lovable.dev/tips-tricks/custom-domain#step-by-step-guide)

\`\`\`

# src\App.css

\`\`\`css
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}

\`\`\`

# src\App.tsx

\`\`\`tsx

import { Toaster } from "@/components/ui/toaster";
import { Toaster as Sonner } from "@/components/ui/sonner";
import { TooltipProvider } from "@/components/ui/tooltip";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { BrowserRouter, Routes, Route, useLocation } from "react-router-dom";
import { AnimatePresence, motion } from "framer-motion";
import IntroScreen from "./components/IntroScreen";
import Dashboard from "./pages/Dashboard";
import BankSelection from "./pages/BankSelection";
import NotFound from "./pages/NotFound";
import { ThemeProvider } from "./components/ThemeProvider";
import { ThemeToggle } from "./components/ThemeToggle";

const queryClient = new QueryClient();

// Simple, elegant fade transition
const pageVariants = {
  initial: {
    opacity: 0
  },
  in: {
    opacity: 1
  },
  out: {
    opacity: 0
  }
};

// Smooth, quick transition
const pageTransition = {
  duration: 0.3,
  ease: "easeInOut"
};

// Animation wrapper component with elegant transitions
const AnimatedRoutes = () => {
  const location = useLocation();
  
  return (
    <AnimatePresence mode="wait">
      <motion.div
        key={location.pathname}
        initial="initial"
        animate="in"
        exit="out"
        variants={pageVariants}
        transition={pageTransition}
        className="w-full min-h-screen"
      >
        {/* Theme toggle positioned in header instead of fixed position */}
        <Routes location={location}>
          <Route path="/" element={<IntroScreen />} />
          <Route path="/select-bank" element={<BankSelection />} />
          <Route path="/dashboard" element={<Dashboard />} />
          <Route path="*" element={<NotFound />} />
        </Routes>
      </motion.div>
    </AnimatePresence>
  );
};

const App = () => (
  <QueryClientProvider client={queryClient}>
    <ThemeProvider defaultTheme="light">
      <TooltipProvider>
        <Toaster />
        <Sonner />
        <BrowserRouter>
          <AnimatedRoutes />
        </BrowserRouter>
      </TooltipProvider>
    </ThemeProvider>
  </QueryClientProvider>
);

export default App;

\`\`\`

# src\components\dashboard\CombinedTab.tsx

\`\`\`tsx
// src/components/dashboard/CombinedTab.tsx

import { Button } from '@/components/ui/button';
import { ProcessingResult } from '@/lib/types';
import { Download } from 'lucide-react';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';

export interface CombinedTabProps { // Ensure this interface matches Dashboard's usage
  results: ProcessingResult[];
  onDownloadResults: () => void;
  selectedBank: string;
}

const CombinedTab = ({ results, onDownloadResults, selectedBank }: CombinedTabProps) => {
  // ... (rest of the component logic from the previous correct version)
  const combinedData = results
    .filter(result => result.status === 'success' && result.data)
    .flatMap(result => {
      return result.data?.map(item => ({
        ...item,
        Source: `${result.fileName} - ${result.promptName}`
      })) || [];
    });

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h2 className="text-lg font-semibold mb-1">Combined Results for {selectedBank}</h2>
          <p className="text-sm text-muted-foreground">
            View and download the final processed data in Excel format
          </p>
        </div>
        <Button 
          variant="outline" 
          size="sm" 
          onClick={onDownloadResults}
          className="flex items-center gap-1 border-yellow-400 bg-white text-black hover:bg-yellow-50 dark:text-black dark:hover:bg-yellow-100 dark:border-yellow-500"
        >
          <Download className="h-4 w-4" />
          <span>Download Excel</span>
        </Button>
      </div>
      
      {combinedData.length > 0 ? (
        <div className="border rounded-lg overflow-hidden dark:border-gray-700">
          <div className="flex justify-between items-center p-3 bg-muted dark:bg-gray-800 border-b dark:border-gray-700">
            <Button 
              variant="outline" 
              size="sm" 
              className="py-1 h-8 bg-yellow-400 hover:bg-yellow-500 border-none text-black"
            >
              Combined View
            </Button>
            <div className="text-sm text-muted-foreground">
              {combinedData.length} rows
            </div>
          </div>
          <ScrollArea className="h-[650px]">
            <Table>
              <TableHeader className="bg-muted/70 dark:bg-gray-800/70 sticky top-0">
                <TableRow className="dark:border-gray-700">
                  <TableHead className="font-semibold text-black dark:text-white">Category</TableHead>
                  <TableHead className="font-semibold text-black dark:text-white">Stage</TableHead>
                  <TableHead className="font-semibold text-black dark:text-white">Field</TableHead>
                  <TableHead className="font-semibold text-black dark:text-white">Value</TableHead>
                  <TableHead className="font-semibold text-black dark:text-white">Source</TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {combinedData.map((item, index) => (
                  <TableRow key={index} className="dark:border-gray-700">
                    <TableCell className="dark:text-gray-300">{item.Category === 'ECL By Stage' ? 'ECL' : item.Category}</TableCell>
                    <TableCell className="dark:text-gray-300">{item.Stage}</TableCell>
                    <TableCell className="dark:text-gray-300">{item.Field}</TableCell>
                    <TableCell className="dark:text-gray-300">{item.Value}</TableCell>
                    <TableCell className="dark:text-gray-300">{item.Source}</TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </ScrollArea>
        </div>
      ) : (
        <div className="border rounded-lg p-12 text-center dark:border-gray-700">
          <p className="text-muted-foreground">No results available yet.</p>
          <p className="text-sm text-muted-foreground mt-1">Process files with prompts to see combined results.</p>
        </div>
      )}
    </div>
  );
};

export default CombinedTab;
\`\`\`

# src\components\dashboard\Footer.tsx

\`\`\`tsx

const Footer = () => {
  return (
    <footer className="bg-gray-100 border-t mt-auto py-4">
      <div className="container mx-auto px-4">
        <div className="flex justify-between items-center text-sm text-muted-foreground">
          <div>AiDEx - AI powered Data Extraction</div>
          <div>© {new Date().getFullYear()} Barclays Financial Services</div>
        </div>
      </div>
    </footer>
  );
};

export default Footer;

\`\`\`

# src\components\dashboard\PromptsTab.tsx

\`\`\`tsx
// src/components/dashboard/PromptsTab.tsx
// (Ensure this is the version you have from the previous response, 
// it should be mostly correct for fetching and passing props)

import PromptSelector from '@/components/PromptSelector';
import PromptDescriptions from '@/components/PromptDescriptions';
import { PromptOption } from '@/lib/types';
import { useCallback, useEffect, useState } from 'react';
import { useToast } from '@/hooks/use-toast';
import { Loader2 } from 'lucide-react';

interface PromptsTabProps {
  onPromptSelected: (prompts: PromptOption[]) => void; // This is Dashboard's handler
  isProcessing: boolean;
  selectedPrompts?: PromptOption[]; // User's currently active selection from Dashboard
}

const PromptsTab = ({ 
  onPromptSelected, 
  isProcessing, 
  selectedPrompts: dashboardSelectedPrompts = [] 
}: PromptsTabProps) => {
  const [fetchedBankPrompts, setFetchedBankPrompts] = useState<PromptOption[]>([]);
  const [isLoadingPrompts, setIsLoadingPrompts] = useState(false);
  const [currentBankDisplay, setCurrentBankDisplay] = useState<string>("selected bank(s)");
  const { toast } = useToast();

  // This callback will be called by PromptSelector when its "Apply" button is clicked.
  const handleApplyFromSelector = useCallback((newlyAppliedSelection: PromptOption[]) => {
    onPromptSelected(newlyAppliedSelection); // Update Dashboard's state
    // Toast for applying is now handled within PromptSelector itself after its own apply.
  }, [onPromptSelected]);

  useEffect(() => {
    const fetchBankPrompts = async () => {
      setIsLoadingPrompts(true);
      const storedBank = sessionStorage.getItem('selectedBank') || 'barclays';
      const storedBanksString = sessionStorage.getItem('selectedBanks');
      const enableMulti = sessionStorage.getItem('enableMultiBanks') === 'true';
      
      let banksToFetch: string[] = [];
      if (enableMulti && storedBanksString) {
        try {
          banksToFetch = JSON.parse(storedBanksString);
          setCurrentBankDisplay(banksToFetch.map(b => b.charAt(0).toUpperCase() + b.slice(1)).join(', ') || 'selected banks');
        } catch (e) {
          console.error("Error parsing selectedBanks from sessionStorage", e);
          banksToFetch = [storedBank]; 
          setCurrentBankDisplay(storedBank.charAt(0).toUpperCase() + storedBank.slice(1));
        }
      } else {
        banksToFetch = [storedBank];
        setCurrentBankDisplay(storedBank.charAt(0).toUpperCase() + storedBank.slice(1));
      }

      if (banksToFetch.length === 0 && !enableMulti) { // Check only if not multi-mode and no single bank
        setFetchedBankPrompts([]);
        setIsLoadingPrompts(false);
        toast({ title: "No Bank Selected", description: "Please select a bank on the previous screen.", variant: "destructive" });
        return;
      }
      if (banksToFetch.length === 0 && enableMulti) {
         setFetchedBankPrompts([]);
         setIsLoadingPrompts(false);
         toast({ title: "No Banks Selected for Multi-Analysis", description: "Please select banks on the previous screen.", variant: "default" });
        return;
      }


      try {
        const allFetchedPrompts: PromptOption[] = [];
        const uniquePromptIds = new Set<string>();

        for (const bankId of banksToFetch) {
          const response = await fetch(`http://localhost:5000/api/prompts/default/${bankId}`);
          if (!response.ok) {
            const errorData = await response.json();
            console.warn(`Failed to fetch prompts for ${bankId}: ${errorData.error || response.statusText}`);
            toast({ title: `Prompt Fetch Error for ${bankId}`, description: errorData.error || "Could not load prompts.", variant: "destructive"});
            continue; 
          }
          const data = await response.json();
          if (data.status === 'success' && Array.isArray(data.prompts)) {
            data.prompts.forEach((prompt: PromptOption) => {
              if (!uniquePromptIds.has(prompt.id)) { 
                allFetchedPrompts.push(prompt);
                uniquePromptIds.add(prompt.id);
              }
            });
          } else if (data.message) {
            console.log(data.message); // Log "No prompts found for bank" message
          }
        }
        setFetchedBankPrompts(allFetchedPrompts);
        if (allFetchedPrompts.length === 0 && banksToFetch.length > 0) {
             toast({ title: "No Predefined Prompts", description: `No predefined prompts were found for ${banksToFetch.join(', ')} in the CSV.`, variant: "default" });
        }
      } catch (error) {
        console.error("Error fetching predefined prompts:", error);
        toast({
          title: "Error Fetching Prompts",
          description: error instanceof Error ? error.message : "Could not load predefined prompts from server.",
          variant: "destructive",
        });
        setFetchedBankPrompts([]);
      } finally {
        setIsLoadingPrompts(false);
      }
    };

    fetchBankPrompts();
  }, [toast]); 

  if (isLoadingPrompts) {
    return (
      <div className="flex flex-col items-center justify-center h-[400px] space-y-4">
        <Loader2 className="h-12 w-12 animate-spin text-yellow-500" />
        <p className="text-muted-foreground">Loading prompts for {currentBankDisplay}...</p>
      </div>
    );
  }

  return (
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div>
        <PromptSelector 
          onPromptsApplied={handleApplyFromSelector} 
          disabled={isProcessing || isLoadingPrompts}
          availablePredefinedPrompts={fetchedBankPrompts}
          // Pass the dashboard's current selection to pre-tick items in PromptSelector
          initiallyTickedPrompts={dashboardSelectedPrompts} 
          bankDisplay={currentBankDisplay}
        />
      </div>
      <div>
        <PromptDescriptions 
          availablePrompts={fetchedBankPrompts} 
          bankDisplay={currentBankDisplay}
        />
      </div>
    </div>
  );
};

export default PromptsTab;
\`\`\`

# src\components\dashboard\ResultsTab.tsx

\`\`\`tsx
// src/components/dashboard/ResultsTab.tsx

import ResultsViewer from '@/components/ResultsViewer'; //
import { ProcessingResult } from '@/lib/types'; //

// Define or update ResultsTabProps here
export interface ResultsTabProps {
  results: ProcessingResult[];
  onDownloadResults: () => void;
  isProcessing: boolean;
  processingProgress: number;
  processingStep: string;
  selectedBank: string;         // <-- ENSURE THIS LINE IS PRESENT
  totalUploadedFiles: number; 
}

const ResultsTab = ({ 
  results, 
  onDownloadResults, 
  isProcessing, 
  processingProgress, 
  processingStep,
  selectedBank,
  totalUploadedFiles 
}: ResultsTabProps) => {
  
  const uniqueFileIdsInResults = new Set(results.map(r => r.fileId));
  const totalFilesToDisplay = isProcessing ? Math.max(1, totalUploadedFiles) : uniqueFileIdsInResults.size;
  const processedFilesCount = results.filter(r => r.status === 'success' || r.status === 'error').length;
  
  return (
    <ResultsViewer 
      results={results}
      onDownloadResults={onDownloadResults}
      isProcessing={isProcessing}
      processingProgress={processingProgress}
      processingStep={processingStep}
      totalFiles={totalFilesToDisplay} 
      processedFiles={processedFilesCount}
      selectedBank={selectedBank} // Pass it down
    />
  );
};

export default ResultsTab;
\`\`\`

# src\components\dashboard\SideBySideTab.tsx

\`\`\`tsx
// src/components/dashboard/SideBySideTab.tsx

import { useState, useEffect } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Button } from '@/components/ui/button';
import { RefreshCw, Info, Check } from 'lucide-react'; // Added Check, was missing
import { ProcessingResult } from '@/lib/types';
import PDFViewer from '@/components/PDFViewer';
import { Badge } from "@/components/ui/badge"; // Added Badge, was missing
import { cn } from "@/lib/utils"; // Added cn, was missing

// CORRECTED Props Interface
export interface SideBySideTabProps {
  results: ProcessingResult[];
  selectedBank: string; 
}

const SideBySideTab = ({ results, selectedBank }: SideBySideTabProps) => {
  // ... rest of your component logic from the version in codebase_frontend.md ...
  // (Ensure all the component logic is present here, I'm just showing the interface fix)

  const [selectedFileForPdfPreview, setSelectedFileForPdfPreview] = useState<File | null>(null);
  const [selectedProcessingResult, setSelectedProcessingResult] = useState<ProcessingResult | null>(null);
  const [retryPdfCounter, setRetryPdfCounter] = useState(0);
  const [clientSidePdfFiles, setClientSidePdfFiles] = useState<Map<string, File>>(new Map());

  const resultsByFile: Record<string, ProcessingResult[]> = results.reduce((acc, result) => {
    if (!result) return acc;
    const key = result.fileId || result.fileName; 
    if (!acc[key]) acc[key] = [];
    acc[key].push(result);
    return acc;
  }, {} as Record<string, ProcessingResult[]>);

  const uniqueFileEntries = Object.values(resultsByFile).map(fileResults => fileResults[0]).filter(Boolean);

  // createDummyPDF function as provided in your codebase_frontend.md
  const createDummyPDF = (fileName: string): File => {
    const base64PDF = `JVBERi0xLjcKJeTjz9IKMSAwIG9iago8PC9UeXBlL0NhdGFsb2cvUGFnZXMgMiAwIFIvTGFuZyhqYS1KUCkgL1N0cnVjdFRyZWVSb290IDIxIDAgUi9NYXJrSW5mbzw8L01hcmtlZCB0cnVlPj4vTWV0YWRhdGEgNTggMCBSL1ZpZXdlclByZWZlcmVuY2VzIDU5IDAgUj4+CmVuZG9iagoyIDAgb2JqCjw8L1R5cGUvUGFnZXMvQ291bnQgMS9LaWRzWyAzIDAgUl0gPj4KZW5kb2JqCjMgMCBvYmoKPDwvVHlwZS9QYWdlL1BhcmVudCAyIDAgUi9SZXNvdXJjZXM8PC9YT2JqZWN0PDwvSW1hZ2U1IDUgMCBSL0ltYWdlNyA3IDAgUj4+L0ZvbnQ8PC9GMSAxMSAwIFIvRjIgMTMgMCBSL0YzIDE1IDAgUi9GNCAxNyAwIFI+Pi9FeHRHU3RhdGU8PC9HUzcgNyAwIFIvR1M4IDggMCBSPj4vUHJvY1NldFsvUERGL1RleHQvSW1hZ2VCL0ltYWdlQy9JbWFnZUldID4+L01lZGlhQm94WyAwIDAgNTk1LjMyIDg0MS45Ml0gL0NvbnRlbnRzIDQgMCBSL0dyb3VwPDwvVHlwZS9Hcm91cC9TL1RyYW5zcGFyZW5jeS9DUy9EZXZpY2VSR0I+Pi9UYWJzL1MvU3RydWN0UGFyZW50cyAwPj4KZW5kb2JqCjQgMCBvYmoKPDwvRmlsdGVyL0ZsYXRlRGVjb2RlL0xlbmd0aCAxOTA4Pj4Kc3RyZWFtCn陲Vnbkps4EH3nK3Q5uwo1urHB43gnpHBiy4iL12vv5mErD4MsMBXGBXgr+4d8XDeSuRgwdpKtmiqEkOg+3af7yHy7It9olr6TM87oNb2JxYGqM8qTrCCxgD8CBS3oi0xyEYn0nIooAynMaM5SciW/ZCknb7Oz8w8kE2QinkYHcq2iI8lj8g0awW+p/HuWvvAYBp6wPDqQmNIF/Emf4BFRamDNBHklMTzNNQIqwC4JjI9T+FeSh39MegVj9CjN0E6jBQWnISVqwXOaJCALfodFnBZCo89FivXlErBTYAa841mSJ+mJ8MmzDDC+1QxuJ+pEefBHzJKMJwcS8cN+RtVs8+NPwBa7wOxpt3i8eXn4gfrju8Ct3h1CLx1G7+7QuH+Anj4Oj90XgfmrOOye/WwO+1npeI7ukDsFrrjcHUbyGU0IvkZTp8pfa33pwsb7UuC1gYs8QdNq5jYZxNYzX+/oDXrTTOA+WCzCnJEUJrhA7q0wC3JE4ZPNH3W1mROL04h1Qhim4OKmdhPbAcrTIiVvdZ2z9DC6dAA+UFw4bjA2/P54g+1+PB6NvEvn2Ld6u+pBE9ufjI39wUg/D3F6aoLBHLScFLLJksm+xM/JXCNYM4YeBicJvc8rC7PSK5G6Tjv4i8Wt4wcj63q1ut6qhlggOcgcUYk20WXJHC7Vdu4wSnOEeQrmJpnDxKBkOgLS5kS2KQdTqUHmsHxhnB+GlaEggPm4bDq/rUlUvUjrx4i2DXDjo1hMBHxkDMsODMexmsHZeqXN9+VqKDEpPJhKkDs18A6kTGPycPv00ADXRkNEvF8xRdspeH8QLGfr3wE5KQCh7y/xziq8IATdLe3z1ZPvu9Po0L7ls/lyTA8s1zwx6/aipdyGvrI4SDx7E9cNeGdf3b2et7BfIxgBybl5YQzMoNsqSZS1h9HbCI1zdw6HpcT9hdiBBEcHkiFgY5YXSkAVGjuvamNUrSYyeUp1Gp7oicxolhfyuTsloXNpDRzuTLnjDifqveWQivUky2PkpeB7hFRdRV6wVbyrzLMCHqxUUW/HGQj7VEwIMEOZoVUbVZnWxp4Ge1mCstY3VHkOkUW4dPZVtSvdX51rXq4tUPhM+cyjdAlOM9g0E66NuugYnUCMr9311TxRn51l90OwvcFq4KKw1pQ42gAsntdgwrqmJ/Brl2P82jZQYzOUFO5LqPYvzc/bhpy+N3ubZnfVAJ+pDaKZIL/lQzdTDstKjB6gXjcr9bY9Dru6QF3Ac415RwleFebeUxGlPB5fd9/9gl3oQonA7eUXarKL9KhHka22R4CleLvNYlSY7UgVW3LQmKcd90zcqJPJCcCdiX/62fXPrcdJLJssALwbnztejx93ndtvHcpGx7ocwX8aSO00vRdTTBZeQni3WjjEIb58LMeQO4e/aBMFLTHvizWssNRIkltzmJJCH0nP7ci+co6Pmvr8M/awR8FFekLNDNcymoI7JlvzZquAKc9MsJQHx2+6m8t7oG0zG6S6uCW3cTAdOUfmznGcN6ZM0tyhr7RT4BqKFeBhcMXHwRptklv0KiDZLewprKkKtjTGpuq+d8ctsrGXbnVTB59DE8vjXIXlnJNsKqTqdfqL85PVLBHZU4DUfHWUt1sW5wnXHS2HlQ3GZghWyMvKZYLEf+XimTTHD0te3mdpeML10Xf6TrC3XRu6pksPUrQX1cUQN1hAQGF2aL8feZNFhbq2JIA06UM2wUuTBPjuDAIpPRAVVIQHKJ6Juo5E54bc70m2kUWNSYk8I3cSoNt90tKkmwkLiRLIpGq41cQE9+QrPQzp21JAcDdAA1J8jFWqKOlnQSsj225Yu4R/2EOWWtheOD6IQn8wCdptq5bU90v8l/zAiThahUZBNYzgdGZG3CKqTDehjCfYbIGluBVteMXWN2z/ut6wrSINS+4X6PcYwXVPrZ/IXEU452MocU826M76xG7j6W0B5qAjUYxc/DVJdXOXt6JKbAA2C1+r3ELS+J6T6rRfILmcZCphP+Z9hd8/0QPecIxS/CIRfJ7X97hoRc82nLdXLo1wHtdx998hmVxJynrA01ulvqjjjCUJeEXepU6NJXrW18vtdcbYI80CeXcogFNWJctyyDFxKHcWO76Zawsfpzjrx0ffQTWGusezbCs3v/49v87ZF8X+2O23cr7cyi2fLdBjrm6/K9A/vTLv1bHfdcDhqy+FhdLD8YQN5O+1fwEqNfLlCmVuZHN0cmVhbQplbmRvYmoKMjEgMCBvYmoKPDwvVHlwZS9TdHJ1Y3RUcmVlUm9vdC9QYXJlbnRUcmVlID0gNiAwIFIgL0sgPSA1MCAwIFIvSURUcmVlID0gNTEgMCBSID4+CmVuZG9iagoyMiAwIG9iago8PC9UeXBlL0ZvbnQvU3VidHlwZS9UcnVlVHlwZS9OYW1lL0YxL0Jhc2VGb250L0JDREVFRStDYWxpYnJpL0VuY29kaW5nL1dpbkFuc2lFbmNvZGluZy9Gb250RGVzY3JpcHRvciAyMyAwIFIvRmlyc3RDaGFyIDMyL0xhc3RDaGFyIDg0L1dpZHRocyA1MyAwIFI+PgplbmRvYmoKMjMgMCBvYmoKPDwvVHlwZS9Gb250RGVzY3JpcHRvci9Gb250TmFtZS9CQ0RFRUUrQ2FsaWJyaS9GbGFncyAzMi9JdGFsaWNBbmdsZSAwL0FzY2VudCA3NTAvRGVzY2VudCAtMjUwL0NhcEhlaWdodCA3NTAvQXZnV2lkdGggNTIxL01heFdpZHRoIDE3NDMvRm9udFdlaWdodCA0MDAvWEhlaWdodCAyNTAvU3RlbVYgNTIvRm9udEJCb3hbIC01MDMgLTI1MCAxMjQwIDc1MF0gL0ZvbnRGaWxlMiA1MiAwIFI+PgplbmRvYmoKNTMgMCBvYmoKWyAyMjYgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDY0MyAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCA3MTUgMCA2NjIgMCAwIDAgNTQ0XSAKZW5kb2JqCjUwIDAgb2JqCjw8L1R5cGUvU3RydWN0RWxlbS9TL1Jvb3QvUC11dGlsKFRpdGxlKS9LWzQ5IDAgUl0gL1BnIDMgMCBSID4+CmVuZG9iago0OSAwIG9iago8PC9UeXBlL1N0cnVjdEVsZW0vUy9UaXRsZS9QLXV0aWwoSGVhZGluZzEpL0tbNDggMCBSXSAvUGcgMyAwIFIgPj4KZW5kb2JqCjQ4IDAgb2JqCjw8L1R5cGUvU3RydWN0RWxlbS9TL0hlYWRpbmcxL1AvNTAgMCBSL0tbMF0gL1BnIDMgMCBSID4+CmVuZG9iago1MSAwIG9iago8PC9OYW1lcygibG9hbiIpID4+CmVuZG9iago2IDAgb2JqCjw8L051bXMgWzAgWyA0OCAwIFJdIF0gPj4KZW5kb2JqCnhyZWYKMSA0CjAwMDAwMDAwMTAgNjU1MzUgZiAKMDAwMDAwMDAxNSAwMDAwMCBuIAowMDAwMDAwMTgxIDAwMDAwIG4gCjAwMDAwMDAyMzggMDAwMDAgbiAKMTEgMgowMDAwMDAwMDAwIDAwMDAwIGYgCjAwMDAwMDAwMDAgMDAwMDAgZiAKMjEgNAowMDAwMDAyMzMwIDAwMDAwIG4gCjAwMDAwMDI0MTggMDAwMDAgbiAKMDAwMDAwMjU5NSAwMDAwMCBuIAowMDAwMDAyODU4IDAwMDAwIG4gCjQ4IDMKMDAwMDAwMzA3NyAwMDAwMCBuIAowMDAwMDAzMDAwIDAwMDAwIG4gCjAwMDAwMDI5MzUgMDAwMDAgbiAKNTAgMQowMDAwMDAyODY1IDAwMDAwIG4gCjUyIDIKMDAwMDAwMDAwMCAwMDAwMCBmIAowMDAwMDAwMDAwIDAwMDAwIGYgCnRyYWlsZXIKPDwvU2l6ZSA1NS9Sb290IDEgMCBSL0luZm8gMjAgMCBSL0lEWzwyRTA1NzM5MkZDM0JCMTQxQjNDNDkzODNBODY4NDg5OD48MkUwNTczOTJGQzNCQjE0MUIzQzQ5MzgzQTg2ODQ4OTg+XSA+PgpzdGFydHhyZWYKMzE0NQolJUVPRgo=`; //
    try {
      const binaryString = window.atob(base64PDF);
      const len = binaryString.length;
      const bytes = new Uint8Array(len);
      for (let i = 0; i < len; i++) { bytes[i] = binaryString.charCodeAt(i); }
      const pdfBlob = new Blob([bytes.buffer], { type: 'application/pdf' });
      const file = new File([pdfBlob], fileName, { type: 'application/pdf' });
      setClientSidePdfFiles(prev => new Map(prev).set(fileName, file));
      return file;
    } catch (error) {
      console.error("Error creating dummy PDF:", error);
      const minimalPDF = 'JVBERi0xLjAKMSAwIG9iago8PC9UeXBlL0NhdGFsb2cvUGFnZXMgMiAwIFI+PgplbmRvYmoKMiAwIG9iago8PC9UeXBlL1BhZ2VzL0tpZHNbMyAwIFJdL0NvdW50IDE+PgplbmRvYmoKMyAwIG9iago8PC9UeXBlL1BhZ2UvTWVkaWFCb3hbMCAwIDMgM10+PgplbmRvYmoKdHJhaWxlcgo8PC9Sb290IDEgMCBSPj4K';
      const fallbackBytes = Uint8Array.from(window.atob(minimalPDF), c => c.charCodeAt(0));
      return new File([new Blob([fallbackBytes], { type: 'application/pdf' })], fileName, { type: 'application/pdf' });
    }
  };

  useEffect(() => {
    if (results.length === 0) {
      setSelectedFileForPdfPreview(null);
      setSelectedProcessingResult(null);
      return;
    }
    const newPdfFilesMap = new Map(clientSidePdfFiles);
    uniqueFileEntries.forEach(fileInfo => {
      if (fileInfo && fileInfo.fileName && !newPdfFilesMap.has(fileInfo.fileName)) {
        // This updates clientSidePdfFiles via its setState, which will trigger the other useEffect
        createDummyPDF(fileInfo.fileName); 
      }
    });
    if (!selectedProcessingResult && results.length > 0) {
        const firstValidResult = results.find(r => r != null);
        if (firstValidResult) setSelectedProcessingResult(firstValidResult);
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [results, retryPdfCounter]); // Removed clientSidePdfFiles to avoid potential loop if createDummyPDF directly sets it

   useEffect(() => { 
    if (selectedProcessingResult && selectedProcessingResult.fileName) {
        const pdf = clientSidePdfFiles.get(selectedProcessingResult.fileName);
        if (pdf) {
            setSelectedFileForPdfPreview(pdf);
        } else {
            const newPdf = createDummyPDF(selectedProcessingResult.fileName); // create if not in map
            setSelectedFileForPdfPreview(newPdf);
        }
    }
  }, [selectedProcessingResult, clientSidePdfFiles]);


  const handleFileSelect = (fileIdOrName: string, fileName: string) => {
    const pdf = clientSidePdfFiles.get(fileName) || createDummyPDF(fileName);
    setSelectedFileForPdfPreview(pdf);
    const fileResults = resultsByFile[fileIdOrName];
    if (fileResults && fileResults.length > 0) {
      setSelectedProcessingResult(fileResults[0]);
    }
  };

  const handleResultSelect = (result: ProcessingResult) => {
    setSelectedProcessingResult(result);
  };

  const handleRetryLoadingPdf = () => {
    setRetryPdfCounter(prev => prev + 1); 
    if (selectedProcessingResult?.fileName) {
      const newPdf = createDummyPDF(selectedProcessingResult.fileName);
      setSelectedFileForPdfPreview(newPdf);
    }
  };
  // ... (rest of the JSX from the previous correct version) ...
  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-lg font-semibold mb-1">Side by Side Comparison for {selectedBank}</h2>
        <p className="text-sm text-muted-foreground">Compare extracted data with the original document.</p>
      </div>
      
      <div className="grid grid-cols-1 lg:grid-cols-7 gap-4">
        {/* Left sidebar - File and Result selection */}
        <div className="lg:col-span-2">
          <Card className="overflow-hidden h-full flex flex-col dark:bg-gray-800 dark:border-gray-700">
            <div className="bg-black text-white p-2 text-sm font-medium">Processed Files & Prompts</div>
            <ScrollArea className="flex-grow">
              <div className="p-2">
                {uniqueFileEntries.map((fileInfo) => (
                  <div key={fileInfo.fileId || fileInfo.fileName} className="mb-3">
                    <div 
                      className="text-sm font-medium p-2 bg-muted dark:bg-gray-700 rounded-t-md cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600"
                      onClick={() => handleFileSelect(fileInfo.fileId || fileInfo.fileName, fileInfo.fileName)}
                    >
                      {fileInfo.fileName}
                    </div>
                    <div className="border border-t-0 rounded-b-md dark:border-gray-600">
                      {(resultsByFile[fileInfo.fileId || fileInfo.fileName] || []).map(result => (
                        <div 
                          key={result.id}
                          className={cn(
                            "flex items-center justify-between p-2 text-sm cursor-pointer border-b dark:border-gray-600 last:border-b-0",
                            selectedProcessingResult?.id === result.id 
                              ? "bg-yellow-100 dark:bg-yellow-700/50 border-l-4 border-yellow-500 dark:border-yellow-400 text-black dark:text-white" 
                              : "hover:bg-muted/50 dark:hover:bg-gray-700/30"
                          )}
                          onClick={() => handleResultSelect(result)}
                        >
                          <span className="truncate pr-2">{result.promptName}</span>
                          {result.status === 'success' && <Check className="h-4 w-4 text-green-500 flex-shrink-0" />}
                          {result.status === 'error' && <Info className="h-4 w-4 text-red-500 flex-shrink-0" />}
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </ScrollArea>
          </Card>
        </div>
        
        <div className="lg:col-span-2">
          <Card className="overflow-hidden h-full flex flex-col dark:bg-gray-800 dark:border-gray-700">
            <div className="bg-black text-white p-2 text-sm font-medium">Document Preview</div>
            <div className="flex-grow flex flex-col bg-gray-100 dark:bg-gray-700">
              <PDFViewer file={selectedFileForPdfPreview} className="flex-1"/>
              <div className="flex justify-center p-2 bg-card border-t dark:bg-gray-800 dark:border-gray-600">
                <Button variant="outline" size="sm" className="flex items-center gap-2" onClick={handleRetryLoadingPdf}>
                  <RefreshCw className="h-4 w-4" /> Reload PDF Preview
                </Button>
              </div>
            </div>
          </Card>
        </div>
        
        <div className="lg:col-span-3">
          <Card className="overflow-hidden h-full flex flex-col dark:bg-gray-800 dark:border-gray-700">
            <div className="bg-black text-white p-3 flex justify-between items-center">
              <div>
                <div className="font-medium">{selectedProcessingResult?.promptName || "No prompt selected"}</div>
                <div className="text-xs text-gray-400">From: {selectedProcessingResult?.fileName || "N/A"}</div>
              </div>
              {selectedProcessingResult && (
                <Badge className={cn("capitalize", 
                    selectedProcessingResult.status === 'success' && "bg-green-600 text-white",
                    selectedProcessingResult.status === 'error' && "bg-red-600 text-white",
                    selectedProcessingResult.status === 'pending' && "bg-blue-500 text-white",
                    selectedProcessingResult.status === 'processing' && "bg-purple-500 text-white"
                )}>
                  {selectedProcessingResult.status}
                </Badge>
              )}
            </div>
            
            <div className="p-3 flex-grow">
              {selectedProcessingResult && selectedProcessingResult.status === 'success' && selectedProcessingResult.data && selectedProcessingResult.data.length > 0 ? (
                <ScrollArea className="h-[calc(100vh_-_250px)] max-h-[550px]">
                  <Table>
                    <TableHeader className="bg-muted dark:bg-gray-700 sticky top-0">
                      <TableRow className="dark:border-gray-600">
                        <TableHead className="font-semibold dark:text-gray-200">Category</TableHead>
                        <TableHead className="font-semibold dark:text-gray-200">Stage</TableHead>
                        <TableHead className="font-semibold dark:text-gray-200">Field</TableHead>
                        <TableHead className="font-semibold dark:text-gray-200">Value</TableHead>
                      </TableRow>
                    </TableHeader>
                    <TableBody>
                      {selectedProcessingResult.data.map((item, index) => {
                        if (!item) return null;
                        return (
                          <TableRow key={index} className="dark:border-gray-600">
                            <TableCell className="dark:text-gray-300">{item.Category === 'ECL By Stage' ? 'ECL' : item.Category}</TableCell>
                            <TableCell className="dark:text-gray-300">{item.Stage}</TableCell>
                            <TableCell className="dark:text-gray-300">{item.Field}</TableCell>
                            <TableCell className="font-medium dark:text-gray-200">{item.Value}</TableCell>
                          </TableRow>
                        );
                      })}
                    </TableBody>
                  </Table>
                </ScrollArea>
              ) : selectedProcessingResult && selectedProcessingResult.status === 'error' ? (
                 <div className="flex flex-col items-center justify-center h-full text-center p-4">
                    <Info className="h-10 w-10 text-red-500 mb-3" />
                    <p className="font-semibold">Error in this extraction.</p>
                    <p className="text-xs text-muted-foreground mt-1">{selectedProcessingResult.error || "An unknown error occurred."}</p>
                 </div>
              ): (
                <div className="flex flex-col items-center justify-center h-full text-center p-4">
                  <Info className="h-10 w-10 text-muted-foreground mb-3" />
                  <p className="text-muted-foreground">
                    {selectedProcessingResult ? "No data extracted for this result or result not successful." : "Select a result to view extracted data."}
                  </p>
                </div>
              )}
            </div>
          </Card>
        </div>
      </div>
    </div>
  );
};

export default SideBySideTab;
\`\`\`

# src\components\dashboard\TabNavigation.tsx

\`\`\`tsx

import { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Upload, FileText, FileSpreadsheet, Download, LayoutPanelLeft } from 'lucide-react';
import { ThemeToggle } from '@/components/ThemeToggle';

interface TabNavigationProps {
  activeTab: string;
  setActiveTab: (value: string) => void;
}

const TabNavigation = ({ activeTab, setActiveTab }: TabNavigationProps) => {
  return (
    <div className="border-b dark:border-gray-700">
      <div className="container mx-auto px-4 flex items-center justify-between">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
          <TabsList className="grid grid-cols-5 w-full max-w-2xl mx-auto my-4">
            <TabsTrigger 
              value="upload" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <Upload className="h-4 w-4 mr-2" />
              Upload
            </TabsTrigger>
            <TabsTrigger 
              value="prompts" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <FileText className="h-4 w-4 mr-2" />
              Prompts
            </TabsTrigger>
            <TabsTrigger 
              value="results" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <FileSpreadsheet className="h-4 w-4 mr-2" />
              Results
            </TabsTrigger>
            <TabsTrigger 
              value="combined" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <Download className="h-4 w-4 mr-2" />
              Combined
            </TabsTrigger>
            <TabsTrigger 
              value="sidebyside" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <LayoutPanelLeft className="h-4 w-4 mr-2" />
              Side by Side
            </TabsTrigger>
          </TabsList>
        </Tabs>
        <ThemeToggle className="mr-4" />
      </div>
    </div>
  );
};

export default TabNavigation;

\`\`\`

# src\components\dashboard\UploadTab.tsx

\`\`\`tsx
// src/components/dashboard/UploadTab.tsx

import { Button } from '@/components/ui/button';
import FileUploader from '@/components/FileUploader';
import { UploadedFile } from '@/lib/types';
import { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { FileText, Eye, EyeOff, Loader2 } from 'lucide-react';
import PDFViewer from '@/components/PDFViewer';
import { motion } from 'framer-motion';
import { useToast } from '@/hooks/use-toast';

interface UploadTabProps {
  onFilesUploaded: (files: UploadedFile[]) => void;
  uploadedFiles: UploadedFile[];
  goToNextTab: () => void;
}

const UploadTab = ({ onFilesUploaded, uploadedFiles, goToNextTab }: UploadTabProps) => {
  const [selectedFileForPreview, setSelectedFileForPreview] = useState<UploadedFile | null>(null);
  const [showPreview, setShowPreview] = useState<boolean>(true);
  const [pdfFileForPreview, setPdfFileForPreview] = useState<File | null>(null);
  
  // Stores the mapping from a client-generated ID (from FileUploader) to the actual File object.
  // This is used to get the File object for upload and potentially for preview.
  const [clientRawFileMap, setClientRawFileMap] = useState<Map<string, File>>(new Map());
  const [isUploading, setIsUploading] = useState(false);
  const { toast } = useToast();

  // Effect to update preview when dashboard's uploadedFiles (backend confirmed) change
  useEffect(() => {
    if (uploadedFiles.length > 0) {
      const latestBackendFileMeta = uploadedFiles[uploadedFiles.length - 1];
      setSelectedFileForPreview(latestBackendFileMeta);

      // Attempt to find the raw file for preview using its name and size,
      // as backend IDs won't match client-side IDs in clientRawFileMap.
      let fileToPreview: File | null = null;
      for (const rawFile of clientRawFileMap.values()) {
        if (rawFile.name === latestBackendFileMeta.name && rawFile.size === latestBackendFileMeta.size) {
          fileToPreview = rawFile;
          break;
        }
      }
      setPdfFileForPreview(fileToPreview);

    } else {
      setSelectedFileForPreview(null);
      setPdfFileForPreview(null);
    }
  // Listen to uploadedFiles (from Dashboard) and clientRawFileMap (local state for raw files)
  }, [uploadedFiles, clientRawFileMap]);


  // This function is called by FileUploader when files are selected locally
  const handleFilesSelectedByUploader = async (
    clientSideFileMetadataList: UploadedFile[], // Metadata generated by FileUploader (client-side IDs)
    rawFileObjectsMap: Map<string, File> // The actual File objects, mapped by client-side ID
  ) => {
    // Store the raw files mapped by their client-side ID.
    // This map will be used to retrieve the actual File objects for upload.
    setClientRawFileMap(new Map([...clientRawFileMap, ...rawFileObjectsMap]));
    
    setIsUploading(true);
    toast({ title: "Uploading files...", description: `Attempting to upload ${rawFileObjectsMap.size} file(s).` });

    const formData = new FormData();
    let filesToUploadExist = false;
    
    // Iterate over the File objects from the map to append to FormData
    rawFileObjectsMap.forEach(file => {
      formData.append('files', file); 
      filesToUploadExist = true;
    });

    if (!filesToUploadExist) {
        setIsUploading(false);
        toast({ title: "No new files selected to upload.", variant: "default" });
        // Call onFilesUploaded with current backend-confirmed files if no new files were actually added.
        // This ensures consistency if the user re-selects existing files or an empty list.
        onFilesUploaded(uploadedFiles); // Pass the current state from Dashboard
        return;
    }

    try {
      const response = await fetch('http://localhost:5000/api/upload', {
        method: 'POST',
        body: formData,
      });

      const result = await response.json();

      if (response.ok && result.status === 'success' && result.files) {
        // `result.files` are the UploadedFile objects from the backend.
        // These have backend-generated IDs.
        // We should merge these with any existing uploaded files, handling potential duplicates if necessary.
        // For simplicity here, we'll assume new uploads replace or add.
        // A more robust solution might check for existing files by name/size if re-uploading is possible.
        
        // Create a map of existing files by their backend ID for quick lookup
        const existingFilesMap = new Map(uploadedFiles.map(f => [f.id, f]));
        const newBackendFiles = result.files as UploadedFile[];

        newBackendFiles.forEach(backendFile => {
            existingFilesMap.set(backendFile.id, backendFile); // Add or update file by backend ID
        });
        
        const updatedFilesForDashboard = Array.from(existingFilesMap.values());
        onFilesUploaded(updatedFilesForDashboard); // Update Dashboard state

        toast({
          title: "Upload Successful",
          description: `${newBackendFiles.length} file(s) processed by server. Total uploaded: ${updatedFilesForDashboard.length}`,
        });
      } else {
        throw new Error(result.error || 'Unknown upload error from server');
      }
    } catch (error) {
      console.error("Upload error:", error);
      toast({
        title: "Upload Failed",
        description: error instanceof Error ? error.message : "Could not upload files to server.",
        variant: "destructive",
      });
      // Optionally, you might want to revert clientRawFileMap or not call onFilesUploaded
      // depending on how you want to handle partial failures or retries.
      // For now, we don't change the dashboard's uploadedFiles state on failure here.
    } finally {
      setIsUploading(false);
    }
  };

  const togglePreview = () => {
    setShowPreview(!showPreview);
  };

  // Handle selection for preview from the `uploadedFiles` list (which are backend confirmed)
  const handleFileSelectionForPreview = (fileMetadata: UploadedFile) => {
    setSelectedFileForPreview(fileMetadata);
    // Attempt to find the corresponding raw file for preview from the clientRawFileMap
    // This relies on the raw files being available client-side.
    // If files are cleared from clientRawFileMap after upload, this preview might not work for older files.
    let fileToPreview: File | null = null;
    for (const rawFile of clientRawFileMap.values()) {
        // Match by name and size as IDs might differ (client vs backend)
        if (rawFile.name === fileMetadata.name && rawFile.size === fileMetadata.size) {
            fileToPreview = rawFile;
            break;
        }
    }
    if (fileToPreview) {
      setPdfFileForPreview(fileToPreview);
    } else {
      setPdfFileForPreview(null); 
      toast({title: "Preview unavailable", description: "Original file for preview not found locally.", variant: "default"})
    }
  };

  return (
    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div className="lg:col-span-1 space-y-6">
        <FileUploader 
          onFilesUploaded={handleFilesSelectedByUploader} 
          acceptedFileTypes={['.pdf']}
        />
        
        {isUploading && (
          <div className="flex items-center justify-center p-4 border rounded-md bg-muted">
            <Loader2 className="h-5 w-5 animate-spin mr-2" />
            <span>Uploading files...</span>
          </div>
        )}

        {uploadedFiles.length > 0 && !isUploading && (
          <motion.div 
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ duration: 0.3 }}
            className="border rounded-md"
          >
            <div className="bg-muted p-3 font-medium flex justify-between items-center">
              <div>Uploaded Files ({uploadedFiles.length}/10)</div>
              <Button 
                variant="ghost" 
                size="sm" 
                className="h-8 px-2 text-muted-foreground"
                onClick={togglePreview}
              >
                {showPreview ? <EyeOff className="h-4 w-4 mr-1" /> : <Eye className="h-4 w-4 mr-1" />}
                {showPreview ? "Hide Preview" : "Show Preview"}
              </Button>
            </div>
            <div className="divide-y max-h-[300px] overflow-y-auto">
              {uploadedFiles.map((file) => ( 
                <motion.div
                  key={file.id} 
                  className={`p-3 flex items-center justify-between cursor-pointer hover:bg-muted/50 transition-colors ${selectedFileForPreview?.id === file.id ? 'bg-yellow-50 border-l-2 border-yellow-400' : ''}`}
                  onClick={() => handleFileSelectionForPreview(file)}
                >
                  <div className="flex items-center">
                    <FileText className="h-4 w-4 text-muted-foreground mr-2" />
                    <span className="text-sm font-medium">{file.name}</span>
                  </div>
                  <div className="text-xs text-muted-foreground">
                    {Math.round(file.size / 1024).toLocaleString()} KB
                  </div>
                </motion.div>
              ))}
            </div>
          </motion.div>
        )}
      </div>

      {uploadedFiles.length > 0 && selectedFileForPreview && showPreview && !isUploading && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ duration: 0.3 }}
          className="lg:col-span-2"
        >
          <Card className="h-full">
            <CardHeader className="pb-3">
              <CardTitle className="text-base flex items-center justify-between">
                <div className="flex items-center">
                  <FileText className="h-4 w-4 mr-2" />
                  PDF Preview
                </div>
                <div className="text-sm font-normal">
                  {selectedFileForPreview.name}
                </div>
              </CardTitle>
            </CardHeader>
            <CardContent className="p-0">
              <div className="bg-muted/30 h-[750px] flex flex-col">
                <PDFViewer file={pdfFileForPreview} className="h-full" />
              </div>
            </CardContent>
          </Card>
        </motion.div>
      )}

      <div className="flex justify-end col-span-full">
        <motion.div>
          <Button 
            onClick={goToNextTab} 
            disabled={uploadedFiles.length === 0 || isUploading}
            className="bg-yellow-400 hover:bg-yellow-500 text-black"
          >
            {isUploading ? <Loader2 className="h-4 w-4 animate-spin mr-2" /> : null}
            {isUploading ? "Uploading..." : "Next: Select Prompts"}
          </Button>
        </motion.div>
      </div>
    </div>
  );
};

export default UploadTab;
\`\`\`

# src\components\FileUploader.tsx

\`\`\`tsx

import { useState, useRef, useCallback } from 'react';
import { Button } from '@/components/ui/button';
import { UploadedFile } from '@/lib/types';
import { Upload, FileText, X, Check, Loader } from 'lucide-react';
import { Progress } from '@/components/ui/progress';
import { cn } from '@/lib/utils';
import { useToast } from '@/hooks/use-toast';

interface FileUploaderProps {
  onFilesUploaded: (files: UploadedFile[], actualFiles: Map<string, File>) => void;
  acceptedFileTypes?: string[];
  maxFiles?: number;
}

const FileUploader = ({ 
  onFilesUploaded, 
  acceptedFileTypes = ['.pdf'], 
  maxFiles = 10 
}: FileUploaderProps) => {
  const [files, setFiles] = useState<UploadedFile[]>([]);
  const [isDragging, setIsDragging] = useState(false);
  const fileInputRef = useRef<HTMLInputElement>(null);
  const [actualFiles, setActualFiles] = useState<Map<string, File>>(new Map());
  const { toast } = useToast();

  const handleFileSelect = useCallback((selectedFiles: FileList | null) => {
    if (!selectedFiles || selectedFiles.length === 0) return;

    // Check if adding these files would exceed the maximum
    if (files.length + selectedFiles.length > maxFiles) {
      toast({
        title: "Too many files",
        description: `You can upload a maximum of ${maxFiles} files.`,
        variant: "destructive",
      });
      return;
    }

    const newFiles: UploadedFile[] = [];
    const newActualFiles = new Map(actualFiles);
    
    Array.from(selectedFiles).forEach(file => {
      // Check file type
      const fileExtension = `.${file.name.split('.').pop()?.toLowerCase()}`;
      if (!acceptedFileTypes.includes(fileExtension) && !acceptedFileTypes.includes('*')) {
        toast({
          title: "Invalid file type",
          description: `${file.name} is not a supported file type. Please upload ${acceptedFileTypes.join(", ")} files.`,
          variant: "destructive",
        });
        return;
      }
      
      // File is valid, add it to our list
      const fileId = `file-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
      const newFile: UploadedFile = {
        id: fileId,
        name: file.name,
        size: file.size,
        type: file.type,
        lastModified: file.lastModified,
        status: 'success' as const,  // Mark as success immediately for simplicity
        progress: 100,  // Set to 100% immediately
      };
      
      // Store the actual File object in our Map
      newActualFiles.set(fileId, file);
      newFiles.push(newFile);
    });
    
    if (newFiles.length > 0) {
      // Update state in a single batch
      const updatedFiles = [...files, ...newFiles];
      setFiles(updatedFiles);
      setActualFiles(newActualFiles);
      
      // Notify parent component after our state is updated
      setTimeout(() => {
        onFilesUploaded(updatedFiles, newActualFiles);
      }, 0);
    }
  }, [files, actualFiles, maxFiles, acceptedFileTypes, onFilesUploaded, toast]);

  const removeFile = useCallback((id: string) => {
    const updatedFiles = files.filter(file => file.id !== id);
    setFiles(updatedFiles);
    
    // Also remove the actual File object
    const newActualFiles = new Map(actualFiles);
    newActualFiles.delete(id);
    setActualFiles(newActualFiles);
    
    onFilesUploaded(updatedFiles, newActualFiles);
  }, [files, actualFiles, onFilesUploaded]);

  const formatFileSize = (sizeInBytes: number) => {
    if (sizeInBytes < 1024) return `${sizeInBytes} B`;
    else if (sizeInBytes < 1048576) return `${(sizeInBytes / 1024).toFixed(1)} KB`;
    else return `${(sizeInBytes / 1048576).toFixed(1)} MB`;
  };

  const handleDragOver = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(true);
  };

  const handleDragLeave = () => {
    setIsDragging(false);
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(false);
    handleFileSelect(e.dataTransfer.files);
  };

  return (
    <div className="w-full space-y-4">
      {/* File upload area */}
      <div
        className={cn(
          "border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors",
          isDragging ? "border-yellow-400 bg-yellow-50" : "border-muted-foreground/20",
          files.length >= maxFiles && "opacity-50 cursor-not-allowed"
        )}
        onDragOver={handleDragOver}
        onDragLeave={handleDragLeave}
        onDrop={handleDrop}
        onClick={() => files.length < maxFiles && fileInputRef.current?.click()}
      >
        <input
          type="file"
          ref={fileInputRef}
          className="hidden"
          accept={acceptedFileTypes.join(',')}
          multiple
          onChange={(e) => handleFileSelect(e.target.files)}
          disabled={files.length >= maxFiles}
        />
        <div className="flex flex-col items-center justify-center gap-2">
          <Upload className="h-12 w-12 text-muted-foreground" />
          <h3 className="text-lg font-medium">Upload PDF Financial Reports</h3>
          <p className="text-sm text-muted-foreground max-w-md mx-auto">
            Drag and drop files here, or click to browse. We accept PDF files with financial data.
          </p>
          <Button 
            variant="outline"
            className="mt-2"
            disabled={files.length >= maxFiles}
          >
            Select Files
          </Button>
        </div>
      </div>

      {/* File list */}
      {files.length > 0 && (
        <div className="mt-6">
          <h3 className="font-medium mb-2 text-sm">Uploaded Files ({files.length}/{maxFiles})</h3>
          <div className="space-y-2">
            {files.map(file => (
              <div 
                key={file.id} 
                className="flex items-center p-3 bg-muted/30 rounded-md border"
              >
                <FileText className="h-5 w-5 text-muted-foreground mr-3" />
                <div className="flex-1 min-w-0">
                  <div className="flex justify-between">
                    <p className="text-sm font-medium truncate">{file.name}</p>
                    <span className="text-xs text-muted-foreground">{formatFileSize(file.size)}</span>
                  </div>
                  {file.status === 'pending' && (
                    <Progress value={file.progress} className="h-1 mt-1" />
                  )}
                </div>
                <div className="ml-4 flex items-center">
                  {file.status === 'pending' && <Loader className="h-4 w-4 text-muted-foreground animate-spin" />}
                  {file.status === 'success' && <Check className="h-4 w-4 text-green-500" />}
                  {file.status === 'error' && <X className="h-4 w-4 text-destructive" />}
                  <button 
                    onClick={(e) => {
                      e.stopPropagation();
                      removeFile(file.id);
                    }}
                    className="ml-2 text-muted-foreground hover:text-destructive transition-colors"
                  >
                    <X className="h-4 w-4" />
                  </button>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
};

export default FileUploader;

\`\`\`

# src\components\IntroScreen.tsx

\`\`\`tsx
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { useNavigate } from 'react-router-dom';
import { Progress } from '@/components/ui/progress';
import { motion } from 'framer-motion';

const IntroScreen = () => {
  const navigate = useNavigate();
  const [loading, setLoading] = useState(true);
  const [loadingProgress, setLoadingProgress] = useState(0);
  
  useEffect(() => {
    // Simulate progressive loading
    const totalTime = 2000; // 2 seconds
    const intervalTime = 50; // update every 50ms
    const steps = totalTime / intervalTime;
    let currentStep = 0;
    
    const timer = setInterval(() => {
      currentStep += 1;
      const newProgress = Math.min(100, Math.floor((currentStep / steps) * 100));
      setLoadingProgress(newProgress);
      
      if (newProgress >= 100) {
        clearInterval(timer);
        setTimeout(() => setLoading(false), 200);
      }
    }, intervalTime);
    
    return () => clearInterval(timer);
  }, []);

  const handleEnterApp = () => {
    navigate('/select-bank');
  };

  // Animation variants for the logo and letters
  const containerVariants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: {
        delayChildren: 0.3,
        staggerChildren: 0.1
      }
    }
  };

  const letterVariants = {
    hidden: { y: 20, opacity: 0 },
    visible: {
      y: 0,
      opacity: 1,
      transition: {
        type: "spring",
        damping: 12,
        stiffness: 100
      }
    }
  };

  const floatVariants = {
    animate: {
      y: [0, -10, 0],
      transition: {
        duration: 2,
        repeat: Infinity,
        repeatType: "reverse" as const,
        ease: "easeInOut"
      }
    }
  };

  const logoVariants = {
    hidden: { scale: 0.8, opacity: 0 },
    visible: {
      scale: 1,
      opacity: 1,
      transition: {
        type: "spring",
        damping: 12,
        stiffness: 100
      }
    }
  };

  // Combined animation for the logo that includes floating effect
  const logoAnimation = {
    scale: 1,
    opacity: 1,
    y: [0, -8, 0]
  };
  
  // Combined transition for the logo
  const logoTransition = {
    scale: {
      type: "spring",
      damping: 12,
      stiffness: 100
    },
    opacity: {
      type: "spring",
      damping: 12,
      stiffness: 100
    },
    y: {
      duration: 3,
      repeat: Infinity,
      repeatType: "reverse",
      ease: "easeInOut"
    }
  };
  
  const buttonVariants = {
    initial: { scale: 1 },
    hover: { 
      scale: 1.05,
      transition: { type: "spring", stiffness: 400, damping: 10 }
    },
    tap: { scale: 0.95 }
  };

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-ey-black text-white">
      <div className="w-full max-w-md px-6 py-12 text-center">
        <motion.div 
          className="mb-8"
          initial="hidden"
          animate="visible"
          variants={containerVariants}
        >
          <motion.div 
            className="flex justify-center mb-6"
          >
            <motion.div 
              className="h-16 w-16 bg-ey-yellow rounded-md"
              variants={logoVariants}
              initial="hidden"
              animate={logoAnimation}
              transition={logoTransition}
              whileHover={{ scale: 1.05 }}
            ></motion.div>
          </motion.div>
          
          <motion.h1 
            className="text-4xl font-bold mb-2 flex justify-center"
            variants={containerVariants}
          >
            {Array.from("AiDEx").map((letter, index) => (
              <motion.span
                key={index}
                className="inline-block"
                variants={letterVariants}
                custom={index}
                whileHover={floatVariants.animate}
              >
                {letter}
              </motion.span>
            ))}
          </motion.h1>
          
          <motion.p 
            className="text-ey-gray-400"
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.8 }}
          >
            AI powered Data Extraction
          </motion.p>
          
          <motion.p 
            className="text-ey-gray-500 text-sm mt-1"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 1 }}
          >
            Supported by EYQ
          </motion.p>
        </motion.div>
        
        {loading ? (
          <motion.div 
            className="space-y-3"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.5 }}
          >
            <Progress 
              value={loadingProgress} 
              className="h-2" 
              indicatorClassName="bg-ey-yellow" 
            />
            <p className="text-sm text-ey-gray-400 animate-pulse">
              Loading application... {loadingProgress}%
            </p>
          </motion.div>
        ) : (
          <motion.div
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2 }}
          >
            <motion.button
              onClick={handleEnterApp}
              className="w-full bg-ey-yellow hover:bg-ey-yellow/90 text-ey-black font-medium py-2 px-4 rounded"
              variants={buttonVariants}
              initial="initial"
              whileHover="hover"
              whileTap="tap"
            >
              Enter Application
            </motion.button>
          </motion.div>
        )}
        
        <motion.div 
          className="mt-12 text-xs text-ey-gray-500"
          initial={{ opacity: 0 }}
          animate={{ opacity: 0.7 }}
          transition={{ delay: 1.2 }}
        >
          <p>© {new Date().getFullYear()} EY | A better working world</p>
        </motion.div>
      </div>
    </div>
  );
};

export default IntroScreen;

\`\`\`

# src\components\PDFViewer.tsx

\`\`\`tsx

import { useState, useEffect, useRef } from 'react';
import * as pdfjs from 'pdfjs-dist';
import { Button } from '@/components/ui/button';
import { ChevronLeft, ChevronRight, Loader, RefreshCw } from 'lucide-react';
import { ScrollArea } from '@/components/ui/scroll-area';

// Fix worker import
import { GlobalWorkerOptions } from 'pdfjs-dist';

// Set worker source directly
GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.min.js`;

interface PDFViewerProps {
  file: File | null;
  className?: string;
}

const PDFViewer = ({ file, className = '' }: PDFViewerProps) => {
  const [pdfDoc, setPdfDoc] = useState<pdfjs.PDFDocumentProxy | null>(null);
  const [pageNum, setPageNum] = useState(1);
  const [totalPages, setTotalPages] = useState(0);
  const [isLoading, setIsLoading] = useState(false);
  const [renderError, setRenderError] = useState<string | null>(null);
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const [retryCount, setRetryCount] = useState(0); // Track retry attempts
  const containerRef = useRef<HTMLDivElement>(null);

  // Load the PDF when the file changes or when retryCount changes
  useEffect(() => {
    if (!file) {
      setPdfDoc(null);
      return;
    }

    let isMounted = true;
    
    // Reset states
    setIsLoading(true);
    setRenderError(null);
    
    console.log("Starting to load PDF file:", file.name);
    
    // Convert file to array buffer
    const fileReader = new FileReader();
    
    fileReader.onload = async (event) => {
      if (!isMounted) return;
      
      try {
        const arrayBuffer = event.target?.result;
        
        if (!arrayBuffer) {
          setRenderError("Failed to read file");
          setIsLoading(false);
          return;
        }
        
        // Load the PDF document
        const typedArray = new Uint8Array(arrayBuffer as ArrayBuffer);
        
        console.log("Creating PDF loading task");
        const loadingTask = pdfjs.getDocument(typedArray);
        
        loadingTask.promise
          .then(pdf => {
            if (!isMounted) return;
            
            console.log("PDF loaded successfully with", pdf.numPages, "pages");
            setPdfDoc(pdf);
            setTotalPages(pdf.numPages);
            setPageNum(1); // Reset to first page when loading new PDF
            setIsLoading(false);
          })
          .catch(error => {
            if (!isMounted) return;
            
            console.error('Error loading PDF:', error);
            setRenderError(`Error loading PDF: ${error.message}`);
            setIsLoading(false);
          });
      } catch (error: any) {
        if (!isMounted) return;
        
        console.error('Error processing PDF:', error);
        setRenderError(`Error processing PDF: ${error.message}`);
        setIsLoading(false);
      }
    };
    
    fileReader.onerror = () => {
      if (!isMounted) return;
      
      setRenderError("Error reading file");
      setIsLoading(false);
    };
    
    // Start reading the file
    fileReader.readAsArrayBuffer(file);
    
    return () => {
      isMounted = false;
      if (pdfDoc) {
        try {
          pdfDoc.destroy().catch(e => console.error("Error destroying PDF:", e));
        } catch (error) {
          console.error("Error destroying previous PDF:", error);
        }
      }
    };
  }, [file, retryCount]);

  // Render the PDF page
  useEffect(() => {
    if (!pdfDoc || !canvasRef.current) return;

    let isMounted = true;
    
    const renderPage = async () => {
      if (!isMounted) return;
      
      try {
        // Get the page
        console.log("Getting page", pageNum);
        const page = await pdfDoc.getPage(pageNum);
        
        if (!isMounted || !canvasRef.current) return;
        
        const canvas = canvasRef.current;
        const context = canvas.getContext('2d');
        
        if (!context) {
          setRenderError("Could not get canvas context");
          return;
        }
        
        // Calculate scale to fit width
        const containerWidth = containerRef.current?.clientWidth || canvas.parentElement?.clientWidth || 800;
        const viewport = page.getViewport({ scale: 1.0 });
        const scale = Math.min(containerWidth / viewport.width, 1.0); // Limit scale to 1.0 for better quality
        const scaledViewport = page.getViewport({ scale });

        // Set canvas dimensions
        canvas.height = scaledViewport.height;
        canvas.width = scaledViewport.width;
        
        // Improve rendering quality
        context.imageSmoothingEnabled = true;
        context.imageSmoothingQuality = 'high';
        
        // Set background color
        context.fillStyle = '#FFFFFF';
        context.fillRect(0, 0, canvas.width, canvas.height);
        
        // Render the page
        console.log("Rendering page", pageNum, "of PDF");
        const renderContext = {
          canvasContext: context,
          viewport: scaledViewport,
          background: 'rgba(255,255,255,1)',
        };
        
        await page.render(renderContext).promise;
        
        // Add subtle page border
        context.strokeStyle = '#e2e8f0';
        context.lineWidth = 1;
        context.strokeRect(0, 0, canvas.width, canvas.height);
      } catch (error: any) {
        if (isMounted) {
          console.error('Error rendering page:', error);
          setRenderError(`Error rendering page: ${error.message}`);
        }
      }
    };

    renderPage();
    
    return () => {
      isMounted = false;
    };
  }, [pdfDoc, pageNum]);

  // Effect to adjust canvas size when window resizes
  useEffect(() => {
    const handleResize = () => {
      // Re-render the current page to adjust for new container width
      if (pdfDoc) {
        // Simply update pageNum state to trigger re-render effect
        setPageNum(prevPage => prevPage);
      }
    };

    window.addEventListener('resize', handleResize);
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, [pdfDoc]);

  const goToPreviousPage = () => {
    if (pageNum <= 1) return;
    setPageNum(pageNum - 1);
  };

  const goToNextPage = () => {
    if (pageNum >= totalPages) return;
    setPageNum(pageNum + 1);
  };

  // Create a simple PDF retry button
  const handleRetry = () => {
    if (!file) return;
    setRetryCount(retryCount + 1); // Increment retry count to trigger useEffect
    setIsLoading(true);
    setRenderError(null);
  };

  return (
    <div className={`flex flex-col h-full ${className}`}>
      <ScrollArea className="flex-1 h-full bg-gray-50">
        <div ref={containerRef} className="flex justify-center p-4">
          {isLoading ? (
            <div className="flex flex-col items-center justify-center h-64 w-full">
              <Loader className="h-8 w-8 animate-spin text-yellow-400 mb-4" />
              <div className="text-muted-foreground">
                Loading PDF...
              </div>
            </div>
          ) : renderError ? (
            <div className="flex flex-col items-center justify-center h-64 w-full">
              <div className="text-red-500 mb-4">{renderError}</div>
              <Button 
                variant="outline" 
                size="sm"
                onClick={handleRetry}
                className="flex items-center gap-2"
              >
                <RefreshCw className="h-4 w-4" />
                Retry Loading PDF
              </Button>
            </div>
          ) : !pdfDoc ? (
            <div className="flex items-center justify-center h-64 w-full">
              <div className="text-center">
                <div className="text-muted-foreground mb-2">No PDF selected</div>
                <div className="text-xs text-muted-foreground">Upload a PDF document to view it here</div>
              </div>
            </div>
          ) : (
            <div className="relative shadow-lg bg-white rounded-lg p-1">
              <canvas ref={canvasRef} className="relative z-10 rounded-lg" />
            </div>
          )}
        </div>
      </ScrollArea>

      {pdfDoc && (
        <div className="p-2 border-t bg-white flex justify-between items-center">
          <div className="text-sm text-gray-600 truncate max-w-[150px]">
            {file?.name || "Document"}
          </div>
          <div className="flex items-center space-x-2">
            <Button
              variant="outline"
              size="icon"
              className="h-8 w-8"
              disabled={pageNum === 1}
              onClick={goToPreviousPage}
            >
              <ChevronLeft className="h-4 w-4" />
            </Button>
            <span className="text-sm font-medium min-w-[50px] text-center">
              {pageNum} / {totalPages}
            </span>
            <Button
              variant="outline"
              size="icon"
              className="h-8 w-8"
              disabled={pageNum === totalPages}
              onClick={goToNextPage}
            >
              <ChevronRight className="h-4 w-4" />
            </Button>
          </div>
        </div>
      )}
    </div>
  );
};

export default PDFViewer;

\`\`\`

# src\components\ProcessingStatus.tsx

\`\`\`tsx

import { Card, CardContent } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { cn } from "@/lib/utils";
import { Loader } from "lucide-react";

interface ProcessingStatusProps {
  isProcessing: boolean;
  progress: number;
  currentStep: string;
  totalFiles?: number;
  processedFiles?: number;
  className?: string;
}

const ProcessingStatus = ({
  isProcessing,
  progress,
  currentStep,
  totalFiles = 1,
  processedFiles = 0,
  className
}: ProcessingStatusProps) => {
  if (!isProcessing) return null;

  return (
    <Card className={cn("border-yellow-400 bg-yellow-50", className)}>
      <CardContent className="p-4 space-y-3">
        <div className="flex items-center justify-between">
          <div>
            <div className="flex items-center text-sm">
              <span className="font-medium text-black">Processing</span>
              <span className="ml-2 text-black/70">{processedFiles}/{totalFiles} files</span>
            </div>
            <p className="text-xs text-black/70">Extracting financial data from reports</p>
          </div>
          <Loader className="h-4 w-4 text-yellow-500 animate-spin" />
        </div>
        
        <div className="space-y-2">
          <div className="text-sm font-medium text-black">{currentStep}</div>
          <div className="relative">
            <Progress 
              value={progress} 
              className="h-2" 
              indicatorClassName="bg-yellow-400" 
            />
            <div className="absolute right-0 top-0 -mt-5 text-xs font-medium text-black">
              {progress.toFixed(1)}%
            </div>
          </div>
          <div className="text-xs text-black/70">
            Processing financial data, please wait...
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

export default ProcessingStatus;

\`\`\`

# src\components\PromptDescriptions.tsx

\`\`\`tsx
// src/components/PromptDescriptions.tsx

import { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from "@/components/ui/accordion";
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { Building2, FileText, Newspaper, Info } from "lucide-react"; 
import { PromptOption } from "@/lib/types"; 
import { useEffect, useState, useMemo } from "react";

interface PromptDescriptionsProps {
  availablePrompts: PromptOption[]; 
  bankDisplay: string; 
}

interface GroupedPrompts {
  [groupTitle: string]: { 
    prompts: PromptOption[];
    isBankGroup?: boolean; 
    categories?: { 
        [categoryName: string]: PromptOption[];
    }
  };
}

// Helper function defined outside or at the top of the component file
const getCategoryIcon = (groupName: string, isBankGroup?: boolean): JSX.Element => {
  if (isBankGroup) return <Building2 className="h-5 w-5 text-yellow-500 flex-shrink-0" />;
  const lowerGroupName = groupName.toLowerCase();
  if (lowerGroupName.includes("ecl") || lowerGroupName.includes("credit risk")) return <FileText className="h-5 w-5 text-yellow-500 flex-shrink-0" />;
  if (lowerGroupName.includes("scenario")) return <Newspaper className="h-5 w-5 text-yellow-500 flex-shrink-0" />;
  if (lowerGroupName.includes("methodology")) return <Info className="h-5 w-5 text-yellow-500 flex-shrink-0" />;
  return <Info className="h-5 w-5 text-yellow-500 flex-shrink-0" />; 
};

const PromptDescriptions = ({ availablePrompts, bankDisplay }: PromptDescriptionsProps) => {
  const [isMultiBankMode, setIsMultiBankMode] = useState(false);
  
  useEffect(() => {
    setIsMultiBankMode(sessionStorage.getItem('enableMultiBanks') === 'true');
  }, []); // Run once on mount or when relevant session storage might change

  const groupedPrompts = useMemo(() => {
    const enableMulti = sessionStorage.getItem('enableMultiBanks') === 'true';
    // setIsMultiBankMode(enableMulti); // Setting state inside useMemo is an anti-pattern. Moved to useEffect.

    if (!availablePrompts || availablePrompts.length === 0) {
      return {};
    }

    const newGroupedPrompts: GroupedPrompts = {};
    if (enableMulti) {
      availablePrompts.forEach(prompt => {
        const bankKey = prompt.bankName || "Other Banks";
        if (!newGroupedPrompts[bankKey]) {
          newGroupedPrompts[bankKey] = { prompts: [], isBankGroup: true, categories: {} };
        }
        newGroupedPrompts[bankKey].prompts.push(prompt);
        
        const categoryKey = prompt.category || "Default Prompts";
        // Ensure categories object exists before pushing
        if (!newGroupedPrompts[bankKey].categories) {
            newGroupedPrompts[bankKey].categories = {};
        }
        if (!newGroupedPrompts[bankKey].categories![categoryKey]) {
          newGroupedPrompts[bankKey].categories![categoryKey] = [];
        }
        newGroupedPrompts[bankKey].categories![categoryKey].push(prompt);
      });
    } else {
      // Single bank mode: group by prompt.category directly
      let singleBankPromptsCategorized: Record<string, PromptOption[]> = {};
      availablePrompts.forEach(prompt => {
          const categoryKey = prompt.category || "Default Prompts";
           if (!singleBankPromptsCategorized[categoryKey]) {
            singleBankPromptsCategorized[categoryKey] = [];
          }
          singleBankPromptsCategorized[categoryKey].push(prompt);
      });
      // If single bank, the top-level group IS the category
      for(const categoryKey in singleBankPromptsCategorized) {
        newGroupedPrompts[categoryKey] = { prompts: singleBankPromptsCategorized[categoryKey], isBankGroup: false };
      }
    }
    return newGroupedPrompts;
  }, [availablePrompts, bankDisplay]); // isMultiBankMode will be stable from its own useEffect

  const renderPromptList = (prompts: PromptOption[]) => (
    prompts.map((prompt) => (
      <div key={prompt.id} className="bg-muted/40 dark:bg-slate-800/30 p-3 rounded-md border border-gray-200 dark:border-slate-700/60 space-y-1.5">
        <div className="font-semibold text-sm text-foreground">{prompt.name}</div>
        {prompt.description && (
          <p className="text-xs text-muted-foreground italic">
            {prompt.description}
          </p>
        )}
        <details className="text-xs">
          <summary className="cursor-pointer text-blue-600 dark:text-blue-400 hover:underline focus:outline-none">
            Show Actual Prompt Text
          </summary>
          <pre className="mt-1.5 p-2 bg-gray-100 dark:bg-slate-900/50 rounded text-xs whitespace-pre-wrap break-words overflow-x-auto max-h-48">
            {prompt.template}
          </pre>
        </details>
      </div>
    ))
  );

  // ... (rest of the JSX from the previous correct version) ...
  return (
    <Card className="shadow-sm border-gray-200 dark:border-gray-700 h-full flex flex-col">
      <CardHeader className="bg-gray-50 dark:bg-slate-800/50 border-b dark:border-gray-700">
        <CardTitle className="text-lg flex items-center">
          <Building2 className="mr-2 h-5 w-5 text-yellow-500 flex-shrink-0" />
          Available Extraction Prompts
        </CardTitle>
        <CardDescription className="dark:text-slate-400">
          Details of prompts loaded from the CSV for: <span className="font-medium">{bankDisplay}</span>.
        </CardDescription>
      </CardHeader>
      <CardContent className="pt-4 flex-grow overflow-y-auto">
        {availablePrompts.length === 0 ? (
          <div className="text-center py-10 h-full flex flex-col justify-center items-center">
            <Info className="h-10 w-10 text-muted-foreground mb-3" />
            <p className="text-muted-foreground">No predefined prompts loaded for {bankDisplay}.</p>
            <p className="text-sm text-muted-foreground mt-1">Prompts are sourced from the central CSV file via the backend.</p>
          </div>
        ) : (
          <Accordion type={isMultiBankMode ? "multiple" : "single"} collapsible className="w-full">
            {Object.entries(groupedPrompts).map(([groupTitle, groupData]) => (
              <AccordionItem key={groupTitle} value={groupTitle} className="border-b dark:border-slate-700 last:border-b-0">
                <AccordionTrigger className="hover:bg-gray-100 dark:hover:bg-slate-700/40 px-4 py-3 rounded-t-md text-left">
                  <div className="flex items-center">
                    {getCategoryIcon(groupTitle, groupData.isBankGroup)}
                    <span className="ml-3 font-medium text-foreground">{groupTitle} ({groupData.prompts.length})</span>
                  </div>
                </AccordionTrigger>
                <AccordionContent className="px-2 pt-1 pb-3 space-y-2 bg-background dark:bg-slate-800/10 rounded-b-md">
                  {groupData.isBankGroup && groupData.categories ? (
                    <Accordion type="multiple" className="w-full pl-2">
                      {Object.entries(groupData.categories).map(([categoryName, promptsInCategory]) => (
                         <AccordionItem key={`${groupTitle}-${categoryName}`} value={`${groupTitle}-${categoryName}`} className="border-none">
                           <AccordionTrigger className="text-sm hover:bg-gray-50 dark:hover:bg-slate-700/20 px-2 py-2 rounded-md text-left">
                             <div className="flex items-center">
                               {getCategoryIcon(categoryName, false)} {/* isBankGroup is false for categories */}
                               <span className="ml-2 font-normal">{categoryName} ({promptsInCategory.length})</span>
                             </div>
                           </AccordionTrigger>
                           <AccordionContent className="px-2 pt-1 pb-2 space-y-2">
                             {renderPromptList(promptsInCategory)}
                           </AccordionContent>
                         </AccordionItem>
                      ))}
                    </Accordion>
                  ) : (
                    renderPromptList(groupData.prompts)
                  )}
                </AccordionContent>
              </AccordionItem>
            ))}
          </Accordion>
        )}
      </CardContent>
      <CardFooter className="bg-gray-50 dark:bg-slate-800/30 text-xs text-center py-3 border-t dark:border-gray-700 mt-auto">
        <div className="w-full flex items-center justify-center">
          <span className="text-slate-500 dark:text-slate-400">Supported by</span>
          <span className="font-semibold text-black dark:text-white ml-1">EYQ</span>
          <span className="text-slate-500 dark:text-slate-400 ml-1">natural language processing</span>
        </div>
      </CardFooter>
    </Card>
  );
};

export default PromptDescriptions;
\`\`\`

# src\components\PromptSelector.tsx

\`\`\`tsx
// src/components/PromptSelector.tsx

import { useState, useEffect, useCallback } from 'react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'; //
import { Label } from '@/components/ui/label'; //
import { Input } from '@/components/ui/input'; //
import { Button } from '@/components/ui/button'; //
import { Check, FileText, Upload, Loader2 } from 'lucide-react';
import { PromptOption } from '@/lib/types';
import { ScrollArea } from '@/components/ui/scroll-area'; //
import { Badge } from '@/components/ui/badge'; //
import { cn } from '@/lib/utils'; //
import { parseExcelPrompts } from '@/lib/excelUtils'; //
import { useToast } from '@/hooks/use-toast'; //

interface PromptSelectorProps {
  onPromptsApplied: (prompts: PromptOption[]) => void; // Changed from onPromptSelected
  disabled?: boolean;
  availablePredefinedPrompts: PromptOption[];
  initiallyTickedPrompts?: PromptOption[]; // Renamed for clarity
  bankDisplay: string;
}

const PromptSelector = ({ 
  onPromptsApplied, 
  disabled = false,
  availablePredefinedPrompts,
  initiallyTickedPrompts = [],
  bankDisplay
}: PromptSelectorProps) => {
  // Local state for user's temporary selections before applying
  const [locallyTickedPrompts, setLocallyTickedPrompts] = useState<PromptOption[]>([]);
  
  const [customPromptFile, setCustomPromptFile] = useState<File | null>(null);
  const [customPrompts, setCustomPrompts] = useState<PromptOption[]>([]);
  const [isLoadingCustom, setIsLoadingCustom] = useState(false);
  const { toast } = useToast();
  
  // Sync local ticks when initiallyTickedPrompts (from Dashboard) or available prompts change
  useEffect(() => {
    // Filter initiallyTickedPrompts to only include those available for the current bank
    const relevantInitialTicks = initiallyTickedPrompts.filter(initPrompt =>
      availablePredefinedPrompts.some(availPrompt => availPrompt.id === initPrompt.id)
    );
    setLocallyTickedPrompts(relevantInitialTicks);
  }, [initiallyTickedPrompts, availablePredefinedPrompts]);
  
  const togglePrompt = (prompt: PromptOption) => {
    if (disabled) return;
    setLocallyTickedPrompts(prevSelected => {
      const isSelected = prevSelected.some(p => p.id === prompt.id);
      if (isSelected) {
        return prevSelected.filter(p => p.id !== prompt.id);
      } else {
        return [...prevSelected, prompt];
      }
    });
  };
  
  const selectAllPredefinedPrompts = () => {
    if (disabled || availablePredefinedPrompts.length === 0) return;
    setLocallyTickedPrompts([...availablePredefinedPrompts]);
  };
  
  const deselectAllPredefinedPrompts = () => {
    if (disabled) return;
    // Deselect only from the predefined ones, keep custom selections if any were merged previously (though UI separates this now)
    setLocallyTickedPrompts(locallyTickedPrompts.filter(p => !availablePredefinedPrompts.some(ap => ap.id === p.id)));
  };
  
  const handleApplyPredefined = () => {
    // Filter to ensure only available predefined prompts are applied
    const promptsToApply = locallyTickedPrompts.filter(ltp => 
      availablePredefinedPrompts.some(ap => ap.id === ltp.id)
    );
    onPromptsApplied(promptsToApply);
     toast({
        title: "Predefined Prompts Applied",
        description: `${promptsToApply.length} predefined prompt(s) now selected for processing.`,
      });
  };
  
  const handleCustomPromptUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    if (e.target.files && e.target.files[0]) {
      const file = e.target.files[0];
      setCustomPromptFile(file);
      setIsLoadingCustom(true);
      try {
        const parsedPrompts = await parseExcelPrompts(file);
        setCustomPrompts(parsedPrompts);
        toast({
          title: "Excel File Processed",
          description: `${parsedPrompts.length} custom prompts loaded. Click 'Apply Custom Prompts'.`,
        });
      } catch (error) {
        toast({
          title: "Error Processing Excel File",
          description: error instanceof Error ? error.message : "Unknown error occurred",
          variant: "destructive",
        });
        setCustomPrompts([]);
      } finally {
        setIsLoadingCustom(false);
      }
    }
  };
  
  const handleApplyCustomPrompts = () => {
    if (customPrompts.length > 0) {
      onPromptsApplied(customPrompts); 
      setLocallyTickedPrompts(customPrompts); // Update local selection to reflect this choice
      toast({
        title: "Custom Prompts Applied",
        description: `${customPrompts.length} custom prompt(s) are now selected for processing.`,
      });
    }
  };

  const predefinedPromptsByCategory = (availablePredefinedPrompts || []).reduce((acc, prompt) => {
    const category = prompt.category || "Default";
    if (!acc[category]) acc[category] = [];
    acc[category].push(prompt);
    return acc;
  }, {} as Record<string, PromptOption[]>);

  const customPromptsForDisplayByCategory = customPrompts.reduce((acc, prompt) => {
    const category = prompt.category || "Custom";
    if (!acc[category]) acc[category] = [];
    acc[category].push(prompt);
    return acc;
  }, {} as Record<string, PromptOption[]>);

  return (
    <div className="space-y-6">
      {/* Info Section - This layout can be adjusted as per your original design if it was part of a two-column layout */}
      <div className="space-y-4 lg:col-span-1"> {/* Assuming it's stacked or adjust grid if needed */}
        <div>
          <h2 className="text-lg font-semibold mb-1">Select Data to Extract</h2>
          <p className="text-sm text-muted-foreground">
            Choose financial data points to extract from PDFs for: <span className="font-medium">{bankDisplay}</span>.
          </p>
        </div>
        <div className="bg-muted p-4 rounded-lg border">
          <h3 className="font-medium mb-2">How It Works</h3>
          <p className="text-sm text-muted-foreground">
            Select predefined prompts relevant to {bankDisplay}, or upload an Excel file with your own custom prompts. Selections here will be used for the "Process Files" step.
          </p>
        </div>
      </div>

      {/* Prompt Selection Tabs */}
      <div className="lg:col-span-1"> {/* Assuming it's stacked or adjust grid if needed */}
        <Tabs defaultValue="predefined" className="w-full">
          <TabsList className="grid grid-cols-2 mb-4 w-full">
            <TabsTrigger value="predefined" className="text-sm">Predefined Prompts ({availablePredefinedPrompts.length})</TabsTrigger>
            <TabsTrigger value="custom" className="text-sm">Custom Excel Prompts</TabsTrigger>
          </TabsList>
          
          <TabsContent value="predefined">
            <div className="space-y-4">
              {availablePredefinedPrompts.length === 0 && !disabled ? (
                 <div className="text-center py-10 border rounded-md">
                    <p className="text-muted-foreground">No predefined prompts found for {bankDisplay}.</p>
                    <p className="text-sm text-muted-foreground mt-1">Check the CSV or use the "Custom Excel Prompts" tab.</p>
                 </div>
              ) : (
                <>
                  <div className="flex justify-between items-center mb-2">
                    <div>
                      <span className="text-sm font-medium">
                        {locallyTickedPrompts.filter(p => availablePredefinedPrompts.some(ap => ap.id === p.id)).length} of {availablePredefinedPrompts.length} selected
                      </span>
                    </div>
                    <div className="space-x-2">
                      <Button 
                        variant="outline" size="sm" onClick={selectAllPredefinedPrompts} 
                        disabled={disabled || availablePredefinedPrompts.length === 0 || locallyTickedPrompts.length === availablePredefinedPrompts.length}
                      >Select All</Button>
                      <Button 
                        variant="outline" size="sm" onClick={deselectAllPredefinedPrompts} 
                        disabled={disabled || locallyTickedPrompts.filter(p => availablePredefinedPrompts.some(ap => ap.id === p.id)).length === 0}
                      >Deselect All</Button>
                    </div>
                  </div>
                  
                  <ScrollArea className="h-[300px] pr-1 border rounded-md p-2"> {/* Adjusted height & padding */}
                    {Object.entries(predefinedPromptsByCategory).map(([category, promptsInCategory]) => (
                      <div key={category} className="mb-4">
                        <h4 className="text-xs font-semibold text-muted-foreground mb-2 uppercase tracking-wider px-1">{category}</h4>
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2"> {/* Two columns for prompt cards */}
                          {promptsInCategory.map((prompt) => (
                            <div 
                              key={prompt.id}
                              className={cn(
                                "border rounded-lg p-3 cursor-pointer transition-all hover:shadow-lg", // More card-like
                                locallyTickedPrompts.some(p => p.id === prompt.id) 
                                  ? "border-yellow-500 bg-yellow-100 dark:bg-yellow-700/30 text-black dark:text-white ring-2 ring-yellow-400" 
                                  : "border-gray-300 dark:border-gray-700 bg-card hover:bg-muted/70",
                                disabled ? "opacity-60 cursor-not-allowed" : ""
                              )}
                              onClick={() => !disabled && togglePrompt(prompt)}
                              role="checkbox"
                              aria-checked={locallyTickedPrompts.some(p => p.id === prompt.id)}
                              tabIndex={disabled ? -1 : 0}
                              onKeyDown={(e) => { if (e.key === ' ' || e.key === 'Enter') !disabled && togglePrompt(prompt); }}
                            >
                              <div className="flex justify-between items-start mb-1">
                                <div className="font-semibold text-sm text-foreground">{prompt.name}</div>
                                {locallyTickedPrompts.some(p => p.id === prompt.id) && (
                                  <Check className="h-5 w-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0" />
                                )}
                              </div>
                              <p className="text-xs text-muted-foreground line-clamp-2"> {/* Ensure description class matches styling */}
                                {prompt.description}
                              </p>
                            </div>
                          ))}
                        </div>
                      </div>
                    ))}
                  </ScrollArea>
                  
                  <Button 
                    className="w-full bg-yellow-400 hover:bg-yellow-500 text-black mt-4" 
                    onClick={handleApplyPredefined}
                    disabled={disabled || availablePredefinedPrompts.length === 0}
                  >
                    Apply Selected Predefined Prompts
                  </Button>
                </>
              )}
            </div>
          </TabsContent>
          
          {/* Custom Prompts Tab - styling remains similar, ensure functionality */}
          <TabsContent value="custom">
            {/* ... (Custom Prompts UI - largely unchanged from your previous version) ... */}
            <div className="space-y-6">
                <div className="bg-muted/50 p-4 rounded-md border">
                  <div className="flex items-start">
                    <FileText className="h-6 w-6 text-muted-foreground mr-3 mt-1" />
                    <div>
                      <h4 className="font-medium text-sm">Upload Custom Prompts via Excel</h4>
                      <p className="text-xs text-muted-foreground mt-1">
                        The Excel file should contain columns: `Bank`, `PromptName`, `PromptText`, and optionally `Category`.
                      </p>
                    </div>
                  </div>
                </div>
                
                <div>
                  <Label htmlFor="promptFile">Upload Prompt Excel File (.xlsx, .xls)</Label>
                  <div className="mt-2 flex items-center space-x-3">
                    <div className="flex-1 relative">
                      <Input 
                        id="promptFile" type="file" onChange={handleCustomPromptUpload} 
                        accept=".xlsx,.xls" disabled={disabled || isLoadingCustom} className="flex-1"
                      />
                      {isLoadingCustom && (
                        <div className="absolute inset-0 flex items-center justify-center bg-background/70">
                          <Loader2 className="h-5 w-5 animate-spin text-yellow-500" />
                        </div>
                      )}
                    </div>
                    <Button 
                      variant="outline" size="icon" disabled={disabled || isLoadingCustom}
                      onClick={() => (document.getElementById('promptFile') as HTMLInputElement)?.click()}
                      aria-label="Upload custom prompt file"
                    ><Upload className="h-4 w-4" /></Button>
                  </div>
                  {customPromptFile && (
                    <div className="mt-2 flex items-center text-sm">
                      <FileText className="h-4 w-4 text-yellow-500 mr-2 flex-shrink-0" />
                      <span className="truncate">{customPromptFile.name}</span>
                      <Badge variant="outline" className="ml-2 text-xs">
                        {isLoadingCustom ? 'Processing...' : `${customPrompts.length} prompts loaded`}
                      </Badge>
                    </div>
                  )}
                </div>
                
                {customPrompts.length > 0 && !isLoadingCustom && (
                  <div className="border rounded-md p-4">
                    <h3 className="text-sm font-medium mb-3">Loaded Custom Prompts Preview</h3>
                    <ScrollArea className="h-[150px]">
                      <div className="space-y-1">
                        {Object.entries(customPromptsForDisplayByCategory).map(([category, prompts]) => (
                          <div key={category} className="mb-2">
                            <h4 className="text-xs font-semibold text-muted-foreground mb-1 uppercase tracking-wider">{category}</h4>
                            {prompts.map((prompt) => (
                              <div key={prompt.id} className="text-sm py-0.5 px-1 rounded-sm truncate" title={prompt.name}>
                                - {prompt.name}
                              </div>
                            ))}
                          </div>
                        ))}
                      </div>
                    </ScrollArea>
                  </div>
                )}
                
                <Button 
                  className="w-full bg-yellow-400 hover:bg-yellow-500 text-black" 
                  disabled={!customPromptFile || disabled || isLoadingCustom || customPrompts.length === 0}
                  onClick={handleApplyCustomPrompts}
                > Apply Custom Prompts
                </Button>
              </div>
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
};

export default PromptSelector;
\`\`\`

# src\components\ResultsViewer.tsx

\`\`\`tsx
// src/components/ResultsViewer.tsx

import { useState, useEffect, useMemo } from 'react'; // Added useMemo
import { Card, CardContent } from '@/components/ui/card';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { Button } from '@/components/ui/button';
import { AlertCircle, Check, Download, Loader2, Info, ChevronsUpDown, Star } from 'lucide-react';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { ProcessingResult } from '@/lib/types';
import { cn } from '@/lib/utils';
import { Badge } from '@/components/ui/badge';
import { ScrollArea } from '@/components/ui/scroll-area';
import ProcessingStatus from './ProcessingStatus';
import {
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
} from "@/components/ui/collapsible";

export interface ResultsViewerProps {
  results: ProcessingResult[];
  onDownloadResults: () => void;
  isProcessing?: boolean;
  processingProgress?: number;
  processingStep?: string;
  totalFiles?: number;
  processedFiles?: number;
  selectedBank: string;
}

const ResultsViewer = ({ 
  results, 
  onDownloadResults, 
  isProcessing = false, 
  processingProgress = 0, 
  processingStep = '',
  totalFiles = 1,
  processedFiles = 0,
  selectedBank
}: ResultsViewerProps) => {
  const [selectedResultId, setSelectedResultId] = useState<string | null>(null);
  const [isNotesOpen, setIsNotesOpen] = useState(false);

  useEffect(() => {
    if (results.length > 0) {
      if (!selectedResultId || !results.find(r => r.id === selectedResultId)) {
        setSelectedResultId(results[0].id); 
      }
    } else {
      setSelectedResultId(null); 
    }
    // Only reset notes if the selected result actually changes or results become empty
    // This prevents notes from closing if results array is updated but selection remains the same valid item.
  }, [results]); // Removed selectedResultId from deps to avoid loop with setIsNotesOpen

  useEffect(() => {
    setIsNotesOpen(false); // Close notes when the selected result changes
  }, [selectedResultId]);


  const currentResult = useMemo(() => results.find(result => result && result.id === selectedResultId), [results, selectedResultId]);
  
  const resultsByFile = useMemo(() => results.reduce((acc, result) => {
    if (!result) return acc;
    const fileKey = result.fileId || result.fileName; 
    if (!acc[fileKey]) {
      acc[fileKey] = [];
    }
    acc[fileKey].push(result);
    return acc;
  }, {} as Record<string, ProcessingResult[]>), [results]);

  const isEclByStageCategory = currentResult?.data?.some(item => item?.Category === 'ECL By Stage');
  
  // ... (if (results.length === 0 && !isProcessing) ... block )
  // ... (if (isProcessing && results.length === 0) ... block )
  if (results.length === 0 && !isProcessing) {
    return (
      <div className="space-y-6">
        <div>
          <h2 className="text-lg font-semibold mb-1">Extraction Results</h2>
          <p className="text-sm text-muted-foreground">View and download extracted financial data for {selectedBank}</p>
        </div>
        <Card className="dark:border-gray-700">
          <CardContent className="flex flex-col items-center justify-center p-12 text-center">
            <Info className="h-10 w-10 text-muted-foreground mb-4"/>
            <div className="text-muted-foreground mb-2">No extraction results yet.</div>
            <div className="text-sm text-muted-foreground">Process files to see extraction results.</div>
          </CardContent>
        </Card>
      </div>
    );
  }

  if (isProcessing && results.length === 0) {
    return (
      <div className="space-y-6">
        <div>
          <h2 className="text-lg font-semibold mb-1">Extraction Results</h2>
          <p className="text-sm text-muted-foreground">View and download extracted financial data for {selectedBank}</p>
        </div>
        <ProcessingStatus
          isProcessing={isProcessing}
          progress={processingProgress}
          currentStep={processingStep}
          totalFiles={totalFiles}
          processedFiles={processedFiles}
        />
        <div className="flex items-center justify-center h-[300px] border rounded-lg dark:border-gray-700">
            <div className="text-center p-8">
                <Loader2 className="mx-auto h-12 w-12 text-yellow-500 animate-spin mb-4" />
                <h3 className="text-lg font-medium mb-2">Processing Data...</h3>
                <p className="text-sm text-muted-foreground">
                    {processingStep || "Extracting information from your documents..."}
                </p>
            </div>
        </div>
      </div>
    );
  }


  return (
    <div className="space-y-6">
      {/* ... (Header and Download button section remains the same) ... */}
      <div className="flex justify-between items-center">
        <div>
          <h2 className="text-lg font-semibold mb-1">Extraction Results</h2>
          <p className="text-sm text-muted-foreground">View and download extracted financial data for {selectedBank}</p>
        </div>
        <Button 
          variant="outline" size="sm" onClick={onDownloadResults}
          disabled={isProcessing || results.length === 0}
          className="flex items-center gap-1 border-yellow-400 bg-white text-black hover:bg-yellow-50 dark:text-black dark:hover:bg-yellow-100 dark:border-yellow-500"
        >
          <Download className="h-4 w-4" />
          <span>Download All Results</span>
        </Button>
      </div>
      
      {isProcessing && (
          <ProcessingStatus
            isProcessing={isProcessing}
            progress={processingProgress}
            currentStep={processingStep}
            totalFiles={totalFiles}
            processedFiles={processedFiles}
            className="mb-6"
          />
      )}

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div className="lg:col-span-1">
           {/* ... (Processed Files & Prompts list logic remains the same) ... */}
           <Card className="overflow-hidden h-full flex flex-col dark:bg-gray-800 dark:border-gray-700">
            <div className="bg-black text-white p-2 text-sm font-medium">Processed Files & Prompts</div>
            <ScrollArea className="h-[400px] flex-grow">
              <div className="p-2">
                {Object.entries(resultsByFile).map(([fileKey, fileResults]) => {
                  const fileInfo = fileResults[0];
                  if (!fileInfo) return null;
                  return (
                    <div key={fileKey} className="mb-4">
                      <div className="text-sm font-medium p-2 bg-muted dark:bg-gray-700 rounded-t-md">
                        {fileInfo.fileName}
                      </div>
                      <div className="border border-t-0 rounded-b-md dark:border-gray-600">
                        {fileResults.map(result => {
                          if (!result) return null;
                          const isSelected = selectedResultId === result.id;
                          return (
                            <div 
                              key={result.id}
                              className={cn(
                                "flex items-center justify-between p-2 text-sm rounded-sm cursor-pointer border-b dark:border-gray-600 last:border-b-0",
                                isSelected ? "bg-yellow-100 dark:bg-yellow-700/50 border-l-4 border-yellow-500 dark:border-yellow-400 text-black dark:text-white" : "hover:bg-muted/50 dark:hover:bg-gray-700/30"
                              )}
                              onClick={() => {setSelectedResultId(result.id); /* setIsNotesOpen will be reset by useEffect now */}}
                            >
                              <div className="truncate pr-2">{result.promptName}</div>
                              <div className="flex items-center flex-shrink-0">
                                {result.status === 'success' && <Check className="h-4 w-4 text-green-500" />}
                                {result.status === 'error' && <AlertCircle className="h-4 w-4 text-red-500" />}
                                {(result.status === 'pending' || result.status === 'processing') && <Loader2 className="h-4 w-4 text-blue-500 animate-spin" />}
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  );
                })}
              </div>
            </ScrollArea>
          </Card>
        </div>
        
        <div className="lg:col-span-2">
          {currentResult ? (
            <Card className="overflow-hidden h-full flex flex-col dark:bg-gray-800 dark:border-gray-700">
              {/* ... (Card Header with promptName, fileName, status Badge remains the same) ... */}
              <div className="bg-black text-white p-3 flex justify-between items-center">
                <div>
                  <div className="font-medium">{currentResult.promptName}</div>
                  <div className="text-xs text-gray-400">From: {currentResult.fileName}</div>
                </div>
                <Badge 
                  className={cn("capitalize text-white", currentResult.status === 'success' && "bg-green-600", currentResult.status === 'error' && "bg-red-600", (currentResult.status === 'pending' || currentResult.status === 'processing') && "bg-blue-500")}>
                  {currentResult.status}
                </Badge>
              </div>
              
              <div className="p-3 flex-grow overflow-y-auto">
                {/* ... (status handling for processing and error remains the same) ... */}
                {currentResult.status === 'processing' && ( <div className="flex flex-col items-center justify-center h-full py-8"><Loader2 className="h-8 w-8 text-yellow-500 animate-spin mb-2" /><div className="text-sm text-muted-foreground">Processing...</div></div>)}
                {currentResult.status === 'error' && currentResult.error && ( <Alert variant="destructive" className="my-4"><AlertCircle className="h-4 w-4" /><AlertTitle>Extraction Error</AlertTitle><AlertDescription>{currentResult.error}</AlertDescription></Alert>)}
                
                {currentResult.notes && (
                  <Collapsible open={isNotesOpen} onOpenChange={setIsNotesOpen} className="w-full space-y-1 mb-4">
                    <CollapsibleTrigger asChild>
                      <Button variant="ghost" className="flex items-center justify-start p-0 h-auto text-blue-600 dark:text-blue-400 hover:underline focus-visible:ring-0 focus-visible:ring-offset-0">
                        <Info className="h-4 w-4 mr-2 flex-shrink-0" />
                        <span className="text-sm font-medium">{isNotesOpen ? "Hide Notes" : "Show Notes from LLM"}</span>
                        <ChevronsUpDown className={`h-4 w-4 ml-1 transition-transform duration-200 ${isNotesOpen ? 'rotate-180' : ''} flex-shrink-0`} />
                      </Button>
                    </CollapsibleTrigger>
                    <CollapsibleContent>
                      <Alert variant="default" className="mt-1 bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800">
                        <AlertDescription className="text-blue-700 dark:text-blue-300 text-xs whitespace-pre-wrap max-h-48 overflow-y-auto">
                            {currentResult.notes}
                        </AlertDescription>
                      </Alert>
                    </CollapsibleContent>
                  </Collapsible>
                )}
                
                {currentResult.status === 'success' && currentResult.data && currentResult.data.length > 0 && (
                  <Tabs defaultValue="table" className="flex flex-col h-full">
                    {/* ... (TabsList remains the same) ... */}
                    <TabsList className="mb-4 shrink-0">
                      <TabsTrigger value="table">Table View</TabsTrigger>
                      <TabsTrigger value="json">JSON View</TabsTrigger>
                      {isEclByStageCategory && (<TabsTrigger value="by-stage">By Stage</TabsTrigger>)}
                    </TabsList>
                    
                    <ScrollArea className="flex-grow min-h-0">
                      {/* ... (TabsContent for "table" and "json" remain the same) ... */}
                      <TabsContent value="table" className="mt-0">
                        <Table>
                          <TableHeader className="bg-muted dark:bg-gray-700/80 sticky top-0 z-10">
                            <TableRow className="dark:border-gray-600">
                              <TableHead className="font-semibold dark:text-gray-200">Category</TableHead>
                              <TableHead className="font-semibold dark:text-gray-200">Stage</TableHead>
                              <TableHead className="font-semibold dark:text-gray-200">Field</TableHead>
                              <TableHead className="font-semibold dark:text-gray-200">Value</TableHead>
                            </TableRow>
                          </TableHeader>
                          <TableBody>
                            {currentResult.data.map((item, index) => {
                              if (!item) return null;
                              return (
                                <TableRow key={`table-item-${index}`} className="dark:border-gray-600">
                                  <TableCell className="dark:text-gray-300">{item.Category === 'ECL By Stage' ? 'ECL' : String(item.Category)}</TableCell>
                                  <TableCell className="dark:text-gray-300">{String(item.Stage)}</TableCell>
                                  <TableCell className="dark:text-gray-300">{String(item.Field)}</TableCell>
                                  <TableCell className="font-medium dark:text-gray-200">{String(item.Value)}</TableCell>
                                </TableRow>
                              );
                            })}
                          </TableBody>
                        </Table>
                      </TabsContent>
                      <TabsContent value="json" className="mt-0">
                          <pre className="bg-muted dark:bg-gray-700/50 p-4 rounded-md text-xs overflow-x-auto">
                            {JSON.stringify(currentResult.data, null, 2)}
                          </pre>
                      </TabsContent>
                      
                      {isEclByStageCategory && (
                        <TabsContent value="by-stage" className="mt-0">
                            <div className="space-y-4">
                              {(() => {
                                // CORRECTED LINE FOR STAGES:
                                const stages = Array.from(new Set(currentResult.data?.filter(item => item && item.Category === 'ECL By Stage').map(item => item?.Stage).filter((stage): stage is string => Boolean(stage)) ));
                                
                                return stages.map(stage => {
                                  const stageData = currentResult.data?.filter(d => d && d.Stage === stage && d.Category === 'ECL By Stage');
                                  if (!stageData || stageData.length === 0) return null;
                                  
                                  return (
                                    <div key={`stage-group-${stage}`} className="border rounded-md overflow-hidden dark:border-gray-600">
                                      <div className="bg-muted dark:bg-gray-700 p-2"><h4 className="font-medium dark:text-gray-200">Stage {stage}</h4></div>
                                      <Table>
                                        <TableHeader><TableRow className="dark:border-gray-600"><TableHead className="dark:text-gray-300">Category</TableHead><TableHead className="dark:text-gray-300">Field</TableHead><TableHead className="dark:text-gray-300">Value</TableHead></TableRow></TableHeader>
                                        <TableBody>
                                          {stageData.map((item, index) => {
                                              const itemField = (item && typeof item.Field === 'string') ? item.Field : 'N/A';
                                              const itemValue = (item && (typeof item.Value === 'string' || typeof item.Value === 'number')) ? String(item.Value) : 'N/A';
                                              return (
                                                <TableRow key={`by-stage-item-${stage}-${index}`} className="dark:border-gray-600">
                                                    <TableCell className="dark:text-gray-300">ECL</TableCell>
                                                    <TableCell className="dark:text-gray-300">{itemField}</TableCell>
                                                    <TableCell className="font-medium dark:text-gray-200">{itemValue}</TableCell>
                                                </TableRow>
                                            );
                                          })}
                                        </TableBody>
                                      </Table>
                                    </div>
                                  );
                                });
                              })()}
                            </div>
                        </TabsContent>
                      )}
                    </ScrollArea>
                  </Tabs>
                )}
                 {currentResult.status === 'success' && (!currentResult.data || currentResult.data.length === 0) && ( <div className="flex flex-col items-center justify-center h-full py-8"><Info className="h-8 w-8 text-muted-foreground mb-2" /><div className="text-sm text-muted-foreground">No data points were extracted for this prompt.</div></div> )}
              </div>
            </Card>
          ) : ( /* ... (No currentResult selected placeholder remains the same) ... */ 
            <Card className="flex flex-col items-center justify-center h-full dark:bg-gray-800 dark:border-gray-700">
              <CardContent className="text-center">
                <Info className="h-10 w-10 text-muted-foreground mx-auto mb-4" />
                <p className="text-muted-foreground">Select a result from the list on the left to view details.</p>
              </CardContent>
            </Card>
          )}
        </div>
      </div>
    </div>
  );
};

export default ResultsViewer;
\`\`\`

# src\components\ThemeProvider.tsx

\`\`\`tsx

"use client";

import * as React from "react";
import { createContext, useContext, useEffect, useState } from "react";

type Theme = "dark" | "light" | "system";

type ThemeProviderProps = {
  children: React.ReactNode;
  defaultTheme?: Theme;
  storageKey?: string;
};

type ThemeProviderState = {
  theme: Theme;
  setTheme: (theme: Theme) => void;
};

const initialState: ThemeProviderState = {
  theme: "system",
  setTheme: () => null,
};

const ThemeProviderContext = createContext<ThemeProviderState>(initialState);

export function ThemeProvider({
  children,
  defaultTheme = "system",
  storageKey = "vite-ui-theme",
  ...props
}: ThemeProviderProps) {
  const [theme, setTheme] = useState<Theme>(
    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme
  );

  useEffect(() => {
    const root = window.document.documentElement;
    root.classList.remove("light", "dark");

    if (theme === "system") {
      const systemTheme = window.matchMedia("(prefers-color-scheme: dark)")
        .matches
        ? "dark"
        : "light";

      root.classList.add(systemTheme);
      return;
    }

    root.classList.add(theme);
  }, [theme]);

  const value = {
    theme,
    setTheme: (theme: Theme) => {
      localStorage.setItem(storageKey, theme);
      setTheme(theme);
    },
  };

  return (
    <ThemeProviderContext.Provider {...props} value={value}>
      {children}
    </ThemeProviderContext.Provider>
  );
}

export const useTheme = () => {
  const context = useContext(ThemeProviderContext);

  if (context === undefined)
    throw new Error("useTheme must be used within a ThemeProvider");

  return context;
};

\`\`\`

# src\components\ThemeToggle.tsx

\`\`\`tsx

import { Moon, Sun } from "lucide-react";
import { Button } from "@/components/ui/button";
import { useTheme } from "@/components/ThemeProvider";
import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from "@/components/ui/dropdown-menu";

export function ThemeToggle({ className }: { className?: string }) {
  const { setTheme, theme } = useTheme();

  return (
    <div className={className}>
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <Button variant="outline" size="icon" className="rounded-full bg-white dark:bg-yellow-400">
            <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0 dark:text-black" />
            <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100 dark:text-black" />
            <span className="sr-only">Toggle theme</span>
          </Button>
        </DropdownMenuTrigger>
        <DropdownMenuContent align="end">
          <DropdownMenuItem onClick={() => setTheme("light")}>
            Light
          </DropdownMenuItem>
          <DropdownMenuItem onClick={() => setTheme("dark")}>
            Dark
          </DropdownMenuItem>
          <DropdownMenuItem onClick={() => setTheme("system")}>
            System
          </DropdownMenuItem>
        </DropdownMenuContent>
      </DropdownMenu>
    </div>
  );
}

\`\`\`

# src\components\ui\accordion.tsx

\`\`\`tsx
import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn("border-b", className)}
    {...props}
  />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))

AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }

\`\`\`

# src\components\ui\alert-dialog.tsx

\`\`\`tsx
import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

const AlertDialog = AlertDialogPrimitive.Root

const AlertDialogTrigger = AlertDialogPrimitive.Trigger

const AlertDialogPortal = AlertDialogPrimitive.Portal

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    />
  </AlertDialogPortal>
))
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName

const AlertDialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
AlertDialogHeader.displayName = "AlertDialogHeader"

const AlertDialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
AlertDialogFooter.displayName = "AlertDialogFooter"

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold", className)}
    {...props}
  />
))
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action
    ref={ref}
    className={cn(buttonVariants(), className)}
    {...props}
  />
))
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    )}
    {...props}
  />
))
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}

\`\`\`

# src\components\ui\alert.tsx

\`\`\`tsx
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive:
          "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
))
Alert.displayName = "Alert"

const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn("mb-1 font-medium leading-none tracking-tight", className)}
    {...props}
  />
))
AlertTitle.displayName = "AlertTitle"

const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm [&_p]:leading-relaxed", className)}
    {...props}
  />
))
AlertDescription.displayName = "AlertDescription"

export { Alert, AlertTitle, AlertDescription }

\`\`\`

# src\components\ui\aspect-ratio.tsx

\`\`\`tsx
import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio"

const AspectRatio = AspectRatioPrimitive.Root

export { AspectRatio }

\`\`\`

# src\components\ui\avatar.tsx

\`\`\`tsx
import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    )}
    {...props}
  />
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image
    ref={ref}
    className={cn("aspect-square h-full w-full", className)}
    {...props}
  />
))
AvatarImage.displayName = AvatarPrimitive.Image.displayName

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn(
      "flex h-full w-full items-center justify-center rounded-full bg-muted",
      className
    )}
    {...props}
  />
))
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName

export { Avatar, AvatarImage, AvatarFallback }

\`\`\`

# src\components\ui\badge.tsx

\`\`\`tsx
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  )
}

export { Badge, badgeVariants }

\`\`\`

# src\components\ui\breadcrumb.tsx

\`\`\`tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"

const Breadcrumb = React.forwardRef<
  HTMLElement,
  React.ComponentPropsWithoutRef<"nav"> & {
    separator?: React.ReactNode
  }
>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)
Breadcrumb.displayName = "Breadcrumb"

const BreadcrumbList = React.forwardRef<
  HTMLOListElement,
  React.ComponentPropsWithoutRef<"ol">
>(({ className, ...props }, ref) => (
  <ol
    ref={ref}
    className={cn(
      "flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",
      className
    )}
    {...props}
  />
))
BreadcrumbList.displayName = "BreadcrumbList"

const BreadcrumbItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentPropsWithoutRef<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    className={cn("inline-flex items-center gap-1.5", className)}
    {...props}
  />
))
BreadcrumbItem.displayName = "BreadcrumbItem"

const BreadcrumbLink = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentPropsWithoutRef<"a"> & {
    asChild?: boolean
  }
>(({ asChild, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      className={cn("transition-colors hover:text-foreground", className)}
      {...props}
    />
  )
})
BreadcrumbLink.displayName = "BreadcrumbLink"

const BreadcrumbPage = React.forwardRef<
  HTMLSpanElement,
  React.ComponentPropsWithoutRef<"span">
>(({ className, ...props }, ref) => (
  <span
    ref={ref}
    role="link"
    aria-disabled="true"
    aria-current="page"
    className={cn("font-normal text-foreground", className)}
    {...props}
  />
))
BreadcrumbPage.displayName = "BreadcrumbPage"

const BreadcrumbSeparator = ({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) => (
  <li
    role="presentation"
    aria-hidden="true"
    className={cn("[&>svg]:size-3.5", className)}
    {...props}
  >
    {children ?? <ChevronRight />}
  </li>
)
BreadcrumbSeparator.displayName = "BreadcrumbSeparator"

const BreadcrumbEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    role="presentation"
    aria-hidden="true"
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More</span>
  </span>
)
BreadcrumbEllipsis.displayName = "BreadcrumbElipssis"

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}

\`\`\`

# src\components\ui\button.tsx

\`\`\`tsx

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-500",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground dark:border-gray-600",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-500",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
        eyOutline: "border border-ey-gray-400 text-white hover:bg-ey-gray-800 hover:border-ey-gray-500 transition-colors",
        eyPrimary: "bg-ey-yellow text-ey-black hover:bg-ey-yellow/90 font-medium transition-colors",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }

\`\`\`

# src\components\ui\calendar.tsx

\`\`\`tsx
import * as React from "react";
import { ChevronLeft, ChevronRight } from "lucide-react";
import { DayPicker } from "react-day-picker";

import { cn } from "@/lib/utils";
import { buttonVariants } from "@/components/ui/button";

export type CalendarProps = React.ComponentProps<typeof DayPicker>;

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: CalendarProps) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",
        month: "space-y-4",
        caption: "flex justify-center pt-1 relative items-center",
        caption_label: "text-sm font-medium",
        nav: "space-x-1 flex items-center",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-y-1",
        head_row: "flex",
        head_cell:
          "text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",
        day: cn(
          buttonVariants({ variant: "ghost" }),
          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"
        ),
        day_range_end: "day-range-end",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle:
          "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ ..._props }) => <ChevronLeft className="h-4 w-4" />,
        IconRight: ({ ..._props }) => <ChevronRight className="h-4 w-4" />,
      }}
      {...props}
    />
  );
}
Calendar.displayName = "Calendar";

export { Calendar };

\`\`\`

# src\components\ui\card.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }

\`\`\`

# src\components\ui\carousel.tsx

\`\`\`tsx
import * as React from "react"
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react"
import { ArrowLeft, ArrowRight } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: "horizontal" | "vertical"
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />")
  }

  return context
}

const Carousel = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & CarouselProps
>(
  (
    {
      orientation = "horizontal",
      opts,
      setApi,
      plugins,
      className,
      children,
      ...props
    },
    ref
  ) => {
    const [carouselRef, api] = useEmblaCarousel(
      {
        ...opts,
        axis: orientation === "horizontal" ? "x" : "y",
      },
      plugins
    )
    const [canScrollPrev, setCanScrollPrev] = React.useState(false)
    const [canScrollNext, setCanScrollNext] = React.useState(false)

    const onSelect = React.useCallback((api: CarouselApi) => {
      if (!api) {
        return
      }

      setCanScrollPrev(api.canScrollPrev())
      setCanScrollNext(api.canScrollNext())
    }, [])

    const scrollPrev = React.useCallback(() => {
      api?.scrollPrev()
    }, [api])

    const scrollNext = React.useCallback(() => {
      api?.scrollNext()
    }, [api])

    const handleKeyDown = React.useCallback(
      (event: React.KeyboardEvent<HTMLDivElement>) => {
        if (event.key === "ArrowLeft") {
          event.preventDefault()
          scrollPrev()
        } else if (event.key === "ArrowRight") {
          event.preventDefault()
          scrollNext()
        }
      },
      [scrollPrev, scrollNext]
    )

    React.useEffect(() => {
      if (!api || !setApi) {
        return
      }

      setApi(api)
    }, [api, setApi])

    React.useEffect(() => {
      if (!api) {
        return
      }

      onSelect(api)
      api.on("reInit", onSelect)
      api.on("select", onSelect)

      return () => {
        api?.off("select", onSelect)
      }
    }, [api, onSelect])

    return (
      <CarouselContext.Provider
        value={{
          carouselRef,
          api: api,
          opts,
          orientation:
            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
          scrollPrev,
          scrollNext,
          canScrollPrev,
          canScrollNext,
        }}
      >
        <div
          ref={ref}
          onKeyDownCapture={handleKeyDown}
          className={cn("relative", className)}
          role="region"
          aria-roledescription="carousel"
          {...props}
        >
          {children}
        </div>
      </CarouselContext.Provider>
    )
  }
)
Carousel.displayName = "Carousel"

const CarouselContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div ref={carouselRef} className="overflow-hidden">
      <div
        ref={ref}
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className
        )}
        {...props}
      />
    </div>
  )
})
CarouselContent.displayName = "CarouselContent"

const CarouselItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { orientation } = useCarousel()

  return (
    <div
      ref={ref}
      role="group"
      aria-roledescription="slide"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className
      )}
      {...props}
    />
  )
})
CarouselItem.displayName = "CarouselItem"

const CarouselPrevious = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute  h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-left-12 top-1/2 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft className="h-4 w-4" />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
})
CarouselPrevious.displayName = "CarouselPrevious"

const CarouselNext = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-right-12 top-1/2 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight className="h-4 w-4" />
      <span className="sr-only">Next slide</span>
    </Button>
  )
})
CarouselNext.displayName = "CarouselNext"

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}

\`\`\`

# src\components\ui\chart.tsx

\`\`\`tsx
import * as React from "react"
import * as RechartsPrimitive from "recharts"

import { cn } from "@/lib/utils"

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />")
  }

  return context
}

const ChartContainer = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    config: ChartConfig
    children: React.ComponentProps<
      typeof RechartsPrimitive.ResponsiveContainer
    >["children"]
  }
>(({ id, className, children, config, ...props }, ref) => {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-chart={chartId}
        ref={ref}
        className={cn(
          "flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",
          className
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
})
ChartContainer.displayName = "Chart"

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([_, config]) => config.theme || config.color
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join("\n")}
}
`
          )
          .join("\n"),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

const ChartTooltipContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
    React.ComponentProps<"div"> & {
      hideLabel?: boolean
      hideIndicator?: boolean
      indicator?: "line" | "dot" | "dashed"
      nameKey?: string
      labelKey?: string
    }
>(
  (
    {
      active,
      payload,
      className,
      indicator = "dot",
      hideLabel = false,
      hideIndicator = false,
      label,
      labelFormatter,
      labelClassName,
      formatter,
      color,
      nameKey,
      labelKey,
    },
    ref
  ) => {
    const { config } = useChart()

    const tooltipLabel = React.useMemo(() => {
      if (hideLabel || !payload?.length) {
        return null
      }

      const [item] = payload
      const key = `${labelKey || item.dataKey || item.name || "value"}`
      const itemConfig = getPayloadConfigFromPayload(config, item, key)
      const value =
        !labelKey && typeof label === "string"
          ? config[label as keyof typeof config]?.label || label
          : itemConfig?.label

      if (labelFormatter) {
        return (
          <div className={cn("font-medium", labelClassName)}>
            {labelFormatter(value, payload)}
          </div>
        )
      }

      if (!value) {
        return null
      }

      return <div className={cn("font-medium", labelClassName)}>{value}</div>
    }, [
      label,
      labelFormatter,
      payload,
      hideLabel,
      labelClassName,
      config,
      labelKey,
    ])

    if (!active || !payload?.length) {
      return null
    }

    const nestLabel = payload.length === 1 && indicator !== "dot"

    return (
      <div
        ref={ref}
        className={cn(
          "grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",
          className
        )}
      >
        {!nestLabel ? tooltipLabel : null}
        <div className="grid gap-1.5">
          {payload.map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`
            const itemConfig = getPayloadConfigFromPayload(config, item, key)
            const indicatorColor = color || item.payload.fill || item.color

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",
                  indicator === "dot" && "items-center"
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn(
                            "shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",
                            {
                              "h-2.5 w-2.5": indicator === "dot",
                              "w-1": indicator === "line",
                              "w-0 border-[1.5px] border-dashed bg-transparent":
                                indicator === "dashed",
                              "my-0.5": nestLabel && indicator === "dashed",
                            }
                          )}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center"
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">
                          {itemConfig?.label || item.name}
                        </span>
                      </div>
                      {item.value && (
                        <span className="font-mono font-medium tabular-nums text-foreground">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            )
          })}
        </div>
      </div>
    )
  }
)
ChartTooltipContent.displayName = "ChartTooltip"

const ChartLegend = RechartsPrimitive.Legend

const ChartLegendContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> &
    Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
      hideIcon?: boolean
      nameKey?: string
    }
>(
  (
    { className, hideIcon = false, payload, verticalAlign = "bottom", nameKey },
    ref
  ) => {
    const { config } = useChart()

    if (!payload?.length) {
      return null
    }

    return (
      <div
        ref={ref}
        className={cn(
          "flex items-center justify-center gap-4",
          verticalAlign === "top" ? "pb-3" : "pt-3",
          className
        )}
      >
        {payload.map((item) => {
          const key = `${nameKey || item.dataKey || "value"}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)

          return (
            <div
              key={item.value}
              className={cn(
                "flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"
              )}
            >
              {itemConfig?.icon && !hideIcon ? (
                <itemConfig.icon />
              ) : (
                <div
                  className="h-2 w-2 shrink-0 rounded-[2px]"
                  style={{
                    backgroundColor: item.color,
                  }}
                />
              )}
              {itemConfig?.label}
            </div>
          )
        })}
      </div>
    )
  }
)
ChartLegendContent.displayName = "ChartLegend"

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}

\`\`\`

# src\components\ui\checkbox.tsx

\`\`\`tsx
import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }

\`\`\`

# src\components\ui\collapsible.tsx

\`\`\`tsx
import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

const Collapsible = CollapsiblePrimitive.Root

const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger

const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent

export { Collapsible, CollapsibleTrigger, CollapsibleContent }

\`\`\`

# src\components\ui\command.tsx

\`\`\`tsx
import * as React from "react"
import { type DialogProps } from "@radix-ui/react-dialog"
import { Command as CommandPrimitive } from "cmdk"
import { Search } from "lucide-react"

import { cn } from "@/lib/utils"
import { Dialog, DialogContent } from "@/components/ui/dialog"

const Command = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive>
>(({ className, ...props }, ref) => (
  <CommandPrimitive
    ref={ref}
    className={cn(
      "flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",
      className
    )}
    {...props}
  />
))
Command.displayName = CommandPrimitive.displayName

interface CommandDialogProps extends DialogProps {}

const CommandDialog = ({ children, ...props }: CommandDialogProps) => {
  return (
    <Dialog {...props}>
      <DialogContent className="overflow-hidden p-0 shadow-lg">
        <Command className="[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

const CommandInput = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Input>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
>(({ className, ...props }, ref) => (
  <div className="flex items-center border-b px-3" cmdk-input-wrapper="">
    <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
    <CommandPrimitive.Input
      ref={ref}
      className={cn(
        "flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    />
  </div>
))

CommandInput.displayName = CommandPrimitive.Input.displayName

const CommandList = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.List
    ref={ref}
    className={cn("max-h-[300px] overflow-y-auto overflow-x-hidden", className)}
    {...props}
  />
))

CommandList.displayName = CommandPrimitive.List.displayName

const CommandEmpty = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Empty>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>
>((props, ref) => (
  <CommandPrimitive.Empty
    ref={ref}
    className="py-6 text-center text-sm"
    {...props}
  />
))

CommandEmpty.displayName = CommandPrimitive.Empty.displayName

const CommandGroup = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Group>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Group
    ref={ref}
    className={cn(
      "overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",
      className
    )}
    {...props}
  />
))

CommandGroup.displayName = CommandPrimitive.Group.displayName

const CommandSeparator = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 h-px bg-border", className)}
    {...props}
  />
))
CommandSeparator.displayName = CommandPrimitive.Separator.displayName

const CommandItem = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",
      className
    )}
    {...props}
  />
))

CommandItem.displayName = CommandPrimitive.Item.displayName

const CommandShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
CommandShortcut.displayName = "CommandShortcut"

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}

\`\`\`

# src\components\ui\context-menu.tsx

\`\`\`tsx
import * as React from "react"
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const ContextMenu = ContextMenuPrimitive.Root

const ContextMenuTrigger = ContextMenuPrimitive.Trigger

const ContextMenuGroup = ContextMenuPrimitive.Group

const ContextMenuPortal = ContextMenuPrimitive.Portal

const ContextMenuSub = ContextMenuPrimitive.Sub

const ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup

const ContextMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <ContextMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </ContextMenuPrimitive.SubTrigger>
))
ContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName

const ContextMenuSubContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
ContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName

const ContextMenuContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Portal>
    <ContextMenuPrimitive.Content
      ref={ref}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </ContextMenuPrimitive.Portal>
))
ContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName

const ContextMenuItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName

const ContextMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <ContextMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.CheckboxItem>
))
ContextMenuCheckboxItem.displayName =
  ContextMenuPrimitive.CheckboxItem.displayName

const ContextMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <ContextMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.RadioItem>
))
ContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName

const ContextMenuLabel = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold text-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName

const ContextMenuSeparator = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-border", className)}
    {...props}
  />
))
ContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName

const ContextMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
ContextMenuShortcut.displayName = "ContextMenuShortcut"

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}

\`\`\`

# src\components\ui\dialog.tsx

\`\`\`tsx
import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}

\`\`\`

# src\components\ui\drawer.tsx

\`\`\`tsx
import * as React from "react"
import { Drawer as DrawerPrimitive } from "vaul"

import { cn } from "@/lib/utils"

const Drawer = ({
  shouldScaleBackground = true,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (
  <DrawerPrimitive.Root
    shouldScaleBackground={shouldScaleBackground}
    {...props}
  />
)
Drawer.displayName = "Drawer"

const DrawerTrigger = DrawerPrimitive.Trigger

const DrawerPortal = DrawerPrimitive.Portal

const DrawerClose = DrawerPrimitive.Close

const DrawerOverlay = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Overlay
    ref={ref}
    className={cn("fixed inset-0 z-50 bg-black/80", className)}
    {...props}
  />
))
DrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName

const DrawerContent = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DrawerPortal>
    <DrawerOverlay />
    <DrawerPrimitive.Content
      ref={ref}
      className={cn(
        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",
        className
      )}
      {...props}
    >
      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted" />
      {children}
    </DrawerPrimitive.Content>
  </DrawerPortal>
))
DrawerContent.displayName = "DrawerContent"

const DrawerHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}
    {...props}
  />
)
DrawerHeader.displayName = "DrawerHeader"

const DrawerFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("mt-auto flex flex-col gap-2 p-4", className)}
    {...props}
  />
)
DrawerFooter.displayName = "DrawerFooter"

const DrawerTitle = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DrawerTitle.displayName = DrawerPrimitive.Title.displayName

const DrawerDescription = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DrawerDescription.displayName = DrawerPrimitive.Description.displayName

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}

\`\`\`

# src\components\ui\dropdown-menu.tsx

\`\`\`tsx
import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const DropdownMenu = DropdownMenuPrimitive.Root

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger

const DropdownMenuGroup = DropdownMenuPrimitive.Group

const DropdownMenuPortal = DropdownMenuPrimitive.Portal

const DropdownMenuSub = DropdownMenuPrimitive.Sub

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </DropdownMenuPrimitive.SubTrigger>
))
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
))
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
))
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  )
}
DropdownMenuShortcut.displayName = "DropdownMenuShortcut"

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
}

\`\`\`

# src\components\ui\form.tsx

\`\`\`tsx
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  ControllerProps,
  FieldPath,
  FieldValues,
  FormProvider,
  useFormContext,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState, formState } = useFormContext()

  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn("space-y-2", className)} {...props} />
    </FormItemContext.Provider>
  )
})
FormItem.displayName = "FormItem"

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField()

  return (
    <Label
      ref={ref}
      className={cn(error && "text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
})
FormLabel.displayName = "FormLabel"

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
})
FormControl.displayName = "FormControl"

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField()

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn("text-sm text-muted-foreground", className)}
      {...props}
    />
  )
})
FormDescription.displayName = "FormDescription"

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message) : children

  if (!body) {
    return null
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn("text-sm font-medium text-destructive", className)}
      {...props}
    >
      {body}
    </p>
  )
})
FormMessage.displayName = "FormMessage"

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}

\`\`\`

# src\components\ui\hover-card.tsx

\`\`\`tsx
import * as React from "react"
import * as HoverCardPrimitive from "@radix-ui/react-hover-card"

import { cn } from "@/lib/utils"

const HoverCard = HoverCardPrimitive.Root

const HoverCardTrigger = HoverCardPrimitive.Trigger

const HoverCardContent = React.forwardRef<
  React.ElementRef<typeof HoverCardPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <HoverCardPrimitive.Content
    ref={ref}
    align={align}
    sideOffset={sideOffset}
    className={cn(
      "z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
HoverCardContent.displayName = HoverCardPrimitive.Content.displayName

export { HoverCard, HoverCardTrigger, HoverCardContent }

\`\`\`

# src\components\ui\input-otp.tsx

\`\`\`tsx
import * as React from "react"
import { OTPInput, OTPInputContext } from "input-otp"
import { Dot } from "lucide-react"

import { cn } from "@/lib/utils"

const InputOTP = React.forwardRef<
  React.ElementRef<typeof OTPInput>,
  React.ComponentPropsWithoutRef<typeof OTPInput>
>(({ className, containerClassName, ...props }, ref) => (
  <OTPInput
    ref={ref}
    containerClassName={cn(
      "flex items-center gap-2 has-[:disabled]:opacity-50",
      containerClassName
    )}
    className={cn("disabled:cursor-not-allowed", className)}
    {...props}
  />
))
InputOTP.displayName = "InputOTP"

const InputOTPGroup = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("flex items-center", className)} {...props} />
))
InputOTPGroup.displayName = "InputOTPGroup"

const InputOTPSlot = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div"> & { index: number }
>(({ index, className, ...props }, ref) => {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]

  return (
    <div
      ref={ref}
      className={cn(
        "relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",
        isActive && "z-10 ring-2 ring-ring ring-offset-background",
        className
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="h-4 w-px animate-caret-blink bg-foreground duration-1000" />
        </div>
      )}
    </div>
  )
})
InputOTPSlot.displayName = "InputOTPSlot"

const InputOTPSeparator = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ ...props }, ref) => (
  <div ref={ref} role="separator" {...props}>
    <Dot />
  </div>
))
InputOTPSeparator.displayName = "InputOTPSeparator"

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }

\`\`\`

# src\components\ui\input.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }

\`\`\`

# src\components\ui\label.tsx

\`\`\`tsx
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }

\`\`\`

# src\components\ui\menubar.tsx

\`\`\`tsx
import * as React from "react"
import * as MenubarPrimitive from "@radix-ui/react-menubar"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const MenubarMenu = MenubarPrimitive.Menu

const MenubarGroup = MenubarPrimitive.Group

const MenubarPortal = MenubarPrimitive.Portal

const MenubarSub = MenubarPrimitive.Sub

const MenubarRadioGroup = MenubarPrimitive.RadioGroup

const Menubar = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Root
    ref={ref}
    className={cn(
      "flex h-10 items-center space-x-1 rounded-md border bg-background p-1",
      className
    )}
    {...props}
  />
))
Menubar.displayName = MenubarPrimitive.Root.displayName

const MenubarTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      className
    )}
    {...props}
  />
))
MenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName

const MenubarSubTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <MenubarPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </MenubarPrimitive.SubTrigger>
))
MenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName

const MenubarSubContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
MenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName

const MenubarContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>
>(
  (
    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },
    ref
  ) => (
    <MenubarPrimitive.Portal>
      <MenubarPrimitive.Content
        ref={ref}
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
          className
        )}
        {...props}
      />
    </MenubarPrimitive.Portal>
  )
)
MenubarContent.displayName = MenubarPrimitive.Content.displayName

const MenubarItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarItem.displayName = MenubarPrimitive.Item.displayName

const MenubarCheckboxItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <MenubarPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.CheckboxItem>
))
MenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName

const MenubarRadioItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <MenubarPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.RadioItem>
))
MenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName

const MenubarLabel = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarLabel.displayName = MenubarPrimitive.Label.displayName

const MenubarSeparator = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
MenubarSeparator.displayName = MenubarPrimitive.Separator.displayName

const MenubarShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
MenubarShortcut.displayname = "MenubarShortcut"

export {
  Menubar,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarItem,
  MenubarSeparator,
  MenubarLabel,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarPortal,
  MenubarSubContent,
  MenubarSubTrigger,
  MenubarGroup,
  MenubarSub,
  MenubarShortcut,
}

\`\`\`

# src\components\ui\navigation-menu.tsx

\`\`\`tsx
import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const NavigationMenu = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Root
    ref={ref}
    className={cn(
      "relative z-10 flex max-w-max flex-1 items-center justify-center",
      className
    )}
    {...props}
  >
    {children}
    <NavigationMenuViewport />
  </NavigationMenuPrimitive.Root>
))
NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName

const NavigationMenuList = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.List
    ref={ref}
    className={cn(
      "group flex flex-1 list-none items-center justify-center space-x-1",
      className
    )}
    {...props}
  />
))
NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName

const NavigationMenuItem = NavigationMenuPrimitive.Item

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50"
)

const NavigationMenuTrigger = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Trigger
    ref={ref}
    className={cn(navigationMenuTriggerStyle(), "group", className)}
    {...props}
  >
    {children}{" "}
    <ChevronDown
      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"
      aria-hidden="true"
    />
  </NavigationMenuPrimitive.Trigger>
))
NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName

const NavigationMenuContent = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Content
    ref={ref}
    className={cn(
      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",
      className
    )}
    {...props}
  />
))
NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName

const NavigationMenuLink = NavigationMenuPrimitive.Link

const NavigationMenuViewport = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
>(({ className, ...props }, ref) => (
  <div className={cn("absolute left-0 top-full flex justify-center")}>
    <NavigationMenuPrimitive.Viewport
      className={cn(
        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",
        className
      )}
      ref={ref}
      {...props}
    />
  </div>
))
NavigationMenuViewport.displayName =
  NavigationMenuPrimitive.Viewport.displayName

const NavigationMenuIndicator = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Indicator
    ref={ref}
    className={cn(
      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",
      className
    )}
    {...props}
  >
    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md" />
  </NavigationMenuPrimitive.Indicator>
))
NavigationMenuIndicator.displayName =
  NavigationMenuPrimitive.Indicator.displayName

export {
  navigationMenuTriggerStyle,
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
}

\`\`\`

# src\components\ui\pagination.tsx

\`\`\`tsx
import * as React from "react"
import { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"
import { ButtonProps, buttonVariants } from "@/components/ui/button"

const Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn("mx-auto flex w-full justify-center", className)}
    {...props}
  />
)
Pagination.displayName = "Pagination"

const PaginationContent = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    className={cn("flex flex-row items-center gap-1", className)}
    {...props}
  />
))
PaginationContent.displayName = "PaginationContent"

const PaginationItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li ref={ref} className={cn("", className)} {...props} />
))
PaginationItem.displayName = "PaginationItem"

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<ButtonProps, "size"> &
  React.ComponentProps<"a">

const PaginationLink = ({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) => (
  <a
    aria-current={isActive ? "page" : undefined}
    className={cn(
      buttonVariants({
        variant: isActive ? "outline" : "ghost",
        size,
      }),
      className
    )}
    {...props}
  />
)
PaginationLink.displayName = "PaginationLink"

const PaginationPrevious = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to previous page"
    size="default"
    className={cn("gap-1 pl-2.5", className)}
    {...props}
  >
    <ChevronLeft className="h-4 w-4" />
    <span>Previous</span>
  </PaginationLink>
)
PaginationPrevious.displayName = "PaginationPrevious"

const PaginationNext = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to next page"
    size="default"
    className={cn("gap-1 pr-2.5", className)}
    {...props}
  >
    <span>Next</span>
    <ChevronRight className="h-4 w-4" />
  </PaginationLink>
)
PaginationNext.displayName = "PaginationNext"

const PaginationEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    aria-hidden
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More pages</span>
  </span>
)
PaginationEllipsis.displayName = "PaginationEllipsis"

export {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
}

\`\`\`

# src\components\ui\popover.tsx

\`\`\`tsx
import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

const Popover = PopoverPrimitive.Root

const PopoverTrigger = PopoverPrimitive.Trigger

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
))
PopoverContent.displayName = PopoverPrimitive.Content.displayName

export { Popover, PopoverTrigger, PopoverContent }

\`\`\`

# src\components\ui\progress.tsx

\`\`\`tsx

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

interface ProgressProps extends React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root> {
  indicatorClassName?: string;
}

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  ProgressProps
>(({ className, value, indicatorClassName, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-4 w-full overflow-hidden rounded-full bg-secondary",
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className={cn(
        "h-full w-full flex-1 bg-primary transition-all",
        indicatorClassName
      )}
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }

\`\`\`

# src\components\ui\radio-group.tsx

\`\`\`tsx
import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Root
      className={cn("grid gap-2", className)}
      {...props}
      ref={ref}
    />
  )
})
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
})
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName

export { RadioGroup, RadioGroupItem }

\`\`\`

# src\components\ui\resizable.tsx

\`\`\`tsx
import { GripVertical } from "lucide-react"
import * as ResizablePrimitive from "react-resizable-panels"

import { cn } from "@/lib/utils"

const ResizablePanelGroup = ({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (
  <ResizablePrimitive.PanelGroup
    className={cn(
      "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
      className
    )}
    {...props}
  />
)

const ResizablePanel = ResizablePrimitive.Panel

const ResizableHandle = ({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) => (
  <ResizablePrimitive.PanelResizeHandle
    className={cn(
      "relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
      className
    )}
    {...props}
  >
    {withHandle && (
      <div className="z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border">
        <GripVertical className="h-2.5 w-2.5" />
      </div>
    )}
  </ResizablePrimitive.PanelResizeHandle>
)

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }

\`\`\`

# src\components\ui\scroll-area.tsx

\`\`\`tsx
import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root
    ref={ref}
    className={cn("relative overflow-hidden", className)}
    {...props}
  >
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">
      {children}
    </ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
))
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName

const ScrollBar = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
>(({ className, orientation = "vertical", ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      "flex touch-none select-none transition-colors",
      orientation === "vertical" &&
        "h-full w-2.5 border-l border-l-transparent p-[1px]",
      orientation === "horizontal" &&
        "h-2.5 flex-col border-t border-t-transparent p-[1px]",
      className
    )}
    {...props}
  >
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
))
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName

export { ScrollArea, ScrollBar }

\`\`\`

# src\components\ui\select.tsx

\`\`\`tsx
import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}

\`\`\`

# src\components\ui\separator.tsx

\`\`\`tsx
import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }

\`\`\`

# src\components\ui\sheet.tsx

\`\`\`tsx
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"
import * as React from "react"

import { cn } from "@/lib/utils"

const Sheet = SheetPrimitive.Root

const SheetTrigger = SheetPrimitive.Trigger

const SheetClose = SheetPrimitive.Close

const SheetPortal = SheetPrimitive.Portal

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName

const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom:
          "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right:
          "inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
)

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
  VariantProps<typeof sheetVariants> { }

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(({ side = "right", className, children, ...props }, ref) => (
  <SheetPortal>
    <SheetOverlay />
    <SheetPrimitive.Content
      ref={ref}
      className={cn(sheetVariants({ side }), className)}
      {...props}
    >
      {children}
      <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </SheetPrimitive.Close>
    </SheetPrimitive.Content>
  </SheetPortal>
))
SheetContent.displayName = SheetPrimitive.Content.displayName

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
SheetHeader.displayName = "SheetHeader"

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
SheetFooter.displayName = "SheetFooter"

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold text-foreground", className)}
    {...props}
  />
))
SheetTitle.displayName = SheetPrimitive.Title.displayName

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
SheetDescription.displayName = SheetPrimitive.Description.displayName

export {
  Sheet, SheetClose,
  SheetContent, SheetDescription, SheetFooter, SheetHeader, SheetOverlay, SheetPortal, SheetTitle, SheetTrigger
}


\`\`\`

# src\components\ui\sidebar.tsx

\`\`\`tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { VariantProps, cva } from "class-variance-authority"
import { PanelLeft } from "lucide-react"

import { useIsMobile } from "@/hooks/use-mobile"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Separator } from "@/components/ui/separator"
import { Sheet, SheetContent } from "@/components/ui/sheet"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip"

const SIDEBAR_COOKIE_NAME = "sidebar:state"
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = "16rem"
const SIDEBAR_WIDTH_MOBILE = "18rem"
const SIDEBAR_WIDTH_ICON = "3rem"
const SIDEBAR_KEYBOARD_SHORTCUT = "b"

type SidebarContext = {
  state: "expanded" | "collapsed"
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContext | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.")
  }

  return context
}

const SidebarProvider = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    defaultOpen?: boolean
    open?: boolean
    onOpenChange?: (open: boolean) => void
  }
>(
  (
    {
      defaultOpen = true,
      open: openProp,
      onOpenChange: setOpenProp,
      className,
      style,
      children,
      ...props
    },
    ref
  ) => {
    const isMobile = useIsMobile()
    const [openMobile, setOpenMobile] = React.useState(false)

    // This is the internal state of the sidebar.
    // We use openProp and setOpenProp for control from outside the component.
    const [_open, _setOpen] = React.useState(defaultOpen)
    const open = openProp ?? _open
    const setOpen = React.useCallback(
      (value: boolean | ((value: boolean) => boolean)) => {
        const openState = typeof value === "function" ? value(open) : value
        if (setOpenProp) {
          setOpenProp(openState)
        } else {
          _setOpen(openState)
        }

        // This sets the cookie to keep the sidebar state.
        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
      },
      [setOpenProp, open]
    )

    // Helper to toggle the sidebar.
    const toggleSidebar = React.useCallback(() => {
      return isMobile
        ? setOpenMobile((open) => !open)
        : setOpen((open) => !open)
    }, [isMobile, setOpen, setOpenMobile])

    // Adds a keyboard shortcut to toggle the sidebar.
    React.useEffect(() => {
      const handleKeyDown = (event: KeyboardEvent) => {
        if (
          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
          (event.metaKey || event.ctrlKey)
        ) {
          event.preventDefault()
          toggleSidebar()
        }
      }

      window.addEventListener("keydown", handleKeyDown)
      return () => window.removeEventListener("keydown", handleKeyDown)
    }, [toggleSidebar])

    // We add a state so that we can do data-state="expanded" or "collapsed".
    // This makes it easier to style the sidebar with Tailwind classes.
    const state = open ? "expanded" : "collapsed"

    const contextValue = React.useMemo<SidebarContext>(
      () => ({
        state,
        open,
        setOpen,
        isMobile,
        openMobile,
        setOpenMobile,
        toggleSidebar,
      }),
      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]
    )

    return (
      <SidebarContext.Provider value={contextValue}>
        <TooltipProvider delayDuration={0}>
          <div
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH,
                "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
                ...style,
              } as React.CSSProperties
            }
            className={cn(
              "group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",
              className
            )}
            ref={ref}
            {...props}
          >
            {children}
          </div>
        </TooltipProvider>
      </SidebarContext.Provider>
    )
  }
)
SidebarProvider.displayName = "SidebarProvider"

const Sidebar = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    side?: "left" | "right"
    variant?: "sidebar" | "floating" | "inset"
    collapsible?: "offcanvas" | "icon" | "none"
  }
>(
  (
    {
      side = "left",
      variant = "sidebar",
      collapsible = "offcanvas",
      className,
      children,
      ...props
    },
    ref
  ) => {
    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

    if (collapsible === "none") {
      return (
        <div
          className={cn(
            "flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",
            className
          )}
          ref={ref}
          {...props}
        >
          {children}
        </div>
      )
    }

    if (isMobile) {
      return (
        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
          <SheetContent
            data-sidebar="sidebar"
            data-mobile="true"
            className="w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden"
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
              } as React.CSSProperties
            }
            side={side}
          >
            <div className="flex h-full w-full flex-col">{children}</div>
          </SheetContent>
        </Sheet>
      )
    }

    return (
      <div
        ref={ref}
        className="group peer hidden md:block text-sidebar-foreground"
        data-state={state}
        data-collapsible={state === "collapsed" ? collapsible : ""}
        data-variant={variant}
        data-side={side}
      >
        {/* This is what handles the sidebar gap on desktop */}
        <div
          className={cn(
            "duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear",
            "group-data-[collapsible=offcanvas]:w-0",
            "group-data-[side=right]:rotate-180",
            variant === "floating" || variant === "inset"
              ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon]"
          )}
        />
        <div
          className={cn(
            "duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",
            side === "left"
              ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
              : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
            // Adjust the padding for floating and inset variants.
            variant === "floating" || variant === "inset"
              ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",
            className
          )}
          {...props}
        >
          <div
            data-sidebar="sidebar"
            className="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"
          >
            {children}
          </div>
        </div>
      </div>
    )
  }
)
Sidebar.displayName = "Sidebar"

const SidebarTrigger = React.forwardRef<
  React.ElementRef<typeof Button>,
  React.ComponentProps<typeof Button>
>(({ className, onClick, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      ref={ref}
      data-sidebar="trigger"
      variant="ghost"
      size="icon"
      className={cn("h-7 w-7", className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeft />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
})
SidebarTrigger.displayName = "SidebarTrigger"

const SidebarRail = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button">
>(({ className, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      ref={ref}
      data-sidebar="rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex",
        "[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className
      )}
      {...props}
    />
  )
})
SidebarRail.displayName = "SidebarRail"

const SidebarInset = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"main">
>(({ className, ...props }, ref) => {
  return (
    <main
      ref={ref}
      className={cn(
        "relative flex min-h-svh flex-1 flex-col bg-background",
        "peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",
        className
      )}
      {...props}
    />
  )
})
SidebarInset.displayName = "SidebarInset"

const SidebarInput = React.forwardRef<
  React.ElementRef<typeof Input>,
  React.ComponentProps<typeof Input>
>(({ className, ...props }, ref) => {
  return (
    <Input
      ref={ref}
      data-sidebar="input"
      className={cn(
        "h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",
        className
      )}
      {...props}
    />
  )
})
SidebarInput.displayName = "SidebarInput"

const SidebarHeader = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarHeader.displayName = "SidebarHeader"

const SidebarFooter = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarFooter.displayName = "SidebarFooter"

const SidebarSeparator = React.forwardRef<
  React.ElementRef<typeof Separator>,
  React.ComponentProps<typeof Separator>
>(({ className, ...props }, ref) => {
  return (
    <Separator
      ref={ref}
      data-sidebar="separator"
      className={cn("mx-2 w-auto bg-sidebar-border", className)}
      {...props}
    />
  )
})
SidebarSeparator.displayName = "SidebarSeparator"

const SidebarContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarContent.displayName = "SidebarContent"

const SidebarGroup = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  )
})
SidebarGroup.displayName = "SidebarGroup"

const SidebarGroupLabel = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "div"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-label"
      className={cn(
        "duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupLabel.displayName = "SidebarGroupLabel"

const SidebarGroupAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-action"
      className={cn(
        "absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupAction.displayName = "SidebarGroupAction"

const SidebarGroupContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="group-content"
    className={cn("w-full text-sm", className)}
    {...props}
  />
))
SidebarGroupContent.displayName = "SidebarGroupContent"

const SidebarMenu = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu"
    className={cn("flex w-full min-w-0 flex-col gap-1", className)}
    {...props}
  />
))
SidebarMenu.displayName = "SidebarMenu"

const SidebarMenuItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    data-sidebar="menu-item"
    className={cn("group/menu-item relative", className)}
    {...props}
  />
))
SidebarMenuItem.displayName = "SidebarMenuItem"

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:!p-0",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const SidebarMenuButton = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    isActive?: boolean
    tooltip?: string | React.ComponentProps<typeof TooltipContent>
  } & VariantProps<typeof sidebarMenuButtonVariants>
>(
  (
    {
      asChild = false,
      isActive = false,
      variant = "default",
      size = "default",
      tooltip,
      className,
      ...props
    },
    ref
  ) => {
    const Comp = asChild ? Slot : "button"
    const { isMobile, state } = useSidebar()

    const button = (
      <Comp
        ref={ref}
        data-sidebar="menu-button"
        data-size={size}
        data-active={isActive}
        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
        {...props}
      />
    )

    if (!tooltip) {
      return button
    }

    if (typeof tooltip === "string") {
      tooltip = {
        children: tooltip,
      }
    }

    return (
      <Tooltip>
        <TooltipTrigger asChild>{button}</TooltipTrigger>
        <TooltipContent
          side="right"
          align="center"
          hidden={state !== "collapsed" || isMobile}
          {...tooltip}
        />
      </Tooltip>
    )
  }
)
SidebarMenuButton.displayName = "SidebarMenuButton"

const SidebarMenuAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    showOnHover?: boolean
  }
>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-action"
      className={cn(
        "absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuAction.displayName = "SidebarMenuAction"

const SidebarMenuBadge = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="menu-badge"
    className={cn(
      "absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none",
      "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
      "peer-data-[size=sm]/menu-button:top-1",
      "peer-data-[size=default]/menu-button:top-1.5",
      "peer-data-[size=lg]/menu-button:top-2.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuBadge.displayName = "SidebarMenuBadge"

const SidebarMenuSkeleton = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    showIcon?: boolean
  }
>(({ className, showIcon = false, ...props }, ref) => {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      ref={ref}
      data-sidebar="menu-skeleton"
      className={cn("rounded-md h-8 flex gap-2 px-2 items-center", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 flex-1 max-w-[--skeleton-width]"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  )
})
SidebarMenuSkeleton.displayName = "SidebarMenuSkeleton"

const SidebarMenuSub = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu-sub"
    className={cn(
      "mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuSub.displayName = "SidebarMenuSub"

const SidebarMenuSubItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ ...props }, ref) => <li ref={ref} {...props} />)
SidebarMenuSubItem.displayName = "SidebarMenuSubItem"

const SidebarMenuSubButton = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentProps<"a"> & {
    asChild?: boolean
    size?: "sm" | "md"
    isActive?: boolean
  }
>(({ asChild = false, size = "md", isActive, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuSubButton.displayName = "SidebarMenuSubButton"

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}

\`\`\`

# src\components\ui\skeleton.tsx

\`\`\`tsx
import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      {...props}
    />
  )
}

export { Skeleton }

\`\`\`

# src\components\ui\slider.tsx

\`\`\`tsx
import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

const Slider = React.forwardRef<
  React.ElementRef<typeof SliderPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
>(({ className, ...props }, ref) => (
  <SliderPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex w-full touch-none select-none items-center",
      className
    )}
    {...props}
  >
    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-secondary">
      <SliderPrimitive.Range className="absolute h-full bg-primary" />
    </SliderPrimitive.Track>
    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
  </SliderPrimitive.Root>
))
Slider.displayName = SliderPrimitive.Root.displayName

export { Slider }

\`\`\`

# src\components\ui\sonner.tsx

\`\`\`tsx
import { useTheme } from "next-themes"
import { Toaster as Sonner, toast } from "sonner"

type ToasterProps = React.ComponentProps<typeof Sonner>

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      toastOptions={{
        classNames: {
          toast:
            "group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",
          description: "group-[.toast]:text-muted-foreground",
          actionButton:
            "group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",
          cancelButton:
            "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",
        },
      }}
      {...props}
    />
  )
}

export { Toaster, toast }

\`\`\`

# src\components\ui\switch.tsx

\`\`\`tsx
import * as React from "react"
import * as SwitchPrimitives from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

const Switch = React.forwardRef<
  React.ElementRef<typeof SwitchPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
>(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
      className
    )}
    {...props}
    ref={ref}
  >
    <SwitchPrimitives.Thumb
      className={cn(
        "pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"
      )}
    />
  </SwitchPrimitives.Root>
))
Switch.displayName = SwitchPrimitives.Root.displayName

export { Switch }

\`\`\`

# src\components\ui\table.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props}
    />
  </div>
))
Table.displayName = "Table"

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
))
TableHeader.displayName = "TableHeader"

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props}
  />
))
TableBody.displayName = "TableBody"

const TableFooter = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn(
      "border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",
      className
    )}
    {...props}
  />
))
TableFooter.displayName = "TableFooter"

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    )}
    {...props}
  />
))
TableRow.displayName = "TableRow"

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
      className
    )}
    {...props}
  />
))
TableHead.displayName = "TableHead"

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}
    {...props}
  />
))
TableCell.displayName = "TableCell"

const TableCaption = React.forwardRef<
  HTMLTableCaptionElement,
  React.HTMLAttributes<HTMLTableCaptionElement>
>(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn("mt-4 text-sm text-muted-foreground", className)}
    {...props}
  />
))
TableCaption.displayName = "TableCaption"

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}

\`\`\`

# src\components\ui\tabs.tsx

\`\`\`tsx
import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }

\`\`\`

# src\components\ui\textarea.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

export interface TextareaProps
  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}

const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, ...props }, ref) => {
    return (
      <textarea
        className={cn(
          "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Textarea.displayName = "Textarea"

export { Textarea }

\`\`\`

# src\components\ui\toast.tsx

\`\`\`tsx
import * as React from "react"
import * as ToastPrimitives from "@radix-ui/react-toast"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
      className
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
  {
    variants: {
      variant: {
        default: "border bg-background text-foreground",
        destructive:
          "destructive group border-destructive bg-destructive text-destructive-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
      className
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      "absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
      className
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn("text-sm font-semibold", className)}
    {...props}
  />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn("text-sm opacity-90", className)}
    {...props}
  />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}

\`\`\`

# src\components\ui\toaster.tsx

\`\`\`tsx
import { useToast } from "@/hooks/use-toast"
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from "@/components/ui/toast"

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}

\`\`\`

# src\components\ui\toggle-group.tsx

\`\`\`tsx
import * as React from "react"
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"
import { type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { toggleVariants } from "@/components/ui/toggle"

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
})

const ToggleGroup = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, children, ...props }, ref) => (
  <ToggleGroupPrimitive.Root
    ref={ref}
    className={cn("flex items-center justify-center gap-1", className)}
    {...props}
  >
    <ToggleGroupContext.Provider value={{ variant, size }}>
      {children}
    </ToggleGroupContext.Provider>
  </ToggleGroupPrimitive.Root>
))

ToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName

const ToggleGroupItem = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &
    VariantProps<typeof toggleVariants>
>(({ className, children, variant, size, ...props }, ref) => {
  const context = React.useContext(ToggleGroupContext)

  return (
    <ToggleGroupPrimitive.Item
      ref={ref}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        className
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  )
})

ToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName

export { ToggleGroup, ToggleGroupItem }

\`\`\`

# src\components\ui\toggle.tsx

\`\`\`tsx
import * as React from "react"
import * as TogglePrimitive from "@radix-ui/react-toggle"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const toggleVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-10 px-3",
        sm: "h-9 px-2.5",
        lg: "h-11 px-5",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const Toggle = React.forwardRef<
  React.ElementRef<typeof TogglePrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, ...props }, ref) => (
  <TogglePrimitive.Root
    ref={ref}
    className={cn(toggleVariants({ variant, size, className }))}
    {...props}
  />
))

Toggle.displayName = TogglePrimitive.Root.displayName

export { Toggle, toggleVariants }

\`\`\`

# src\components\ui\tooltip.tsx

\`\`\`tsx
import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }

\`\`\`

# src\components\ui\use-toast.ts

\`\`\`ts
import { useToast, toast } from "@/hooks/use-toast";

export { useToast, toast };

\`\`\`

# src\hooks\use-mobile.tsx

\`\`\`tsx
import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}

\`\`\`

# src\hooks\use-toast.ts

\`\`\`ts
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }

\`\`\`

# src\index.css

\`\`\`css

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 240 10% 14%;

    --card: 0 0% 100%;
    --card-foreground: 240 10% 14%;

    --popover: 0 0% 100%;
    --popover-foreground: 240 10% 14%;

    --primary: 52 100% 50%;
    --primary-foreground: 0 0% 0%;

    --secondary: 0 0% 96%;
    --secondary-foreground: 240 10% 14%;

    --muted: 240 5% 96%;
    --muted-foreground: 240 3.8% 46.1%;

    --accent: 0 0% 96%;
    --accent-foreground: 240 10% 14%;

    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 100%;

    --border: 240 5.9% 90%;
    --input: 240 5.9% 90%;
    --ring: 52 100% 50%;

    --radius: 0.5rem;

    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }

  .dark {
    --background: 0 0% 28%; /* #474747 - Outer Space */
    --foreground: 0 0% 98%;

    --card: 0 0% 28%;
    --card-foreground: 0 0% 98%;

    --popover: 0 0% 28%;
    --popover-foreground: 0 0% 98%;

    --primary: 52 100% 50%;
    --primary-foreground: 0 0% 0%;

    --secondary: 240 3.7% 15.9%;
    --secondary-foreground: 0 0% 98%;

    --muted: 240 3.7% 15.9%;
    --muted-foreground: 240 5% 64.9%;

    --accent: 240 3.7% 15.9%;
    --accent-foreground: 0 0% 98%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;

    --border: 240 3.7% 15.9%;
    --input: 240 3.7% 15.9%;
    --ring: 52 100% 50%;
    
    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
  }
  
  /* Apply dark mode universally to ensure all elements get the dark background */
  .dark body,
  .dark .bg-white {
    @apply bg-[#474747];
  }
  
  /* Make buttons yellow with black text in dark mode - fixed to avoid circular dependency */
  .dark button[data-state="active"] {
    background-color: #FFE600;
    color: black;
  }
  
  .dark .bg-yellow-400 {
    background-color: #FFE600;
    color: black;
  }
  
  /* Ensure yellow backgrounds always use black text for contrast */
  .bg-yellow-50, 
  .bg-yellow-100, 
  .bg-yellow-200, 
  .bg-yellow-300, 
  .bg-yellow-400, 
  .bg-yellow-500 {
    color: black;
  }
}

@layer components {
  .ey-button {
    @apply bg-ey-yellow hover:bg-ey-yellow/90 text-ey-black font-semibold py-2 px-4 rounded-md transition-colors;
  }
  
  .ey-input {
    @apply border border-ey-gray-400 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-ey-yellow;
  }

  .ey-card {
    @apply bg-white rounded-lg shadow-md p-6 border border-ey-gray-300 hover:shadow-lg transition-shadow dark:bg-background dark:border-ey-gray-700;
  }
}

\`\`\`

# src\lib\excelUtils.ts

\`\`\`ts

import * as XLSX from 'xlsx';
import { PromptOption } from './types';

// Parse Excel file and extract prompts
export const parseExcelPrompts = async (file: File): Promise<PromptOption[]> => {
  try {
    // Read the Excel file
    const data = await file.arrayBuffer();
    const workbook = XLSX.read(data);
    
    // Get the first worksheet
    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
    
    // Convert the worksheet to JSON
    const jsonData = XLSX.utils.sheet_to_json(worksheet);
    
    // Map the JSON data to PromptOption format
    const prompts: PromptOption[] = jsonData.map((row: any, index) => {
      return {
        id: `custom-${index}`,
        name: row['Prompt Name'] || row['Name'] || `Custom Prompt ${index + 1}`,
        description: row['Description'] || 'Custom prompt from Excel file',
        template: row['Template'] || 'Custom_Template',
        category: row['Category'] || 'Custom'
      };
    });
    
    return prompts;
  } catch (error) {
    console.error('Error parsing Excel file:', error);
    throw new Error('Failed to parse Excel file. Please check the format.');
  }
};

// Generate more realistic extraction results based on prompts
export const generateRealisticResults = (promptName: string) => {
  // Create more realistic data based on prompt name/type
  switch (promptName.toLowerCase()) {
    case 'ecl by stage':
      return [
        { Category: "ECL by Stage", Stage: "Stage 1", Field: "Gross Carrying Amount", Value: "$1,245.67m" },
        { Category: "ECL by Stage", Stage: "Stage 1", Field: "Loss Allowance", Value: "$12.45m" },
        { Category: "ECL by Stage", Stage: "Stage 1", Field: "Coverage Ratio", Value: "1.00%" },
        { Category: "ECL by Stage", Stage: "Stage 2", Field: "Gross Carrying Amount", Value: "$428.91m" },
        { Category: "ECL by Stage", Stage: "Stage 2", Field: "Loss Allowance", Value: "$21.45m" },
        { Category: "ECL by Stage", Stage: "Stage 2", Field: "Coverage Ratio", Value: "5.00%" },
        { Category: "ECL by Stage", Stage: "Stage 3", Field: "Gross Carrying Amount", Value: "$85.34m" },
        { Category: "ECL by Stage", Stage: "Stage 3", Field: "Loss Allowance", Value: "$42.67m" },
        { Category: "ECL by Stage", Stage: "Stage 3", Field: "Coverage Ratio", Value: "50.00%" }
      ];
    case 'management adjustments':
      return [
        { Category: "Management Adjustments", Stage: "N/A", Field: "Economic Uncertainty", Value: "$24.5m" },
        { Category: "Management Adjustments", Stage: "N/A", Field: "Model Limitations", Value: "$12.3m" },
        { Category: "Management Adjustments", Stage: "N/A", Field: "Other Adjustments", Value: "$5.8m" },
        { Category: "Management Adjustments", Stage: "N/A", Field: "Total Overlays", Value: "$42.6m" }
      ];
    case 'scenario weights':
      return [
        { Category: "Scenario Weights", Stage: "N/A", Field: "Baseline", Value: "40%" },
        { Category: "Scenario Weights", Stage: "N/A", Field: "Upside", Value: "30%" },
        { Category: "Scenario Weights", Stage: "N/A", Field: "Downside", Value: "30%" }
      ];
    case 'macro variables':
      return [
        { Category: "Macro Variables", Stage: "Baseline", Field: "GDP Growth", Value: "1.3%" },
        { Category: "Macro Variables", Stage: "Baseline", Field: "Unemployment", Value: "4.2%" },
        { Category: "Macro Variables", Stage: "Baseline", Field: "HPI Growth", Value: "1.8%" },
        { Category: "Macro Variables", Stage: "Upside", Field: "GDP Growth", Value: "2.5%" },
        { Category: "Macro Variables", Stage: "Upside", Field: "Unemployment", Value: "3.7%" },
        { Category: "Macro Variables", Stage: "Upside", Field: "HPI Growth", Value: "3.2%" },
        { Category: "Macro Variables", Stage: "Downside", Field: "GDP Growth", Value: "-0.5%" },
        { Category: "Macro Variables", Stage: "Downside", Field: "Unemployment", Value: "5.8%" },
        { Category: "Macro Variables", Stage: "Downside", Field: "HPI Growth", Value: "-2.1%" }
      ];
    default:
      return [
        { Category: promptName, Stage: "N/A", Field: "Value 1", Value: "$123.45m" },
        { Category: promptName, Stage: "N/A", Field: "Value 2", Value: "$67.89m" },
        { Category: promptName, Stage: "N/A", Field: "Ratio", Value: "55.00%" }
      ];
  }
};

\`\`\`

# src\lib\types.ts

\`\`\`ts
// src/lib/types.ts

export interface UploadedFile {
  id: string;
  name: string;
  size: number;
  type: string;
  lastModified: number;
  status: 'pending' | 'processing' | 'success' | 'error';
  progress?: number;
}

export interface PromptOption {
  id: string;
  name: string;
  description: string;
  template: string;
  category: string;
  bankName?: string; // <-- ENSURE THIS LINE IS PRESENT AND CORRECT
}

export interface ExtractedData {
  Category: string;
  Stage: string;
  Field: string;
  Value: string;
}

export interface ProcessingResult {
  id: string;
  fileId: string;
  fileName: string;
  promptId: string;
  promptName: string;
  status: 'pending' | 'processing' | 'success' | 'error';
  timestamp: string;
  data?: ExtractedData[];
  notes?: string;
  error?: string;
}
\`\`\`

# src\lib\utils.ts

\`\`\`ts

import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

/**
 * Ensures proper text contrast on colored backgrounds
 * @param bgColor - The background color class (e.g., 'bg-yellow-400')
 * @returns string - The appropriate text color class
 */
export function getTextColorForBackground(bgColor: string): string {
  // Yellow backgrounds should always have black text
  if (
    bgColor.includes('yellow') || 
    bgColor.includes('lime') || 
    bgColor.includes('green-300') ||
    bgColor.includes('amber')
  ) {
    return 'text-black';
  }
  
  // Dark backgrounds should have white text
  if (
    bgColor.includes('black') || 
    bgColor.includes('gray-800') || 
    bgColor.includes('gray-900') ||
    bgColor.includes('slate-800') ||
    bgColor.includes('slate-900')
  ) {
    return 'text-white';
  }
  
  // Default - use the current text color
  return '';
}

\`\`\`

# src\main.tsx

\`\`\`tsx

import { createRoot } from 'react-dom/client'
import App from './App.tsx'
import './index.css'

// Create root and render app
createRoot(document.getElementById("root")!).render(<App />);

\`\`\`

# src\pages\BankSelection.tsx

\`\`\`tsx

import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Button } from '@/components/ui/button';
import { 
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue
} from '@/components/ui/select';
import { ArrowRight, Check } from 'lucide-react';
import { Checkbox } from '@/components/ui/checkbox';
import { Label } from '@/components/ui/label';

const banks = [
  { id: 'barclays', name: 'Barclays' },
  { id: 'hsbc', name: 'HSBC' },
  { id: 'lloyds', name: 'Lloyds Banking Group' },
  { id: 'natwest', name: 'NatWest Group' },
  { id: 'santander', name: 'Santander UK' },
  { id: 'standard', name: 'Standard Chartered' }
];

const BankSelection = () => {
  const navigate = useNavigate();
  const [selectedBank, setSelectedBank] = useState<string>('');
  const [selectedBanks, setSelectedBanks] = useState<string[]>([]);
  const [enableMultiBanks, setEnableMultiBanks] = useState<boolean>(false);

  // Update selected banks when toggling multi-bank mode
  useEffect(() => {
    if (enableMultiBanks) {
      // If switching to multi-bank mode, initialize with the current selection
      if (selectedBank && !selectedBanks.includes(selectedBank)) {
        setSelectedBanks([selectedBank]);
      }
    } else {
      // If switching to single bank mode, use the first selected bank or empty
      setSelectedBank(selectedBanks.length > 0 ? selectedBanks[0] : '');
    }
  }, [enableMultiBanks]);

  const handleContinue = () => {
    if ((enableMultiBanks && selectedBanks.length > 0) || (!enableMultiBanks && selectedBank)) {
      // Store the selected bank(s) in session storage for use across the application
      sessionStorage.setItem('selectedBank', enableMultiBanks ? selectedBanks[0] : selectedBank);
      sessionStorage.setItem('selectedBanks', JSON.stringify(enableMultiBanks ? selectedBanks : [selectedBank]));
      sessionStorage.setItem('enableMultiBanks', enableMultiBanks.toString());
      navigate('/dashboard');
    }
  };

  const toggleBankSelection = (bankId: string) => {
    setSelectedBanks(prevSelected => {
      if (prevSelected.includes(bankId)) {
        return prevSelected.filter(id => id !== bankId);
      } else {
        return [...prevSelected, bankId];
      }
    });
  };

  // Check if a bank is selected in multi-bank mode
  const isBankSelected = (bankId: string) => {
    return selectedBanks.includes(bankId);
  };

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-ey-black text-white">
      <div className="w-full max-w-md px-6 py-12 text-center">
        <div className="mb-8">
          <div className="flex justify-center mb-6">
            <div className="h-16 w-16 bg-ey-yellow rounded-md"></div>
          </div>
          
          <h1 className="text-4xl font-bold mb-2">AiDEx</h1>
          <p className="text-ey-gray-400">
            AI powered Data Extraction
          </p>
          <p className="text-ey-gray-500 text-sm mt-1">
            Supported by EYQ
          </p>
        </div>
        
        <div className="border border-ey-gray-700 rounded-lg p-6 mb-8">
          <h2 className="text-xl font-semibold mb-6">Select Bank</h2>
          <p className="text-sm text-ey-gray-400 mb-6">
            Choose the bank you want to analyze for data extraction.
          </p>
          
          <div className="space-y-4">
            <div className="flex items-center space-x-3 mt-4 mb-4 p-3 bg-ey-gray-800/50 rounded-md">
              <Checkbox 
                id="enableMultiBanks" 
                checked={enableMultiBanks} 
                onCheckedChange={(checked) => setEnableMultiBanks(checked as boolean)}
                className="data-[state=checked]:bg-ey-yellow data-[state=checked]:text-black"
              />
              <Label htmlFor="enableMultiBanks" className="text-sm cursor-pointer">
                Enable multi-bank analysis & comparison
              </Label>
            </div>

            {enableMultiBanks ? (
              // Multi-bank selection UI
              <div className="space-y-2">
                <label className="text-sm font-medium mb-1 block text-left">
                  Financial Institutions
                </label>
                <div className="border border-ey-gray-600 bg-ey-black text-white rounded-md p-1">
                  <div className="space-y-1">
                    {banks.map(bank => (
                      <div 
                        key={bank.id}
                        onClick={() => toggleBankSelection(bank.id)}
                        className={`flex items-center justify-between p-3 rounded-md cursor-pointer transition-colors ${
                          isBankSelected(bank.id) ? 'bg-ey-yellow/20 border border-ey-yellow' : 'hover:bg-ey-gray-800'
                        }`}
                      >
                        <span className="text-sm">{bank.name}</span>
                        {isBankSelected(bank.id) && (
                          <Check className="h-4 w-4 text-ey-yellow" />
                        )}
                      </div>
                    ))}
                  </div>
                </div>
                {selectedBanks.length === 0 && (
                  <p className="text-xs text-ey-yellow mt-1">Please select at least one bank</p>
                )}
              </div>
            ) : (
              // Single bank selection UI
              <div className="text-left">
                <label className="text-sm font-medium mb-1 block">
                  Financial Institution
                </label>
                <Select onValueChange={setSelectedBank} value={selectedBank}>
                  <SelectTrigger className="w-full border-ey-gray-600 bg-ey-black text-white">
                    <SelectValue placeholder="Select a bank" />
                  </SelectTrigger>
                  <SelectContent className="bg-ey-black text-white border-ey-gray-700">
                    {banks.map(bank => (
                      <SelectItem key={bank.id} value={bank.id} className="hover:bg-ey-gray-800">
                        {bank.name}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
            )}
            
            <Button 
              onClick={handleContinue}
              disabled={enableMultiBanks ? selectedBanks.length === 0 : !selectedBank}
              className="w-full bg-ey-yellow hover:bg-ey-yellow/90 text-ey-black font-medium mt-6"
            >
              Continue to Dashboard
              <ArrowRight className="ml-2 h-4 w-4" />
            </Button>
          </div>
        </div>
        
        <div className="text-xs text-ey-gray-500">
          <p>© {new Date().getFullYear()} EY | A better working world</p>
        </div>
      </div>
    </div>
  );
};

export default BankSelection;

\`\`\`

# src\pages\Dashboard.tsx

\`\`\`tsx
// src/pages/Dashboard.tsx
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Tabs, TabsContent } from '@/components/ui/tabs'; //
import { useToast } from '@/hooks/use-toast'; //
import { UploadedFile, PromptOption, ProcessingResult } from '@/lib/types'; //
import TabNavigation from '@/components/dashboard/TabNavigation'; //
import UploadTab from '@/components/dashboard/UploadTab'; //
import PromptsTab from '@/components/dashboard/PromptsTab'; //
import ResultsTab from '@/components/dashboard/ResultsTab'; //
import CombinedTab from '@/components/dashboard/CombinedTab'; //
import SideBySideTab from '@/components/dashboard/SideBySideTab'; //
import Footer from '@/components/dashboard/Footer'; //
import { Button } from '@/components/ui/button'; //
import { Loader2 } from 'lucide-react';

const Dashboard = () => {
  const [uploadedFiles, setUploadedFiles] = useState<UploadedFile[]>([]);
  const [selectedPrompts, setSelectedPrompts] = useState<PromptOption[]>([]);
  const [results, setResults] = useState<ProcessingResult[]>([]);
  const [isProcessing, setIsProcessing] = useState(false);
  const [processingStep, setProcessingStep] = useState('');
  const [processingProgress, setProcessingProgress] = useState(0);
  const [activeTab, setActiveTab] = useState('upload');
  const { toast } = useToast();
  const [currentSessionId, setCurrentSessionId] = useState<string | null>(null);
  const navigate = useNavigate();

  const [bankDisplayInfo, setBankDisplayInfo] = useState<string>('banks');
  
  useEffect(() => {
    const enableMulti = sessionStorage.getItem('enableMultiBanks') === 'true';
    const singleBank = sessionStorage.getItem('selectedBank') || 'Selected Bank';
    const multiBanksString = sessionStorage.getItem('selectedBanks');

    let displayInfo = singleBank.charAt(0).toUpperCase() + singleBank.slice(1);
    if (enableMulti && multiBanksString) {
      try {
        const banksArray = JSON.parse(multiBanksString) as string[];
        if (banksArray.length > 0) {
          displayInfo = banksArray.map((b:string) => b.charAt(0).toUpperCase() + b.slice(1)).join(', ');
        } else {
           displayInfo = "No banks selected"; 
        }
      } catch { /* Keep singleBank displayInfo as fallback */ }
    }
    setBankDisplayInfo(displayInfo);
  }, []);

  const handleFilesUploaded = (backendConfirmedFiles: UploadedFile[]) => {
    setUploadedFiles(backendConfirmedFiles);
  };

  const handlePromptSelectedForProcessing = (promptsToProcess: PromptOption[]) => {
    setSelectedPrompts(promptsToProcess);
    if (promptsToProcess.length > 0) {
      toast({
        title: "Prompts Ready for Processing",
        description: `${promptsToProcess.length} prompt(s) selected. Click 'Process Files'.`,
      });
    }
  };

  const processFiles = async () => {
    if (uploadedFiles.length === 0) {
      toast({ title: "No Files Uploaded", description: "Please upload PDF file(s) first.", variant: "destructive" });
      return;
    }
    if (selectedPrompts.length === 0) {
      toast({ title: "No Prompts Selected", description: "Please select at least one extraction prompt.", variant: "destructive" });
      return;
    }

    setIsProcessing(true);
    setResults([]); 
    const newSessionId = `session-${Date.now()}-${Math.random().toString(36).substring(2, 10)}`;
    setCurrentSessionId(newSessionId);
    
    setProcessingStep(`Initializing processing for ${uploadedFiles.length} file(s)...`);
    setProcessingProgress(5);
    setActiveTab('results');

    try {
      const response = await fetch('http://localhost:5000/api/process', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          files: uploadedFiles.map(f => ({ id: f.id, name: f.name })), 
          prompts: selectedPrompts.map(p => ({ id: p.id, name: p.name, template: p.template })), 
          sessionId: newSessionId 
        })
      });

      if (!response.ok) {
        const errorData = await response.json().catch(() => ({ error: "Server error during processing setup."}));
        throw new Error(errorData.error || `Processing request failed: ${response.statusText}`);
      }
      const data = await response.json();
      if (data.status === 'success' && data.results) {
        setResults(data.results);
        setProcessingStep('Processing complete!');
        setProcessingProgress(100);
        toast({ title: "Processing Complete", description: `Session ${newSessionId} finished.`});
      } else {
         throw new Error(data.error || "Processing finished with an unexpected status or no results.");
      }
    } catch (error) {
      console.error("Processing Error:", error);
      setProcessingStep('Error during processing.');
      setProcessingProgress(100);
      toast({ title: "Processing Error", description: error instanceof Error ? error.message : "An unknown error occurred.", variant: "destructive" });
    } finally {
      setIsProcessing(false);
    }
  };

  const handleDownloadResults = async () => {
    if (!currentSessionId) {
      toast({ title: "Cannot Download", description: "No processing session found. Please process files first.", variant: "destructive" }); return;
    }
     if (results.length === 0 && !isProcessing) {
       toast({ title: "No Results to Download", description: "Process files to generate results first.", variant: "default"}); return;
     }
     if (isProcessing) {
        toast({ title: "Processing in Progress", description: "Please wait for processing to complete before downloading.", variant: "default"}); return;
     }
    toast({ title: "Preparing Download...", description: "Your Excel file is being generated." });
    try {
      const response = await fetch(`http://localhost:5000/api/download/${currentSessionId}`);
      if (!response.ok) {
        const errorData = await response.json().catch(() => ({ error: "Download request failed with status: " + response.status }));
        throw new Error(errorData.error || `Server error: ${response.statusText}`);
      }
      const blob = await response.blob();
      const contentDisposition = response.headers.get('content-disposition');
      let filename = `IFRS9_Results_${currentSessionId}.xlsx`;
      if (contentDisposition) {
        const filenameMatch = contentDisposition.match(/filename="?(.+)"?/i);
        if (filenameMatch && filenameMatch.length > 1) filename = filenameMatch[1];
      }
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a); a.click(); a.remove();
      window.URL.revokeObjectURL(url);
      toast({ title: "Download Started!", description: `${filename} is downloading.` });
    } catch (error) {
      console.error("Download Error:", error);
      toast({ title: "Download Failed", description: (error instanceof Error ? error.message : "Could not download results."), variant: "destructive" });
    }
  };

  const handleReset = () => {
    setUploadedFiles([]); setSelectedPrompts([]); setResults([]);
    setCurrentSessionId(null); setActiveTab('upload');
    setProcessingProgress(0); setProcessingStep('');
    toast({ title: "Application Reset", description: "All selections and results cleared." });
  };
  
  const goToNextTab = () => {
    if (activeTab === 'upload' && uploadedFiles.length > 0) setActiveTab('prompts');
    else if (activeTab === 'upload' && uploadedFiles.length === 0) {
        toast({title: "No Files Uploaded", description: "Please upload files to proceed.", variant: "default"});
    }
  };

  const goToPreviousTab = () => {
    if (activeTab === 'prompts') setActiveTab('upload');
    else if (['results', 'combined', 'sidebyside'].includes(activeTab)) setActiveTab('prompts');
  };

  // Line 229: Check for typos or missing commas if error persists around here
  return (
    <div className="min-h-screen flex flex-col bg-background text-foreground">
      <div className="bg-yellow-400 text-black py-1 px-4 text-sm flex justify-between items-center">
        <div>
          Selected Bank(s): <span className="font-semibold">{bankDisplayInfo}</span>
        </div>
        <Button 
          variant="link" size="sm" onClick={() => navigate('/')}
          className="h-auto p-0 text-black underline text-xs hover:text-gray-700"
        >Change Bank(s)</Button>
      </div>
      
      <TabNavigation activeTab={activeTab} setActiveTab={setActiveTab} />

      <main className="flex-grow container mx-auto px-4 py-6">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
          {/* ... UploadTab and PromptsTab ... */}
          <TabsContent value="upload" className="space-y-6">
            <UploadTab 
              onFilesUploaded={handleFilesUploaded}
              uploadedFiles={uploadedFiles}
              goToNextTab={goToNextTab}
            />
          </TabsContent>
          
          <TabsContent value="prompts" className="space-y-6">
            <div className="flex flex-col space-y-4">
              <PromptsTab 
                onPromptSelected={handlePromptSelectedForProcessing}
                isProcessing={isProcessing}
                selectedPrompts={selectedPrompts}
              />
              <div className="flex justify-between items-center mt-4 pt-4 border-t dark:border-gray-700">
                <Button onClick={goToPreviousTab} variant="outline" disabled={isProcessing}>
                  Back to Upload
                </Button>
                <Button 
                  onClick={processFiles}
                  disabled={isProcessing || selectedPrompts.length === 0 || uploadedFiles.length === 0}
                  className="bg-yellow-400 hover:bg-yellow-500 text-black font-semibold"
                >
                  {isProcessing && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
                  {isProcessing ? "Processing..." : `Process ${uploadedFiles.length} File(s)`}
                </Button>
              </div>
            </div>
          </TabsContent>
          
          <TabsContent value="results" className="space-y-6">
            <ResultsTab 
              results={results}
              onDownloadResults={handleDownloadResults}
              isProcessing={isProcessing}
              processingProgress={processingProgress}
              processingStep={processingStep}
              selectedBank={bankDisplayInfo}
              totalUploadedFiles={uploadedFiles.length}
            />
          </TabsContent>
          
          <TabsContent value="combined" className="space-y-6">
            <CombinedTab 
              results={results} 
              onDownloadResults={handleDownloadResults} 
              selectedBank={bankDisplayInfo}
            />
          </TabsContent>
        {/* Line 244: Where SideBySideTab is rendered */}
          <TabsContent value="sidebyside" className="space-y-6">
            <SideBySideTab 
              results={results} 
              selectedBank={bankDisplayInfo} 
              // No other props seem to be passed here
            />
          </TabsContent>
        </Tabs>
      </main>
      
      <Footer />
    </div>
  );
};

export default Dashboard;
\`\`\`

# src\pages\Index.tsx

\`\`\`tsx

import { useState } from 'react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { UploadedFile, PromptOption, ProcessingResult } from '@/lib/types';
import { Button } from '@/components/ui/button';
import FileUploader from '@/components/FileUploader';
import PromptSelector from '@/components/PromptSelector';
import ResultsViewer from '@/components/ResultsViewer';
import { useToast } from '@/hooks/use-toast';
import { Download, Upload, FileText, FileSpreadsheet } from 'lucide-react';
import { generateRealisticResults } from '@/lib/excelUtils';

const Index = () => {
  const [uploadedFiles, setUploadedFiles] = useState<UploadedFile[]>([]);
  const [selectedPrompts, setSelectedPrompts] = useState<PromptOption[]>([]);
  const [results, setResults] = useState<ProcessingResult[]>([]);
  const [isProcessing, setIsProcessing] = useState(false);
  const [processingStep, setProcessingStep] = useState('');
  const [processingProgress, setProcessingProgress] = useState(0);
  const [activeTab, setActiveTab] = useState('upload');
  const { toast } = useToast();

  // Handle uploaded files
  const handleFilesUploaded = (files: UploadedFile[]) => {
    setUploadedFiles(files);
  };

  // Handle prompt selection
  const handlePromptSelected = (prompts: PromptOption[]) => {
    setSelectedPrompts(prompts);
    if (prompts.length > 0) {
      toast({
        title: "Prompts Selected",
        description: `${prompts.length} extraction ${prompts.length === 1 ? 'prompt' : 'prompts'} selected`,
      });
    }
  };

  // Simulate the processing function
  const processFiles = async () => {
    if (uploadedFiles.length === 0) {
      toast({
        title: "No files to process",
        description: "Please upload at least one PDF file.",
        variant: "destructive",
      });
      return;
    }

    if (selectedPrompts.length === 0) {
      toast({
        title: "No prompts selected",
        description: "Please select at least one extraction prompt.",
        variant: "destructive",
      });
      return;
    }

    // Start processing
    setIsProcessing(true);
    setProcessingStep('Initializing extraction process...');
    setProcessingProgress(5);
    setActiveTab('results');

    const newResults: ProcessingResult[] = [];

    // Simulate processing for each file and prompt
    let completedItems = 0;
    const totalItems = uploadedFiles.length * selectedPrompts.length;

    for (const file of uploadedFiles) {
      // Simulate parsing the file
      setProcessingStep(`Parsing ${file.name}...`);
      await new Promise(resolve => setTimeout(resolve, 1000));
      setProcessingProgress(10 + (completedItems / totalItems) * 30);

      // For each prompt, create a result
      for (const prompt of selectedPrompts) {
        setProcessingStep(`Extracting ${prompt.name} from ${file.name}...`);
        
        // Simulate API request delay
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // Create a result with either success or random error
        const isSuccess = Math.random() > 0.05; // 95% success rate for demo
        
        const result: ProcessingResult = {
          id: `result-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
          fileId: file.id,
          fileName: file.name,
          promptId: prompt.id,
          promptName: prompt.name,
          status: isSuccess ? 'success' : 'error',
          timestamp: new Date().toISOString(),
          data: isSuccess ? generateRealisticResults(prompt.name) : undefined,
          notes: isSuccess 
            ? `Extraction completed successfully for ${prompt.name}.` 
            : undefined,
          error: isSuccess 
            ? undefined 
            : "Could not find relevant information in the document or the format was not recognized."
        };
        
        newResults.push(result);
        completedItems++;
        setProcessingProgress(10 + (completedItems / totalItems) * 80);
      }
    }

    // Final processing step
    setProcessingStep('Finalizing results...');
    await new Promise(resolve => setTimeout(resolve, 1000));
    setProcessingProgress(100);

    // Update results and finish processing
    setResults([...results, ...newResults]);
    setIsProcessing(false);
    
    toast({
      title: "Processing Complete",
      description: `Processed ${uploadedFiles.length} files with ${selectedPrompts.length} prompts`,
      variant: "default",
    });
  };

  // Simulate downloading results
  const handleDownloadResults = () => {
    toast({
      title: "Downloading Results",
      description: "Your results would download as an Excel file in a real implementation.",
    });
  };

  // Reset everything
  const handleReset = () => {
    setUploadedFiles([]);
    setSelectedPrompts([]);
    setResults([]);
    setActiveTab('upload');
    toast({
      title: "Reset Complete",
      description: "All files and prompts have been cleared.",
    });
  };

  // Navigate to the next tab
  const goToNextTab = () => {
    if (activeTab === 'upload') setActiveTab('prompts');
    else if (activeTab === 'prompts') {
      processFiles();
    }
  };

  // Go back to previous tab
  const goToPreviousTab = () => {
    if (activeTab === 'prompts') setActiveTab('upload');
    else if (activeTab === 'results') setActiveTab('prompts');
  };

  return (
    <div className="min-h-screen flex flex-col bg-white">
      {/* Tabs header */}
      <div className="border-b">
        <div className="container mx-auto px-4">
          <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
            <TabsList className="grid grid-cols-4 w-full max-w-2xl mx-auto my-4">
              <TabsTrigger 
                value="upload" 
                className={activeTab === 'upload' ? 'bg-yellow-400 text-black' : ''}
              >
                <Upload className="h-4 w-4 mr-2" />
                Upload
              </TabsTrigger>
              <TabsTrigger 
                value="prompts" 
                className={activeTab === 'prompts' ? 'bg-yellow-400 text-black' : ''}
              >
                <FileText className="h-4 w-4 mr-2" />
                Prompts
              </TabsTrigger>
              <TabsTrigger 
                value="results" 
                className={activeTab === 'results' ? 'bg-yellow-400 text-black' : ''}
              >
                <FileSpreadsheet className="h-4 w-4 mr-2" />
                Results
              </TabsTrigger>
              <TabsTrigger 
                value="combined" 
                className={activeTab === 'combined' ? 'bg-yellow-400 text-black' : ''}
              >
                <Download className="h-4 w-4 mr-2" />
                Combined
              </TabsTrigger>
            </TabsList>
          </Tabs>
        </div>
      </div>

      {/* Main Content */}
      <main className="flex-grow container mx-auto px-4 py-6">
        <Tabs value={activeTab}>
          {/* Upload Tab */}
          <TabsContent value="upload" className="space-y-6">
            <div className="grid grid-cols-1 gap-6">
              <FileUploader 
                onFilesUploaded={handleFilesUploaded}
                acceptedFileTypes={['.pdf']}
              />
              
              <div className="flex justify-end">
                <Button 
                  onClick={goToNextTab} 
                  disabled={uploadedFiles.length === 0}
                  className="bg-yellow-400 hover:bg-yellow-500 text-black"
                >
                  Next: Select Prompts
                </Button>
              </div>
            </div>
          </TabsContent>
          
          {/* Prompts Tab */}
          <TabsContent value="prompts" className="space-y-6">
            <PromptSelector 
              onPromptSelected={handlePromptSelected} 
              disabled={isProcessing}
            />
          </TabsContent>
          
          {/* Results Tab */}
          <TabsContent value="results" className="space-y-6">
            <ResultsViewer 
              results={results}
              onDownloadResults={handleDownloadResults}
              isProcessing={isProcessing}
              processingProgress={processingProgress}
              processingStep={processingStep}
            />
          </TabsContent>
          
          {/* Combined Tab */}
          <TabsContent value="combined" className="space-y-6">
            <div className="space-y-6">
              <div className="flex justify-between items-center">
                <div>
                  <h2 className="text-lg font-semibold mb-1">IFRS9 Combined Results</h2>
                  <p className="text-sm text-muted-foreground">
                    View and download the final processed IFRS9 data in Excel format
                  </p>
                </div>
                <Button 
                  variant="outline" 
                  size="sm" 
                  onClick={handleDownloadResults}
                  className="flex items-center gap-1 border-yellow-400 bg-white text-black hover:bg-yellow-50"
                >
                  <Download className="h-4 w-4" />
                  <span>Download Excel</span>
                </Button>
              </div>
              
              <div className="border rounded-lg overflow-hidden">
                <div className="flex justify-between items-center p-3 bg-muted border-b">
                  <Button 
                    variant="outline" 
                    size="sm" 
                    className="py-1 h-8 bg-yellow-400 hover:bg-yellow-500 border-none text-black"
                  >
                    Combined View
                  </Button>
                  <div className="text-sm text-muted-foreground">
                    28 rows
                  </div>
                </div>
                
                <div className="h-[500px] overflow-y-auto">
                  <table className="w-full text-sm">
                    <thead className="bg-muted/70 sticky top-0">
                      <tr>
                        <th className="p-3 text-left font-semibold text-black">Category</th>
                        <th className="p-3 text-left font-semibold text-black">Stage</th>
                        <th className="p-3 text-left font-semibold text-black">Field</th>
                        <th className="p-3 text-left font-semibold text-black">Value</th>
                        <th className="p-3 text-left font-semibold text-black">Source</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 1</td>
                        <td className="p-3">Gross Carrying Amount</td>
                        <td className="p-3">$1,029.66m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 1</td>
                        <td className="p-3">Loss Allowance</td>
                        <td className="p-3">$12.64m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 1</td>
                        <td className="p-3">Coverage Ratio</td>
                        <td className="p-3">0.94%</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 2</td>
                        <td className="p-3">Gross Carrying Amount</td>
                        <td className="p-3">$502.11m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 2</td>
                        <td className="p-3">Loss Allowance</td>
                        <td className="p-3">$20.71m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 2</td>
                        <td className="p-3">Coverage Ratio</td>
                        <td className="p-3">6.35%</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </TabsContent>
        </Tabs>
      </main>
      
      {/* Footer */}
      <footer className="bg-gray-100 border-t mt-auto py-4">
        <div className="container mx-auto px-4">
          <div className="flex justify-between items-center text-sm text-muted-foreground">
            <div>IFRS9 Data Extraction Tool</div>
            <div>© {new Date().getFullYear()} Barclays Financial Services</div>
          </div>
        </div>
      </footer>
    </div>
  );
};

export default Index;

\`\`\`

# src\pages\NotFound.tsx

\`\`\`tsx
import { useLocation } from "react-router-dom";
import { useEffect } from "react";

const NotFound = () => {
  const location = useLocation();

  useEffect(() => {
    console.error(
      "404 Error: User attempted to access non-existent route:",
      location.pathname
    );
  }, [location.pathname]);

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <div className="text-center">
        <h1 className="text-4xl font-bold mb-4">404</h1>
        <p className="text-xl text-gray-600 mb-4">Oops! Page not found</p>
        <a href="/" className="text-blue-500 hover:text-blue-700 underline">
          Return to Home
        </a>
      </div>
    </div>
  );
};

export default NotFound;

\`\`\`

# src\vite-env.d.ts

\`\`\`ts
/// <reference types="vite/client" />

\`\`\`

# tailwind.config.ts

\`\`\`ts

import type { Config } from "tailwindcss";

export default {
	darkMode: ["class"],
	content: [
		"./pages/**/*.{ts,tsx}",
		"./components/**/*.{ts,tsx}",
		"./app/**/*.{ts,tsx}",
		"./src/**/*.{ts,tsx}",
	],
	prefix: "",
	theme: {
		container: {
			center: true,
			padding: '2rem',
			screens: {
				'2xl': '1400px'
			}
		},
		extend: {
			colors: {
				border: 'hsl(var(--border))',
				input: 'hsl(var(--input))',
				ring: 'hsl(var(--ring))',
				background: 'hsl(var(--background))',
				foreground: 'hsl(var(--foreground))',
				primary: {
					DEFAULT: 'hsl(var(--primary))',
					foreground: 'hsl(var(--primary-foreground))'
				},
				secondary: {
					DEFAULT: 'hsl(var(--secondary))',
					foreground: 'hsl(var(--secondary-foreground))'
				},
				destructive: {
					DEFAULT: 'hsl(var(--destructive))',
					foreground: 'hsl(var(--destructive-foreground))'
				},
				muted: {
					DEFAULT: 'hsl(var(--muted))',
					foreground: 'hsl(var(--muted-foreground))'
				},
				accent: {
					DEFAULT: 'hsl(var(--accent))',
					foreground: 'hsl(var(--accent-foreground))'
				},
				popover: {
					DEFAULT: 'hsl(var(--popover))',
					foreground: 'hsl(var(--popover-foreground))'
				},
				card: {
					DEFAULT: 'hsl(var(--card))',
					foreground: 'hsl(var(--card-foreground))'
				},
				sidebar: {
					DEFAULT: 'hsl(var(--sidebar-background))',
					foreground: 'hsl(var(--sidebar-foreground))',
					primary: 'hsl(var(--sidebar-primary))',
					'primary-foreground': 'hsl(var(--sidebar-primary-foreground))',
					accent: 'hsl(var(--sidebar-accent))',
					'accent-foreground': 'hsl(var(--sidebar-accent-foreground))',
					border: 'hsl(var(--sidebar-border))',
					ring: 'hsl(var(--sidebar-ring))'
				},
				ey: {
					black: '#000000',
					yellow: '#FFE600',
					white: '#FFFFFF',
					gray: {
						100: '#F6F6F7',
						200: '#F1F1F1', 
						300: '#EAEAEA',
						400: '#C8C8C9',
						500: '#9F9EA1',
						600: '#8A898C',
						700: '#555555',
						800: '#403E43',
						900: '#221F26'
					}
				}
			},
			borderRadius: {
				lg: 'var(--radius)',
				md: 'calc(var(--radius) - 2px)',
				sm: 'calc(var(--radius) - 4px)'
			},
			keyframes: {
				'accordion-down': {
					from: {
						height: '0'
					},
					to: {
						height: 'var(--radix-accordion-content-height)'
					}
				},
				'accordion-up': {
					from: {
						height: 'var(--radix-accordion-content-height)'
					},
					to: {
						height: '0'
					}
				},
				'pulse-gentle': {
					'0%, 100%': { opacity: '1' },
					'50%': { opacity: '0.7' }
				},
				'fade-in': {
					'0%': { opacity: '0' },
					'100%': { opacity: '1' }
				},
				'slide-up': {
					'0%': { transform: 'translateY(20px)', opacity: '0' },
					'100%': { transform: 'translateY(0)', opacity: '1' }
				},
				'float-1': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-5px)' }
				},
				'float-2': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-7px)' }
				},
				'float-3': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-4px)' }
				},
				'float-4': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-6px)' }
				},
				'float-5': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-3px)' }
				},
				'float-6': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-5px)' }
				},
				'float-7': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-4px)' }
				},
				'float-8': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-6px)' }
				},
				'page-transition-in': {
					'0%': { transform: 'translateX(20px)', opacity: '0' },
					'100%': { transform: 'translateX(0)', opacity: '1' }
				},
				'page-transition-out': {
					'0%': { transform: 'translateX(0)', opacity: '1' },
					'100%': { transform: 'translateX(-20px)', opacity: '0' }
				}
			},
			animation: {
				'accordion-down': 'accordion-down 0.2s ease-out',
				'accordion-up': 'accordion-up 0.2s ease-out',
				'pulse-gentle': 'pulse-gentle 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
				'fade-in': 'fade-in 0.6s ease-in-out',
				'slide-up': 'slide-up 0.6s ease-out',
				'float-1': 'float-1 3s ease-in-out infinite',
				'float-2': 'float-2 3.2s ease-in-out infinite 0.1s',
				'float-3': 'float-3 2.8s ease-in-out infinite 0.2s',
				'float-4': 'float-4 3.5s ease-in-out infinite 0.3s',
				'float-5': 'float-5 2.9s ease-in-out infinite 0.4s',
				'float-6': 'float-6 3.1s ease-in-out infinite 0.5s',
				'float-7': 'float-7 3.3s ease-in-out infinite 0.6s',
				'float-8': 'float-8 3.0s ease-in-out infinite 0.7s',
				'page-transition-in': 'page-transition-in 0.3s ease-out',
				'page-transition-out': 'page-transition-out 0.3s ease-out'
			}
		}
	},
	plugins: [require("tailwindcss-animate")],
} satisfies Config;

\`\`\`

# tsconfig.app.json

\`\`\`json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": false,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noImplicitAny": false,
    "noFallthroughCasesInSwitch": false,

    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"]
}

\`\`\`

# tsconfig.json

\`\`\`json
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ],
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    },
    "noImplicitAny": false,
    "noUnusedParameters": false,
    "skipLibCheck": true,
    "allowJs": true,
    "noUnusedLocals": false,
    "strictNullChecks": false
  }
}

\`\`\`

# tsconfig.node.json

\`\`\`json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["vite.config.ts"]
}

\`\`\`

# vite.config.ts

\`\`\`ts
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react-swc";
import path from "path";
import { componentTagger } from "lovable-tagger";

// https://vitejs.dev/config/
export default defineConfig(({ mode }) => ({
  server: {
    host: "::",
    port: 8080,
  },
  plugins: [
    react(),
    mode === 'development' &&
    componentTagger(),
  ].filter(Boolean),
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
}));

\`\`\`


```

# dataextract-ey-main\codebase_frontend.md

```md
# .gitignore

\`\`\`
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

\`\`\`

# components.json

\`\`\`json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "src/index.css",
    "baseColor": "slate",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  }
}
\`\`\`

# eslint.config.js

\`\`\`js
import js from "@eslint/js";
import globals from "globals";
import reactHooks from "eslint-plugin-react-hooks";
import reactRefresh from "eslint-plugin-react-refresh";
import tseslint from "typescript-eslint";

export default tseslint.config(
  { ignores: ["dist"] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ["**/*.{ts,tsx}"],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      "react-hooks": reactHooks,
      "react-refresh": reactRefresh,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      "react-refresh/only-export-components": [
        "warn",
        { allowConstantExport: true },
      ],
      "@typescript-eslint/no-unused-vars": "off",
    },
  }
);

\`\`\`

# index.html

\`\`\`html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>finscope-data-miner</title>
    <meta name="description" content="Lovable Generated Project" />
    <meta name="author" content="Lovable" />

    <meta property="og:title" content="finscope-data-miner" />
    <meta property="og:description" content="Lovable Generated Project" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  </head>

  <body>
    <div id="root"></div>
    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

\`\`\`

# package.json

\`\`\`json
{
  "name": "vite_react_shadcn_ts",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "build:dev": "vite build --mode development",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@hookform/resolvers": "^3.9.0",
    "@radix-ui/react-accordion": "^1.2.0",
    "@radix-ui/react-alert-dialog": "^1.1.1",
    "@radix-ui/react-aspect-ratio": "^1.1.0",
    "@radix-ui/react-avatar": "^1.1.0",
    "@radix-ui/react-checkbox": "^1.1.1",
    "@radix-ui/react-collapsible": "^1.1.0",
    "@radix-ui/react-context-menu": "^2.2.1",
    "@radix-ui/react-dialog": "^1.1.2",
    "@radix-ui/react-dropdown-menu": "^2.1.1",
    "@radix-ui/react-hover-card": "^1.1.1",
    "@radix-ui/react-label": "^2.1.0",
    "@radix-ui/react-menubar": "^1.1.1",
    "@radix-ui/react-navigation-menu": "^1.2.0",
    "@radix-ui/react-popover": "^1.1.1",
    "@radix-ui/react-progress": "^1.1.0",
    "@radix-ui/react-radio-group": "^1.2.0",
    "@radix-ui/react-scroll-area": "^1.1.0",
    "@radix-ui/react-select": "^2.1.1",
    "@radix-ui/react-separator": "^1.1.0",
    "@radix-ui/react-slider": "^1.2.0",
    "@radix-ui/react-slot": "^1.1.0",
    "@radix-ui/react-switch": "^1.1.0",
    "@radix-ui/react-tabs": "^1.1.0",
    "@radix-ui/react-toast": "^1.2.1",
    "@radix-ui/react-toggle": "^1.1.0",
    "@radix-ui/react-toggle-group": "^1.1.0",
    "@radix-ui/react-tooltip": "^1.1.4",
    "@tanstack/react-query": "^5.56.2",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.0.0",
    "date-fns": "^3.6.0",
    "embla-carousel-react": "^8.3.0",
    "framer-motion": "^12.10.5",
    "input-otp": "^1.2.4",
    "lucide-react": "^0.462.0",
    "next-themes": "^0.3.0",
    "pdfjs-dist": "^3.10.111",
    "react": "^18.3.1",
    "react-day-picker": "^8.10.1",
    "react-dom": "^18.3.1",
    "react-hook-form": "^7.53.0",
    "react-resizable-panels": "^2.1.3",
    "react-router-dom": "^6.26.2",
    "recharts": "^2.12.7",
    "sonner": "^1.5.0",
    "tailwind-merge": "^2.5.2",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^0.9.3",
    "xlsx": "^0.18.5",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@eslint/js": "^9.9.0",
    "@tailwindcss/typography": "^0.5.15",
    "@types/node": "^22.5.5",
    "@types/react": "^18.3.3",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react-swc": "^3.5.0",
    "autoprefixer": "^10.4.20",
    "eslint": "^9.9.0",
    "eslint-plugin-react-hooks": "^5.1.0-rc.0",
    "eslint-plugin-react-refresh": "^0.4.9",
    "globals": "^15.9.0",
    "lovable-tagger": "^1.1.7",
    "postcss": "^8.4.47",
    "tailwindcss": "^3.4.11",
    "typescript": "^5.5.3",
    "typescript-eslint": "^8.0.1",
    "vite": "^5.4.1"
  }
}

\`\`\`

# postcss.config.js

\`\`\`js
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}

\`\`\`

# public\favicon.ico

This is a binary file of the type: Binary

# public\placeholder.svg

This is a file of the type: SVG Image

# public\robots.txt

\`\`\`txt
User-agent: Googlebot
Allow: /

User-agent: Bingbot
Allow: /

User-agent: Twitterbot
Allow: /

User-agent: facebookexternalhit
Allow: /

User-agent: *
Allow: /

\`\`\`

# README.md

\`\`\`md
# Welcome to your Lovable project

## Project info

**URL**: https://lovable.dev/projects/f1c52b0c-481b-4d58-84cf-5beb28959f75

## How can I edit this code?

There are several ways of editing your application.

**Use Lovable**

Simply visit the [Lovable Project](https://lovable.dev/projects/f1c52b0c-481b-4d58-84cf-5beb28959f75) and start prompting.

Changes made via Lovable will be committed automatically to this repo.

**Use your preferred IDE**

If you want to work locally using your own IDE, you can clone this repo and push changes. Pushed changes will also be reflected in Lovable.

The only requirement is having Node.js & npm installed - [install with nvm](https://github.com/nvm-sh/nvm#installing-and-updating)

Follow these steps:

\`\`\`sh
# Step 1: Clone the repository using the project's Git URL.
git clone <YOUR_GIT_URL>

# Step 2: Navigate to the project directory.
cd <YOUR_PROJECT_NAME>

# Step 3: Install the necessary dependencies.
npm i

# Step 4: Start the development server with auto-reloading and an instant preview.
npm run dev
\`\`\`

**Edit a file directly in GitHub**

- Navigate to the desired file(s).
- Click the "Edit" button (pencil icon) at the top right of the file view.
- Make your changes and commit the changes.

**Use GitHub Codespaces**

- Navigate to the main page of your repository.
- Click on the "Code" button (green button) near the top right.
- Select the "Codespaces" tab.
- Click on "New codespace" to launch a new Codespace environment.
- Edit files directly within the Codespace and commit and push your changes once you're done.

## What technologies are used for this project?

This project is built with:

- Vite
- TypeScript
- React
- shadcn-ui
- Tailwind CSS

## How can I deploy this project?

Simply open [Lovable](https://lovable.dev/projects/f1c52b0c-481b-4d58-84cf-5beb28959f75) and click on Share -> Publish.

## Can I connect a custom domain to my Lovable project?

Yes, you can!

To connect a domain, navigate to Project > Settings > Domains and click Connect Domain.

Read more here: [Setting up a custom domain](https://docs.lovable.dev/tips-tricks/custom-domain#step-by-step-guide)

\`\`\`

# src\App.css

\`\`\`css
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}

\`\`\`

# src\App.tsx

\`\`\`tsx

import { Toaster } from "@/components/ui/toaster";
import { Toaster as Sonner } from "@/components/ui/sonner";
import { TooltipProvider } from "@/components/ui/tooltip";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { BrowserRouter, Routes, Route, useLocation } from "react-router-dom";
import { AnimatePresence, motion } from "framer-motion";
import IntroScreen from "./components/IntroScreen";
import Dashboard from "./pages/Dashboard";
import BankSelection from "./pages/BankSelection";
import NotFound from "./pages/NotFound";
import { ThemeProvider } from "./components/ThemeProvider";
import { ThemeToggle } from "./components/ThemeToggle";

const queryClient = new QueryClient();

// Simple, elegant fade transition
const pageVariants = {
  initial: {
    opacity: 0
  },
  in: {
    opacity: 1
  },
  out: {
    opacity: 0
  }
};

// Smooth, quick transition
const pageTransition = {
  duration: 0.3,
  ease: "easeInOut"
};

// Animation wrapper component with elegant transitions
const AnimatedRoutes = () => {
  const location = useLocation();
  
  return (
    <AnimatePresence mode="wait">
      <motion.div
        key={location.pathname}
        initial="initial"
        animate="in"
        exit="out"
        variants={pageVariants}
        transition={pageTransition}
        className="w-full min-h-screen"
      >
        {/* Theme toggle positioned in header instead of fixed position */}
        <Routes location={location}>
          <Route path="/" element={<IntroScreen />} />
          <Route path="/select-bank" element={<BankSelection />} />
          <Route path="/dashboard" element={<Dashboard />} />
          <Route path="*" element={<NotFound />} />
        </Routes>
      </motion.div>
    </AnimatePresence>
  );
};

const App = () => (
  <QueryClientProvider client={queryClient}>
    <ThemeProvider defaultTheme="light">
      <TooltipProvider>
        <Toaster />
        <Sonner />
        <BrowserRouter>
          <AnimatedRoutes />
        </BrowserRouter>
      </TooltipProvider>
    </ThemeProvider>
  </QueryClientProvider>
);

export default App;

\`\`\`

# src\components\dashboard\CombinedTab.tsx

\`\`\`tsx

import { Button } from '@/components/ui/button';
import { ProcessingResult } from '@/lib/types';
import { Download } from 'lucide-react';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';

interface CombinedTabProps {
  results: ProcessingResult[];
  onDownloadResults: () => void;
}

const CombinedTab = ({ results, onDownloadResults }: CombinedTabProps) => {
  // Extract unique data entries from all results
  const combinedData = results
    .filter(result => result.status === 'success' && result.data)
    .flatMap(result => {
      return result.data?.map(item => ({
        ...item,
        Source: `${result.fileName} - ${result.promptName}`
      })) || [];
    });

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h2 className="text-lg font-semibold mb-1">Combined Results</h2>
          <p className="text-sm text-muted-foreground">
            View and download the final processed data in Excel format
          </p>
        </div>
        <Button 
          variant="outline" 
          size="sm" 
          onClick={onDownloadResults}
          className="flex items-center gap-1 border-yellow-400 bg-white text-black hover:bg-yellow-50"
        >
          <Download className="h-4 w-4" />
          <span>Download Excel</span>
        </Button>
      </div>
      
      {combinedData.length > 0 ? (
        <div className="border rounded-lg overflow-hidden">
          <div className="flex justify-between items-center p-3 bg-muted border-b">
            <Button 
              variant="outline" 
              size="sm" 
              className="py-1 h-8 bg-yellow-400 hover:bg-yellow-500 border-none text-black"
            >
              Combined View
            </Button>
            <div className="text-sm text-muted-foreground">
              {combinedData.length} rows
            </div>
          </div>
          
          {/* Increased the height from 500px to 650px for larger view */}
          <ScrollArea className="h-[650px]">
            <Table>
              <TableHeader className="bg-muted/70 sticky top-0">
                <TableRow>
                  <TableHead className="font-semibold text-black">Category</TableHead>
                  <TableHead className="font-semibold text-black">Stage</TableHead>
                  <TableHead className="font-semibold text-black">Field</TableHead>
                  <TableHead className="font-semibold text-black">Value</TableHead>
                  <TableHead className="font-semibold text-black">Source</TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {combinedData.map((item, index) => (
                  <TableRow key={index}>
                    <TableCell>{item.Category === 'ECL By Stage' ? 'ECL' : item.Category}</TableCell>
                    <TableCell>{item.Stage}</TableCell>
                    <TableCell>{item.Field}</TableCell>
                    <TableCell>{item.Value}</TableCell>
                    <TableCell>{item.Source}</TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </ScrollArea>
        </div>
      ) : (
        <div className="border rounded-lg p-12 text-center">
          <p className="text-muted-foreground">No results available yet.</p>
          <p className="text-sm text-muted-foreground mt-1">Process files with prompts to see combined results.</p>
        </div>
      )}
    </div>
  );
};

export default CombinedTab;

\`\`\`

# src\components\dashboard\Footer.tsx

\`\`\`tsx

const Footer = () => {
  return (
    <footer className="bg-gray-100 border-t mt-auto py-4">
      <div className="container mx-auto px-4">
        <div className="flex justify-between items-center text-sm text-muted-foreground">
          <div>AiDEx - AI powered Data Extraction</div>
          <div>© {new Date().getFullYear()} Barclays Financial Services</div>
        </div>
      </div>
    </footer>
  );
};

export default Footer;

\`\`\`

# src\components\dashboard\PromptsTab.tsx

\`\`\`tsx

import PromptSelector from '@/components/PromptSelector';
import PromptDescriptions from '@/components/PromptDescriptions';
import { PromptOption } from '@/lib/types';
import { useCallback } from 'react';

interface PromptsTabProps {
  onPromptSelected: (prompts: PromptOption[]) => void;
  isProcessing: boolean;
  selectedPrompts?: PromptOption[];
}

const PromptsTab = ({ onPromptSelected, isProcessing, selectedPrompts = [] }: PromptsTabProps) => {
  // Use a callback to avoid setState during render
  const handlePromptSelected = useCallback((prompts: PromptOption[]) => {
    onPromptSelected(prompts);
  }, [onPromptSelected]);

  return (
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div>
        <PromptSelector 
          onPromptSelected={handlePromptSelected}
          disabled={isProcessing}
          selectedPrompts={selectedPrompts}
        />
      </div>
      <div>
        <PromptDescriptions />
      </div>
    </div>
  );
};

export default PromptsTab;

\`\`\`

# src\components\dashboard\ResultsTab.tsx

\`\`\`tsx

import ResultsViewer from '@/components/ResultsViewer';
import { ProcessingResult } from '@/lib/types';

interface ResultsTabProps {
  results: ProcessingResult[];
  onDownloadResults: () => void;
  isProcessing: boolean;
  processingProgress: number;
  processingStep: string;
}

const ResultsTab = ({ 
  results, 
  onDownloadResults, 
  isProcessing, 
  processingProgress, 
  processingStep 
}: ResultsTabProps) => {
  // Calculate total files and processed files from the results
  const uniqueFileIds = new Set(results.map(r => r.fileId));
  const totalFiles = isProcessing ? Math.max(1, uniqueFileIds.size) : uniqueFileIds.size;
  const processedFiles = isProcessing && processingProgress >= 100 ? totalFiles : uniqueFileIds.size;
  
  return (
    <ResultsViewer 
      results={results}
      onDownloadResults={onDownloadResults}
      isProcessing={isProcessing}
      processingProgress={processingProgress}
      processingStep={processingStep}
      totalFiles={totalFiles}
      processedFiles={processedFiles}
    />
  );
};

export default ResultsTab;

\`\`\`

# src\components\dashboard\SideBySideTab.tsx

\`\`\`tsx

import { useState, useEffect } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Button } from '@/components/ui/button';
import { RefreshCw } from 'lucide-react';
import { ProcessingResult } from '@/lib/types';
import PDFViewer from '@/components/PDFViewer';

interface SideBySideTabProps {
  results: ProcessingResult[];
}

const SideBySideTab = ({ results }: SideBySideTabProps) => {
  const [selectedFile, setSelectedFile] = useState<File | null>(null);
  const [selectedResult, setSelectedResult] = useState<ProcessingResult | null>(
    results.length > 0 ? results[0] : null
  );
  const [retryCounter, setRetryCounter] = useState(0);
  const [pdfFiles, setPdfFiles] = useState<Map<string, File>>(new Map());

  // Group results by file
  const resultsByFile: Record<string, ProcessingResult[]> = results.reduce((acc, result) => {
    if (!result) return acc;
    if (!acc[result.fileId]) {
      acc[result.fileId] = [];
    }
    acc[result.fileId].push(result);
    return acc;
  }, {} as Record<string, ProcessingResult[]>);

  // Get unique file names
  const uniqueFiles = Object.entries(resultsByFile).map(([_, fileResults]) => {
    return fileResults[0];
  });

  // Create an improved dummy PDF file with better formatting - same as in UploadTab
  const createDummyPDF = (fileName: string): File => {
    // This is a higher quality PDF with better formatting
    const base64PDF = `JVBERi0xLjcKJeTjz9IKMSAwIG9iago8PC9UeXBlL0NhdGFsb2cvUGFnZXMgMiAwIFIvTGFuZyhqYS1KUCkgL1N0cnVjdFRyZWVSb290IDIxIDAgUi9NYXJrSW5mbzw8L01hcmtlZCB0cnVlPj4vTWV0YWRhdGEgNTggMCBSL1ZpZXdlclByZWZlcmVuY2VzIDU5IDAgUj4+CmVuZG9iagoyIDAgb2JqCjw8L1R5cGUvUGFnZXMvQ291bnQgMS9LaWRzWyAzIDAgUl0gPj4KZW5kb2JqCjMgMCBvYmoKPDwvVHlwZS9QYWdlL1BhcmVudCAyIDAgUi9SZXNvdXJjZXM8PC9YT2JqZWN0PDwvSW1hZ2U1IDUgMCBSL0ltYWdlNyA3IDAgUj4+L0ZvbnQ8PC9GMSAxMSAwIFIvRjIgMTMgMCBSL0YzIDE1IDAgUi9GNCAxNyAwIFI+Pi9FeHRHU3RhdGU8PC9HUzcgNyAwIFIvR1M4IDggMCBSPj4vUHJvY1NldFsvUERGL1RleHQvSW1hZ2VCL0ltYWdlQy9JbWFnZUldID4+L01lZGlhQm94WyAwIDAgNTk1LjMyIDg0MS45Ml0gL0NvbnRlbnRzIDQgMCBSL0dyb3VwPDwvVHlwZS9Hcm91cC9TL1RyYW5zcGFyZW5jeS9DUy9EZXZpY2VSR0I+Pi9UYWJzL1MvU3RydWN0UGFyZW50cyAwPj4KZW5kb2JqCjQgMCBvYmoKPDwvRmlsdGVyL0ZsYXRlRGVjb2RlL0xlbmd0aCAxOTA4Pj4Kc3RyZWFtCnictVnbkps4EH3nK3Q5uwo1urHB43gnpHBiy4iL12vv5mErD4MsMBXGBXgr+4d8XDeSuRgwdpKtmiqEkOg+3af7yHy7It9olr6TM87oNb2JxYGqM8qTrCCxgD8CBS3oi0xyEYn0nIooAynMaM5SciW/ZCknb7Oz8w8kE2QinkYHcq2iI8lj8g0awW+p/HuWvvAYBp6wPDqQmNIF/Emf4BFRamDNBHklMTzNNQIqwC4JjI9T+FeSh39MegVj9CjN0E6jBQWnISVqwXOaJCALfodFnBZCo89FivXlErBTYAa841mSJ+mJ8MmzDDC+1QxuJ+pEefBHzJKMJwcS8cN+RtVs8+NPwBa7wOxpt3i8eXn4gfrju8Ct3h1CLx1G7+7QuH+Anj4Oj90XgfmrOOye/WwO+1npeI7ukDsFrrjcHUbyGU0IvkZTp8pfa33pwsb7UuC1gYs8QdNq5jYZxNYzX+/oDXrTTOA+WCzCnJEUJrhA7q0wC3JE4ZPNH3W1mROL04h1Qhim4OKmdhPbAcrTIiVvdZ2z9DC6dAA+UFw4bjA2/P54g+1+PB6NvEvn2Ld6u+pBE9ufjI39wUg/D3F6aoLBHLScFLLJksm+xM/JXCNYM4YeBicJvc8rC7PSK5G6Tjv4i8Wt4wcj63q1ut6qhlggOcgcUYk20WXJHC7Vdu4wSnOEeQrmJpnDxKBkOgLS5kS2KQdTqUHmsHxhnB+GlaEggPm4bDq/rUlUvUjrx4i2DXDjo1hMBHxkDMsODMexmsHZeqXN9+VqKDEpPJhKkDs18A6kTGPycPv00ADXRkNEvF8xRdspeH8QLGfr3wE5KQCh7y/xziq8IATdLe3z1ZPvu9Po0L7ls/lyTA8s1zwx6/aipdyGvrI4SDx7E9cNeGdf3b2et7BfIxgBybl5YQzMoNsqSZS1h9HbCI1zdw6HpcT9hdiBBEcHkiFgY5YXSkAVGjuvamNUrSYyeUp1Gp7oicxolhfyuTsloXNpDRzuTLnjDifqveWQivUky2PkpeB7hFRdRV6wVbyrzLMCHqxUUW/HGQj7VEwIMEOZoVUbVZnWxp4Ge1mCstY3VHkOkUW4dPZVtSvdX51rXq4tUPhM+cyjdAlOM9g0E66NuugYnUCMr9311TxRn51l90OwvcFq4KKw1pQ42gAsntdgwrqmJ/Brl2P82jZQYzOUFO5LqPYvzc/bhpy+N3ubZnfVAJ+pDaKZIL/lQzdTDstKjB6gXjcr9bY9Dru6QF3Ac415RwleFebeUxGlPB5fd9/9gl3oQonA7eUXarKL9KhHka22R4CleLvNYlSY7UgVW3LQmKcd90zcqJPJCcCdiX/62fXPrcdJLJssALwbnztejx93ndtvHcpGx7ocwX8aSO00vRdTTBZeQni3WjjEIb58LMeQO4e/aBMFLTHvizWssNRIkltzmJJCH0nP7ci+co6Pmvr8M/awR8FFekLNDNcymoI7JlvzZquAKc9MsJQHx2+6m8t7oG0zG6S6uCW3cTAdOUfmznGcN6ZM0tyhr7RT4BqKFeBhcMXHwRptklv0KiDZLewprKkKtjTGpuq+d8ctsrGXbnVTB59DE8vjXIXlnJNsKqTqdfqL85PVLBHZU4DUfHWUt1sW5wnXHS2HlQ3GZghWyMvKZYLEf+XimTTHD0te3mdpeML10Xf6TrC3XRu6pksPUrQX1cUQN1hAQGF2aL8feZNFhbq2JIA06UM2wUuTBPjuDAIpPRAVVIQHKJ6Juo5E54bc70m2kUWNSYk8I3cSoNt90tKkmwkLiRLIpGq41cQE9+QrPQzp21JAcDdAA1J8jFWqKOlnQSsj225Yu4R/2EOWWtheOD6IQn8wCdptq5bU90v8l/zAiThahUZBNYzgdGZG3CKqTDehjCfYbIGluBVteMXWN2z/ut6wrSINS+4X6PcYwXVPrZ/IXEU452MocU826M76xG7j6W0B5qAjUYxc/DVJdXOXt6JKbAA2C1+r3ELS+J6T6rRfILmcZCphP+Z9hd8/0QPecIxS/CIRfJ7X97hoRc82nLdXLo1wHtdx998hmVxJynrA01ulvqjjjCUJeEXepU6NJXrW18vtdcbYI80CeXcogFNWJctyyDFxKHcWO76Zawsfpzjrx0ffQTWGusezbCs3v/49v87ZF8X+2O23cr7cyi2fLdBjrm6/K9A/vTLv1bHfdcDhqy+FhdLD8YQN5O+1fwEqNfLlCmVuZHN0cmVhbQplbmRvYmoKMjEgMCBvYmoKPDwvVHlwZS9TdHJ1Y3RUcmVlUm9vdC9QYXJlbnRUcmVlID0gNiAwIFIgL0sgPSA1MCAwIFIvSURUcmVlID0gNTEgMCBSID4+CmVuZG9iagoyMiAwIG9iago8PC9UeXBlL0ZvbnQvU3VidHlwZS9UcnVlVHlwZS9OYW1lL0YxL0Jhc2VGb250L0JDREVFRStDYWxpYnJpL0VuY29kaW5nL1dpbkFuc2lFbmNvZGluZy9Gb250RGVzY3JpcHRvciAyMyAwIFIvRmlyc3RDaGFyIDMyL0xhc3RDaGFyIDg0L1dpZHRocyA1MyAwIFI+PgplbmRvYmoKMjMgMCBvYmoKPDwvVHlwZS9Gb250RGVzY3JpcHRvci9Gb250TmFtZS9CQ0RFRUUrQ2FsaWJyaS9GbGFncyAzMi9JdGFsaWNBbmdsZSAwL0FzY2VudCA3NTAvRGVzY2VudCAtMjUwL0NhcEhlaWdodCA3NTAvQXZnV2lkdGggNTIxL01heFdpZHRoIDE3NDMvRm9udFdlaWdodCA0MDAvWEhlaWdodCAyNTAvU3RlbVYgNTIvRm9udEJCb3hbIC01MDMgLTI1MCAxMjQwIDc1MF0gL0ZvbnRGaWxlMiA1MiAwIFI+PgplbmRvYmoKNTMgMCBvYmoKWyAyMjYgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDY0MyAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCA3MTUgMCA2NjIgMCAwIDAgNTQ0XSAKZW5kb2JqCjUwIDAgb2JqCjw8L1R5cGUvU3RydWN0RWxlbS9TL1Jvb3QvUC11dGlsKFRpdGxlKS9LWzQ5IDAgUl0gL1BnIDMgMCBSID4+CmVuZG9iago0OSAwIG9iago8PC9UeXBlL1N0cnVjdEVsZW0vUy9UaXRsZS9QLXV0aWwoSGVhZGluZzEpL0tbNDggMCBSXSAvUGcgMyAwIFIgPj4KZW5kb2JqCjQ4IDAgb2JqCjw8L1R5cGUvU3RydWN0RWxlbS9TL0hlYWRpbmcxL1AvNTAgMCBSL0tbMF0gL1BnIDMgMCBSID4+CmVuZG9iago1MSAwIG9iago8PC9OYW1lcygibG9hbiIpID4+CmVuZG9iago2IDAgb2JqCjw8L051bXMgWzAgWyA0OCAwIFJdIF0gPj4KZW5kb2JqCnhyZWYKMSA0CjAwMDAwMDAwMTAgNjU1MzUgZiAKMDAwMDAwMDAxNSAwMDAwMCBuIAowMDAwMDAwMTgxIDAwMDAwIG4gCjAwMDAwMDAyMzggMDAwMDAgbiAKMTEgMgowMDAwMDAwMDAwIDAwMDAwIGYgCjAwMDAwMDAwMDAgMDAwMDAgZiAKMjEgNAowMDAwMDAyMzMwIDAwMDAwIG4gCjAwMDAwMDI0MTggMDAwMDAgbiAKMDAwMDAwMjU5NSAwMDAwMCBuIAowMDAwMDAyODU4IDAwMDAwIG4gCjQ4IDMKMDAwMDAwMzA3NyAwMDAwMCBuIAowMDAwMDAzMDAwIDAwMDAwIG4gCjAwMDAwMDI5MzUgMDAwMDAgbiAKNTAgMQowMDAwMDAyODY1IDAwMDAwIG4gCjUyIDIKMDAwMDAwMDAwMCAwMDAwMCBmIAowMDAwMDAwMDAwIDAwMDAwIGYgCnRyYWlsZXIKPDwvU2l6ZSA1NS9Sb290IDEgMCBSL0luZm8gMjAgMCBSL0lEWzwyRTA1NzM5MkZDM0JCMTQxQjNDNDkzODNBODY4NDg5OD48MkUwNTczOTJGQzNCQjE0MUIzQzQ5MzgzQTg2ODQ4OTg+XSA+PgpzdGFydHhyZWYKMzE0NQolJUVPRgo=`;
    
    try {
      // Convert base64 to blob
      const binaryString = window.atob(base64PDF);
      const len = binaryString.length;
      const bytes = new Uint8Array(len);
      for (let i = 0; i < len; i++) {
        bytes[i] = binaryString.charCodeAt(i);
      }
      
      // Create a blob from the binary data
      const pdfBlob = new Blob([bytes.buffer], { type: 'application/pdf' });
      
      // Create a File object from the blob
      const file = new File([pdfBlob], fileName, { type: 'application/pdf' });
      
      // Store the file in our map
      const updatedFiles = new Map(pdfFiles);
      updatedFiles.set(fileName, file);
      setPdfFiles(updatedFiles);
      
      console.log("Created higher-quality PDF file:", file.name, file.size, "bytes");
      return file;
    } catch (error) {
      console.error("Error creating PDF file:", error);
      // Create a minimal fallback PDF
      const minimalPDF = 'JVBERi0xLjAKMSAwIG9iago8PC9UeXBlL0NhdGFsb2cvUGFnZXMgMiAwIFI+PgplbmRvYmoKMiAwIG9iago8PC9UeXBlL1BhZ2VzL0tpZHNbMyAwIFJdL0NvdW50IDE+PgplbmRvYmoKMyAwIG9iago8PC9UeXBlL1BhZ2UvTWVkaWFCb3hbMCAwIDMgM10+PgplbmRvYmoKdHJhaWxlcgo8PC9Sb290IDEgMCBSPj4K';
      const fallbackBytes = Uint8Array.from(window.atob(minimalPDF), c => c.charCodeAt(0));
      const fallbackBlob = new Blob([fallbackBytes], { type: 'application/pdf' });
      return new File([fallbackBlob], fileName, { type: 'application/pdf' });
    }
  };

  // Initialize PDFs when component mounts
  useEffect(() => {
    if (results.length === 0) {
      setSelectedFile(null);
      setSelectedResult(null);
      return;
    }

    // Initialize PDFs for all files
    const newPdfFiles = new Map();
    
    uniqueFiles.forEach(fileInfo => {
      const pdfFile = createDummyPDF(fileInfo.fileName);
      newPdfFiles.set(fileInfo.fileName, pdfFile);
    });
    
    setPdfFiles(newPdfFiles);
    
    // Set defaults if needed
    if (!selectedResult && results.length > 0) {
      setSelectedResult(results[0]);
    }
    
    // Load the first file by default
    if (uniqueFiles.length > 0) {
      const firstFile = uniqueFiles[0];
      const pdfFile = newPdfFiles.get(firstFile.fileName);
      if (pdfFile) {
        setSelectedFile(pdfFile);
      }
    }
  }, [results, retryCounter]);

  // Handle file selection
  const handleFileSelect = (fileId: string, fileName: string) => {
    console.log("File selected:", fileName);
    
    // Use the already created PDF from our map
    const existingPDF = pdfFiles.get(fileName);
    if (existingPDF) {
      setSelectedFile(existingPDF);
    } else {
      // Create one if it doesn't exist yet
      const newPDF = createDummyPDF(fileName);
      setSelectedFile(newPDF);
    }
    
    // Set the first result from this file as the selected result
    const fileResults = resultsByFile[fileId];
    if (fileResults && fileResults.length > 0) {
      setSelectedResult(fileResults[0]);
    }
  };

  // Handle result selection
  const handleResultSelect = (result: ProcessingResult) => {
    setSelectedResult(result);
    
    // Make sure we have a PDF file for this result
    if (result.fileName) {
      const existingPDF = pdfFiles.get(result.fileName);
      if (existingPDF) {
        setSelectedFile(existingPDF);
      } else {
        const newPDF = createDummyPDF(result.fileName);
        setSelectedFile(newPDF);
      }
    }
  };

  // Handle retry loading
  const handleRetryLoading = () => {
    console.log("Retrying PDF load...");
    setRetryCounter(prev => prev + 1);
    
    // Re-create all PDFs
    if (uniqueFiles.length > 0) {
      const newPdfFiles = new Map();
      
      uniqueFiles.forEach(fileInfo => {
        const pdfFile = createDummyPDF(fileInfo.fileName);
        newPdfFiles.set(fileInfo.fileName, pdfFile);
      });
      
      setPdfFiles(newPdfFiles);
      
      // Refresh the current selection
      if (selectedResult?.fileName) {
        const refreshedPDF = newPdfFiles.get(selectedResult.fileName);
        if (refreshedPDF) {
          setSelectedFile(refreshedPDF);
        }
      }
    }
  };

  // Display a loading message if no results are available
  if (results.length === 0) {
    return (
      <div className="space-y-6">
        <div>
          <h2 className="text-lg font-semibold mb-1">Side by Side Comparison</h2>
          <p className="text-sm text-muted-foreground">Compare extracted data with the original document</p>
        </div>
        
        <Card>
          <CardContent className="flex flex-col items-center justify-center p-12 text-center">
            <div className="text-muted-foreground mb-2">
              No extraction results yet
            </div>
            <div className="text-sm text-muted-foreground">
              Process files to see side by side comparison
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-lg font-semibold mb-1">Side by Side Comparison</h2>
        <p className="text-sm text-muted-foreground">Compare extracted data with the original document</p>
      </div>
      
      <div className="grid grid-cols-1 lg:grid-cols-7 gap-6">
        {/* Left sidebar - File and Result selection */}
        <div className="lg:col-span-2">
          <div className="border rounded-lg overflow-hidden">
            <div className="bg-black text-white p-2 text-sm font-medium">
              Processed Files
            </div>
            <ScrollArea className="h-[600px]">
              <div className="p-2">
                {uniqueFiles.map((fileInfo) => (
                  <div key={fileInfo.fileId} className="mb-4">
                    <div 
                      className="text-sm font-medium p-2 bg-muted cursor-pointer hover:bg-gray-200"
                      onClick={() => handleFileSelect(fileInfo.fileId, fileInfo.fileName)}
                    >
                      {fileInfo.fileName}
                    </div>
                    
                    {resultsByFile[fileInfo.fileId].map(result => {
                      const isSelected = selectedResult?.id === result.id;
                      
                      return (
                        <div 
                          key={result.id}
                          className={`flex items-center justify-between p-2 text-sm rounded-md cursor-pointer ${
                            isSelected ? "bg-yellow-50 border border-yellow-400 text-black" : "hover:bg-muted"
                          }`}
                          onClick={() => handleResultSelect(result)}
                        >
                          <div className="truncate pr-2">{result.promptName}</div>
                        </div>
                      );
                    })}
                  </div>
                ))}
              </div>
            </ScrollArea>
          </div>
        </div>
        
        {/* Center - PDF Viewer */}
        <div className="lg:col-span-2">
          <div className="border rounded-lg overflow-hidden h-full flex flex-col">
            <div className="bg-black text-white p-2 text-sm font-medium">
              Document Preview
            </div>
            <div className="flex-1 flex flex-col bg-white">
              <PDFViewer 
                file={selectedFile}
                className="flex-1"
              />
              
              {/* Retry button */}
              <div className="flex justify-center p-2 bg-white border-t">
                <Button 
                  variant="outline" 
                  size="sm" 
                  className="flex items-center gap-2"
                  onClick={handleRetryLoading}
                >
                  <RefreshCw className="h-4 w-4" />
                  Refresh PDF
                </Button>
              </div>
            </div>
          </div>
        </div>
        
        {/* Right - Extracted Data */}
        <div className="lg:col-span-3">
          <div className="border rounded-lg overflow-hidden h-full flex flex-col">
            <div className="bg-black text-white p-3 flex justify-between items-center">
              <div>
                <div className="font-medium">{selectedResult?.promptName}</div>
                <div className="text-xs text-gray-400">From: {selectedResult?.fileName}</div>
              </div>
            </div>
            
            <div className="p-3 flex-1">
              {selectedResult && selectedResult.status === 'success' && selectedResult.data ? (
                <ScrollArea className="h-[550px]">
                  <Table>
                    <TableHeader className="bg-muted sticky top-0">
                      <TableRow>
                        <TableHead className="font-semibold">Category</TableHead>
                        <TableHead className="font-semibold">Stage</TableHead>
                        <TableHead className="font-semibold">Field</TableHead>
                        <TableHead className="font-semibold">Value</TableHead>
                      </TableRow>
                    </TableHeader>
                    <TableBody>
                      {selectedResult.data.map((item, index) => {
                        if (!item) return null;
                        
                        return (
                          <TableRow key={index}>
                            <TableCell>
                              {item.Category === 'ECL By Stage' ? 'ECL' : item.Category}
                            </TableCell>
                            <TableCell>{item.Stage}</TableCell>
                            <TableCell>{item.Field}</TableCell>
                            <TableCell className="font-medium">{item.Value}</TableCell>
                          </TableRow>
                        );
                      })}
                    </TableBody>
                  </Table>
                </ScrollArea>
              ) : (
                <div className="flex flex-col items-center justify-center h-[550px]">
                  <div className="text-muted-foreground">
                    Select a result to view extracted data
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default SideBySideTab;

\`\`\`

# src\components\dashboard\TabNavigation.tsx

\`\`\`tsx

import { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Upload, FileText, FileSpreadsheet, Download, LayoutPanelLeft } from 'lucide-react';
import { ThemeToggle } from '@/components/ThemeToggle';

interface TabNavigationProps {
  activeTab: string;
  setActiveTab: (value: string) => void;
}

const TabNavigation = ({ activeTab, setActiveTab }: TabNavigationProps) => {
  return (
    <div className="border-b dark:border-gray-700">
      <div className="container mx-auto px-4 flex items-center justify-between">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
          <TabsList className="grid grid-cols-5 w-full max-w-2xl mx-auto my-4">
            <TabsTrigger 
              value="upload" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <Upload className="h-4 w-4 mr-2" />
              Upload
            </TabsTrigger>
            <TabsTrigger 
              value="prompts" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <FileText className="h-4 w-4 mr-2" />
              Prompts
            </TabsTrigger>
            <TabsTrigger 
              value="results" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <FileSpreadsheet className="h-4 w-4 mr-2" />
              Results
            </TabsTrigger>
            <TabsTrigger 
              value="combined" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <Download className="h-4 w-4 mr-2" />
              Combined
            </TabsTrigger>
            <TabsTrigger 
              value="sidebyside" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <LayoutPanelLeft className="h-4 w-4 mr-2" />
              Side by Side
            </TabsTrigger>
          </TabsList>
        </Tabs>
        <ThemeToggle className="mr-4" />
      </div>
    </div>
  );
};

export default TabNavigation;

\`\`\`

# src\components\dashboard\UploadTab.tsx

\`\`\`tsx

import { Button } from '@/components/ui/button';
import FileUploader from '@/components/FileUploader';
import { UploadedFile } from '@/lib/types';
import { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { FileText, Eye, EyeOff } from 'lucide-react';
import PDFViewer from '@/components/PDFViewer';
import { motion } from 'framer-motion';

interface UploadTabProps {
  onFilesUploaded: (files: UploadedFile[]) => void;
  uploadedFiles: UploadedFile[];
  goToNextTab: () => void;
}

const UploadTab = ({ onFilesUploaded, uploadedFiles, goToNextTab }: UploadTabProps) => {
  const [selectedFile, setSelectedFile] = useState<UploadedFile | null>(null);
  const [showPreview, setShowPreview] = useState<boolean>(true);
  const [pdfFile, setPdfFile] = useState<File | null>(null);
  const [actualFiles, setActualFiles] = useState<Map<string, File>>(new Map());

  // Select the first file for preview when files are uploaded
  useEffect(() => {
    if (uploadedFiles.length > 0) {
      // Always select the newest file when a new file is uploaded
      const newestFile = uploadedFiles[uploadedFiles.length - 1];
      setSelectedFile(newestFile);
      const file = actualFiles.get(newestFile.id);
      if (file) {
        setPdfFile(file);
      }
    } else {
      setSelectedFile(null);
      setPdfFile(null);
    }
  }, [uploadedFiles, actualFiles]);

  // Handle files uploaded
  const handleFilesUploaded = (files: UploadedFile[], newActualFiles: Map<string, File>) => {
    // Pass files to parent
    onFilesUploaded(files);
    
    // Store actual File objects
    setActualFiles(newActualFiles);
    
    // If we have files, select the latest one for immediate preview
    if (files.length > 0) {
      const latestFile = files[files.length - 1];
      setSelectedFile(latestFile);
      
      // Set the PDF file for immediate preview
      const fileForPreview = newActualFiles.get(latestFile.id);
      if (fileForPreview) {
        setPdfFile(fileForPreview);
        setShowPreview(true); // Ensure preview is visible
      }
    }
  };

  // Toggle PDF preview visibility
  const togglePreview = () => {
    setShowPreview(!showPreview);
  };

  // Handle file selection
  const handleFileSelection = (file: UploadedFile) => {
    setSelectedFile(file);
    const actualFile = actualFiles.get(file.id);
    if (actualFile) {
      setPdfFile(actualFile);
    }
  };

  return (
    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div className="lg:col-span-1 space-y-6">
        <FileUploader 
          onFilesUploaded={handleFilesUploaded}
          acceptedFileTypes={['.pdf']}
        />
        
        {uploadedFiles.length > 0 && (
          <motion.div 
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ duration: 0.3 }}
            className="border rounded-md"
          >
            <div className="bg-muted p-3 font-medium flex justify-between items-center">
              <div>Uploaded Files ({uploadedFiles.length}/10)</div>
              <Button 
                variant="ghost" 
                size="sm" 
                className="h-8 px-2 text-muted-foreground"
                onClick={togglePreview}
              >
                {showPreview ? <EyeOff className="h-4 w-4 mr-1" /> : <Eye className="h-4 w-4 mr-1" />}
                {showPreview ? "Hide Preview" : "Show Preview"}
              </Button>
            </div>
            <div className="divide-y max-h-[300px] overflow-y-auto">
              {uploadedFiles.map((file) => (
                <motion.div
                  key={file.id}
                  className={`p-3 flex items-center justify-between cursor-pointer hover:bg-muted/50 transition-colors ${selectedFile?.id === file.id ? 'bg-yellow-50 border-l-2 border-yellow-400' : ''}`}
                  onClick={() => handleFileSelection(file)}
                >
                  <div className="flex items-center">
                    <FileText className="h-4 w-4 text-muted-foreground mr-2" />
                    <span className="text-sm font-medium">{file.name}</span>
                  </div>
                  <div className="text-xs text-muted-foreground">
                    {Math.round(file.size / 1024).toLocaleString()} KB
                  </div>
                </motion.div>
              ))}
            </div>
          </motion.div>
        )}
      </div>

      {/* PDF Preview Section - larger size for A4 display */}
      {uploadedFiles.length > 0 && selectedFile && showPreview && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ duration: 0.3 }}
          className="lg:col-span-2"
        >
          <Card className="h-full">
            <CardHeader className="pb-3">
              <CardTitle className="text-base flex items-center justify-between">
                <div className="flex items-center">
                  <FileText className="h-4 w-4 mr-2" />
                  PDF Preview
                </div>
                <div className="text-sm font-normal">
                  {selectedFile.name}
                </div>
              </CardTitle>
            </CardHeader>
            <CardContent className="p-0">
              <div className="bg-muted/30 h-[750px] flex flex-col">
                <PDFViewer file={pdfFile} className="h-full" />
              </div>
            </CardContent>
          </Card>
        </motion.div>
      )}

      <div className="flex justify-end col-span-full">
        <motion.div>
          <Button 
            onClick={goToNextTab} 
            disabled={uploadedFiles.length === 0}
            className="bg-yellow-400 hover:bg-yellow-500 text-black"
          >
            Next: Select Prompts
          </Button>
        </motion.div>
      </div>
    </div>
  );
};

export default UploadTab;

\`\`\`

# src\components\FileUploader.tsx

\`\`\`tsx

import { useState, useRef, useCallback } from 'react';
import { Button } from '@/components/ui/button';
import { UploadedFile } from '@/lib/types';
import { Upload, FileText, X, Check, Loader } from 'lucide-react';
import { Progress } from '@/components/ui/progress';
import { cn } from '@/lib/utils';
import { useToast } from '@/hooks/use-toast';

interface FileUploaderProps {
  onFilesUploaded: (files: UploadedFile[], actualFiles: Map<string, File>) => void;
  acceptedFileTypes?: string[];
  maxFiles?: number;
}

const FileUploader = ({ 
  onFilesUploaded, 
  acceptedFileTypes = ['.pdf'], 
  maxFiles = 10 
}: FileUploaderProps) => {
  const [files, setFiles] = useState<UploadedFile[]>([]);
  const [isDragging, setIsDragging] = useState(false);
  const fileInputRef = useRef<HTMLInputElement>(null);
  const [actualFiles, setActualFiles] = useState<Map<string, File>>(new Map());
  const { toast } = useToast();

  const handleFileSelect = useCallback((selectedFiles: FileList | null) => {
    if (!selectedFiles || selectedFiles.length === 0) return;

    // Check if adding these files would exceed the maximum
    if (files.length + selectedFiles.length > maxFiles) {
      toast({
        title: "Too many files",
        description: `You can upload a maximum of ${maxFiles} files.`,
        variant: "destructive",
      });
      return;
    }

    const newFiles: UploadedFile[] = [];
    const newActualFiles = new Map(actualFiles);
    
    Array.from(selectedFiles).forEach(file => {
      // Check file type
      const fileExtension = `.${file.name.split('.').pop()?.toLowerCase()}`;
      if (!acceptedFileTypes.includes(fileExtension) && !acceptedFileTypes.includes('*')) {
        toast({
          title: "Invalid file type",
          description: `${file.name} is not a supported file type. Please upload ${acceptedFileTypes.join(", ")} files.`,
          variant: "destructive",
        });
        return;
      }
      
      // File is valid, add it to our list
      const fileId = `file-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
      const newFile: UploadedFile = {
        id: fileId,
        name: file.name,
        size: file.size,
        type: file.type,
        lastModified: file.lastModified,
        status: 'success' as const,  // Mark as success immediately for simplicity
        progress: 100,  // Set to 100% immediately
      };
      
      // Store the actual File object in our Map
      newActualFiles.set(fileId, file);
      newFiles.push(newFile);
    });
    
    if (newFiles.length > 0) {
      // Update state in a single batch
      const updatedFiles = [...files, ...newFiles];
      setFiles(updatedFiles);
      setActualFiles(newActualFiles);
      
      // Notify parent component after our state is updated
      setTimeout(() => {
        onFilesUploaded(updatedFiles, newActualFiles);
      }, 0);
    }
  }, [files, actualFiles, maxFiles, acceptedFileTypes, onFilesUploaded, toast]);

  const removeFile = useCallback((id: string) => {
    const updatedFiles = files.filter(file => file.id !== id);
    setFiles(updatedFiles);
    
    // Also remove the actual File object
    const newActualFiles = new Map(actualFiles);
    newActualFiles.delete(id);
    setActualFiles(newActualFiles);
    
    onFilesUploaded(updatedFiles, newActualFiles);
  }, [files, actualFiles, onFilesUploaded]);

  const formatFileSize = (sizeInBytes: number) => {
    if (sizeInBytes < 1024) return `${sizeInBytes} B`;
    else if (sizeInBytes < 1048576) return `${(sizeInBytes / 1024).toFixed(1)} KB`;
    else return `${(sizeInBytes / 1048576).toFixed(1)} MB`;
  };

  const handleDragOver = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(true);
  };

  const handleDragLeave = () => {
    setIsDragging(false);
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(false);
    handleFileSelect(e.dataTransfer.files);
  };

  return (
    <div className="w-full space-y-4">
      {/* File upload area */}
      <div
        className={cn(
          "border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors",
          isDragging ? "border-yellow-400 bg-yellow-50" : "border-muted-foreground/20",
          files.length >= maxFiles && "opacity-50 cursor-not-allowed"
        )}
        onDragOver={handleDragOver}
        onDragLeave={handleDragLeave}
        onDrop={handleDrop}
        onClick={() => files.length < maxFiles && fileInputRef.current?.click()}
      >
        <input
          type="file"
          ref={fileInputRef}
          className="hidden"
          accept={acceptedFileTypes.join(',')}
          multiple
          onChange={(e) => handleFileSelect(e.target.files)}
          disabled={files.length >= maxFiles}
        />
        <div className="flex flex-col items-center justify-center gap-2">
          <Upload className="h-12 w-12 text-muted-foreground" />
          <h3 className="text-lg font-medium">Upload PDF Financial Reports</h3>
          <p className="text-sm text-muted-foreground max-w-md mx-auto">
            Drag and drop files here, or click to browse. We accept PDF files with financial data.
          </p>
          <Button 
            variant="outline"
            className="mt-2"
            disabled={files.length >= maxFiles}
          >
            Select Files
          </Button>
        </div>
      </div>

      {/* File list */}
      {files.length > 0 && (
        <div className="mt-6">
          <h3 className="font-medium mb-2 text-sm">Uploaded Files ({files.length}/{maxFiles})</h3>
          <div className="space-y-2">
            {files.map(file => (
              <div 
                key={file.id} 
                className="flex items-center p-3 bg-muted/30 rounded-md border"
              >
                <FileText className="h-5 w-5 text-muted-foreground mr-3" />
                <div className="flex-1 min-w-0">
                  <div className="flex justify-between">
                    <p className="text-sm font-medium truncate">{file.name}</p>
                    <span className="text-xs text-muted-foreground">{formatFileSize(file.size)}</span>
                  </div>
                  {file.status === 'pending' && (
                    <Progress value={file.progress} className="h-1 mt-1" />
                  )}
                </div>
                <div className="ml-4 flex items-center">
                  {file.status === 'pending' && <Loader className="h-4 w-4 text-muted-foreground animate-spin" />}
                  {file.status === 'success' && <Check className="h-4 w-4 text-green-500" />}
                  {file.status === 'error' && <X className="h-4 w-4 text-destructive" />}
                  <button 
                    onClick={(e) => {
                      e.stopPropagation();
                      removeFile(file.id);
                    }}
                    className="ml-2 text-muted-foreground hover:text-destructive transition-colors"
                  >
                    <X className="h-4 w-4" />
                  </button>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
};

export default FileUploader;

\`\`\`

# src\components\IntroScreen.tsx

\`\`\`tsx
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { useNavigate } from 'react-router-dom';
import { Progress } from '@/components/ui/progress';
import { motion } from 'framer-motion';

const IntroScreen = () => {
  const navigate = useNavigate();
  const [loading, setLoading] = useState(true);
  const [loadingProgress, setLoadingProgress] = useState(0);
  
  useEffect(() => {
    // Simulate progressive loading
    const totalTime = 2000; // 2 seconds
    const intervalTime = 50; // update every 50ms
    const steps = totalTime / intervalTime;
    let currentStep = 0;
    
    const timer = setInterval(() => {
      currentStep += 1;
      const newProgress = Math.min(100, Math.floor((currentStep / steps) * 100));
      setLoadingProgress(newProgress);
      
      if (newProgress >= 100) {
        clearInterval(timer);
        setTimeout(() => setLoading(false), 200);
      }
    }, intervalTime);
    
    return () => clearInterval(timer);
  }, []);

  const handleEnterApp = () => {
    navigate('/select-bank');
  };

  // Animation variants for the logo and letters
  const containerVariants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: {
        delayChildren: 0.3,
        staggerChildren: 0.1
      }
    }
  };

  const letterVariants = {
    hidden: { y: 20, opacity: 0 },
    visible: {
      y: 0,
      opacity: 1,
      transition: {
        type: "spring",
        damping: 12,
        stiffness: 100
      }
    }
  };

  const floatVariants = {
    animate: {
      y: [0, -10, 0],
      transition: {
        duration: 2,
        repeat: Infinity,
        repeatType: "reverse" as const,
        ease: "easeInOut"
      }
    }
  };

  const logoVariants = {
    hidden: { scale: 0.8, opacity: 0 },
    visible: {
      scale: 1,
      opacity: 1,
      transition: {
        type: "spring",
        damping: 12,
        stiffness: 100
      }
    }
  };

  // Combined animation for the logo that includes floating effect
  const logoAnimation = {
    scale: 1,
    opacity: 1,
    y: [0, -8, 0]
  };
  
  // Combined transition for the logo
  const logoTransition = {
    scale: {
      type: "spring",
      damping: 12,
      stiffness: 100
    },
    opacity: {
      type: "spring",
      damping: 12,
      stiffness: 100
    },
    y: {
      duration: 3,
      repeat: Infinity,
      repeatType: "reverse",
      ease: "easeInOut"
    }
  };
  
  const buttonVariants = {
    initial: { scale: 1 },
    hover: { 
      scale: 1.05,
      transition: { type: "spring", stiffness: 400, damping: 10 }
    },
    tap: { scale: 0.95 }
  };

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-ey-black text-white">
      <div className="w-full max-w-md px-6 py-12 text-center">
        <motion.div 
          className="mb-8"
          initial="hidden"
          animate="visible"
          variants={containerVariants}
        >
          <motion.div 
            className="flex justify-center mb-6"
          >
            <motion.div 
              className="h-16 w-16 bg-ey-yellow rounded-md"
              variants={logoVariants}
              initial="hidden"
              animate={logoAnimation}
              transition={logoTransition}
              whileHover={{ scale: 1.05 }}
            ></motion.div>
          </motion.div>
          
          <motion.h1 
            className="text-4xl font-bold mb-2 flex justify-center"
            variants={containerVariants}
          >
            {Array.from("AiDEx").map((letter, index) => (
              <motion.span
                key={index}
                className="inline-block"
                variants={letterVariants}
                custom={index}
                whileHover={floatVariants.animate}
              >
                {letter}
              </motion.span>
            ))}
          </motion.h1>
          
          <motion.p 
            className="text-ey-gray-400"
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.8 }}
          >
            AI powered Data Extraction
          </motion.p>
          
          <motion.p 
            className="text-ey-gray-500 text-sm mt-1"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 1 }}
          >
            Supported by EYQ
          </motion.p>
        </motion.div>
        
        {loading ? (
          <motion.div 
            className="space-y-3"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.5 }}
          >
            <Progress 
              value={loadingProgress} 
              className="h-2" 
              indicatorClassName="bg-ey-yellow" 
            />
            <p className="text-sm text-ey-gray-400 animate-pulse">
              Loading application... {loadingProgress}%
            </p>
          </motion.div>
        ) : (
          <motion.div
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2 }}
          >
            <motion.button
              onClick={handleEnterApp}
              className="w-full bg-ey-yellow hover:bg-ey-yellow/90 text-ey-black font-medium py-2 px-4 rounded"
              variants={buttonVariants}
              initial="initial"
              whileHover="hover"
              whileTap="tap"
            >
              Enter Application
            </motion.button>
          </motion.div>
        )}
        
        <motion.div 
          className="mt-12 text-xs text-ey-gray-500"
          initial={{ opacity: 0 }}
          animate={{ opacity: 0.7 }}
          transition={{ delay: 1.2 }}
        >
          <p>© {new Date().getFullYear()} EY | A better working world</p>
        </motion.div>
      </div>
    </div>
  );
};

export default IntroScreen;

\`\`\`

# src\components\PDFViewer.tsx

\`\`\`tsx

import { useState, useEffect, useRef } from 'react';
import * as pdfjs from 'pdfjs-dist';
import { Button } from '@/components/ui/button';
import { ChevronLeft, ChevronRight, Loader, RefreshCw } from 'lucide-react';
import { ScrollArea } from '@/components/ui/scroll-area';

// Fix worker import
import { GlobalWorkerOptions } from 'pdfjs-dist';

// Set worker source directly
GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.min.js`;

interface PDFViewerProps {
  file: File | null;
  className?: string;
}

const PDFViewer = ({ file, className = '' }: PDFViewerProps) => {
  const [pdfDoc, setPdfDoc] = useState<pdfjs.PDFDocumentProxy | null>(null);
  const [pageNum, setPageNum] = useState(1);
  const [totalPages, setTotalPages] = useState(0);
  const [isLoading, setIsLoading] = useState(false);
  const [renderError, setRenderError] = useState<string | null>(null);
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const [retryCount, setRetryCount] = useState(0); // Track retry attempts
  const containerRef = useRef<HTMLDivElement>(null);

  // Load the PDF when the file changes or when retryCount changes
  useEffect(() => {
    if (!file) {
      setPdfDoc(null);
      return;
    }

    let isMounted = true;
    
    // Reset states
    setIsLoading(true);
    setRenderError(null);
    
    console.log("Starting to load PDF file:", file.name);
    
    // Convert file to array buffer
    const fileReader = new FileReader();
    
    fileReader.onload = async (event) => {
      if (!isMounted) return;
      
      try {
        const arrayBuffer = event.target?.result;
        
        if (!arrayBuffer) {
          setRenderError("Failed to read file");
          setIsLoading(false);
          return;
        }
        
        // Load the PDF document
        const typedArray = new Uint8Array(arrayBuffer as ArrayBuffer);
        
        console.log("Creating PDF loading task");
        const loadingTask = pdfjs.getDocument(typedArray);
        
        loadingTask.promise
          .then(pdf => {
            if (!isMounted) return;
            
            console.log("PDF loaded successfully with", pdf.numPages, "pages");
            setPdfDoc(pdf);
            setTotalPages(pdf.numPages);
            setPageNum(1); // Reset to first page when loading new PDF
            setIsLoading(false);
          })
          .catch(error => {
            if (!isMounted) return;
            
            console.error('Error loading PDF:', error);
            setRenderError(`Error loading PDF: ${error.message}`);
            setIsLoading(false);
          });
      } catch (error: any) {
        if (!isMounted) return;
        
        console.error('Error processing PDF:', error);
        setRenderError(`Error processing PDF: ${error.message}`);
        setIsLoading(false);
      }
    };
    
    fileReader.onerror = () => {
      if (!isMounted) return;
      
      setRenderError("Error reading file");
      setIsLoading(false);
    };
    
    // Start reading the file
    fileReader.readAsArrayBuffer(file);
    
    return () => {
      isMounted = false;
      if (pdfDoc) {
        try {
          pdfDoc.destroy().catch(e => console.error("Error destroying PDF:", e));
        } catch (error) {
          console.error("Error destroying previous PDF:", error);
        }
      }
    };
  }, [file, retryCount]);

  // Render the PDF page
  useEffect(() => {
    if (!pdfDoc || !canvasRef.current) return;

    let isMounted = true;
    
    const renderPage = async () => {
      if (!isMounted) return;
      
      try {
        // Get the page
        console.log("Getting page", pageNum);
        const page = await pdfDoc.getPage(pageNum);
        
        if (!isMounted || !canvasRef.current) return;
        
        const canvas = canvasRef.current;
        const context = canvas.getContext('2d');
        
        if (!context) {
          setRenderError("Could not get canvas context");
          return;
        }
        
        // Calculate scale to fit width
        const containerWidth = containerRef.current?.clientWidth || canvas.parentElement?.clientWidth || 800;
        const viewport = page.getViewport({ scale: 1.0 });
        const scale = Math.min(containerWidth / viewport.width, 1.0); // Limit scale to 1.0 for better quality
        const scaledViewport = page.getViewport({ scale });

        // Set canvas dimensions
        canvas.height = scaledViewport.height;
        canvas.width = scaledViewport.width;
        
        // Improve rendering quality
        context.imageSmoothingEnabled = true;
        context.imageSmoothingQuality = 'high';
        
        // Set background color
        context.fillStyle = '#FFFFFF';
        context.fillRect(0, 0, canvas.width, canvas.height);
        
        // Render the page
        console.log("Rendering page", pageNum, "of PDF");
        const renderContext = {
          canvasContext: context,
          viewport: scaledViewport,
          background: 'rgba(255,255,255,1)',
        };
        
        await page.render(renderContext).promise;
        
        // Add subtle page border
        context.strokeStyle = '#e2e8f0';
        context.lineWidth = 1;
        context.strokeRect(0, 0, canvas.width, canvas.height);
      } catch (error: any) {
        if (isMounted) {
          console.error('Error rendering page:', error);
          setRenderError(`Error rendering page: ${error.message}`);
        }
      }
    };

    renderPage();
    
    return () => {
      isMounted = false;
    };
  }, [pdfDoc, pageNum]);

  // Effect to adjust canvas size when window resizes
  useEffect(() => {
    const handleResize = () => {
      // Re-render the current page to adjust for new container width
      if (pdfDoc) {
        // Simply update pageNum state to trigger re-render effect
        setPageNum(prevPage => prevPage);
      }
    };

    window.addEventListener('resize', handleResize);
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, [pdfDoc]);

  const goToPreviousPage = () => {
    if (pageNum <= 1) return;
    setPageNum(pageNum - 1);
  };

  const goToNextPage = () => {
    if (pageNum >= totalPages) return;
    setPageNum(pageNum + 1);
  };

  // Create a simple PDF retry button
  const handleRetry = () => {
    if (!file) return;
    setRetryCount(retryCount + 1); // Increment retry count to trigger useEffect
    setIsLoading(true);
    setRenderError(null);
  };

  return (
    <div className={`flex flex-col h-full ${className}`}>
      <ScrollArea className="flex-1 h-full bg-gray-50">
        <div ref={containerRef} className="flex justify-center p-4">
          {isLoading ? (
            <div className="flex flex-col items-center justify-center h-64 w-full">
              <Loader className="h-8 w-8 animate-spin text-yellow-400 mb-4" />
              <div className="text-muted-foreground">
                Loading PDF...
              </div>
            </div>
          ) : renderError ? (
            <div className="flex flex-col items-center justify-center h-64 w-full">
              <div className="text-red-500 mb-4">{renderError}</div>
              <Button 
                variant="outline" 
                size="sm"
                onClick={handleRetry}
                className="flex items-center gap-2"
              >
                <RefreshCw className="h-4 w-4" />
                Retry Loading PDF
              </Button>
            </div>
          ) : !pdfDoc ? (
            <div className="flex items-center justify-center h-64 w-full">
              <div className="text-center">
                <div className="text-muted-foreground mb-2">No PDF selected</div>
                <div className="text-xs text-muted-foreground">Upload a PDF document to view it here</div>
              </div>
            </div>
          ) : (
            <div className="relative shadow-lg bg-white rounded-lg p-1">
              <canvas ref={canvasRef} className="relative z-10 rounded-lg" />
            </div>
          )}
        </div>
      </ScrollArea>

      {pdfDoc && (
        <div className="p-2 border-t bg-white flex justify-between items-center">
          <div className="text-sm text-gray-600 truncate max-w-[150px]">
            {file?.name || "Document"}
          </div>
          <div className="flex items-center space-x-2">
            <Button
              variant="outline"
              size="icon"
              className="h-8 w-8"
              disabled={pageNum === 1}
              onClick={goToPreviousPage}
            >
              <ChevronLeft className="h-4 w-4" />
            </Button>
            <span className="text-sm font-medium min-w-[50px] text-center">
              {pageNum} / {totalPages}
            </span>
            <Button
              variant="outline"
              size="icon"
              className="h-8 w-8"
              disabled={pageNum === totalPages}
              onClick={goToNextPage}
            >
              <ChevronRight className="h-4 w-4" />
            </Button>
          </div>
        </div>
      )}
    </div>
  );
};

export default PDFViewer;

\`\`\`

# src\components\ProcessingStatus.tsx

\`\`\`tsx

import { Card, CardContent } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { cn } from "@/lib/utils";
import { Loader } from "lucide-react";

interface ProcessingStatusProps {
  isProcessing: boolean;
  progress: number;
  currentStep: string;
  totalFiles?: number;
  processedFiles?: number;
  className?: string;
}

const ProcessingStatus = ({
  isProcessing,
  progress,
  currentStep,
  totalFiles = 1,
  processedFiles = 0,
  className
}: ProcessingStatusProps) => {
  if (!isProcessing) return null;

  return (
    <Card className={cn("border-yellow-400 bg-yellow-50", className)}>
      <CardContent className="p-4 space-y-3">
        <div className="flex items-center justify-between">
          <div>
            <div className="flex items-center text-sm">
              <span className="font-medium text-black">Processing</span>
              <span className="ml-2 text-black/70">{processedFiles}/{totalFiles} files</span>
            </div>
            <p className="text-xs text-black/70">Extracting financial data from reports</p>
          </div>
          <Loader className="h-4 w-4 text-yellow-500 animate-spin" />
        </div>
        
        <div className="space-y-2">
          <div className="text-sm font-medium text-black">{currentStep}</div>
          <div className="relative">
            <Progress 
              value={progress} 
              className="h-2" 
              indicatorClassName="bg-yellow-400" 
            />
            <div className="absolute right-0 top-0 -mt-5 text-xs font-medium text-black">
              {progress.toFixed(1)}%
            </div>
          </div>
          <div className="text-xs text-black/70">
            Processing financial data, please wait...
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

export default ProcessingStatus;

\`\`\`

# src\components\PromptDescriptions.tsx

\`\`\`tsx

import { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from "@/components/ui/accordion";
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { Building, FileText, BookOpen, Activity, BarChart4, Scale } from "lucide-react";
import { useEffect, useState } from "react";

interface Prompt {
  bank: string;
  description: string;
}

interface PromptCategory {
  id: string;
  title: string;
  icon: JSX.Element;
  description: string;
  prompts: Prompt[];
}

const PromptDescriptions = () => {
  const [selectedBank, setSelectedBank] = useState<string>('barclays');
  const [selectedBanks, setSelectedBanks] = useState<string[]>([]);
  const [enableMultiBanks, setEnableMultiBanks] = useState<boolean>(false);
  
  // Fetch bank selection from session storage
  useEffect(() => {
    const bank = sessionStorage.getItem('selectedBank') || 'barclays';
    const multiBank = sessionStorage.getItem('enableMultiBanks') === 'true';
    const storedBanks = sessionStorage.getItem('selectedBanks');
    const parsedBanks = storedBanks ? JSON.parse(storedBanks) : [bank];
    
    setSelectedBank(bank);
    setSelectedBanks(parsedBanks);
    setEnableMultiBanks(multiBank);
  }, []);
  
  const promptCategories: PromptCategory[] = [
    {
      id: "ecl",
      title: "ECL By Stage",
      icon: <FileText className="h-5 w-5 text-yellow-500" />,
      description: "Extract detailed Expected Credit Loss (ECL) data broken down by stages",
      prompts: [
        { bank: "Barclays", description: "Extract ECL values, gross exposures and coverage ratios by product category and stage." },
        { bank: "Santander", description: "Extract ECL provisions, gross balances and coverage ratios for all business categories." },
        { bank: "VM", description: "Extract Stage 1, 2, and 3 ECL, gross exposure, and coverage ratio information." },
        { bank: "HSBC", description: "Extract ECL values across stages for all loan portfolios." },
        { bank: "Lloyds", description: "Extract ECL values and exposure by stage for retail and commercial portfolios." },
        { bank: "NatWest", description: "Extract ECL metrics by stage across personal and commercial banking." },
        { bank: "Standard", description: "Extract ECL provisions across wholesale and retail banking segments." }
      ]
    },
    {
      id: "adjustments",
      title: "Management Adjustments",
      icon: <Scale className="h-5 w-5 text-yellow-500" />,
      description: "Extract adjustments made by management to ECL models",
      prompts: [
        { bank: "Barclays", description: "Extract economic uncertainty adjustments, other adjustments, and total management adjustments." },
        { bank: "Santander", description: "Extract all information related to management overlays or judgemental adjustments." },
        { bank: "HSBC", description: "Extract management adjustments related to economic uncertainty." },
        { bank: "Lloyds", description: "Extract post-model adjustments and management overlays." },
        { bank: "NatWest", description: "Extract in-model and post-model management adjustments." },
        { bank: "Standard", description: "Extract management overlay amounts by portfolio segment." }
      ]
    },
    {
      id: "scenarios",
      title: "Scenario Weights",
      icon: <BarChart4 className="h-5 w-5 text-yellow-500" />,
      description: "Extract scenario probability weights used in IFRS 9 ECL calculations",
      prompts: [
        { bank: "Barclays", description: "Extract probability weights assigned to Upside, Baseline, and Downside scenarios." },
        { bank: "Santander", description: "Extract forward-looking economic scenarios used in IFRS 9 ECL framework." },
        { bank: "HSBC", description: "Extract scenario weightings for Central, Upside and Downside scenarios." },
        { bank: "Lloyds", description: "Extract Base, Upside, and Downside scenario probability weights." },
        { bank: "NatWest", description: "Extract Base, Upside, and Severe downside scenario weights." },
        { bank: "Standard", description: "Extract probability-weighted scenario assumptions." }
      ]
    },
    {
      id: "macro",
      title: "Macro Variables",
      icon: <Activity className="h-5 w-5 text-yellow-500" />,
      description: "Extract macroeconomic variables used in IFRS 9 ECL calculations",
      prompts: [
        { bank: "Barclays", description: "Extract GDP, unemployment, HPI, and bank rate variables for forecast years." },
        { bank: "Santander", description: "Extract macroeconomic variables used in IFRS 9 base case scenario." },
        { bank: "HSBC", description: "Extract key economic inputs for all modeled scenarios." },
        { bank: "Lloyds", description: "Extract UK GDP, unemployment and HPI forecast assumptions." },
        { bank: "NatWest", description: "Extract macroeconomic variables and their five-year outlook." },
        { bank: "Standard", description: "Extract economic factor assumptions across major markets." }
      ]
    },
    {
      id: "other",
      title: "Other Metrics",
      icon: <BookOpen className="h-5 w-5 text-yellow-500" />,
      description: "Extract various credit quality metrics, staging criteria, and sensitivity analyses",
      prompts: [
        { bank: "Barclays", description: "Extract credit quality metrics, staging criteria, and ECL sensitivity analysis." },
        { bank: "Santander", description: "Extract credit and financial metrics by business segment." },
        { bank: "HSBC", description: "Extract staging criteria and significant increase in credit risk (SICR) thresholds." },
        { bank: "Lloyds", description: "Extract credit quality metrics and sensitivity analysis results." },
        { bank: "NatWest", description: "Extract credit risk metrics and SICR thresholds by product type." },
        { bank: "Standard", description: "Extract credit quality metrics by geographic region." }
      ]
    }
  ];

  // Filter prompts based on selected bank(s) and multi-bank setting
  const filterPrompts = (prompts: Prompt[]) => {
    if (enableMultiBanks) {
      // In multi-bank mode, filter by selected banks (case-insensitive)
      return prompts.filter(prompt => 
        selectedBanks.some(bank => 
          prompt.bank.toLowerCase() === bank.toLowerCase()
        )
      );
    }
    
    // In single bank mode, filter by selected bank (case-insensitive)
    return prompts.filter(prompt => 
      prompt.bank.toLowerCase() === selectedBank.toLowerCase()
    );
  };

  // Format selected bank names for display
  const formatBankNames = () => {
    if (!enableMultiBanks) {
      return selectedBank.charAt(0).toUpperCase() + selectedBank.slice(1);
    }

    // Convert bank IDs to display names
    const bankDisplayNames = selectedBanks.map(bankId => {
      const capitalizedBank = bankId.charAt(0).toUpperCase() + bankId.slice(1);
      // Handle special cases
      if (bankId.toLowerCase() === 'natwest') return 'NatWest Group';
      if (bankId.toLowerCase() === 'lloyds') return 'Lloyds Banking Group';
      if (bankId.toLowerCase() === 'standard') return 'Standard Chartered';
      return capitalizedBank;
    });

    if (bankDisplayNames.length === 0) return 'no banks';
    if (bankDisplayNames.length === 1) return bankDisplayNames[0];
    if (bankDisplayNames.length === 2) return `${bankDisplayNames[0]} and ${bankDisplayNames[1]}`;
    
    const lastBank = bankDisplayNames.pop();
    return `${bankDisplayNames.join(', ')}, and ${lastBank}`;
  };

  return (
    <Card className="shadow-lg border border-gray-200 hover:shadow-xl transition-shadow dark:border-gray-700">
      <CardHeader className="bg-gradient-to-r from-gray-100 to-white dark:from-gray-800 dark:to-gray-700">
        <CardTitle className="text-lg flex items-center">
          <Building className="mr-2 h-5 w-5 text-yellow-500" />
          Available Extraction Prompts
        </CardTitle>
        <CardDescription className="dark:text-gray-300">
          {enableMultiBanks 
            ? `The system can extract the following types of IFRS9 data from ${selectedBanks.length} bank report${selectedBanks.length !== 1 ? 's' : ''}`
            : `The system can extract the following types of IFRS9 data from ${formatBankNames()} reports`
          }
        </CardDescription>
      </CardHeader>
      <CardContent className="pt-4">
        <Accordion type="single" collapsible className="w-full">
          {promptCategories.map((category) => {
            const filteredPrompts = filterPrompts(category.prompts);
            // Skip categories that have no prompts for the selected bank(s)
            if (filteredPrompts.length === 0) return null;
            
            return (
              <AccordionItem key={category.id} value={category.id} className="border-b border-gray-200 dark:border-gray-700">
                <AccordionTrigger className="hover:bg-gray-50 px-4 py-3 rounded-md dark:hover:bg-gray-800">
                  <div className="flex items-center">
                    {category.icon}
                    <span className="ml-2 font-medium">{category.title}</span>
                  </div>
                </AccordionTrigger>
                <AccordionContent className="px-4 pt-2 pb-4">
                  <p className="text-sm text-gray-600 mb-4 dark:text-gray-400">{category.description}</p>
                  <div className="space-y-3">
                    {filteredPrompts.map((prompt, idx) => (
                      <div key={idx} className="bg-gray-50 p-4 rounded-md border border-gray-200 hover:border-yellow-400 transition-colors dark:bg-gray-800 dark:border-gray-700">
                        <div className="flex items-center mb-2">
                          <div className="w-2 h-2 bg-yellow-400 rounded-full mr-2"></div>
                          <div className="font-medium text-sm">{prompt.bank}</div>
                        </div>
                        <div className="text-xs text-gray-600 pl-4 dark:text-gray-400">{prompt.description}</div>
                      </div>
                    ))}
                  </div>
                </AccordionContent>
              </AccordionItem>
            );
          })}
        </Accordion>
      </CardContent>
      <CardFooter className="bg-gray-50 text-xs text-center py-3 border-t border-gray-200 dark:bg-gray-800 dark:border-gray-700">
        <div className="w-full flex items-center justify-center">
          <span className="text-gray-500 dark:text-gray-400">Supported by</span>
          <span className="font-semibold text-black ml-1 dark:text-white">EYQ</span>
          <span className="text-gray-500 ml-1 dark:text-gray-400">natural language processing</span>
        </div>
      </CardFooter>
    </Card>
  );
};

export default PromptDescriptions;

\`\`\`

# src\components\PromptSelector.tsx

\`\`\`tsx

import { useState, useEffect } from 'react';
import { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/card';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Label } from '@/components/ui/label';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { Check, FileText, Upload } from 'lucide-react';
import { PromptOption, DEFAULT_PROMPTS } from '@/lib/types';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Badge } from '@/components/ui/badge';
import { cn } from '@/lib/utils';
import { parseExcelPrompts } from '@/lib/excelUtils';
import { useToast } from '@/hooks/use-toast';

interface PromptSelectorProps {
  onPromptSelected: (prompts: PromptOption[]) => void;
  disabled?: boolean;
  selectedPrompts?: PromptOption[];
}

const PromptSelector = ({ 
  onPromptSelected, 
  disabled = false,
  selectedPrompts: externalSelectedPrompts = [] 
}: PromptSelectorProps) => {
  const [selectedPrompts, setSelectedPrompts] = useState<PromptOption[]>(externalSelectedPrompts);
  const [customPromptFile, setCustomPromptFile] = useState<File | null>(null);
  const [customPrompts, setCustomPrompts] = useState<PromptOption[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const { toast } = useToast();
  
  // Group prompts by category
  const promptsByCategory: Record<string, PromptOption[]> = DEFAULT_PROMPTS.reduce((acc, prompt) => {
    if (!acc[prompt.category]) {
      acc[prompt.category] = [];
    }
    acc[prompt.category].push(prompt);
    return acc;
  }, {} as Record<string, PromptOption[]>);
  
  // Group custom prompts by category
  const customPromptsByCategory: Record<string, PromptOption[]> = customPrompts.reduce((acc, prompt) => {
    if (!acc[prompt.category]) {
      acc[prompt.category] = [];
    }
    acc[prompt.category].push(prompt);
    return acc;
  }, {} as Record<string, PromptOption[]>);
  
  // Sync with external selected prompts when they change
  useEffect(() => {
    if (externalSelectedPrompts.length > 0) {
      setSelectedPrompts(externalSelectedPrompts);
    }
  }, [externalSelectedPrompts]);
  
  const togglePrompt = (prompt: PromptOption) => {
    if (disabled) return;
    
    const isSelected = selectedPrompts.some(p => p.id === prompt.id);
    
    if (isSelected) {
      setSelectedPrompts(selectedPrompts.filter(p => p.id !== prompt.id));
    } else {
      setSelectedPrompts([...selectedPrompts, prompt]);
    }
  };
  
  const selectAllPrompts = () => {
    if (disabled) return;
    setSelectedPrompts(DEFAULT_PROMPTS);
  };
  
  const deselectAllPrompts = () => {
    if (disabled) return;
    setSelectedPrompts([]);
  };
  
  const handleApply = () => {
    onPromptSelected(selectedPrompts);
  };
  
  const handleCustomPromptUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    if (e.target.files && e.target.files[0]) {
      const file = e.target.files[0];
      setCustomPromptFile(file);
      setIsLoading(true);
      
      try {
        const parsedPrompts = await parseExcelPrompts(file);
        setCustomPrompts(parsedPrompts);
        toast({
          title: "Excel File Processed",
          description: `${parsedPrompts.length} prompts loaded from Excel file`,
        });
      } catch (error) {
        toast({
          title: "Error Processing Excel File",
          description: error instanceof Error ? error.message : "Unknown error occurred",
          variant: "destructive",
        });
      } finally {
        setIsLoading(false);
      }
    }
  };
  
  const useCustomPrompts = () => {
    if (customPrompts.length > 0) {
      setSelectedPrompts(customPrompts);
      onPromptSelected(customPrompts);
      toast({
        title: "Custom Prompts Selected",
        description: `${customPrompts.length} custom prompts will be used for extraction`,
      });
    }
  };

  return (
    <div className="space-y-6">
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Left side - Info */}
        <div className="space-y-4">
          <div>
            <h2 className="text-lg font-semibold mb-1">Select Data to Extract</h2>
            <p className="text-sm text-muted-foreground">
              Choose which financial data points you want to extract from Barclays's uploaded PDFs.
            </p>
          </div>
          
          <div className="bg-muted p-4 rounded-lg border">
            <h3 className="font-medium mb-2">How It Works</h3>
            <p className="text-sm text-muted-foreground">
              Each prompt is designed to extract specific IFRS9 data points from financial reports. Select prompts based on the data you need.
            </p>
          </div>
        </div>

        {/* Right side - Prompt selection */}
        <div>
          <Tabs defaultValue="predefined" className="w-full">
            <TabsList className="grid grid-cols-2 mb-4 w-full">
              <TabsTrigger value="predefined" className="text-sm">Predefined Prompts</TabsTrigger>
              <TabsTrigger value="custom" className="text-sm">Custom Excel Prompts</TabsTrigger>
            </TabsList>
            
            <TabsContent value="predefined">
              <div className="space-y-4">
                <div className="flex justify-between items-center">
                  <div>
                    <span className="text-sm font-medium">
                      {selectedPrompts.length} of {DEFAULT_PROMPTS.length} selected
                    </span>
                  </div>
                  <div className="space-x-2">
                    <Button 
                      variant="outline" 
                      size="sm" 
                      onClick={selectAllPrompts} 
                      disabled={disabled || selectedPrompts.length === DEFAULT_PROMPTS.length}
                    >
                      Select All
                    </Button>
                    <Button 
                      variant="outline" 
                      size="sm" 
                      onClick={deselectAllPrompts} 
                      disabled={disabled || selectedPrompts.length === 0}
                    >
                      Deselect All
                    </Button>
                  </div>
                </div>
                
                <ScrollArea className="h-[350px] pr-4 -mr-4">
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                    {DEFAULT_PROMPTS.map((prompt) => (
                      <div 
                        key={prompt.id}
                        className={cn(
                          "border rounded-md p-3 cursor-pointer transition-all",
                          selectedPrompts.some(p => p.id === prompt.id) 
                            ? "border-yellow-400 bg-yellow-50 text-black" 
                            : "border-border"
                        )}
                        onClick={() => togglePrompt(prompt)}
                      >
                        <div className="flex justify-between">
                          <div className="font-medium text-sm">{prompt.name}</div>
                          {selectedPrompts.some(p => p.id === prompt.id) && (
                            <Check className="h-4 w-4 text-yellow-500" />
                          )}
                        </div>
                        <div className="text-xs text-muted-foreground mt-1">
                          {prompt.description}
                        </div>
                      </div>
                    ))}
                  </div>
                </ScrollArea>
                
                <Button 
                  className="w-full bg-yellow-400 hover:bg-yellow-500 text-black" 
                  onClick={handleApply}
                  disabled={disabled || selectedPrompts.length === 0}
                >
                  Apply Selected Prompts
                </Button>
              </div>
            </TabsContent>
            
            <TabsContent value="custom">
              <div className="space-y-6">
                <div className="bg-muted/50 p-4 rounded-md border">
                  <div className="flex items-start">
                    <FileText className="h-6 w-6 text-muted-foreground mr-3 mt-1" />
                    <div>
                      <h4 className="font-medium text-sm">Excel Prompt File Format</h4>
                      <p className="text-xs text-muted-foreground mt-1">
                        Upload an Excel file with prompts. The file should contain columns for Prompt Name, Description, Template, and Category.
                      </p>
                    </div>
                  </div>
                </div>
                
                <div>
                  <Label htmlFor="promptFile">Upload Prompt Excel File</Label>
                  <div className="mt-2 flex items-center space-x-3">
                    <div className="flex-1 relative">
                      <Input 
                        id="promptFile"
                        type="file" 
                        onChange={handleCustomPromptUpload} 
                        accept=".xlsx,.xls"
                        disabled={disabled || isLoading}
                        className="flex-1"
                      />
                      {isLoading && (
                        <div className="absolute inset-0 flex items-center justify-center bg-white/70">
                          <div className="animate-spin h-5 w-5 border-2 border-yellow-400 border-t-transparent rounded-full"></div>
                        </div>
                      )}
                    </div>
                    <Button 
                      variant="outline"
                      size="icon"
                      disabled={disabled || isLoading}
                      onClick={() => document.getElementById('promptFile')?.click()}
                    >
                      <Upload className="h-4 w-4" />
                    </Button>
                  </div>
                  {customPromptFile && (
                    <div className="mt-2 flex items-center">
                      <FileText className="h-4 w-4 text-yellow-500 mr-2" />
                      <span className="text-sm">{customPromptFile.name}</span>
                      <Badge variant="outline" className="ml-2">
                        {isLoading ? 'Processing...' : `${customPrompts.length} prompts loaded`}
                      </Badge>
                    </div>
                  )}
                </div>
                
                {customPrompts.length > 0 && (
                  <div className="border rounded-md p-4">
                    <h3 className="text-sm font-medium mb-3">Loaded Custom Prompts</h3>
                    <ScrollArea className="h-[150px]">
                      <div className="space-y-2">
                        {Object.entries(customPromptsByCategory).map(([category, prompts]) => (
                          <div key={category} className="mb-3">
                            <h4 className="text-xs font-semibold text-muted-foreground mb-1">{category}</h4>
                            {prompts.map((prompt, idx) => (
                              <div key={idx} className="text-sm py-1 px-2 rounded-sm hover:bg-muted">
                                {prompt.name}
                              </div>
                            ))}
                          </div>
                        ))}
                      </div>
                    </ScrollArea>
                  </div>
                )}
                
                <Button 
                  className="w-full bg-yellow-400 hover:bg-yellow-500 text-black" 
                  disabled={!customPromptFile || disabled || customPrompts.length === 0}
                  onClick={useCustomPrompts}
                >
                  Use Custom Prompts
                </Button>
              </div>
            </TabsContent>
          </Tabs>
        </div>
      </div>
    </div>
  );
};

export default PromptSelector;

\`\`\`

# src\components\ResultsViewer.tsx

\`\`\`tsx

import { useState } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { Button } from '@/components/ui/button';
import { AlertCircle, Check, Download, Loader, Star } from 'lucide-react';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { ProcessingResult } from '@/lib/types';
import { cn } from '@/lib/utils';
import { Badge } from '@/components/ui/badge';
import { ScrollArea } from '@/components/ui/scroll-area';
import ProcessingStatus from './ProcessingStatus';

interface ResultsViewerProps {
  results: ProcessingResult[];
  onDownloadResults: () => void;
  isProcessing?: boolean;
  processingProgress?: number;
  processingStep?: string;
  totalFiles?: number;
  processedFiles?: number;
}

const ResultsViewer = ({ 
  results, 
  onDownloadResults, 
  isProcessing = false, 
  processingProgress = 0, 
  processingStep = '',
  totalFiles = 1,
  processedFiles = 0
}: ResultsViewerProps) => {
  const [selectedResult, setSelectedResult] = useState<string | null>(
    results.length > 0 && results[0] ? results[0].id : null
  );
  const [activeTab, setActiveTab] = useState('results');

  const currentResult = results.find(result => result && result.id === selectedResult);
  
  // Group results by file
  const resultsByFile: Record<string, ProcessingResult[]> = results.reduce((acc, result) => {
    if (!result) return acc;
    if (!acc[result.fileId]) {
      acc[result.fileId] = [];
    }
    acc[result.fileId].push(result);
    return acc;
  }, {} as Record<string, ProcessingResult[]>);

  // Check if the current result has ECL By Stage data
  const isEclByStageCategory = currentResult?.data?.some(item => item?.Category === 'ECL By Stage');
  
  if (results.length === 0 && !isProcessing) {
    return (
      <div className="space-y-6">
        <div>
          <h2 className="text-lg font-semibold mb-1">Extraction Results</h2>
          <p className="text-sm text-muted-foreground">View and download the extracted financial data for Barclays</p>
        </div>
        
        <Card>
          <CardContent className="flex flex-col items-center justify-center p-12 text-center">
            <div className="text-muted-foreground mb-2">
              No extraction results yet
            </div>
            <div className="text-sm text-muted-foreground">
              Process files to see extraction results
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  if (isProcessing) {
    return (
      <div className="space-y-6">
        <div>
          <h2 className="text-lg font-semibold mb-1">Extraction Results</h2>
          <p className="text-sm text-muted-foreground">View and download the extracted financial data for Barclays</p>
        </div>
        
        {/* Processing status */}
        <ProcessingStatus
          isProcessing={isProcessing}
          progress={processingProgress}
          currentStep={processingStep}
          totalFiles={totalFiles}
          processedFiles={processedFiles}
        />
        
        <div className="mt-10">
          <h2 className="text-lg font-semibold mb-6">Extraction Results</h2>
          
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div className="lg:col-span-1">
              <div className="border rounded-lg overflow-hidden">
                <div className="bg-black text-white p-2 text-sm font-medium">
                  Processed Files
                </div>
                <div className="p-2 border-b">
                  <div className="text-sm font-medium p-2 bg-muted rounded">Currently Processing</div>
                </div>
                <div className="p-2">
                  <div className="flex items-center justify-between p-2 text-sm rounded-md hover:bg-muted cursor-pointer">
                    <div className="truncate pr-2">Management Adjustments</div>
                    <div className="flex items-center">
                      <Star className="h-3 w-3 text-yellow-400 fill-yellow-400" />
                    </div>
                  </div>
                  <div className="flex items-center justify-between p-2 text-sm rounded-md hover:bg-muted cursor-pointer">
                    <div className="truncate pr-2">Loan Loss Rate</div>
                    <div className="flex items-center">
                      <Star className="h-3 w-3 text-yellow-400 fill-yellow-400" />
                    </div>
                  </div>
                  <div className="flex items-center justify-between p-2 text-sm rounded-md hover:bg-muted cursor-pointer">
                    <div className="truncate pr-2">Macro Variables</div>
                    <div className="flex items-center">
                      <Star className="h-3 w-3 text-yellow-400 fill-yellow-400" />
                    </div>
                  </div>
                </div>
                <div className="p-2 border-t bg-muted/40">
                  <div className="text-sm font-medium p-2">FY24-Barclays-Results-RA.pdf</div>
                  <div className="flex items-center justify-between p-2 text-sm rounded-md hover:bg-muted cursor-pointer bg-yellow-50 border border-yellow-400">
                    <div className="truncate pr-2 text-black">ECL By Stage</div>
                    <div className="flex items-center">
                      <Star className="h-3 w-3 text-yellow-400 fill-yellow-400" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div className="lg:col-span-2">
              <div className="flex items-center justify-center h-[400px] border rounded-lg">
                <div className="text-center p-8">
                  <div className="flex items-center justify-center mb-4">
                    <div className="animate-spin h-10 w-10 border-4 border-yellow-400 border-t-transparent rounded-full"></div>
                  </div>
                  <h3 className="text-lg font-medium mb-2">Processing Data</h3>
                  <p className="text-sm text-muted-foreground">
                    Extracting information from your documents...
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <Tabs value={activeTab} onValueChange={setActiveTab}>
      <div className="space-y-6">
        <div className="flex justify-between items-center">
          <div>
            <h2 className="text-lg font-semibold mb-1">Extraction Results</h2>
            <p className="text-sm text-muted-foreground">View and download the extracted financial data for Barclays</p>
          </div>
          <Button 
            variant="outline" 
            size="sm" 
            onClick={onDownloadResults}
            className="flex items-center gap-1 border-yellow-400 hover:bg-yellow-50"
          >
            <Download className="h-4 w-4" />
            <span>Download All</span>
          </Button>
        </div>
        
        <TabsList className="grid grid-cols-2 max-w-[400px]">
          <TabsTrigger value="results">Results</TabsTrigger>
          <TabsTrigger value="combined">Combined View</TabsTrigger>
        </TabsList>
        
        <TabsContent value="results" className="space-y-6">
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div className="lg:col-span-1">
              <div className="border rounded-lg overflow-hidden">
                <div className="bg-black text-white p-2 text-sm font-medium">
                  Processed Files
                </div>
                <ScrollArea className="h-[400px]">
                  <div className="p-2">
                    {Object.entries(resultsByFile).map(([fileId, fileResults]) => {
                      const fileInfo = fileResults[0];
                      if (!fileInfo) return null;
                      
                      return (
                        <div key={fileId} className="mb-4">
                          <div className="text-sm font-medium p-2 bg-muted">
                            {fileInfo.fileName}
                          </div>
                          {fileResults.map(result => {
                            if (!result) return null;
                            const isSelected = selectedResult === result.id;
                            
                            return (
                              <div 
                                key={result.id}
                                className={cn(
                                  "flex items-center justify-between p-2 text-sm rounded-md cursor-pointer",
                                  isSelected ? "bg-yellow-50 border border-yellow-400 text-black" : "hover:bg-muted"
                                )}
                                onClick={() => setSelectedResult(result.id)}
                              >
                                <div className="truncate pr-2">{result.promptName}</div>
                                <div className="flex items-center">
                                  <Star className="h-3 w-3 text-yellow-400 fill-yellow-400" />
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      );
                    })}
                  </div>
                </ScrollArea>
              </div>
            </div>
            
            <div className="lg:col-span-2">
              {currentResult ? (
                <div className="border rounded-lg overflow-hidden">
                  <div className="bg-black text-white p-3 flex justify-between items-center">
                    <div>
                      <div className="font-medium">{currentResult.promptName}</div>
                      <div className="text-xs text-gray-400">From: {currentResult.fileName}</div>
                    </div>
                    <Badge 
                      className={cn(
                        "capitalize",
                        currentResult.status === 'success' && "bg-green-500",
                        currentResult.status === 'error' && "bg-destructive",
                        currentResult.status === 'processing' && "bg-amber-500"
                      )}
                    >
                      {currentResult.status}
                    </Badge>
                  </div>
                  
                  <div className="p-3">
                    {currentResult.status === 'processing' && (
                      <div className="flex flex-col items-center justify-center h-[350px] py-8">
                        <Loader className="h-8 w-8 text-yellow-400 animate-spin mb-2" />
                        <div className="text-sm">Processing data extraction...</div>
                      </div>
                    )}
                    
                    {currentResult.status === 'error' && currentResult.error && (
                      <Alert variant="destructive" className="mb-4">
                        <AlertCircle className="h-4 w-4" />
                        <AlertTitle>Error</AlertTitle>
                        <AlertDescription>
                          {currentResult.error}
                        </AlertDescription>
                      </Alert>
                    )}
                    
                    {currentResult.status === 'success' && currentResult.data && (
                      <Tabs defaultValue="table">
                        <TabsList className="mb-4">
                          <TabsTrigger value="table">Table View</TabsTrigger>
                          <TabsTrigger value="json">JSON View</TabsTrigger>
                          {/* Only show By Stage tab for ECL By Stage category */}
                          {isEclByStageCategory && (
                            <TabsTrigger value="by-stage">By Stage</TabsTrigger>
                          )}
                        </TabsList>
                        
                        <TabsContent value="table" className="mt-0">
                          <ScrollArea className="h-[350px]">
                            <Table>
                              <TableHeader className="bg-muted sticky top-0">
                                <TableRow>
                                  <TableHead className="font-semibold">Category</TableHead>
                                  <TableHead className="font-semibold">Stage</TableHead>
                                  <TableHead className="font-semibold">Field</TableHead>
                                  <TableHead className="font-semibold">Value</TableHead>
                                </TableRow>
                              </TableHeader>
                              <TableBody>
                                {currentResult.data.map((item, index) => {
                                  if (!item) return null;
                                  
                                  return (
                                    <TableRow key={index}>
                                      <TableCell>
                                        {item.Category === 'ECL By Stage' ? 'ECL' : item.Category}
                                      </TableCell>
                                      <TableCell>{item.Stage}</TableCell>
                                      <TableCell>{item.Field}</TableCell>
                                      <TableCell className="font-medium">{item.Value}</TableCell>
                                    </TableRow>
                                  );
                                })}
                              </TableBody>
                            </Table>
                          </ScrollArea>
                        </TabsContent>
                        
                        <TabsContent value="json" className="mt-0">
                          <ScrollArea className="h-[350px]">
                            <pre className="bg-muted p-4 rounded-md text-xs overflow-x-auto">
                              {JSON.stringify(currentResult.data, null, 2)}
                            </pre>
                          </ScrollArea>
                        </TabsContent>
                        
                        {/* Only render By Stage content for ECL By Stage category */}
                        {isEclByStageCategory && (
                          <TabsContent value="by-stage" className="mt-0">
                            <ScrollArea className="h-[350px]">
                              <div className="space-y-4">
                                {/* Group data by Stage */}
                                {(() => {
                                  // Get unique stages
                                  const stages = Array.from(
                                    new Set(
                                      currentResult.data
                                        .filter(item => item?.Category === 'ECL By Stage')
                                        .map(item => item?.Stage)
                                    )
                                  );
                                  
                                  return stages.map(stage => {
                                    const stageData = currentResult.data.filter(
                                      item => item?.Stage === stage && item?.Category === 'ECL By Stage'
                                    );
                                    
                                    if (stageData.length === 0) return null;
                                    
                                    return (
                                      <div key={`stage-${stage}`} className="border rounded-md overflow-hidden">
                                        <div className="bg-muted p-2">
                                          <h4 className="font-medium">Stage {stage}</h4>
                                        </div>
                                        <Table>
                                          <TableHeader>
                                            <TableRow>
                                              <TableHead>Category</TableHead>
                                              <TableHead>Field</TableHead>
                                              <TableHead>Value</TableHead>
                                            </TableRow>
                                          </TableHeader>
                                          <TableBody>
                                            {stageData.map((item, index) => (
                                              <TableRow key={index}>
                                                <TableCell>ECL</TableCell>
                                                <TableCell>{item.Field}</TableCell>
                                                <TableCell className="font-medium">{item.Value}</TableCell>
                                              </TableRow>
                                            ))}
                                          </TableBody>
                                        </Table>
                                      </div>
                                    );
                                  });
                                })()}
                              </div>
                            </ScrollArea>
                          </TabsContent>
                        )}
                      </Tabs>
                    )}
                  </div>
                </div>
              ) : (
                <div className="flex flex-col items-center justify-center h-[400px] border rounded-lg">
                  <div className="text-muted-foreground">
                    Select a result to view details
                  </div>
                </div>
              )}
            </div>
          </div>
        </TabsContent>
        
        <TabsContent value="combined">
          <div className="space-y-6">
            <div className="flex justify-between items-center">
              <div>
                <h2 className="text-lg font-semibold mb-1">Combined Results</h2>
                <p className="text-sm text-muted-foreground">
                  View and download the final processed data in Excel format
                </p>
              </div>
              <Button 
                variant="outline" 
                size="sm" 
                onClick={onDownloadResults}
                className="flex items-center gap-1 border-yellow-400 bg-white text-black hover:bg-yellow-50"
              >
                <Download className="h-4 w-4" />
                <span>Download Excel</span>
              </Button>
            </div>
            
            {results.length > 0 ? (
              <div className="border rounded-lg overflow-hidden">
                <div className="flex justify-between items-center p-3 bg-muted border-b">
                  <Button 
                    variant="outline" 
                    size="sm" 
                    className="py-1 h-8 bg-yellow-400 hover:bg-yellow-500 border-none text-black"
                  >
                    Combined View
                  </Button>
                  <div className="text-sm text-muted-foreground">
                    {results.filter(r => r.data).flatMap(r => r.data || []).length} rows
                  </div>
                </div>
                
                <ScrollArea className="h-[650px]">
                  <Table>
                    <TableHeader className="bg-muted/70 sticky top-0">
                      <TableRow>
                        <TableHead className="font-semibold text-black">Category</TableHead>
                        <TableHead className="font-semibold text-black">Stage</TableHead>
                        <TableHead className="font-semibold text-black">Field</TableHead>
                        <TableHead className="font-semibold text-black">Value</TableHead>
                        <TableHead className="font-semibold text-black">Source</TableHead>
                      </TableRow>
                    </TableHeader>
                    <TableBody>
                      {results
                        .filter(result => result.status === 'success' && result.data)
                        .flatMap((result, resultIndex) => 
                          (result.data || []).map((item, itemIndex) => (
                            <TableRow key={`${resultIndex}-${itemIndex}`}>
                              <TableCell>
                                {item.Category === 'ECL By Stage' ? 'ECL' : item.Category}
                              </TableCell>
                              <TableCell>{item.Stage}</TableCell>
                              <TableCell>{item.Field}</TableCell>
                              <TableCell>{item.Value}</TableCell>
                              <TableCell>{result.fileName} - {result.promptName}</TableCell>
                            </TableRow>
                          ))
                        )
                      }
                    </TableBody>
                  </Table>
                </ScrollArea>
              </div>
            ) : (
              <div className="border rounded-lg p-12 text-center">
                <p className="text-muted-foreground">No results available yet.</p>
                <p className="text-sm text-muted-foreground mt-1">Process files with prompts to see combined results.</p>
              </div>
            )}
          </div>
        </TabsContent>
      </div>
    </Tabs>
  );
};

// Helper component for Progress
const Progress = ({ value, className }: { value: number, className?: string }) => {
  return (
    <div className={cn("w-full bg-gray-200 rounded-full h-2.5", className)}>
      <div 
        className="bg-yellow-400 h-2.5 rounded-full" 
        style={{ width: `${value}%` }}
      ></div>
    </div>
  );
};

export default ResultsViewer;

\`\`\`

# src\components\ThemeProvider.tsx

\`\`\`tsx

"use client";

import * as React from "react";
import { createContext, useContext, useEffect, useState } from "react";

type Theme = "dark" | "light" | "system";

type ThemeProviderProps = {
  children: React.ReactNode;
  defaultTheme?: Theme;
  storageKey?: string;
};

type ThemeProviderState = {
  theme: Theme;
  setTheme: (theme: Theme) => void;
};

const initialState: ThemeProviderState = {
  theme: "system",
  setTheme: () => null,
};

const ThemeProviderContext = createContext<ThemeProviderState>(initialState);

export function ThemeProvider({
  children,
  defaultTheme = "system",
  storageKey = "vite-ui-theme",
  ...props
}: ThemeProviderProps) {
  const [theme, setTheme] = useState<Theme>(
    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme
  );

  useEffect(() => {
    const root = window.document.documentElement;
    root.classList.remove("light", "dark");

    if (theme === "system") {
      const systemTheme = window.matchMedia("(prefers-color-scheme: dark)")
        .matches
        ? "dark"
        : "light";

      root.classList.add(systemTheme);
      return;
    }

    root.classList.add(theme);
  }, [theme]);

  const value = {
    theme,
    setTheme: (theme: Theme) => {
      localStorage.setItem(storageKey, theme);
      setTheme(theme);
    },
  };

  return (
    <ThemeProviderContext.Provider {...props} value={value}>
      {children}
    </ThemeProviderContext.Provider>
  );
}

export const useTheme = () => {
  const context = useContext(ThemeProviderContext);

  if (context === undefined)
    throw new Error("useTheme must be used within a ThemeProvider");

  return context;
};

\`\`\`

# src\components\ThemeToggle.tsx

\`\`\`tsx

import { Moon, Sun } from "lucide-react";
import { Button } from "@/components/ui/button";
import { useTheme } from "@/components/ThemeProvider";
import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from "@/components/ui/dropdown-menu";

export function ThemeToggle({ className }: { className?: string }) {
  const { setTheme, theme } = useTheme();

  return (
    <div className={className}>
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <Button variant="outline" size="icon" className="rounded-full bg-white dark:bg-yellow-400">
            <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0 dark:text-black" />
            <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100 dark:text-black" />
            <span className="sr-only">Toggle theme</span>
          </Button>
        </DropdownMenuTrigger>
        <DropdownMenuContent align="end">
          <DropdownMenuItem onClick={() => setTheme("light")}>
            Light
          </DropdownMenuItem>
          <DropdownMenuItem onClick={() => setTheme("dark")}>
            Dark
          </DropdownMenuItem>
          <DropdownMenuItem onClick={() => setTheme("system")}>
            System
          </DropdownMenuItem>
        </DropdownMenuContent>
      </DropdownMenu>
    </div>
  );
}

\`\`\`

# src\components\ui\accordion.tsx

\`\`\`tsx
import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn("border-b", className)}
    {...props}
  />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))

AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }

\`\`\`

# src\components\ui\alert-dialog.tsx

\`\`\`tsx
import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

const AlertDialog = AlertDialogPrimitive.Root

const AlertDialogTrigger = AlertDialogPrimitive.Trigger

const AlertDialogPortal = AlertDialogPrimitive.Portal

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    />
  </AlertDialogPortal>
))
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName

const AlertDialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
AlertDialogHeader.displayName = "AlertDialogHeader"

const AlertDialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
AlertDialogFooter.displayName = "AlertDialogFooter"

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold", className)}
    {...props}
  />
))
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action
    ref={ref}
    className={cn(buttonVariants(), className)}
    {...props}
  />
))
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    )}
    {...props}
  />
))
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}

\`\`\`

# src\components\ui\alert.tsx

\`\`\`tsx
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive:
          "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
))
Alert.displayName = "Alert"

const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn("mb-1 font-medium leading-none tracking-tight", className)}
    {...props}
  />
))
AlertTitle.displayName = "AlertTitle"

const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm [&_p]:leading-relaxed", className)}
    {...props}
  />
))
AlertDescription.displayName = "AlertDescription"

export { Alert, AlertTitle, AlertDescription }

\`\`\`

# src\components\ui\aspect-ratio.tsx

\`\`\`tsx
import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio"

const AspectRatio = AspectRatioPrimitive.Root

export { AspectRatio }

\`\`\`

# src\components\ui\avatar.tsx

\`\`\`tsx
import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    )}
    {...props}
  />
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image
    ref={ref}
    className={cn("aspect-square h-full w-full", className)}
    {...props}
  />
))
AvatarImage.displayName = AvatarPrimitive.Image.displayName

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn(
      "flex h-full w-full items-center justify-center rounded-full bg-muted",
      className
    )}
    {...props}
  />
))
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName

export { Avatar, AvatarImage, AvatarFallback }

\`\`\`

# src\components\ui\badge.tsx

\`\`\`tsx
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  )
}

export { Badge, badgeVariants }

\`\`\`

# src\components\ui\breadcrumb.tsx

\`\`\`tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"

const Breadcrumb = React.forwardRef<
  HTMLElement,
  React.ComponentPropsWithoutRef<"nav"> & {
    separator?: React.ReactNode
  }
>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)
Breadcrumb.displayName = "Breadcrumb"

const BreadcrumbList = React.forwardRef<
  HTMLOListElement,
  React.ComponentPropsWithoutRef<"ol">
>(({ className, ...props }, ref) => (
  <ol
    ref={ref}
    className={cn(
      "flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",
      className
    )}
    {...props}
  />
))
BreadcrumbList.displayName = "BreadcrumbList"

const BreadcrumbItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentPropsWithoutRef<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    className={cn("inline-flex items-center gap-1.5", className)}
    {...props}
  />
))
BreadcrumbItem.displayName = "BreadcrumbItem"

const BreadcrumbLink = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentPropsWithoutRef<"a"> & {
    asChild?: boolean
  }
>(({ asChild, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      className={cn("transition-colors hover:text-foreground", className)}
      {...props}
    />
  )
})
BreadcrumbLink.displayName = "BreadcrumbLink"

const BreadcrumbPage = React.forwardRef<
  HTMLSpanElement,
  React.ComponentPropsWithoutRef<"span">
>(({ className, ...props }, ref) => (
  <span
    ref={ref}
    role="link"
    aria-disabled="true"
    aria-current="page"
    className={cn("font-normal text-foreground", className)}
    {...props}
  />
))
BreadcrumbPage.displayName = "BreadcrumbPage"

const BreadcrumbSeparator = ({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) => (
  <li
    role="presentation"
    aria-hidden="true"
    className={cn("[&>svg]:size-3.5", className)}
    {...props}
  >
    {children ?? <ChevronRight />}
  </li>
)
BreadcrumbSeparator.displayName = "BreadcrumbSeparator"

const BreadcrumbEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    role="presentation"
    aria-hidden="true"
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More</span>
  </span>
)
BreadcrumbEllipsis.displayName = "BreadcrumbElipssis"

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}

\`\`\`

# src\components\ui\button.tsx

\`\`\`tsx

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-500",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground dark:border-gray-600",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-500",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
        eyOutline: "border border-ey-gray-400 text-white hover:bg-ey-gray-800 hover:border-ey-gray-500 transition-colors",
        eyPrimary: "bg-ey-yellow text-ey-black hover:bg-ey-yellow/90 font-medium transition-colors",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }

\`\`\`

# src\components\ui\calendar.tsx

\`\`\`tsx
import * as React from "react";
import { ChevronLeft, ChevronRight } from "lucide-react";
import { DayPicker } from "react-day-picker";

import { cn } from "@/lib/utils";
import { buttonVariants } from "@/components/ui/button";

export type CalendarProps = React.ComponentProps<typeof DayPicker>;

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: CalendarProps) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",
        month: "space-y-4",
        caption: "flex justify-center pt-1 relative items-center",
        caption_label: "text-sm font-medium",
        nav: "space-x-1 flex items-center",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-y-1",
        head_row: "flex",
        head_cell:
          "text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",
        day: cn(
          buttonVariants({ variant: "ghost" }),
          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"
        ),
        day_range_end: "day-range-end",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle:
          "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ ..._props }) => <ChevronLeft className="h-4 w-4" />,
        IconRight: ({ ..._props }) => <ChevronRight className="h-4 w-4" />,
      }}
      {...props}
    />
  );
}
Calendar.displayName = "Calendar";

export { Calendar };

\`\`\`

# src\components\ui\card.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }

\`\`\`

# src\components\ui\carousel.tsx

\`\`\`tsx
import * as React from "react"
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react"
import { ArrowLeft, ArrowRight } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: "horizontal" | "vertical"
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />")
  }

  return context
}

const Carousel = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & CarouselProps
>(
  (
    {
      orientation = "horizontal",
      opts,
      setApi,
      plugins,
      className,
      children,
      ...props
    },
    ref
  ) => {
    const [carouselRef, api] = useEmblaCarousel(
      {
        ...opts,
        axis: orientation === "horizontal" ? "x" : "y",
      },
      plugins
    )
    const [canScrollPrev, setCanScrollPrev] = React.useState(false)
    const [canScrollNext, setCanScrollNext] = React.useState(false)

    const onSelect = React.useCallback((api: CarouselApi) => {
      if (!api) {
        return
      }

      setCanScrollPrev(api.canScrollPrev())
      setCanScrollNext(api.canScrollNext())
    }, [])

    const scrollPrev = React.useCallback(() => {
      api?.scrollPrev()
    }, [api])

    const scrollNext = React.useCallback(() => {
      api?.scrollNext()
    }, [api])

    const handleKeyDown = React.useCallback(
      (event: React.KeyboardEvent<HTMLDivElement>) => {
        if (event.key === "ArrowLeft") {
          event.preventDefault()
          scrollPrev()
        } else if (event.key === "ArrowRight") {
          event.preventDefault()
          scrollNext()
        }
      },
      [scrollPrev, scrollNext]
    )

    React.useEffect(() => {
      if (!api || !setApi) {
        return
      }

      setApi(api)
    }, [api, setApi])

    React.useEffect(() => {
      if (!api) {
        return
      }

      onSelect(api)
      api.on("reInit", onSelect)
      api.on("select", onSelect)

      return () => {
        api?.off("select", onSelect)
      }
    }, [api, onSelect])

    return (
      <CarouselContext.Provider
        value={{
          carouselRef,
          api: api,
          opts,
          orientation:
            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
          scrollPrev,
          scrollNext,
          canScrollPrev,
          canScrollNext,
        }}
      >
        <div
          ref={ref}
          onKeyDownCapture={handleKeyDown}
          className={cn("relative", className)}
          role="region"
          aria-roledescription="carousel"
          {...props}
        >
          {children}
        </div>
      </CarouselContext.Provider>
    )
  }
)
Carousel.displayName = "Carousel"

const CarouselContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div ref={carouselRef} className="overflow-hidden">
      <div
        ref={ref}
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className
        )}
        {...props}
      />
    </div>
  )
})
CarouselContent.displayName = "CarouselContent"

const CarouselItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { orientation } = useCarousel()

  return (
    <div
      ref={ref}
      role="group"
      aria-roledescription="slide"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className
      )}
      {...props}
    />
  )
})
CarouselItem.displayName = "CarouselItem"

const CarouselPrevious = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute  h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-left-12 top-1/2 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft className="h-4 w-4" />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
})
CarouselPrevious.displayName = "CarouselPrevious"

const CarouselNext = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-right-12 top-1/2 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight className="h-4 w-4" />
      <span className="sr-only">Next slide</span>
    </Button>
  )
})
CarouselNext.displayName = "CarouselNext"

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}

\`\`\`

# src\components\ui\chart.tsx

\`\`\`tsx
import * as React from "react"
import * as RechartsPrimitive from "recharts"

import { cn } from "@/lib/utils"

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />")
  }

  return context
}

const ChartContainer = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    config: ChartConfig
    children: React.ComponentProps<
      typeof RechartsPrimitive.ResponsiveContainer
    >["children"]
  }
>(({ id, className, children, config, ...props }, ref) => {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-chart={chartId}
        ref={ref}
        className={cn(
          "flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",
          className
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
})
ChartContainer.displayName = "Chart"

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([_, config]) => config.theme || config.color
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join("\n")}
}
`
          )
          .join("\n"),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

const ChartTooltipContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
    React.ComponentProps<"div"> & {
      hideLabel?: boolean
      hideIndicator?: boolean
      indicator?: "line" | "dot" | "dashed"
      nameKey?: string
      labelKey?: string
    }
>(
  (
    {
      active,
      payload,
      className,
      indicator = "dot",
      hideLabel = false,
      hideIndicator = false,
      label,
      labelFormatter,
      labelClassName,
      formatter,
      color,
      nameKey,
      labelKey,
    },
    ref
  ) => {
    const { config } = useChart()

    const tooltipLabel = React.useMemo(() => {
      if (hideLabel || !payload?.length) {
        return null
      }

      const [item] = payload
      const key = `${labelKey || item.dataKey || item.name || "value"}`
      const itemConfig = getPayloadConfigFromPayload(config, item, key)
      const value =
        !labelKey && typeof label === "string"
          ? config[label as keyof typeof config]?.label || label
          : itemConfig?.label

      if (labelFormatter) {
        return (
          <div className={cn("font-medium", labelClassName)}>
            {labelFormatter(value, payload)}
          </div>
        )
      }

      if (!value) {
        return null
      }

      return <div className={cn("font-medium", labelClassName)}>{value}</div>
    }, [
      label,
      labelFormatter,
      payload,
      hideLabel,
      labelClassName,
      config,
      labelKey,
    ])

    if (!active || !payload?.length) {
      return null
    }

    const nestLabel = payload.length === 1 && indicator !== "dot"

    return (
      <div
        ref={ref}
        className={cn(
          "grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",
          className
        )}
      >
        {!nestLabel ? tooltipLabel : null}
        <div className="grid gap-1.5">
          {payload.map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`
            const itemConfig = getPayloadConfigFromPayload(config, item, key)
            const indicatorColor = color || item.payload.fill || item.color

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",
                  indicator === "dot" && "items-center"
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn(
                            "shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",
                            {
                              "h-2.5 w-2.5": indicator === "dot",
                              "w-1": indicator === "line",
                              "w-0 border-[1.5px] border-dashed bg-transparent":
                                indicator === "dashed",
                              "my-0.5": nestLabel && indicator === "dashed",
                            }
                          )}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center"
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">
                          {itemConfig?.label || item.name}
                        </span>
                      </div>
                      {item.value && (
                        <span className="font-mono font-medium tabular-nums text-foreground">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            )
          })}
        </div>
      </div>
    )
  }
)
ChartTooltipContent.displayName = "ChartTooltip"

const ChartLegend = RechartsPrimitive.Legend

const ChartLegendContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> &
    Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
      hideIcon?: boolean
      nameKey?: string
    }
>(
  (
    { className, hideIcon = false, payload, verticalAlign = "bottom", nameKey },
    ref
  ) => {
    const { config } = useChart()

    if (!payload?.length) {
      return null
    }

    return (
      <div
        ref={ref}
        className={cn(
          "flex items-center justify-center gap-4",
          verticalAlign === "top" ? "pb-3" : "pt-3",
          className
        )}
      >
        {payload.map((item) => {
          const key = `${nameKey || item.dataKey || "value"}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)

          return (
            <div
              key={item.value}
              className={cn(
                "flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"
              )}
            >
              {itemConfig?.icon && !hideIcon ? (
                <itemConfig.icon />
              ) : (
                <div
                  className="h-2 w-2 shrink-0 rounded-[2px]"
                  style={{
                    backgroundColor: item.color,
                  }}
                />
              )}
              {itemConfig?.label}
            </div>
          )
        })}
      </div>
    )
  }
)
ChartLegendContent.displayName = "ChartLegend"

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}

\`\`\`

# src\components\ui\checkbox.tsx

\`\`\`tsx
import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }

\`\`\`

# src\components\ui\collapsible.tsx

\`\`\`tsx
import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

const Collapsible = CollapsiblePrimitive.Root

const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger

const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent

export { Collapsible, CollapsibleTrigger, CollapsibleContent }

\`\`\`

# src\components\ui\command.tsx

\`\`\`tsx
import * as React from "react"
import { type DialogProps } from "@radix-ui/react-dialog"
import { Command as CommandPrimitive } from "cmdk"
import { Search } from "lucide-react"

import { cn } from "@/lib/utils"
import { Dialog, DialogContent } from "@/components/ui/dialog"

const Command = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive>
>(({ className, ...props }, ref) => (
  <CommandPrimitive
    ref={ref}
    className={cn(
      "flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",
      className
    )}
    {...props}
  />
))
Command.displayName = CommandPrimitive.displayName

interface CommandDialogProps extends DialogProps {}

const CommandDialog = ({ children, ...props }: CommandDialogProps) => {
  return (
    <Dialog {...props}>
      <DialogContent className="overflow-hidden p-0 shadow-lg">
        <Command className="[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

const CommandInput = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Input>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
>(({ className, ...props }, ref) => (
  <div className="flex items-center border-b px-3" cmdk-input-wrapper="">
    <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
    <CommandPrimitive.Input
      ref={ref}
      className={cn(
        "flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    />
  </div>
))

CommandInput.displayName = CommandPrimitive.Input.displayName

const CommandList = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.List
    ref={ref}
    className={cn("max-h-[300px] overflow-y-auto overflow-x-hidden", className)}
    {...props}
  />
))

CommandList.displayName = CommandPrimitive.List.displayName

const CommandEmpty = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Empty>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>
>((props, ref) => (
  <CommandPrimitive.Empty
    ref={ref}
    className="py-6 text-center text-sm"
    {...props}
  />
))

CommandEmpty.displayName = CommandPrimitive.Empty.displayName

const CommandGroup = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Group>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Group
    ref={ref}
    className={cn(
      "overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",
      className
    )}
    {...props}
  />
))

CommandGroup.displayName = CommandPrimitive.Group.displayName

const CommandSeparator = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 h-px bg-border", className)}
    {...props}
  />
))
CommandSeparator.displayName = CommandPrimitive.Separator.displayName

const CommandItem = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",
      className
    )}
    {...props}
  />
))

CommandItem.displayName = CommandPrimitive.Item.displayName

const CommandShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
CommandShortcut.displayName = "CommandShortcut"

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}

\`\`\`

# src\components\ui\context-menu.tsx

\`\`\`tsx
import * as React from "react"
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const ContextMenu = ContextMenuPrimitive.Root

const ContextMenuTrigger = ContextMenuPrimitive.Trigger

const ContextMenuGroup = ContextMenuPrimitive.Group

const ContextMenuPortal = ContextMenuPrimitive.Portal

const ContextMenuSub = ContextMenuPrimitive.Sub

const ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup

const ContextMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <ContextMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </ContextMenuPrimitive.SubTrigger>
))
ContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName

const ContextMenuSubContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
ContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName

const ContextMenuContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Portal>
    <ContextMenuPrimitive.Content
      ref={ref}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </ContextMenuPrimitive.Portal>
))
ContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName

const ContextMenuItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName

const ContextMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <ContextMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.CheckboxItem>
))
ContextMenuCheckboxItem.displayName =
  ContextMenuPrimitive.CheckboxItem.displayName

const ContextMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <ContextMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.RadioItem>
))
ContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName

const ContextMenuLabel = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold text-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName

const ContextMenuSeparator = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-border", className)}
    {...props}
  />
))
ContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName

const ContextMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
ContextMenuShortcut.displayName = "ContextMenuShortcut"

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}

\`\`\`

# src\components\ui\dialog.tsx

\`\`\`tsx
import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}

\`\`\`

# src\components\ui\drawer.tsx

\`\`\`tsx
import * as React from "react"
import { Drawer as DrawerPrimitive } from "vaul"

import { cn } from "@/lib/utils"

const Drawer = ({
  shouldScaleBackground = true,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (
  <DrawerPrimitive.Root
    shouldScaleBackground={shouldScaleBackground}
    {...props}
  />
)
Drawer.displayName = "Drawer"

const DrawerTrigger = DrawerPrimitive.Trigger

const DrawerPortal = DrawerPrimitive.Portal

const DrawerClose = DrawerPrimitive.Close

const DrawerOverlay = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Overlay
    ref={ref}
    className={cn("fixed inset-0 z-50 bg-black/80", className)}
    {...props}
  />
))
DrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName

const DrawerContent = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DrawerPortal>
    <DrawerOverlay />
    <DrawerPrimitive.Content
      ref={ref}
      className={cn(
        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",
        className
      )}
      {...props}
    >
      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted" />
      {children}
    </DrawerPrimitive.Content>
  </DrawerPortal>
))
DrawerContent.displayName = "DrawerContent"

const DrawerHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}
    {...props}
  />
)
DrawerHeader.displayName = "DrawerHeader"

const DrawerFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("mt-auto flex flex-col gap-2 p-4", className)}
    {...props}
  />
)
DrawerFooter.displayName = "DrawerFooter"

const DrawerTitle = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DrawerTitle.displayName = DrawerPrimitive.Title.displayName

const DrawerDescription = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DrawerDescription.displayName = DrawerPrimitive.Description.displayName

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}

\`\`\`

# src\components\ui\dropdown-menu.tsx

\`\`\`tsx
import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const DropdownMenu = DropdownMenuPrimitive.Root

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger

const DropdownMenuGroup = DropdownMenuPrimitive.Group

const DropdownMenuPortal = DropdownMenuPrimitive.Portal

const DropdownMenuSub = DropdownMenuPrimitive.Sub

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </DropdownMenuPrimitive.SubTrigger>
))
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
))
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
))
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  )
}
DropdownMenuShortcut.displayName = "DropdownMenuShortcut"

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
}

\`\`\`

# src\components\ui\form.tsx

\`\`\`tsx
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  ControllerProps,
  FieldPath,
  FieldValues,
  FormProvider,
  useFormContext,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState, formState } = useFormContext()

  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn("space-y-2", className)} {...props} />
    </FormItemContext.Provider>
  )
})
FormItem.displayName = "FormItem"

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField()

  return (
    <Label
      ref={ref}
      className={cn(error && "text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
})
FormLabel.displayName = "FormLabel"

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
})
FormControl.displayName = "FormControl"

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField()

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn("text-sm text-muted-foreground", className)}
      {...props}
    />
  )
})
FormDescription.displayName = "FormDescription"

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message) : children

  if (!body) {
    return null
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn("text-sm font-medium text-destructive", className)}
      {...props}
    >
      {body}
    </p>
  )
})
FormMessage.displayName = "FormMessage"

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}

\`\`\`

# src\components\ui\hover-card.tsx

\`\`\`tsx
import * as React from "react"
import * as HoverCardPrimitive from "@radix-ui/react-hover-card"

import { cn } from "@/lib/utils"

const HoverCard = HoverCardPrimitive.Root

const HoverCardTrigger = HoverCardPrimitive.Trigger

const HoverCardContent = React.forwardRef<
  React.ElementRef<typeof HoverCardPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <HoverCardPrimitive.Content
    ref={ref}
    align={align}
    sideOffset={sideOffset}
    className={cn(
      "z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
HoverCardContent.displayName = HoverCardPrimitive.Content.displayName

export { HoverCard, HoverCardTrigger, HoverCardContent }

\`\`\`

# src\components\ui\input-otp.tsx

\`\`\`tsx
import * as React from "react"
import { OTPInput, OTPInputContext } from "input-otp"
import { Dot } from "lucide-react"

import { cn } from "@/lib/utils"

const InputOTP = React.forwardRef<
  React.ElementRef<typeof OTPInput>,
  React.ComponentPropsWithoutRef<typeof OTPInput>
>(({ className, containerClassName, ...props }, ref) => (
  <OTPInput
    ref={ref}
    containerClassName={cn(
      "flex items-center gap-2 has-[:disabled]:opacity-50",
      containerClassName
    )}
    className={cn("disabled:cursor-not-allowed", className)}
    {...props}
  />
))
InputOTP.displayName = "InputOTP"

const InputOTPGroup = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("flex items-center", className)} {...props} />
))
InputOTPGroup.displayName = "InputOTPGroup"

const InputOTPSlot = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div"> & { index: number }
>(({ index, className, ...props }, ref) => {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]

  return (
    <div
      ref={ref}
      className={cn(
        "relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",
        isActive && "z-10 ring-2 ring-ring ring-offset-background",
        className
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="h-4 w-px animate-caret-blink bg-foreground duration-1000" />
        </div>
      )}
    </div>
  )
})
InputOTPSlot.displayName = "InputOTPSlot"

const InputOTPSeparator = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ ...props }, ref) => (
  <div ref={ref} role="separator" {...props}>
    <Dot />
  </div>
))
InputOTPSeparator.displayName = "InputOTPSeparator"

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }

\`\`\`

# src\components\ui\input.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }

\`\`\`

# src\components\ui\label.tsx

\`\`\`tsx
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }

\`\`\`

# src\components\ui\menubar.tsx

\`\`\`tsx
import * as React from "react"
import * as MenubarPrimitive from "@radix-ui/react-menubar"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const MenubarMenu = MenubarPrimitive.Menu

const MenubarGroup = MenubarPrimitive.Group

const MenubarPortal = MenubarPrimitive.Portal

const MenubarSub = MenubarPrimitive.Sub

const MenubarRadioGroup = MenubarPrimitive.RadioGroup

const Menubar = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Root
    ref={ref}
    className={cn(
      "flex h-10 items-center space-x-1 rounded-md border bg-background p-1",
      className
    )}
    {...props}
  />
))
Menubar.displayName = MenubarPrimitive.Root.displayName

const MenubarTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      className
    )}
    {...props}
  />
))
MenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName

const MenubarSubTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <MenubarPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </MenubarPrimitive.SubTrigger>
))
MenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName

const MenubarSubContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
MenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName

const MenubarContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>
>(
  (
    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },
    ref
  ) => (
    <MenubarPrimitive.Portal>
      <MenubarPrimitive.Content
        ref={ref}
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
          className
        )}
        {...props}
      />
    </MenubarPrimitive.Portal>
  )
)
MenubarContent.displayName = MenubarPrimitive.Content.displayName

const MenubarItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarItem.displayName = MenubarPrimitive.Item.displayName

const MenubarCheckboxItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <MenubarPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.CheckboxItem>
))
MenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName

const MenubarRadioItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <MenubarPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.RadioItem>
))
MenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName

const MenubarLabel = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarLabel.displayName = MenubarPrimitive.Label.displayName

const MenubarSeparator = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
MenubarSeparator.displayName = MenubarPrimitive.Separator.displayName

const MenubarShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
MenubarShortcut.displayname = "MenubarShortcut"

export {
  Menubar,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarItem,
  MenubarSeparator,
  MenubarLabel,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarPortal,
  MenubarSubContent,
  MenubarSubTrigger,
  MenubarGroup,
  MenubarSub,
  MenubarShortcut,
}

\`\`\`

# src\components\ui\navigation-menu.tsx

\`\`\`tsx
import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const NavigationMenu = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Root
    ref={ref}
    className={cn(
      "relative z-10 flex max-w-max flex-1 items-center justify-center",
      className
    )}
    {...props}
  >
    {children}
    <NavigationMenuViewport />
  </NavigationMenuPrimitive.Root>
))
NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName

const NavigationMenuList = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.List
    ref={ref}
    className={cn(
      "group flex flex-1 list-none items-center justify-center space-x-1",
      className
    )}
    {...props}
  />
))
NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName

const NavigationMenuItem = NavigationMenuPrimitive.Item

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50"
)

const NavigationMenuTrigger = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Trigger
    ref={ref}
    className={cn(navigationMenuTriggerStyle(), "group", className)}
    {...props}
  >
    {children}{" "}
    <ChevronDown
      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"
      aria-hidden="true"
    />
  </NavigationMenuPrimitive.Trigger>
))
NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName

const NavigationMenuContent = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Content
    ref={ref}
    className={cn(
      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",
      className
    )}
    {...props}
  />
))
NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName

const NavigationMenuLink = NavigationMenuPrimitive.Link

const NavigationMenuViewport = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
>(({ className, ...props }, ref) => (
  <div className={cn("absolute left-0 top-full flex justify-center")}>
    <NavigationMenuPrimitive.Viewport
      className={cn(
        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",
        className
      )}
      ref={ref}
      {...props}
    />
  </div>
))
NavigationMenuViewport.displayName =
  NavigationMenuPrimitive.Viewport.displayName

const NavigationMenuIndicator = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Indicator
    ref={ref}
    className={cn(
      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",
      className
    )}
    {...props}
  >
    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md" />
  </NavigationMenuPrimitive.Indicator>
))
NavigationMenuIndicator.displayName =
  NavigationMenuPrimitive.Indicator.displayName

export {
  navigationMenuTriggerStyle,
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
}

\`\`\`

# src\components\ui\pagination.tsx

\`\`\`tsx
import * as React from "react"
import { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"
import { ButtonProps, buttonVariants } from "@/components/ui/button"

const Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn("mx-auto flex w-full justify-center", className)}
    {...props}
  />
)
Pagination.displayName = "Pagination"

const PaginationContent = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    className={cn("flex flex-row items-center gap-1", className)}
    {...props}
  />
))
PaginationContent.displayName = "PaginationContent"

const PaginationItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li ref={ref} className={cn("", className)} {...props} />
))
PaginationItem.displayName = "PaginationItem"

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<ButtonProps, "size"> &
  React.ComponentProps<"a">

const PaginationLink = ({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) => (
  <a
    aria-current={isActive ? "page" : undefined}
    className={cn(
      buttonVariants({
        variant: isActive ? "outline" : "ghost",
        size,
      }),
      className
    )}
    {...props}
  />
)
PaginationLink.displayName = "PaginationLink"

const PaginationPrevious = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to previous page"
    size="default"
    className={cn("gap-1 pl-2.5", className)}
    {...props}
  >
    <ChevronLeft className="h-4 w-4" />
    <span>Previous</span>
  </PaginationLink>
)
PaginationPrevious.displayName = "PaginationPrevious"

const PaginationNext = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to next page"
    size="default"
    className={cn("gap-1 pr-2.5", className)}
    {...props}
  >
    <span>Next</span>
    <ChevronRight className="h-4 w-4" />
  </PaginationLink>
)
PaginationNext.displayName = "PaginationNext"

const PaginationEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    aria-hidden
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More pages</span>
  </span>
)
PaginationEllipsis.displayName = "PaginationEllipsis"

export {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
}

\`\`\`

# src\components\ui\popover.tsx

\`\`\`tsx
import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

const Popover = PopoverPrimitive.Root

const PopoverTrigger = PopoverPrimitive.Trigger

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
))
PopoverContent.displayName = PopoverPrimitive.Content.displayName

export { Popover, PopoverTrigger, PopoverContent }

\`\`\`

# src\components\ui\progress.tsx

\`\`\`tsx

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

interface ProgressProps extends React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root> {
  indicatorClassName?: string;
}

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  ProgressProps
>(({ className, value, indicatorClassName, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-4 w-full overflow-hidden rounded-full bg-secondary",
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className={cn(
        "h-full w-full flex-1 bg-primary transition-all",
        indicatorClassName
      )}
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }

\`\`\`

# src\components\ui\radio-group.tsx

\`\`\`tsx
import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Root
      className={cn("grid gap-2", className)}
      {...props}
      ref={ref}
    />
  )
})
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
})
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName

export { RadioGroup, RadioGroupItem }

\`\`\`

# src\components\ui\resizable.tsx

\`\`\`tsx
import { GripVertical } from "lucide-react"
import * as ResizablePrimitive from "react-resizable-panels"

import { cn } from "@/lib/utils"

const ResizablePanelGroup = ({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (
  <ResizablePrimitive.PanelGroup
    className={cn(
      "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
      className
    )}
    {...props}
  />
)

const ResizablePanel = ResizablePrimitive.Panel

const ResizableHandle = ({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) => (
  <ResizablePrimitive.PanelResizeHandle
    className={cn(
      "relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
      className
    )}
    {...props}
  >
    {withHandle && (
      <div className="z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border">
        <GripVertical className="h-2.5 w-2.5" />
      </div>
    )}
  </ResizablePrimitive.PanelResizeHandle>
)

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }

\`\`\`

# src\components\ui\scroll-area.tsx

\`\`\`tsx
import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root
    ref={ref}
    className={cn("relative overflow-hidden", className)}
    {...props}
  >
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">
      {children}
    </ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
))
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName

const ScrollBar = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
>(({ className, orientation = "vertical", ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      "flex touch-none select-none transition-colors",
      orientation === "vertical" &&
        "h-full w-2.5 border-l border-l-transparent p-[1px]",
      orientation === "horizontal" &&
        "h-2.5 flex-col border-t border-t-transparent p-[1px]",
      className
    )}
    {...props}
  >
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
))
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName

export { ScrollArea, ScrollBar }

\`\`\`

# src\components\ui\select.tsx

\`\`\`tsx
import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}

\`\`\`

# src\components\ui\separator.tsx

\`\`\`tsx
import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }

\`\`\`

# src\components\ui\sheet.tsx

\`\`\`tsx
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"
import * as React from "react"

import { cn } from "@/lib/utils"

const Sheet = SheetPrimitive.Root

const SheetTrigger = SheetPrimitive.Trigger

const SheetClose = SheetPrimitive.Close

const SheetPortal = SheetPrimitive.Portal

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName

const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom:
          "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right:
          "inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
)

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
  VariantProps<typeof sheetVariants> { }

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(({ side = "right", className, children, ...props }, ref) => (
  <SheetPortal>
    <SheetOverlay />
    <SheetPrimitive.Content
      ref={ref}
      className={cn(sheetVariants({ side }), className)}
      {...props}
    >
      {children}
      <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </SheetPrimitive.Close>
    </SheetPrimitive.Content>
  </SheetPortal>
))
SheetContent.displayName = SheetPrimitive.Content.displayName

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
SheetHeader.displayName = "SheetHeader"

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
SheetFooter.displayName = "SheetFooter"

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold text-foreground", className)}
    {...props}
  />
))
SheetTitle.displayName = SheetPrimitive.Title.displayName

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
SheetDescription.displayName = SheetPrimitive.Description.displayName

export {
  Sheet, SheetClose,
  SheetContent, SheetDescription, SheetFooter, SheetHeader, SheetOverlay, SheetPortal, SheetTitle, SheetTrigger
}


\`\`\`

# src\components\ui\sidebar.tsx

\`\`\`tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { VariantProps, cva } from "class-variance-authority"
import { PanelLeft } from "lucide-react"

import { useIsMobile } from "@/hooks/use-mobile"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Separator } from "@/components/ui/separator"
import { Sheet, SheetContent } from "@/components/ui/sheet"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip"

const SIDEBAR_COOKIE_NAME = "sidebar:state"
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = "16rem"
const SIDEBAR_WIDTH_MOBILE = "18rem"
const SIDEBAR_WIDTH_ICON = "3rem"
const SIDEBAR_KEYBOARD_SHORTCUT = "b"

type SidebarContext = {
  state: "expanded" | "collapsed"
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContext | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.")
  }

  return context
}

const SidebarProvider = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    defaultOpen?: boolean
    open?: boolean
    onOpenChange?: (open: boolean) => void
  }
>(
  (
    {
      defaultOpen = true,
      open: openProp,
      onOpenChange: setOpenProp,
      className,
      style,
      children,
      ...props
    },
    ref
  ) => {
    const isMobile = useIsMobile()
    const [openMobile, setOpenMobile] = React.useState(false)

    // This is the internal state of the sidebar.
    // We use openProp and setOpenProp for control from outside the component.
    const [_open, _setOpen] = React.useState(defaultOpen)
    const open = openProp ?? _open
    const setOpen = React.useCallback(
      (value: boolean | ((value: boolean) => boolean)) => {
        const openState = typeof value === "function" ? value(open) : value
        if (setOpenProp) {
          setOpenProp(openState)
        } else {
          _setOpen(openState)
        }

        // This sets the cookie to keep the sidebar state.
        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
      },
      [setOpenProp, open]
    )

    // Helper to toggle the sidebar.
    const toggleSidebar = React.useCallback(() => {
      return isMobile
        ? setOpenMobile((open) => !open)
        : setOpen((open) => !open)
    }, [isMobile, setOpen, setOpenMobile])

    // Adds a keyboard shortcut to toggle the sidebar.
    React.useEffect(() => {
      const handleKeyDown = (event: KeyboardEvent) => {
        if (
          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
          (event.metaKey || event.ctrlKey)
        ) {
          event.preventDefault()
          toggleSidebar()
        }
      }

      window.addEventListener("keydown", handleKeyDown)
      return () => window.removeEventListener("keydown", handleKeyDown)
    }, [toggleSidebar])

    // We add a state so that we can do data-state="expanded" or "collapsed".
    // This makes it easier to style the sidebar with Tailwind classes.
    const state = open ? "expanded" : "collapsed"

    const contextValue = React.useMemo<SidebarContext>(
      () => ({
        state,
        open,
        setOpen,
        isMobile,
        openMobile,
        setOpenMobile,
        toggleSidebar,
      }),
      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]
    )

    return (
      <SidebarContext.Provider value={contextValue}>
        <TooltipProvider delayDuration={0}>
          <div
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH,
                "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
                ...style,
              } as React.CSSProperties
            }
            className={cn(
              "group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",
              className
            )}
            ref={ref}
            {...props}
          >
            {children}
          </div>
        </TooltipProvider>
      </SidebarContext.Provider>
    )
  }
)
SidebarProvider.displayName = "SidebarProvider"

const Sidebar = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    side?: "left" | "right"
    variant?: "sidebar" | "floating" | "inset"
    collapsible?: "offcanvas" | "icon" | "none"
  }
>(
  (
    {
      side = "left",
      variant = "sidebar",
      collapsible = "offcanvas",
      className,
      children,
      ...props
    },
    ref
  ) => {
    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

    if (collapsible === "none") {
      return (
        <div
          className={cn(
            "flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",
            className
          )}
          ref={ref}
          {...props}
        >
          {children}
        </div>
      )
    }

    if (isMobile) {
      return (
        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
          <SheetContent
            data-sidebar="sidebar"
            data-mobile="true"
            className="w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden"
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
              } as React.CSSProperties
            }
            side={side}
          >
            <div className="flex h-full w-full flex-col">{children}</div>
          </SheetContent>
        </Sheet>
      )
    }

    return (
      <div
        ref={ref}
        className="group peer hidden md:block text-sidebar-foreground"
        data-state={state}
        data-collapsible={state === "collapsed" ? collapsible : ""}
        data-variant={variant}
        data-side={side}
      >
        {/* This is what handles the sidebar gap on desktop */}
        <div
          className={cn(
            "duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear",
            "group-data-[collapsible=offcanvas]:w-0",
            "group-data-[side=right]:rotate-180",
            variant === "floating" || variant === "inset"
              ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon]"
          )}
        />
        <div
          className={cn(
            "duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",
            side === "left"
              ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
              : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
            // Adjust the padding for floating and inset variants.
            variant === "floating" || variant === "inset"
              ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",
            className
          )}
          {...props}
        >
          <div
            data-sidebar="sidebar"
            className="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"
          >
            {children}
          </div>
        </div>
      </div>
    )
  }
)
Sidebar.displayName = "Sidebar"

const SidebarTrigger = React.forwardRef<
  React.ElementRef<typeof Button>,
  React.ComponentProps<typeof Button>
>(({ className, onClick, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      ref={ref}
      data-sidebar="trigger"
      variant="ghost"
      size="icon"
      className={cn("h-7 w-7", className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeft />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
})
SidebarTrigger.displayName = "SidebarTrigger"

const SidebarRail = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button">
>(({ className, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      ref={ref}
      data-sidebar="rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex",
        "[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className
      )}
      {...props}
    />
  )
})
SidebarRail.displayName = "SidebarRail"

const SidebarInset = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"main">
>(({ className, ...props }, ref) => {
  return (
    <main
      ref={ref}
      className={cn(
        "relative flex min-h-svh flex-1 flex-col bg-background",
        "peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",
        className
      )}
      {...props}
    />
  )
})
SidebarInset.displayName = "SidebarInset"

const SidebarInput = React.forwardRef<
  React.ElementRef<typeof Input>,
  React.ComponentProps<typeof Input>
>(({ className, ...props }, ref) => {
  return (
    <Input
      ref={ref}
      data-sidebar="input"
      className={cn(
        "h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",
        className
      )}
      {...props}
    />
  )
})
SidebarInput.displayName = "SidebarInput"

const SidebarHeader = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarHeader.displayName = "SidebarHeader"

const SidebarFooter = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarFooter.displayName = "SidebarFooter"

const SidebarSeparator = React.forwardRef<
  React.ElementRef<typeof Separator>,
  React.ComponentProps<typeof Separator>
>(({ className, ...props }, ref) => {
  return (
    <Separator
      ref={ref}
      data-sidebar="separator"
      className={cn("mx-2 w-auto bg-sidebar-border", className)}
      {...props}
    />
  )
})
SidebarSeparator.displayName = "SidebarSeparator"

const SidebarContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarContent.displayName = "SidebarContent"

const SidebarGroup = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  )
})
SidebarGroup.displayName = "SidebarGroup"

const SidebarGroupLabel = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "div"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-label"
      className={cn(
        "duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupLabel.displayName = "SidebarGroupLabel"

const SidebarGroupAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-action"
      className={cn(
        "absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupAction.displayName = "SidebarGroupAction"

const SidebarGroupContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="group-content"
    className={cn("w-full text-sm", className)}
    {...props}
  />
))
SidebarGroupContent.displayName = "SidebarGroupContent"

const SidebarMenu = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu"
    className={cn("flex w-full min-w-0 flex-col gap-1", className)}
    {...props}
  />
))
SidebarMenu.displayName = "SidebarMenu"

const SidebarMenuItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    data-sidebar="menu-item"
    className={cn("group/menu-item relative", className)}
    {...props}
  />
))
SidebarMenuItem.displayName = "SidebarMenuItem"

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:!p-0",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const SidebarMenuButton = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    isActive?: boolean
    tooltip?: string | React.ComponentProps<typeof TooltipContent>
  } & VariantProps<typeof sidebarMenuButtonVariants>
>(
  (
    {
      asChild = false,
      isActive = false,
      variant = "default",
      size = "default",
      tooltip,
      className,
      ...props
    },
    ref
  ) => {
    const Comp = asChild ? Slot : "button"
    const { isMobile, state } = useSidebar()

    const button = (
      <Comp
        ref={ref}
        data-sidebar="menu-button"
        data-size={size}
        data-active={isActive}
        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
        {...props}
      />
    )

    if (!tooltip) {
      return button
    }

    if (typeof tooltip === "string") {
      tooltip = {
        children: tooltip,
      }
    }

    return (
      <Tooltip>
        <TooltipTrigger asChild>{button}</TooltipTrigger>
        <TooltipContent
          side="right"
          align="center"
          hidden={state !== "collapsed" || isMobile}
          {...tooltip}
        />
      </Tooltip>
    )
  }
)
SidebarMenuButton.displayName = "SidebarMenuButton"

const SidebarMenuAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    showOnHover?: boolean
  }
>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-action"
      className={cn(
        "absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuAction.displayName = "SidebarMenuAction"

const SidebarMenuBadge = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="menu-badge"
    className={cn(
      "absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none",
      "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
      "peer-data-[size=sm]/menu-button:top-1",
      "peer-data-[size=default]/menu-button:top-1.5",
      "peer-data-[size=lg]/menu-button:top-2.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuBadge.displayName = "SidebarMenuBadge"

const SidebarMenuSkeleton = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    showIcon?: boolean
  }
>(({ className, showIcon = false, ...props }, ref) => {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      ref={ref}
      data-sidebar="menu-skeleton"
      className={cn("rounded-md h-8 flex gap-2 px-2 items-center", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 flex-1 max-w-[--skeleton-width]"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  )
})
SidebarMenuSkeleton.displayName = "SidebarMenuSkeleton"

const SidebarMenuSub = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu-sub"
    className={cn(
      "mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuSub.displayName = "SidebarMenuSub"

const SidebarMenuSubItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ ...props }, ref) => <li ref={ref} {...props} />)
SidebarMenuSubItem.displayName = "SidebarMenuSubItem"

const SidebarMenuSubButton = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentProps<"a"> & {
    asChild?: boolean
    size?: "sm" | "md"
    isActive?: boolean
  }
>(({ asChild = false, size = "md", isActive, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuSubButton.displayName = "SidebarMenuSubButton"

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}

\`\`\`

# src\components\ui\skeleton.tsx

\`\`\`tsx
import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      {...props}
    />
  )
}

export { Skeleton }

\`\`\`

# src\components\ui\slider.tsx

\`\`\`tsx
import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

const Slider = React.forwardRef<
  React.ElementRef<typeof SliderPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
>(({ className, ...props }, ref) => (
  <SliderPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex w-full touch-none select-none items-center",
      className
    )}
    {...props}
  >
    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-secondary">
      <SliderPrimitive.Range className="absolute h-full bg-primary" />
    </SliderPrimitive.Track>
    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
  </SliderPrimitive.Root>
))
Slider.displayName = SliderPrimitive.Root.displayName

export { Slider }

\`\`\`

# src\components\ui\sonner.tsx

\`\`\`tsx
import { useTheme } from "next-themes"
import { Toaster as Sonner, toast } from "sonner"

type ToasterProps = React.ComponentProps<typeof Sonner>

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      toastOptions={{
        classNames: {
          toast:
            "group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",
          description: "group-[.toast]:text-muted-foreground",
          actionButton:
            "group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",
          cancelButton:
            "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",
        },
      }}
      {...props}
    />
  )
}

export { Toaster, toast }

\`\`\`

# src\components\ui\switch.tsx

\`\`\`tsx
import * as React from "react"
import * as SwitchPrimitives from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

const Switch = React.forwardRef<
  React.ElementRef<typeof SwitchPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
>(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
      className
    )}
    {...props}
    ref={ref}
  >
    <SwitchPrimitives.Thumb
      className={cn(
        "pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"
      )}
    />
  </SwitchPrimitives.Root>
))
Switch.displayName = SwitchPrimitives.Root.displayName

export { Switch }

\`\`\`

# src\components\ui\table.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props}
    />
  </div>
))
Table.displayName = "Table"

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
))
TableHeader.displayName = "TableHeader"

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props}
  />
))
TableBody.displayName = "TableBody"

const TableFooter = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn(
      "border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",
      className
    )}
    {...props}
  />
))
TableFooter.displayName = "TableFooter"

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    )}
    {...props}
  />
))
TableRow.displayName = "TableRow"

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
      className
    )}
    {...props}
  />
))
TableHead.displayName = "TableHead"

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}
    {...props}
  />
))
TableCell.displayName = "TableCell"

const TableCaption = React.forwardRef<
  HTMLTableCaptionElement,
  React.HTMLAttributes<HTMLTableCaptionElement>
>(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn("mt-4 text-sm text-muted-foreground", className)}
    {...props}
  />
))
TableCaption.displayName = "TableCaption"

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}

\`\`\`

# src\components\ui\tabs.tsx

\`\`\`tsx
import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }

\`\`\`

# src\components\ui\textarea.tsx

\`\`\`tsx
import * as React from "react"

import { cn } from "@/lib/utils"

export interface TextareaProps
  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}

const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, ...props }, ref) => {
    return (
      <textarea
        className={cn(
          "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Textarea.displayName = "Textarea"

export { Textarea }

\`\`\`

# src\components\ui\toast.tsx

\`\`\`tsx
import * as React from "react"
import * as ToastPrimitives from "@radix-ui/react-toast"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
      className
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
  {
    variants: {
      variant: {
        default: "border bg-background text-foreground",
        destructive:
          "destructive group border-destructive bg-destructive text-destructive-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
      className
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      "absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
      className
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn("text-sm font-semibold", className)}
    {...props}
  />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn("text-sm opacity-90", className)}
    {...props}
  />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}

\`\`\`

# src\components\ui\toaster.tsx

\`\`\`tsx
import { useToast } from "@/hooks/use-toast"
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from "@/components/ui/toast"

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}

\`\`\`

# src\components\ui\toggle-group.tsx

\`\`\`tsx
import * as React from "react"
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"
import { type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { toggleVariants } from "@/components/ui/toggle"

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
})

const ToggleGroup = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, children, ...props }, ref) => (
  <ToggleGroupPrimitive.Root
    ref={ref}
    className={cn("flex items-center justify-center gap-1", className)}
    {...props}
  >
    <ToggleGroupContext.Provider value={{ variant, size }}>
      {children}
    </ToggleGroupContext.Provider>
  </ToggleGroupPrimitive.Root>
))

ToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName

const ToggleGroupItem = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &
    VariantProps<typeof toggleVariants>
>(({ className, children, variant, size, ...props }, ref) => {
  const context = React.useContext(ToggleGroupContext)

  return (
    <ToggleGroupPrimitive.Item
      ref={ref}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        className
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  )
})

ToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName

export { ToggleGroup, ToggleGroupItem }

\`\`\`

# src\components\ui\toggle.tsx

\`\`\`tsx
import * as React from "react"
import * as TogglePrimitive from "@radix-ui/react-toggle"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const toggleVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-10 px-3",
        sm: "h-9 px-2.5",
        lg: "h-11 px-5",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const Toggle = React.forwardRef<
  React.ElementRef<typeof TogglePrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, ...props }, ref) => (
  <TogglePrimitive.Root
    ref={ref}
    className={cn(toggleVariants({ variant, size, className }))}
    {...props}
  />
))

Toggle.displayName = TogglePrimitive.Root.displayName

export { Toggle, toggleVariants }

\`\`\`

# src\components\ui\tooltip.tsx

\`\`\`tsx
import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }

\`\`\`

# src\components\ui\use-toast.ts

\`\`\`ts
import { useToast, toast } from "@/hooks/use-toast";

export { useToast, toast };

\`\`\`

# src\hooks\use-mobile.tsx

\`\`\`tsx
import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}

\`\`\`

# src\hooks\use-toast.ts

\`\`\`ts
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }

\`\`\`

# src\index.css

\`\`\`css

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 240 10% 14%;

    --card: 0 0% 100%;
    --card-foreground: 240 10% 14%;

    --popover: 0 0% 100%;
    --popover-foreground: 240 10% 14%;

    --primary: 52 100% 50%;
    --primary-foreground: 0 0% 0%;

    --secondary: 0 0% 96%;
    --secondary-foreground: 240 10% 14%;

    --muted: 240 5% 96%;
    --muted-foreground: 240 3.8% 46.1%;

    --accent: 0 0% 96%;
    --accent-foreground: 240 10% 14%;

    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 100%;

    --border: 240 5.9% 90%;
    --input: 240 5.9% 90%;
    --ring: 52 100% 50%;

    --radius: 0.5rem;

    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }

  .dark {
    --background: 0 0% 28%; /* #474747 - Outer Space */
    --foreground: 0 0% 98%;

    --card: 0 0% 28%;
    --card-foreground: 0 0% 98%;

    --popover: 0 0% 28%;
    --popover-foreground: 0 0% 98%;

    --primary: 52 100% 50%;
    --primary-foreground: 0 0% 0%;

    --secondary: 240 3.7% 15.9%;
    --secondary-foreground: 0 0% 98%;

    --muted: 240 3.7% 15.9%;
    --muted-foreground: 240 5% 64.9%;

    --accent: 240 3.7% 15.9%;
    --accent-foreground: 0 0% 98%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;

    --border: 240 3.7% 15.9%;
    --input: 240 3.7% 15.9%;
    --ring: 52 100% 50%;
    
    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
  }
  
  /* Apply dark mode universally to ensure all elements get the dark background */
  .dark body,
  .dark .bg-white {
    @apply bg-[#474747];
  }
  
  /* Make buttons yellow with black text in dark mode - fixed to avoid circular dependency */
  .dark button[data-state="active"] {
    background-color: #FFE600;
    color: black;
  }
  
  .dark .bg-yellow-400 {
    background-color: #FFE600;
    color: black;
  }
  
  /* Ensure yellow backgrounds always use black text for contrast */
  .bg-yellow-50, 
  .bg-yellow-100, 
  .bg-yellow-200, 
  .bg-yellow-300, 
  .bg-yellow-400, 
  .bg-yellow-500 {
    color: black;
  }
}

@layer components {
  .ey-button {
    @apply bg-ey-yellow hover:bg-ey-yellow/90 text-ey-black font-semibold py-2 px-4 rounded-md transition-colors;
  }
  
  .ey-input {
    @apply border border-ey-gray-400 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-ey-yellow;
  }

  .ey-card {
    @apply bg-white rounded-lg shadow-md p-6 border border-ey-gray-300 hover:shadow-lg transition-shadow dark:bg-background dark:border-ey-gray-700;
  }
}

\`\`\`

# src\lib\excelUtils.ts

\`\`\`ts

import * as XLSX from 'xlsx';
import { PromptOption } from './types';

// Parse Excel file and extract prompts
export const parseExcelPrompts = async (file: File): Promise<PromptOption[]> => {
  try {
    // Read the Excel file
    const data = await file.arrayBuffer();
    const workbook = XLSX.read(data);
    
    // Get the first worksheet
    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
    
    // Convert the worksheet to JSON
    const jsonData = XLSX.utils.sheet_to_json(worksheet);
    
    // Map the JSON data to PromptOption format
    const prompts: PromptOption[] = jsonData.map((row: any, index) => {
      return {
        id: `custom-${index}`,
        name: row['Prompt Name'] || row['Name'] || `Custom Prompt ${index + 1}`,
        description: row['Description'] || 'Custom prompt from Excel file',
        template: row['Template'] || 'Custom_Template',
        category: row['Category'] || 'Custom'
      };
    });
    
    return prompts;
  } catch (error) {
    console.error('Error parsing Excel file:', error);
    throw new Error('Failed to parse Excel file. Please check the format.');
  }
};

// Generate more realistic extraction results based on prompts
export const generateRealisticResults = (promptName: string) => {
  // Create more realistic data based on prompt name/type
  switch (promptName.toLowerCase()) {
    case 'ecl by stage':
      return [
        { Category: "ECL by Stage", Stage: "Stage 1", Field: "Gross Carrying Amount", Value: "$1,245.67m" },
        { Category: "ECL by Stage", Stage: "Stage 1", Field: "Loss Allowance", Value: "$12.45m" },
        { Category: "ECL by Stage", Stage: "Stage 1", Field: "Coverage Ratio", Value: "1.00%" },
        { Category: "ECL by Stage", Stage: "Stage 2", Field: "Gross Carrying Amount", Value: "$428.91m" },
        { Category: "ECL by Stage", Stage: "Stage 2", Field: "Loss Allowance", Value: "$21.45m" },
        { Category: "ECL by Stage", Stage: "Stage 2", Field: "Coverage Ratio", Value: "5.00%" },
        { Category: "ECL by Stage", Stage: "Stage 3", Field: "Gross Carrying Amount", Value: "$85.34m" },
        { Category: "ECL by Stage", Stage: "Stage 3", Field: "Loss Allowance", Value: "$42.67m" },
        { Category: "ECL by Stage", Stage: "Stage 3", Field: "Coverage Ratio", Value: "50.00%" }
      ];
    case 'management adjustments':
      return [
        { Category: "Management Adjustments", Stage: "N/A", Field: "Economic Uncertainty", Value: "$24.5m" },
        { Category: "Management Adjustments", Stage: "N/A", Field: "Model Limitations", Value: "$12.3m" },
        { Category: "Management Adjustments", Stage: "N/A", Field: "Other Adjustments", Value: "$5.8m" },
        { Category: "Management Adjustments", Stage: "N/A", Field: "Total Overlays", Value: "$42.6m" }
      ];
    case 'scenario weights':
      return [
        { Category: "Scenario Weights", Stage: "N/A", Field: "Baseline", Value: "40%" },
        { Category: "Scenario Weights", Stage: "N/A", Field: "Upside", Value: "30%" },
        { Category: "Scenario Weights", Stage: "N/A", Field: "Downside", Value: "30%" }
      ];
    case 'macro variables':
      return [
        { Category: "Macro Variables", Stage: "Baseline", Field: "GDP Growth", Value: "1.3%" },
        { Category: "Macro Variables", Stage: "Baseline", Field: "Unemployment", Value: "4.2%" },
        { Category: "Macro Variables", Stage: "Baseline", Field: "HPI Growth", Value: "1.8%" },
        { Category: "Macro Variables", Stage: "Upside", Field: "GDP Growth", Value: "2.5%" },
        { Category: "Macro Variables", Stage: "Upside", Field: "Unemployment", Value: "3.7%" },
        { Category: "Macro Variables", Stage: "Upside", Field: "HPI Growth", Value: "3.2%" },
        { Category: "Macro Variables", Stage: "Downside", Field: "GDP Growth", Value: "-0.5%" },
        { Category: "Macro Variables", Stage: "Downside", Field: "Unemployment", Value: "5.8%" },
        { Category: "Macro Variables", Stage: "Downside", Field: "HPI Growth", Value: "-2.1%" }
      ];
    default:
      return [
        { Category: promptName, Stage: "N/A", Field: "Value 1", Value: "$123.45m" },
        { Category: promptName, Stage: "N/A", Field: "Value 2", Value: "$67.89m" },
        { Category: promptName, Stage: "N/A", Field: "Ratio", Value: "55.00%" }
      ];
  }
};

\`\`\`

# src\lib\types.ts

\`\`\`ts

// Types for the financial data extraction app

export interface UploadedFile {
  id: string;
  name: string;
  size: number;
  type: string;
  lastModified: number;
  status: 'pending' | 'processing' | 'success' | 'error';
  progress?: number;
}

export interface PromptOption {
  id: string;
  name: string;
  description: string;
  template: string;
  category: string;
}

export interface ExtractedData {
  Category: string;
  Stage: string;
  Field: string;
  Value: string;
}

export interface ProcessingResult {
  id: string;
  fileId: string;
  fileName: string;
  promptId: string;
  promptName: string;
  status: 'pending' | 'processing' | 'success' | 'error';
  timestamp: string;
  data?: ExtractedData[];
  notes?: string;
  error?: string;
}

// Mock data for default prompts
export const DEFAULT_PROMPTS: PromptOption[] = [
  {
    id: 'ecl-by-stage',
    name: 'ECL By Stage',
    description: 'Extract Expected Credit Loss data broken down by stages',
    template: 'ECL_By_Stage',
    category: 'Credit Risk'
  },
  {
    id: 'management-adjustments',
    name: 'Management Adjustments',
    description: 'Extract information about management adjustments to ECL',
    template: 'Management_Adjustments',
    category: 'Credit Risk'
  },
  {
    id: 'scenario-weights',
    name: 'Scenario Weights',
    description: 'Extract economic scenario weightings',
    template: 'Scenario_Weights',
    category: 'Economic Scenarios'
  },
  {
    id: 'macro-variables',
    name: 'Macro Variables',
    description: 'Extract macroeconomic variables used in models',
    template: 'Macro_Variables',
    category: 'Economic Scenarios'
  },
  {
    id: 'credit-quality',
    name: 'Credit Quality',
    description: 'Extract credit quality indicators',
    template: 'Credit_Quality',
    category: 'Credit Risk'
  },
  {
    id: 'loan-loss-rate',
    name: 'Loan Loss Rate',
    description: 'Extract loan loss rate data',
    template: 'Loan_Loss_Rate',
    category: 'Credit Risk'
  },
  {
    id: 'staging-criteria',
    name: 'Staging Criteria',
    description: 'Extract criteria used for staging classification',
    template: 'Staging_Criteria',
    category: 'Methodology'
  },
  {
    id: 'sensitivity-analysis',
    name: 'Sensitivity Analysis',
    description: 'Extract sensitivity analysis results',
    template: 'Sensitivity_Analysis',
    category: 'Economic Scenarios'
  }
];

// Mock data for extracted results (for UI demonstration)
export const MOCK_EXTRACTED_DATA: ExtractedData[] = [
  { Category: 'ECL', Stage: 'Stage 1', Field: 'Retail Loans', Value: '125,000,000' },
  { Category: 'ECL', Stage: 'Stage 1', Field: 'Corporate Loans', Value: '372,500,000' },
  { Category: 'ECL', Stage: 'Stage 2', Field: 'Retail Loans', Value: '89,300,000' },
  { Category: 'ECL', Stage: 'Stage 2', Field: 'Corporate Loans', Value: '246,800,000' },
  { Category: 'ECL', Stage: 'Stage 3', Field: 'Retail Loans', Value: '43,200,000' },
  { Category: 'ECL', Stage: 'Stage 3', Field: 'Corporate Loans', Value: '118,500,000' },
  { Category: 'Summary', Stage: 'N/A', Field: 'Total ECL', Value: '995,300,000' },
  { Category: 'Summary', Stage: 'N/A', Field: 'Coverage Ratio', Value: '2.3%' }
];

\`\`\`

# src\lib\utils.ts

\`\`\`ts

import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

/**
 * Ensures proper text contrast on colored backgrounds
 * @param bgColor - The background color class (e.g., 'bg-yellow-400')
 * @returns string - The appropriate text color class
 */
export function getTextColorForBackground(bgColor: string): string {
  // Yellow backgrounds should always have black text
  if (
    bgColor.includes('yellow') || 
    bgColor.includes('lime') || 
    bgColor.includes('green-300') ||
    bgColor.includes('amber')
  ) {
    return 'text-black';
  }
  
  // Dark backgrounds should have white text
  if (
    bgColor.includes('black') || 
    bgColor.includes('gray-800') || 
    bgColor.includes('gray-900') ||
    bgColor.includes('slate-800') ||
    bgColor.includes('slate-900')
  ) {
    return 'text-white';
  }
  
  // Default - use the current text color
  return '';
}

\`\`\`

# src\main.tsx

\`\`\`tsx

import { createRoot } from 'react-dom/client'
import App from './App.tsx'
import './index.css'

// Create root and render app
createRoot(document.getElementById("root")!).render(<App />);

\`\`\`

# src\pages\BankSelection.tsx

\`\`\`tsx

import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Button } from '@/components/ui/button';
import { 
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue
} from '@/components/ui/select';
import { ArrowRight, Check } from 'lucide-react';
import { Checkbox } from '@/components/ui/checkbox';
import { Label } from '@/components/ui/label';

const banks = [
  { id: 'barclays', name: 'Barclays' },
  { id: 'hsbc', name: 'HSBC' },
  { id: 'lloyds', name: 'Lloyds Banking Group' },
  { id: 'natwest', name: 'NatWest Group' },
  { id: 'santander', name: 'Santander UK' },
  { id: 'standard', name: 'Standard Chartered' }
];

const BankSelection = () => {
  const navigate = useNavigate();
  const [selectedBank, setSelectedBank] = useState<string>('');
  const [selectedBanks, setSelectedBanks] = useState<string[]>([]);
  const [enableMultiBanks, setEnableMultiBanks] = useState<boolean>(false);

  // Update selected banks when toggling multi-bank mode
  useEffect(() => {
    if (enableMultiBanks) {
      // If switching to multi-bank mode, initialize with the current selection
      if (selectedBank && !selectedBanks.includes(selectedBank)) {
        setSelectedBanks([selectedBank]);
      }
    } else {
      // If switching to single bank mode, use the first selected bank or empty
      setSelectedBank(selectedBanks.length > 0 ? selectedBanks[0] : '');
    }
  }, [enableMultiBanks]);

  const handleContinue = () => {
    if ((enableMultiBanks && selectedBanks.length > 0) || (!enableMultiBanks && selectedBank)) {
      // Store the selected bank(s) in session storage for use across the application
      sessionStorage.setItem('selectedBank', enableMultiBanks ? selectedBanks[0] : selectedBank);
      sessionStorage.setItem('selectedBanks', JSON.stringify(enableMultiBanks ? selectedBanks : [selectedBank]));
      sessionStorage.setItem('enableMultiBanks', enableMultiBanks.toString());
      navigate('/dashboard');
    }
  };

  const toggleBankSelection = (bankId: string) => {
    setSelectedBanks(prevSelected => {
      if (prevSelected.includes(bankId)) {
        return prevSelected.filter(id => id !== bankId);
      } else {
        return [...prevSelected, bankId];
      }
    });
  };

  // Check if a bank is selected in multi-bank mode
  const isBankSelected = (bankId: string) => {
    return selectedBanks.includes(bankId);
  };

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-ey-black text-white">
      <div className="w-full max-w-md px-6 py-12 text-center">
        <div className="mb-8">
          <div className="flex justify-center mb-6">
            <div className="h-16 w-16 bg-ey-yellow rounded-md"></div>
          </div>
          
          <h1 className="text-4xl font-bold mb-2">AiDEx</h1>
          <p className="text-ey-gray-400">
            AI powered Data Extraction
          </p>
          <p className="text-ey-gray-500 text-sm mt-1">
            Supported by EYQ
          </p>
        </div>
        
        <div className="border border-ey-gray-700 rounded-lg p-6 mb-8">
          <h2 className="text-xl font-semibold mb-6">Select Bank</h2>
          <p className="text-sm text-ey-gray-400 mb-6">
            Choose the bank you want to analyze for data extraction.
          </p>
          
          <div className="space-y-4">
            <div className="flex items-center space-x-3 mt-4 mb-4 p-3 bg-ey-gray-800/50 rounded-md">
              <Checkbox 
                id="enableMultiBanks" 
                checked={enableMultiBanks} 
                onCheckedChange={(checked) => setEnableMultiBanks(checked as boolean)}
                className="data-[state=checked]:bg-ey-yellow data-[state=checked]:text-black"
              />
              <Label htmlFor="enableMultiBanks" className="text-sm cursor-pointer">
                Enable multi-bank analysis & comparison
              </Label>
            </div>

            {enableMultiBanks ? (
              // Multi-bank selection UI
              <div className="space-y-2">
                <label className="text-sm font-medium mb-1 block text-left">
                  Financial Institutions
                </label>
                <div className="border border-ey-gray-600 bg-ey-black text-white rounded-md p-1">
                  <div className="space-y-1">
                    {banks.map(bank => (
                      <div 
                        key={bank.id}
                        onClick={() => toggleBankSelection(bank.id)}
                        className={`flex items-center justify-between p-3 rounded-md cursor-pointer transition-colors ${
                          isBankSelected(bank.id) ? 'bg-ey-yellow/20 border border-ey-yellow' : 'hover:bg-ey-gray-800'
                        }`}
                      >
                        <span className="text-sm">{bank.name}</span>
                        {isBankSelected(bank.id) && (
                          <Check className="h-4 w-4 text-ey-yellow" />
                        )}
                      </div>
                    ))}
                  </div>
                </div>
                {selectedBanks.length === 0 && (
                  <p className="text-xs text-ey-yellow mt-1">Please select at least one bank</p>
                )}
              </div>
            ) : (
              // Single bank selection UI
              <div className="text-left">
                <label className="text-sm font-medium mb-1 block">
                  Financial Institution
                </label>
                <Select onValueChange={setSelectedBank} value={selectedBank}>
                  <SelectTrigger className="w-full border-ey-gray-600 bg-ey-black text-white">
                    <SelectValue placeholder="Select a bank" />
                  </SelectTrigger>
                  <SelectContent className="bg-ey-black text-white border-ey-gray-700">
                    {banks.map(bank => (
                      <SelectItem key={bank.id} value={bank.id} className="hover:bg-ey-gray-800">
                        {bank.name}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
            )}
            
            <Button 
              onClick={handleContinue}
              disabled={enableMultiBanks ? selectedBanks.length === 0 : !selectedBank}
              className="w-full bg-ey-yellow hover:bg-ey-yellow/90 text-ey-black font-medium mt-6"
            >
              Continue to Dashboard
              <ArrowRight className="ml-2 h-4 w-4" />
            </Button>
          </div>
        </div>
        
        <div className="text-xs text-ey-gray-500">
          <p>© {new Date().getFullYear()} EY | A better working world</p>
        </div>
      </div>
    </div>
  );
};

export default BankSelection;

\`\`\`

# src\pages\Dashboard.tsx

\`\`\`tsx
import { useState } from 'react';
import { Tabs, TabsContent } from '@/components/ui/tabs';
import { useToast } from '@/hooks/use-toast';
import { UploadedFile, PromptOption, ProcessingResult } from '@/lib/types';
import { generateRealisticResults } from '@/lib/excelUtils';
import TabNavigation from '@/components/dashboard/TabNavigation';
import UploadTab from '@/components/dashboard/UploadTab';
import PromptsTab from '@/components/dashboard/PromptsTab';
import ResultsTab from '@/components/dashboard/ResultsTab';
import CombinedTab from '@/components/dashboard/CombinedTab';
import SideBySideTab from '@/components/dashboard/SideBySideTab';
import Footer from '@/components/dashboard/Footer';
import { Button } from '@/components/ui/button';

const Dashboard = () => {
  const [uploadedFiles, setUploadedFiles] = useState<UploadedFile[]>([]);
  const [selectedPrompts, setSelectedPrompts] = useState<PromptOption[]>([]);
  const [results, setResults] = useState<ProcessingResult[]>([]);
  const [isProcessing, setIsProcessing] = useState(false);
  const [processingStep, setProcessingStep] = useState('');
  const [processingProgress, setProcessingProgress] = useState(0);
  const [activeTab, setActiveTab] = useState('upload');
  const { toast } = useToast();
  const selectedBank = sessionStorage.getItem('selectedBank') || 'barclays';

  // Handle uploaded files
  const handleFilesUploaded = (files: UploadedFile[]) => {
    setUploadedFiles(files);
  };

  // Handle prompt selection
  const handlePromptSelected = (prompts: PromptOption[]) => {
    setSelectedPrompts(prompts);
    if (prompts.length > 0) {
      toast({
        title: "Prompts Selected",
        description: `${prompts.length} extraction ${prompts.length === 1 ? 'prompt' : 'prompts'} selected`,
      });
    }
  };

  // Simulate the processing function
  const processFiles = async () => {
    if (uploadedFiles.length === 0) {
      toast({
        title: "No files to process",
        description: "Please upload at least one PDF file.",
        variant: "destructive",
      });
      return;
    }

    if (selectedPrompts.length === 0) {
      toast({
        title: "No prompts selected",
        description: "Please select at least one extraction prompt.",
        variant: "destructive",
      });
      return;
    }

    // Start processing
    setIsProcessing(true);
    setProcessingStep('Initializing extraction process...');
    setProcessingProgress(0);
    setActiveTab('results');
    
    // Generate a unique session ID
    const sessionId = Date.now().toString(); 

    try {
      // We assume `uploadedFiles` now contains the metadata returned 
      // by `/api/upload` (handled by UploadTab). 
      // We directly call `/api/process`.

      const processResponse = await fetch('http://localhost:5000/api/process', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          files: uploadedFiles, // Send the metadata we already have
          prompts: selectedPrompts,
          sessionId: sessionId // Use the generated session ID
        })
      });

      if (!processResponse.ok) {
          const errorData = await processResponse.json();
          throw new Error(errorData.error || `Processing failed with status: ${processResponse.status}`);
      }

      const processData = await processResponse.json();
      
      // Update results
      setResults(processData.results);
      setIsProcessing(false);
      
      toast({
        title: "Processing Complete",
        description: `Processed ${uploadedFiles.length} files with ${selectedPrompts.length} prompts`,
      });

      // Optionally, you might want to start polling /api/status/<sessionId> here
      // if the processing is long-running, instead of expecting
      // immediate results. For now, we assume /api/process returns
      // the final results directly as per your Python code.

    } catch (error) {
      setIsProcessing(false);
      console.error("Processing Error:", error); // Log the error
      toast({
        title: "Processing Error",
        description: error instanceof Error ? error.message : "An unknown error occurred during processing.",
        variant: "destructive",
      });
    }
  };

  // Simulate downloading results
  const handleDownloadResults = () => {
    toast({
      title: "Downloading Results",
      description: "Your results would download as an Excel file in a real implementation.",
    });
  };

  // Reset everything
  const handleReset = () => {
    setUploadedFiles([]);
    setSelectedPrompts([]);
    setResults([]);
    setActiveTab('upload');
    toast({
      title: "Reset Complete",
      description: "All files and prompts have been cleared.",
    });
  };

  // Navigate to the next tab
  const goToNextTab = () => {
    if (activeTab === 'upload') setActiveTab('prompts');
    else if (activeTab === 'prompts') {
      processFiles();
    }
  };

  // Go back to previous tab
  const goToPreviousTab = () => {
    if (activeTab === 'prompts') setActiveTab('upload');
    else if (activeTab === 'results') setActiveTab('prompts');
  };
  
  return (
    <div className="min-h-screen flex flex-col bg-white">
      {/* Bank indicator */}
      <div className="bg-yellow-400 text-black py-1 px-4 text-sm flex justify-between">
        <div>
          Selected Bank: <span className="font-semibold">{selectedBank.charAt(0).toUpperCase() + selectedBank.slice(1)}</span>
        </div>
        <Button 
          variant="link" 
          size="sm" 
          onClick={() => window.location.href = '/'}
          className="h-auto p-0 text-black underline text-xs"
        >
          Change
        </Button>
      </div>
      
      {/* Tabs header */}
      <TabNavigation activeTab={activeTab} setActiveTab={setActiveTab} />

      {/* Main Content */}
      <main className="flex-grow container mx-auto px-4 py-6">
        <Tabs value={activeTab}>
          <TabsContent value="upload" className="space-y-6">
            <UploadTab 
              onFilesUploaded={handleFilesUploaded}
              uploadedFiles={uploadedFiles}
              goToNextTab={goToNextTab}
            />
          </TabsContent>
          
          <TabsContent value="prompts" className="space-y-6">
            <div className="flex flex-col space-y-4">
              <PromptsTab 
                onPromptSelected={handlePromptSelected}
                isProcessing={isProcessing}
              />
              
              <div className="flex justify-between mt-4">
                <Button 
                  onClick={goToPreviousTab}
                  variant="outline"
                >
                  Back to Upload
                </Button>
                
                <Button 
                  onClick={processFiles}
                  disabled={isProcessing || selectedPrompts.length === 0}
                  className="bg-yellow-400 hover:bg-yellow-500 text-black"
                >
                  Process Files
                </Button>
              </div>
            </div>
          </TabsContent>
          
          <TabsContent value="results" className="space-y-6">
            <ResultsTab 
              results={results}
              onDownloadResults={handleDownloadResults}
              isProcessing={isProcessing}
              processingProgress={processingProgress}
              processingStep={processingStep}
            />
          </TabsContent>
          
          <TabsContent value="combined" className="space-y-6">
            <CombinedTab 
              results={results} 
              onDownloadResults={handleDownloadResults} 
            />
          </TabsContent>

          <TabsContent value="sidebyside" className="space-y-6">
            <SideBySideTab results={results} />
          </TabsContent>
        </Tabs>
      </main>
      
      {/* Footer */}
      <Footer />
    </div>
  );
};

export default Dashboard;

\`\`\`

# src\pages\Index.tsx

\`\`\`tsx

import { useState } from 'react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { UploadedFile, PromptOption, ProcessingResult } from '@/lib/types';
import { Button } from '@/components/ui/button';
import FileUploader from '@/components/FileUploader';
import PromptSelector from '@/components/PromptSelector';
import ResultsViewer from '@/components/ResultsViewer';
import { useToast } from '@/hooks/use-toast';
import { Download, Upload, FileText, FileSpreadsheet } from 'lucide-react';
import { generateRealisticResults } from '@/lib/excelUtils';

const Index = () => {
  const [uploadedFiles, setUploadedFiles] = useState<UploadedFile[]>([]);
  const [selectedPrompts, setSelectedPrompts] = useState<PromptOption[]>([]);
  const [results, setResults] = useState<ProcessingResult[]>([]);
  const [isProcessing, setIsProcessing] = useState(false);
  const [processingStep, setProcessingStep] = useState('');
  const [processingProgress, setProcessingProgress] = useState(0);
  const [activeTab, setActiveTab] = useState('upload');
  const { toast } = useToast();

  // Handle uploaded files
  const handleFilesUploaded = (files: UploadedFile[]) => {
    setUploadedFiles(files);
  };

  // Handle prompt selection
  const handlePromptSelected = (prompts: PromptOption[]) => {
    setSelectedPrompts(prompts);
    if (prompts.length > 0) {
      toast({
        title: "Prompts Selected",
        description: `${prompts.length} extraction ${prompts.length === 1 ? 'prompt' : 'prompts'} selected`,
      });
    }
  };

  // Simulate the processing function
  const processFiles = async () => {
    if (uploadedFiles.length === 0) {
      toast({
        title: "No files to process",
        description: "Please upload at least one PDF file.",
        variant: "destructive",
      });
      return;
    }

    if (selectedPrompts.length === 0) {
      toast({
        title: "No prompts selected",
        description: "Please select at least one extraction prompt.",
        variant: "destructive",
      });
      return;
    }

    // Start processing
    setIsProcessing(true);
    setProcessingStep('Initializing extraction process...');
    setProcessingProgress(5);
    setActiveTab('results');

    const newResults: ProcessingResult[] = [];

    // Simulate processing for each file and prompt
    let completedItems = 0;
    const totalItems = uploadedFiles.length * selectedPrompts.length;

    for (const file of uploadedFiles) {
      // Simulate parsing the file
      setProcessingStep(`Parsing ${file.name}...`);
      await new Promise(resolve => setTimeout(resolve, 1000));
      setProcessingProgress(10 + (completedItems / totalItems) * 30);

      // For each prompt, create a result
      for (const prompt of selectedPrompts) {
        setProcessingStep(`Extracting ${prompt.name} from ${file.name}...`);
        
        // Simulate API request delay
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // Create a result with either success or random error
        const isSuccess = Math.random() > 0.05; // 95% success rate for demo
        
        const result: ProcessingResult = {
          id: `result-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
          fileId: file.id,
          fileName: file.name,
          promptId: prompt.id,
          promptName: prompt.name,
          status: isSuccess ? 'success' : 'error',
          timestamp: new Date().toISOString(),
          data: isSuccess ? generateRealisticResults(prompt.name) : undefined,
          notes: isSuccess 
            ? `Extraction completed successfully for ${prompt.name}.` 
            : undefined,
          error: isSuccess 
            ? undefined 
            : "Could not find relevant information in the document or the format was not recognized."
        };
        
        newResults.push(result);
        completedItems++;
        setProcessingProgress(10 + (completedItems / totalItems) * 80);
      }
    }

    // Final processing step
    setProcessingStep('Finalizing results...');
    await new Promise(resolve => setTimeout(resolve, 1000));
    setProcessingProgress(100);

    // Update results and finish processing
    setResults([...results, ...newResults]);
    setIsProcessing(false);
    
    toast({
      title: "Processing Complete",
      description: `Processed ${uploadedFiles.length} files with ${selectedPrompts.length} prompts`,
      variant: "default",
    });
  };

  // Simulate downloading results
  const handleDownloadResults = () => {
    toast({
      title: "Downloading Results",
      description: "Your results would download as an Excel file in a real implementation.",
    });
  };

  // Reset everything
  const handleReset = () => {
    setUploadedFiles([]);
    setSelectedPrompts([]);
    setResults([]);
    setActiveTab('upload');
    toast({
      title: "Reset Complete",
      description: "All files and prompts have been cleared.",
    });
  };

  // Navigate to the next tab
  const goToNextTab = () => {
    if (activeTab === 'upload') setActiveTab('prompts');
    else if (activeTab === 'prompts') {
      processFiles();
    }
  };

  // Go back to previous tab
  const goToPreviousTab = () => {
    if (activeTab === 'prompts') setActiveTab('upload');
    else if (activeTab === 'results') setActiveTab('prompts');
  };

  return (
    <div className="min-h-screen flex flex-col bg-white">
      {/* Tabs header */}
      <div className="border-b">
        <div className="container mx-auto px-4">
          <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
            <TabsList className="grid grid-cols-4 w-full max-w-2xl mx-auto my-4">
              <TabsTrigger 
                value="upload" 
                className={activeTab === 'upload' ? 'bg-yellow-400 text-black' : ''}
              >
                <Upload className="h-4 w-4 mr-2" />
                Upload
              </TabsTrigger>
              <TabsTrigger 
                value="prompts" 
                className={activeTab === 'prompts' ? 'bg-yellow-400 text-black' : ''}
              >
                <FileText className="h-4 w-4 mr-2" />
                Prompts
              </TabsTrigger>
              <TabsTrigger 
                value="results" 
                className={activeTab === 'results' ? 'bg-yellow-400 text-black' : ''}
              >
                <FileSpreadsheet className="h-4 w-4 mr-2" />
                Results
              </TabsTrigger>
              <TabsTrigger 
                value="combined" 
                className={activeTab === 'combined' ? 'bg-yellow-400 text-black' : ''}
              >
                <Download className="h-4 w-4 mr-2" />
                Combined
              </TabsTrigger>
            </TabsList>
          </Tabs>
        </div>
      </div>

      {/* Main Content */}
      <main className="flex-grow container mx-auto px-4 py-6">
        <Tabs value={activeTab}>
          {/* Upload Tab */}
          <TabsContent value="upload" className="space-y-6">
            <div className="grid grid-cols-1 gap-6">
              <FileUploader 
                onFilesUploaded={handleFilesUploaded}
                acceptedFileTypes={['.pdf']}
              />
              
              <div className="flex justify-end">
                <Button 
                  onClick={goToNextTab} 
                  disabled={uploadedFiles.length === 0}
                  className="bg-yellow-400 hover:bg-yellow-500 text-black"
                >
                  Next: Select Prompts
                </Button>
              </div>
            </div>
          </TabsContent>
          
          {/* Prompts Tab */}
          <TabsContent value="prompts" className="space-y-6">
            <PromptSelector 
              onPromptSelected={handlePromptSelected} 
              disabled={isProcessing}
            />
          </TabsContent>
          
          {/* Results Tab */}
          <TabsContent value="results" className="space-y-6">
            <ResultsViewer 
              results={results}
              onDownloadResults={handleDownloadResults}
              isProcessing={isProcessing}
              processingProgress={processingProgress}
              processingStep={processingStep}
            />
          </TabsContent>
          
          {/* Combined Tab */}
          <TabsContent value="combined" className="space-y-6">
            <div className="space-y-6">
              <div className="flex justify-between items-center">
                <div>
                  <h2 className="text-lg font-semibold mb-1">IFRS9 Combined Results</h2>
                  <p className="text-sm text-muted-foreground">
                    View and download the final processed IFRS9 data in Excel format
                  </p>
                </div>
                <Button 
                  variant="outline" 
                  size="sm" 
                  onClick={handleDownloadResults}
                  className="flex items-center gap-1 border-yellow-400 bg-white text-black hover:bg-yellow-50"
                >
                  <Download className="h-4 w-4" />
                  <span>Download Excel</span>
                </Button>
              </div>
              
              <div className="border rounded-lg overflow-hidden">
                <div className="flex justify-between items-center p-3 bg-muted border-b">
                  <Button 
                    variant="outline" 
                    size="sm" 
                    className="py-1 h-8 bg-yellow-400 hover:bg-yellow-500 border-none text-black"
                  >
                    Combined View
                  </Button>
                  <div className="text-sm text-muted-foreground">
                    28 rows
                  </div>
                </div>
                
                <div className="h-[500px] overflow-y-auto">
                  <table className="w-full text-sm">
                    <thead className="bg-muted/70 sticky top-0">
                      <tr>
                        <th className="p-3 text-left font-semibold text-black">Category</th>
                        <th className="p-3 text-left font-semibold text-black">Stage</th>
                        <th className="p-3 text-left font-semibold text-black">Field</th>
                        <th className="p-3 text-left font-semibold text-black">Value</th>
                        <th className="p-3 text-left font-semibold text-black">Source</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 1</td>
                        <td className="p-3">Gross Carrying Amount</td>
                        <td className="p-3">$1,029.66m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 1</td>
                        <td className="p-3">Loss Allowance</td>
                        <td className="p-3">$12.64m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 1</td>
                        <td className="p-3">Coverage Ratio</td>
                        <td className="p-3">0.94%</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 2</td>
                        <td className="p-3">Gross Carrying Amount</td>
                        <td className="p-3">$502.11m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 2</td>
                        <td className="p-3">Loss Allowance</td>
                        <td className="p-3">$20.71m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 2</td>
                        <td className="p-3">Coverage Ratio</td>
                        <td className="p-3">6.35%</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </TabsContent>
        </Tabs>
      </main>
      
      {/* Footer */}
      <footer className="bg-gray-100 border-t mt-auto py-4">
        <div className="container mx-auto px-4">
          <div className="flex justify-between items-center text-sm text-muted-foreground">
            <div>IFRS9 Data Extraction Tool</div>
            <div>© {new Date().getFullYear()} Barclays Financial Services</div>
          </div>
        </div>
      </footer>
    </div>
  );
};

export default Index;

\`\`\`

# src\pages\NotFound.tsx

\`\`\`tsx
import { useLocation } from "react-router-dom";
import { useEffect } from "react";

const NotFound = () => {
  const location = useLocation();

  useEffect(() => {
    console.error(
      "404 Error: User attempted to access non-existent route:",
      location.pathname
    );
  }, [location.pathname]);

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <div className="text-center">
        <h1 className="text-4xl font-bold mb-4">404</h1>
        <p className="text-xl text-gray-600 mb-4">Oops! Page not found</p>
        <a href="/" className="text-blue-500 hover:text-blue-700 underline">
          Return to Home
        </a>
      </div>
    </div>
  );
};

export default NotFound;

\`\`\`

# src\vite-env.d.ts

\`\`\`ts
/// <reference types="vite/client" />

\`\`\`

# tailwind.config.ts

\`\`\`ts

import type { Config } from "tailwindcss";

export default {
	darkMode: ["class"],
	content: [
		"./pages/**/*.{ts,tsx}",
		"./components/**/*.{ts,tsx}",
		"./app/**/*.{ts,tsx}",
		"./src/**/*.{ts,tsx}",
	],
	prefix: "",
	theme: {
		container: {
			center: true,
			padding: '2rem',
			screens: {
				'2xl': '1400px'
			}
		},
		extend: {
			colors: {
				border: 'hsl(var(--border))',
				input: 'hsl(var(--input))',
				ring: 'hsl(var(--ring))',
				background: 'hsl(var(--background))',
				foreground: 'hsl(var(--foreground))',
				primary: {
					DEFAULT: 'hsl(var(--primary))',
					foreground: 'hsl(var(--primary-foreground))'
				},
				secondary: {
					DEFAULT: 'hsl(var(--secondary))',
					foreground: 'hsl(var(--secondary-foreground))'
				},
				destructive: {
					DEFAULT: 'hsl(var(--destructive))',
					foreground: 'hsl(var(--destructive-foreground))'
				},
				muted: {
					DEFAULT: 'hsl(var(--muted))',
					foreground: 'hsl(var(--muted-foreground))'
				},
				accent: {
					DEFAULT: 'hsl(var(--accent))',
					foreground: 'hsl(var(--accent-foreground))'
				},
				popover: {
					DEFAULT: 'hsl(var(--popover))',
					foreground: 'hsl(var(--popover-foreground))'
				},
				card: {
					DEFAULT: 'hsl(var(--card))',
					foreground: 'hsl(var(--card-foreground))'
				},
				sidebar: {
					DEFAULT: 'hsl(var(--sidebar-background))',
					foreground: 'hsl(var(--sidebar-foreground))',
					primary: 'hsl(var(--sidebar-primary))',
					'primary-foreground': 'hsl(var(--sidebar-primary-foreground))',
					accent: 'hsl(var(--sidebar-accent))',
					'accent-foreground': 'hsl(var(--sidebar-accent-foreground))',
					border: 'hsl(var(--sidebar-border))',
					ring: 'hsl(var(--sidebar-ring))'
				},
				ey: {
					black: '#000000',
					yellow: '#FFE600',
					white: '#FFFFFF',
					gray: {
						100: '#F6F6F7',
						200: '#F1F1F1', 
						300: '#EAEAEA',
						400: '#C8C8C9',
						500: '#9F9EA1',
						600: '#8A898C',
						700: '#555555',
						800: '#403E43',
						900: '#221F26'
					}
				}
			},
			borderRadius: {
				lg: 'var(--radius)',
				md: 'calc(var(--radius) - 2px)',
				sm: 'calc(var(--radius) - 4px)'
			},
			keyframes: {
				'accordion-down': {
					from: {
						height: '0'
					},
					to: {
						height: 'var(--radix-accordion-content-height)'
					}
				},
				'accordion-up': {
					from: {
						height: 'var(--radix-accordion-content-height)'
					},
					to: {
						height: '0'
					}
				},
				'pulse-gentle': {
					'0%, 100%': { opacity: '1' },
					'50%': { opacity: '0.7' }
				},
				'fade-in': {
					'0%': { opacity: '0' },
					'100%': { opacity: '1' }
				},
				'slide-up': {
					'0%': { transform: 'translateY(20px)', opacity: '0' },
					'100%': { transform: 'translateY(0)', opacity: '1' }
				},
				'float-1': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-5px)' }
				},
				'float-2': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-7px)' }
				},
				'float-3': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-4px)' }
				},
				'float-4': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-6px)' }
				},
				'float-5': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-3px)' }
				},
				'float-6': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-5px)' }
				},
				'float-7': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-4px)' }
				},
				'float-8': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-6px)' }
				},
				'page-transition-in': {
					'0%': { transform: 'translateX(20px)', opacity: '0' },
					'100%': { transform: 'translateX(0)', opacity: '1' }
				},
				'page-transition-out': {
					'0%': { transform: 'translateX(0)', opacity: '1' },
					'100%': { transform: 'translateX(-20px)', opacity: '0' }
				}
			},
			animation: {
				'accordion-down': 'accordion-down 0.2s ease-out',
				'accordion-up': 'accordion-up 0.2s ease-out',
				'pulse-gentle': 'pulse-gentle 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
				'fade-in': 'fade-in 0.6s ease-in-out',
				'slide-up': 'slide-up 0.6s ease-out',
				'float-1': 'float-1 3s ease-in-out infinite',
				'float-2': 'float-2 3.2s ease-in-out infinite 0.1s',
				'float-3': 'float-3 2.8s ease-in-out infinite 0.2s',
				'float-4': 'float-4 3.5s ease-in-out infinite 0.3s',
				'float-5': 'float-5 2.9s ease-in-out infinite 0.4s',
				'float-6': 'float-6 3.1s ease-in-out infinite 0.5s',
				'float-7': 'float-7 3.3s ease-in-out infinite 0.6s',
				'float-8': 'float-8 3.0s ease-in-out infinite 0.7s',
				'page-transition-in': 'page-transition-in 0.3s ease-out',
				'page-transition-out': 'page-transition-out 0.3s ease-out'
			}
		}
	},
	plugins: [require("tailwindcss-animate")],
} satisfies Config;

\`\`\`

# tsconfig.app.json

\`\`\`json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": false,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noImplicitAny": false,
    "noFallthroughCasesInSwitch": false,

    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"]
}

\`\`\`

# tsconfig.json

\`\`\`json
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ],
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    },
    "noImplicitAny": false,
    "noUnusedParameters": false,
    "skipLibCheck": true,
    "allowJs": true,
    "noUnusedLocals": false,
    "strictNullChecks": false
  }
}

\`\`\`

# tsconfig.node.json

\`\`\`json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["vite.config.ts"]
}

\`\`\`

# vite.config.ts

\`\`\`ts
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react-swc";
import path from "path";
import { componentTagger } from "lovable-tagger";

// https://vitejs.dev/config/
export default defineConfig(({ mode }) => ({
  server: {
    host: "::",
    port: 8080,
  },
  plugins: [
    react(),
    mode === 'development' &&
    componentTagger(),
  ].filter(Boolean),
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
}));

\`\`\`


```

# dataextract-ey-main\components.json

```json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "src/index.css",
    "baseColor": "slate",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  }
}
```

# dataextract-ey-main\eslint.config.js

```js
import js from "@eslint/js";
import globals from "globals";
import reactHooks from "eslint-plugin-react-hooks";
import reactRefresh from "eslint-plugin-react-refresh";
import tseslint from "typescript-eslint";

export default tseslint.config(
  { ignores: ["dist"] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ["**/*.{ts,tsx}"],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      "react-hooks": reactHooks,
      "react-refresh": reactRefresh,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      "react-refresh/only-export-components": [
        "warn",
        { allowConstantExport: true },
      ],
      "@typescript-eslint/no-unused-vars": "off",
    },
  }
);

```

# dataextract-ey-main\index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>finscope-data-miner</title>
    <meta name="description" content="Lovable Generated Project" />
    <meta name="author" content="Lovable" />

    <meta property="og:title" content="finscope-data-miner" />
    <meta property="og:description" content="Lovable Generated Project" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  </head>

  <body>
    <div id="root"></div>
    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

```

# dataextract-ey-main\package.json

```json
{
  "name": "vite_react_shadcn_ts",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "build:dev": "vite build --mode development",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@hookform/resolvers": "^3.9.0",
    "@radix-ui/react-accordion": "^1.2.0",
    "@radix-ui/react-alert-dialog": "^1.1.1",
    "@radix-ui/react-aspect-ratio": "^1.1.0",
    "@radix-ui/react-avatar": "^1.1.0",
    "@radix-ui/react-checkbox": "^1.1.1",
    "@radix-ui/react-collapsible": "^1.1.0",
    "@radix-ui/react-context-menu": "^2.2.1",
    "@radix-ui/react-dialog": "^1.1.2",
    "@radix-ui/react-dropdown-menu": "^2.1.1",
    "@radix-ui/react-hover-card": "^1.1.1",
    "@radix-ui/react-label": "^2.1.0",
    "@radix-ui/react-menubar": "^1.1.1",
    "@radix-ui/react-navigation-menu": "^1.2.0",
    "@radix-ui/react-popover": "^1.1.1",
    "@radix-ui/react-progress": "^1.1.0",
    "@radix-ui/react-radio-group": "^1.2.0",
    "@radix-ui/react-scroll-area": "^1.1.0",
    "@radix-ui/react-select": "^2.1.1",
    "@radix-ui/react-separator": "^1.1.0",
    "@radix-ui/react-slider": "^1.2.0",
    "@radix-ui/react-slot": "^1.1.0",
    "@radix-ui/react-switch": "^1.1.0",
    "@radix-ui/react-tabs": "^1.1.0",
    "@radix-ui/react-toast": "^1.2.1",
    "@radix-ui/react-toggle": "^1.1.0",
    "@radix-ui/react-toggle-group": "^1.1.0",
    "@radix-ui/react-tooltip": "^1.1.4",
    "@tanstack/react-query": "^5.56.2",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.0.0",
    "date-fns": "^3.6.0",
    "embla-carousel-react": "^8.3.0",
    "framer-motion": "^12.10.5",
    "input-otp": "^1.2.4",
    "lucide-react": "^0.462.0",
    "next-themes": "^0.3.0",
    "pdfjs-dist": "^3.10.111",
    "react": "^18.3.1",
    "react-day-picker": "^8.10.1",
    "react-dom": "^18.3.1",
    "react-hook-form": "^7.53.0",
    "react-resizable-panels": "^2.1.3",
    "react-router-dom": "^6.26.2",
    "recharts": "^2.12.7",
    "sonner": "^1.5.0",
    "tailwind-merge": "^2.5.2",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^0.9.3",
    "xlsx": "^0.18.5",
    "zod": "^3.23.8"
  },
  "devDependencies": {
    "@eslint/js": "^9.9.0",
    "@tailwindcss/typography": "^0.5.15",
    "@types/node": "^22.5.5",
    "@types/react": "^18.3.3",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react-swc": "^3.5.0",
    "autoprefixer": "^10.4.20",
    "eslint": "^9.9.0",
    "eslint-plugin-react-hooks": "^5.1.0-rc.0",
    "eslint-plugin-react-refresh": "^0.4.9",
    "globals": "^15.9.0",
    "lovable-tagger": "^1.1.7",
    "postcss": "^8.4.47",
    "tailwindcss": "^3.4.11",
    "typescript": "^5.5.3",
    "typescript-eslint": "^8.0.1",
    "vite": "^5.4.1"
  }
}

```

# dataextract-ey-main\postcss.config.js

```js
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}

```

# dataextract-ey-main\public\favicon.ico

This is a binary file of the type: Binary

# dataextract-ey-main\public\placeholder.svg

This is a file of the type: SVG Image

# dataextract-ey-main\public\robots.txt

```txt
User-agent: Googlebot
Allow: /

User-agent: Bingbot
Allow: /

User-agent: Twitterbot
Allow: /

User-agent: facebookexternalhit
Allow: /

User-agent: *
Allow: /

```

# dataextract-ey-main\README.md

```md
# Welcome to your Lovable project

## Project info

**URL**: https://lovable.dev/projects/f1c52b0c-481b-4d58-84cf-5beb28959f75

## How can I edit this code?

There are several ways of editing your application.

**Use Lovable**

Simply visit the [Lovable Project](https://lovable.dev/projects/f1c52b0c-481b-4d58-84cf-5beb28959f75) and start prompting.

Changes made via Lovable will be committed automatically to this repo.

**Use your preferred IDE**

If you want to work locally using your own IDE, you can clone this repo and push changes. Pushed changes will also be reflected in Lovable.

The only requirement is having Node.js & npm installed - [install with nvm](https://github.com/nvm-sh/nvm#installing-and-updating)

Follow these steps:

\`\`\`sh
# Step 1: Clone the repository using the project's Git URL.
git clone <YOUR_GIT_URL>

# Step 2: Navigate to the project directory.
cd <YOUR_PROJECT_NAME>

# Step 3: Install the necessary dependencies.
npm i

# Step 4: Start the development server with auto-reloading and an instant preview.
npm run dev
\`\`\`

**Edit a file directly in GitHub**

- Navigate to the desired file(s).
- Click the "Edit" button (pencil icon) at the top right of the file view.
- Make your changes and commit the changes.

**Use GitHub Codespaces**

- Navigate to the main page of your repository.
- Click on the "Code" button (green button) near the top right.
- Select the "Codespaces" tab.
- Click on "New codespace" to launch a new Codespace environment.
- Edit files directly within the Codespace and commit and push your changes once you're done.

## What technologies are used for this project?

This project is built with:

- Vite
- TypeScript
- React
- shadcn-ui
- Tailwind CSS

## How can I deploy this project?

Simply open [Lovable](https://lovable.dev/projects/f1c52b0c-481b-4d58-84cf-5beb28959f75) and click on Share -> Publish.

## Can I connect a custom domain to my Lovable project?

Yes, you can!

To connect a domain, navigate to Project > Settings > Domains and click Connect Domain.

Read more here: [Setting up a custom domain](https://docs.lovable.dev/tips-tricks/custom-domain#step-by-step-guide)

```

# dataextract-ey-main\src\App.css

```css
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}

```

# dataextract-ey-main\src\App.tsx

```tsx

import { Toaster } from "@/components/ui/toaster";
import { Toaster as Sonner } from "@/components/ui/sonner";
import { TooltipProvider } from "@/components/ui/tooltip";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { BrowserRouter, Routes, Route, useLocation } from "react-router-dom";
import { AnimatePresence, motion } from "framer-motion";
import IntroScreen from "./components/IntroScreen";
import Dashboard from "./pages/Dashboard";
import BankSelection from "./pages/BankSelection";
import NotFound from "./pages/NotFound";
import { ThemeProvider } from "./components/ThemeProvider";
import { ThemeToggle } from "./components/ThemeToggle";

const queryClient = new QueryClient();

// Simple, elegant fade transition
const pageVariants = {
  initial: {
    opacity: 0
  },
  in: {
    opacity: 1
  },
  out: {
    opacity: 0
  }
};

// Smooth, quick transition
const pageTransition = {
  duration: 0.3,
  ease: "easeInOut"
};

// Animation wrapper component with elegant transitions
const AnimatedRoutes = () => {
  const location = useLocation();
  
  return (
    <AnimatePresence mode="wait">
      <motion.div
        key={location.pathname}
        initial="initial"
        animate="in"
        exit="out"
        variants={pageVariants}
        transition={pageTransition}
        className="w-full min-h-screen"
      >
        {/* Theme toggle positioned in header instead of fixed position */}
        <Routes location={location}>
          <Route path="/" element={<IntroScreen />} />
          <Route path="/select-bank" element={<BankSelection />} />
          <Route path="/dashboard" element={<Dashboard />} />
          <Route path="*" element={<NotFound />} />
        </Routes>
      </motion.div>
    </AnimatePresence>
  );
};

const App = () => (
  <QueryClientProvider client={queryClient}>
    <ThemeProvider defaultTheme="light">
      <TooltipProvider>
        <Toaster />
        <Sonner />
        <BrowserRouter>
          <AnimatedRoutes />
        </BrowserRouter>
      </TooltipProvider>
    </ThemeProvider>
  </QueryClientProvider>
);

export default App;

```

# dataextract-ey-main\src\components\dashboard\CombinedTab.tsx

```tsx
// src/components/dashboard/CombinedTab.tsx

import { Button } from '@/components/ui/button';
import { ProcessingResult } from '@/lib/types';
import { Download } from 'lucide-react';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';

export interface CombinedTabProps { // Ensure this interface matches Dashboard's usage
  results: ProcessingResult[];
  onDownloadResults: () => void;
  selectedBank: string;
}

const CombinedTab = ({ results, onDownloadResults, selectedBank }: CombinedTabProps) => {
  // ... (rest of the component logic from the previous correct version)
  const combinedData = results
    .filter(result => result.status === 'success' && result.data)
    .flatMap(result => {
      return result.data?.map(item => ({
        ...item,
        Source: `${result.fileName} - ${result.promptName}`
      })) || [];
    });

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h2 className="text-lg font-semibold mb-1">Combined Results for {selectedBank}</h2>
          <p className="text-sm text-muted-foreground">
            View and download the final processed data in Excel format
          </p>
        </div>
        <Button 
          variant="outline" 
          size="sm" 
          onClick={onDownloadResults}
          className="flex items-center gap-1 border-yellow-400 bg-white text-black hover:bg-yellow-50 dark:text-black dark:hover:bg-yellow-100 dark:border-yellow-500"
        >
          <Download className="h-4 w-4" />
          <span>Download Excel</span>
        </Button>
      </div>
      
      {combinedData.length > 0 ? (
        <div className="border rounded-lg overflow-hidden dark:border-gray-700">
          <div className="flex justify-between items-center p-3 bg-muted dark:bg-gray-800 border-b dark:border-gray-700">
            <Button 
              variant="outline" 
              size="sm" 
              className="py-1 h-8 bg-yellow-400 hover:bg-yellow-500 border-none text-black"
            >
              Combined View
            </Button>
            <div className="text-sm text-muted-foreground">
              {combinedData.length} rows
            </div>
          </div>
          <ScrollArea className="h-[650px]">
            <Table>
              <TableHeader className="bg-muted/70 dark:bg-gray-800/70 sticky top-0">
                <TableRow className="dark:border-gray-700">
                  <TableHead className="font-semibold text-black dark:text-white">Category</TableHead>
                  <TableHead className="font-semibold text-black dark:text-white">Stage</TableHead>
                  <TableHead className="font-semibold text-black dark:text-white">Field</TableHead>
                  <TableHead className="font-semibold text-black dark:text-white">Value</TableHead>
                  <TableHead className="font-semibold text-black dark:text-white">Source</TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {combinedData.map((item, index) => (
                  <TableRow key={index} className="dark:border-gray-700">
                    <TableCell className="dark:text-gray-300">{item.Category === 'ECL By Stage' ? 'ECL' : item.Category}</TableCell>
                    <TableCell className="dark:text-gray-300">{item.Stage}</TableCell>
                    <TableCell className="dark:text-gray-300">{item.Field}</TableCell>
                    <TableCell className="dark:text-gray-300">{item.Value}</TableCell>
                    <TableCell className="dark:text-gray-300">{item.Source}</TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </ScrollArea>
        </div>
      ) : (
        <div className="border rounded-lg p-12 text-center dark:border-gray-700">
          <p className="text-muted-foreground">No results available yet.</p>
          <p className="text-sm text-muted-foreground mt-1">Process files with prompts to see combined results.</p>
        </div>
      )}
    </div>
  );
};

export default CombinedTab;
```

# dataextract-ey-main\src\components\dashboard\Footer.tsx

```tsx

const Footer = () => {
  return (
    <footer className="bg-gray-100 border-t mt-auto py-4">
      <div className="container mx-auto px-4">
        <div className="flex justify-between items-center text-sm text-muted-foreground">
          <div>AiDEx - AI powered Data Extraction</div>
          <div>© {new Date().getFullYear()} Barclays Financial Services</div>
        </div>
      </div>
    </footer>
  );
};

export default Footer;

```

# dataextract-ey-main\src\components\dashboard\PromptsTab.tsx

```tsx
// src/components/dashboard/PromptsTab.tsx
// (Ensure this is the version you have from the previous response, 
// it should be mostly correct for fetching and passing props)

import PromptSelector from '@/components/PromptSelector';
import PromptDescriptions from '@/components/PromptDescriptions';
import { PromptOption } from '@/lib/types';
import { useCallback, useEffect, useState } from 'react';
import { useToast } from '@/hooks/use-toast';
import { Loader2 } from 'lucide-react';

interface PromptsTabProps {
  onPromptSelected: (prompts: PromptOption[]) => void; // This is Dashboard's handler
  isProcessing: boolean;
  selectedPrompts?: PromptOption[]; // User's currently active selection from Dashboard
}

const PromptsTab = ({ 
  onPromptSelected, 
  isProcessing, 
  selectedPrompts: dashboardSelectedPrompts = [] 
}: PromptsTabProps) => {
  const [fetchedBankPrompts, setFetchedBankPrompts] = useState<PromptOption[]>([]);
  const [isLoadingPrompts, setIsLoadingPrompts] = useState(false);
  const [currentBankDisplay, setCurrentBankDisplay] = useState<string>("selected bank(s)");
  const { toast } = useToast();

  // This callback will be called by PromptSelector when its "Apply" button is clicked.
  const handleApplyFromSelector = useCallback((newlyAppliedSelection: PromptOption[]) => {
    onPromptSelected(newlyAppliedSelection); // Update Dashboard's state
    // Toast for applying is now handled within PromptSelector itself after its own apply.
  }, [onPromptSelected]);

  useEffect(() => {
    const fetchBankPrompts = async () => {
      setIsLoadingPrompts(true);
      const storedBank = sessionStorage.getItem('selectedBank') || 'barclays';
      const storedBanksString = sessionStorage.getItem('selectedBanks');
      const enableMulti = sessionStorage.getItem('enableMultiBanks') === 'true';
      
      let banksToFetch: string[] = [];
      if (enableMulti && storedBanksString) {
        try {
          banksToFetch = JSON.parse(storedBanksString);
          setCurrentBankDisplay(banksToFetch.map(b => b.charAt(0).toUpperCase() + b.slice(1)).join(', ') || 'selected banks');
        } catch (e) {
          console.error("Error parsing selectedBanks from sessionStorage", e);
          banksToFetch = [storedBank]; 
          setCurrentBankDisplay(storedBank.charAt(0).toUpperCase() + storedBank.slice(1));
        }
      } else {
        banksToFetch = [storedBank];
        setCurrentBankDisplay(storedBank.charAt(0).toUpperCase() + storedBank.slice(1));
      }

      if (banksToFetch.length === 0 && !enableMulti) { // Check only if not multi-mode and no single bank
        setFetchedBankPrompts([]);
        setIsLoadingPrompts(false);
        toast({ title: "No Bank Selected", description: "Please select a bank on the previous screen.", variant: "destructive" });
        return;
      }
      if (banksToFetch.length === 0 && enableMulti) {
         setFetchedBankPrompts([]);
         setIsLoadingPrompts(false);
         toast({ title: "No Banks Selected for Multi-Analysis", description: "Please select banks on the previous screen.", variant: "default" });
        return;
      }


      try {
        const allFetchedPrompts: PromptOption[] = [];
        const uniquePromptIds = new Set<string>();

        for (const bankId of banksToFetch) {
          const response = await fetch(`http://localhost:5000/api/prompts/default/${bankId}`);
          if (!response.ok) {
            const errorData = await response.json();
            console.warn(`Failed to fetch prompts for ${bankId}: ${errorData.error || response.statusText}`);
            toast({ title: `Prompt Fetch Error for ${bankId}`, description: errorData.error || "Could not load prompts.", variant: "destructive"});
            continue; 
          }
          const data = await response.json();
          if (data.status === 'success' && Array.isArray(data.prompts)) {
            data.prompts.forEach((prompt: PromptOption) => {
              if (!uniquePromptIds.has(prompt.id)) { 
                allFetchedPrompts.push(prompt);
                uniquePromptIds.add(prompt.id);
              }
            });
          } else if (data.message) {
            console.log(data.message); // Log "No prompts found for bank" message
          }
        }
        setFetchedBankPrompts(allFetchedPrompts);
        if (allFetchedPrompts.length === 0 && banksToFetch.length > 0) {
             toast({ title: "No Predefined Prompts", description: `No predefined prompts were found for ${banksToFetch.join(', ')} in the CSV.`, variant: "default" });
        }
      } catch (error) {
        console.error("Error fetching predefined prompts:", error);
        toast({
          title: "Error Fetching Prompts",
          description: error instanceof Error ? error.message : "Could not load predefined prompts from server.",
          variant: "destructive",
        });
        setFetchedBankPrompts([]);
      } finally {
        setIsLoadingPrompts(false);
      }
    };

    fetchBankPrompts();
  }, [toast]); 

  if (isLoadingPrompts) {
    return (
      <div className="flex flex-col items-center justify-center h-[400px] space-y-4">
        <Loader2 className="h-12 w-12 animate-spin text-yellow-500" />
        <p className="text-muted-foreground">Loading prompts for {currentBankDisplay}...</p>
      </div>
    );
  }

  return (
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div>
        <PromptSelector 
          onPromptsApplied={handleApplyFromSelector} 
          disabled={isProcessing || isLoadingPrompts}
          availablePredefinedPrompts={fetchedBankPrompts}
          // Pass the dashboard's current selection to pre-tick items in PromptSelector
          initiallyTickedPrompts={dashboardSelectedPrompts} 
          bankDisplay={currentBankDisplay}
        />
      </div>
      <div>
        <PromptDescriptions 
          availablePrompts={fetchedBankPrompts} 
          bankDisplay={currentBankDisplay}
        />
      </div>
    </div>
  );
};

export default PromptsTab;
```

# dataextract-ey-main\src\components\dashboard\ResultsTab.tsx

```tsx
// src/components/dashboard/ResultsTab.tsx

import ResultsViewer from '@/components/ResultsViewer'; //
import { ProcessingResult } from '@/lib/types'; //

// Define or update ResultsTabProps here
export interface ResultsTabProps {
  results: ProcessingResult[];
  onDownloadResults: () => void;
  isProcessing: boolean;
  processingProgress: number;
  processingStep: string;
  selectedBank: string;         // <-- ENSURE THIS LINE IS PRESENT
  totalUploadedFiles: number; 
}

const ResultsTab = ({ 
  results, 
  onDownloadResults, 
  isProcessing, 
  processingProgress, 
  processingStep,
  selectedBank,
  totalUploadedFiles 
}: ResultsTabProps) => {
  
  const uniqueFileIdsInResults = new Set(results.map(r => r.fileId));
  const totalFilesToDisplay = isProcessing ? Math.max(1, totalUploadedFiles) : uniqueFileIdsInResults.size;
  const processedFilesCount = results.filter(r => r.status === 'success' || r.status === 'error').length;
  
  return (
    <ResultsViewer 
      results={results}
      onDownloadResults={onDownloadResults}
      isProcessing={isProcessing}
      processingProgress={processingProgress}
      processingStep={processingStep}
      totalFiles={totalFilesToDisplay} 
      processedFiles={processedFilesCount}
      selectedBank={selectedBank} // Pass it down
    />
  );
};

export default ResultsTab;
```

# dataextract-ey-main\src\components\dashboard\SideBySideTab.tsx

```tsx
// src/components/dashboard/SideBySideTab.tsx

import { useState, useEffect } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Button } from '@/components/ui/button';
import { RefreshCw, Info, Check } from 'lucide-react'; // Added Check, was missing
import { ProcessingResult } from '@/lib/types';
import PDFViewer from '@/components/PDFViewer';
import { Badge } from "@/components/ui/badge"; // Added Badge, was missing
import { cn } from "@/lib/utils"; // Added cn, was missing

// CORRECTED Props Interface
export interface SideBySideTabProps {
  results: ProcessingResult[];
  selectedBank: string; 
}

const SideBySideTab = ({ results, selectedBank }: SideBySideTabProps) => {
  // ... rest of your component logic from the version in codebase_frontend.md ...
  // (Ensure all the component logic is present here, I'm just showing the interface fix)

  const [selectedFileForPdfPreview, setSelectedFileForPdfPreview] = useState<File | null>(null);
  const [selectedProcessingResult, setSelectedProcessingResult] = useState<ProcessingResult | null>(null);
  const [retryPdfCounter, setRetryPdfCounter] = useState(0);
  const [clientSidePdfFiles, setClientSidePdfFiles] = useState<Map<string, File>>(new Map());

  const resultsByFile: Record<string, ProcessingResult[]> = results.reduce((acc, result) => {
    if (!result) return acc;
    const key = result.fileId || result.fileName; 
    if (!acc[key]) acc[key] = [];
    acc[key].push(result);
    return acc;
  }, {} as Record<string, ProcessingResult[]>);

  const uniqueFileEntries = Object.values(resultsByFile).map(fileResults => fileResults[0]).filter(Boolean);

  // createDummyPDF function as provided in your codebase_frontend.md
  const createDummyPDF = (fileName: string): File => {
    const base64PDF = `JVBERi0xLjcKJeTjz9IKMSAwIG9iago8PC9UeXBlL0NhdGFsb2cvUGFnZXMgMiAwIFIvTGFuZyhqYS1KUCkgL1N0cnVjdFRyZWVSb290IDIxIDAgUi9NYXJrSW5mbzw8L01hcmtlZCB0cnVlPj4vTWV0YWRhdGEgNTggMCBSL1ZpZXdlclByZWZlcmVuY2VzIDU5IDAgUj4+CmVuZG9iagoyIDAgb2JqCjw8L1R5cGUvUGFnZXMvQ291bnQgMS9LaWRzWyAzIDAgUl0gPj4KZW5kb2JqCjMgMCBvYmoKPDwvVHlwZS9QYWdlL1BhcmVudCAyIDAgUi9SZXNvdXJjZXM8PC9YT2JqZWN0PDwvSW1hZ2U1IDUgMCBSL0ltYWdlNyA3IDAgUj4+L0ZvbnQ8PC9GMSAxMSAwIFIvRjIgMTMgMCBSL0YzIDE1IDAgUi9GNCAxNyAwIFI+Pi9FeHRHU3RhdGU8PC9HUzcgNyAwIFIvR1M4IDggMCBSPj4vUHJvY1NldFsvUERGL1RleHQvSW1hZ2VCL0ltYWdlQy9JbWFnZUldID4+L01lZGlhQm94WyAwIDAgNTk1LjMyIDg0MS45Ml0gL0NvbnRlbnRzIDQgMCBSL0dyb3VwPDwvVHlwZS9Hcm91cC9TL1RyYW5zcGFyZW5jeS9DUy9EZXZpY2VSR0I+Pi9UYWJzL1MvU3RydWN0UGFyZW50cyAwPj4KZW5kb2JqCjQgMCBvYmoKPDwvRmlsdGVyL0ZsYXRlRGVjb2RlL0xlbmd0aCAxOTA4Pj4Kc3RyZWFtCn陲Vnbkps4EH3nK3Q5uwo1urHB43gnpHBiy4iL12vv5mErD4MsMBXGBXgr+4d8XDeSuRgwdpKtmiqEkOg+3af7yHy7It9olr6TM87oNb2JxYGqM8qTrCCxgD8CBS3oi0xyEYn0nIooAynMaM5SciW/ZCknb7Oz8w8kE2QinkYHcq2iI8lj8g0awW+p/HuWvvAYBp6wPDqQmNIF/Emf4BFRamDNBHklMTzNNQIqwC4JjI9T+FeSh39MegVj9CjN0E6jBQWnISVqwXOaJCALfodFnBZCo89FivXlErBTYAa841mSJ+mJ8MmzDDC+1QxuJ+pEefBHzJKMJwcS8cN+RtVs8+NPwBa7wOxpt3i8eXn4gfrju8Ct3h1CLx1G7+7QuH+Anj4Oj90XgfmrOOye/WwO+1npeI7ukDsFrrjcHUbyGU0IvkZTp8pfa33pwsb7UuC1gYs8QdNq5jYZxNYzX+/oDXrTTOA+WCzCnJEUJrhA7q0wC3JE4ZPNH3W1mROL04h1Qhim4OKmdhPbAcrTIiVvdZ2z9DC6dAA+UFw4bjA2/P54g+1+PB6NvEvn2Ld6u+pBE9ufjI39wUg/D3F6aoLBHLScFLLJksm+xM/JXCNYM4YeBicJvc8rC7PSK5G6Tjv4i8Wt4wcj63q1ut6qhlggOcgcUYk20WXJHC7Vdu4wSnOEeQrmJpnDxKBkOgLS5kS2KQdTqUHmsHxhnB+GlaEggPm4bDq/rUlUvUjrx4i2DXDjo1hMBHxkDMsODMexmsHZeqXN9+VqKDEpPJhKkDs18A6kTGPycPv00ADXRkNEvF8xRdspeH8QLGfr3wE5KQCh7y/xziq8IATdLe3z1ZPvu9Po0L7ls/lyTA8s1zwx6/aipdyGvrI4SDx7E9cNeGdf3b2et7BfIxgBybl5YQzMoNsqSZS1h9HbCI1zdw6HpcT9hdiBBEcHkiFgY5YXSkAVGjuvamNUrSYyeUp1Gp7oicxolhfyuTsloXNpDRzuTLnjDifqveWQivUky2PkpeB7hFRdRV6wVbyrzLMCHqxUUW/HGQj7VEwIMEOZoVUbVZnWxp4Ge1mCstY3VHkOkUW4dPZVtSvdX51rXq4tUPhM+cyjdAlOM9g0E66NuugYnUCMr9311TxRn51l90OwvcFq4KKw1pQ42gAsntdgwrqmJ/Brl2P82jZQYzOUFO5LqPYvzc/bhpy+N3ubZnfVAJ+pDaKZIL/lQzdTDstKjB6gXjcr9bY9Dru6QF3Ac415RwleFebeUxGlPB5fd9/9gl3oQonA7eUXarKL9KhHka22R4CleLvNYlSY7UgVW3LQmKcd90zcqJPJCcCdiX/62fXPrcdJLJssALwbnztejx93ndtvHcpGx7ocwX8aSO00vRdTTBZeQni3WjjEIb58LMeQO4e/aBMFLTHvizWssNRIkltzmJJCH0nP7ci+co6Pmvr8M/awR8FFekLNDNcymoI7JlvzZquAKc9MsJQHx2+6m8t7oG0zG6S6uCW3cTAdOUfmznGcN6ZM0tyhr7RT4BqKFeBhcMXHwRptklv0KiDZLewprKkKtjTGpuq+d8ctsrGXbnVTB59DE8vjXIXlnJNsKqTqdfqL85PVLBHZU4DUfHWUt1sW5wnXHS2HlQ3GZghWyMvKZYLEf+XimTTHD0te3mdpeML10Xf6TrC3XRu6pksPUrQX1cUQN1hAQGF2aL8feZNFhbq2JIA06UM2wUuTBPjuDAIpPRAVVIQHKJ6Juo5E54bc70m2kUWNSYk8I3cSoNt90tKkmwkLiRLIpGq41cQE9+QrPQzp21JAcDdAA1J8jFWqKOlnQSsj225Yu4R/2EOWWtheOD6IQn8wCdptq5bU90v8l/zAiThahUZBNYzgdGZG3CKqTDehjCfYbIGluBVteMXWN2z/ut6wrSINS+4X6PcYwXVPrZ/IXEU452MocU826M76xG7j6W0B5qAjUYxc/DVJdXOXt6JKbAA2C1+r3ELS+J6T6rRfILmcZCphP+Z9hd8/0QPecIxS/CIRfJ7X97hoRc82nLdXLo1wHtdx998hmVxJynrA01ulvqjjjCUJeEXepU6NJXrW18vtdcbYI80CeXcogFNWJctyyDFxKHcWO76Zawsfpzjrx0ffQTWGusezbCs3v/49v87ZF8X+2O23cr7cyi2fLdBjrm6/K9A/vTLv1bHfdcDhqy+FhdLD8YQN5O+1fwEqNfLlCmVuZHN0cmVhbQplbmRvYmoKMjEgMCBvYmoKPDwvVHlwZS9TdHJ1Y3RUcmVlUm9vdC9QYXJlbnRUcmVlID0gNiAwIFIgL0sgPSA1MCAwIFIvSURUcmVlID0gNTEgMCBSID4+CmVuZG9iagoyMiAwIG9iago8PC9UeXBlL0ZvbnQvU3VidHlwZS9UcnVlVHlwZS9OYW1lL0YxL0Jhc2VGb250L0JDREVFRStDYWxpYnJpL0VuY29kaW5nL1dpbkFuc2lFbmNvZGluZy9Gb250RGVzY3JpcHRvciAyMyAwIFIvRmlyc3RDaGFyIDMyL0xhc3RDaGFyIDg0L1dpZHRocyA1MyAwIFI+PgplbmRvYmoKMjMgMCBvYmoKPDwvVHlwZS9Gb250RGVzY3JpcHRvci9Gb250TmFtZS9CQ0RFRUUrQ2FsaWJyaS9GbGFncyAzMi9JdGFsaWNBbmdsZSAwL0FzY2VudCA3NTAvRGVzY2VudCAtMjUwL0NhcEhlaWdodCA3NTAvQXZnV2lkdGggNTIxL01heFdpZHRoIDE3NDMvRm9udFdlaWdodCA0MDAvWEhlaWdodCAyNTAvU3RlbVYgNTIvRm9udEJCb3hbIC01MDMgLTI1MCAxMjQwIDc1MF0gL0ZvbnRGaWxlMiA1MiAwIFI+PgplbmRvYmoKNTMgMCBvYmoKWyAyMjYgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDY0MyAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCA3MTUgMCA2NjIgMCAwIDAgNTQ0XSAKZW5kb2JqCjUwIDAgb2JqCjw8L1R5cGUvU3RydWN0RWxlbS9TL1Jvb3QvUC11dGlsKFRpdGxlKS9LWzQ5IDAgUl0gL1BnIDMgMCBSID4+CmVuZG9iago0OSAwIG9iago8PC9UeXBlL1N0cnVjdEVsZW0vUy9UaXRsZS9QLXV0aWwoSGVhZGluZzEpL0tbNDggMCBSXSAvUGcgMyAwIFIgPj4KZW5kb2JqCjQ4IDAgb2JqCjw8L1R5cGUvU3RydWN0RWxlbS9TL0hlYWRpbmcxL1AvNTAgMCBSL0tbMF0gL1BnIDMgMCBSID4+CmVuZG9iago1MSAwIG9iago8PC9OYW1lcygibG9hbiIpID4+CmVuZG9iago2IDAgb2JqCjw8L051bXMgWzAgWyA0OCAwIFJdIF0gPj4KZW5kb2JqCnhyZWYKMSA0CjAwMDAwMDAwMTAgNjU1MzUgZiAKMDAwMDAwMDAxNSAwMDAwMCBuIAowMDAwMDAwMTgxIDAwMDAwIG4gCjAwMDAwMDAyMzggMDAwMDAgbiAKMTEgMgowMDAwMDAwMDAwIDAwMDAwIGYgCjAwMDAwMDAwMDAgMDAwMDAgZiAKMjEgNAowMDAwMDAyMzMwIDAwMDAwIG4gCjAwMDAwMDI0MTggMDAwMDAgbiAKMDAwMDAwMjU5NSAwMDAwMCBuIAowMDAwMDAyODU4IDAwMDAwIG4gCjQ4IDMKMDAwMDAwMzA3NyAwMDAwMCBuIAowMDAwMDAzMDAwIDAwMDAwIG4gCjAwMDAwMDI5MzUgMDAwMDAgbiAKNTAgMQowMDAwMDAyODY1IDAwMDAwIG4gCjUyIDIKMDAwMDAwMDAwMCAwMDAwMCBmIAowMDAwMDAwMDAwIDAwMDAwIGYgCnRyYWlsZXIKPDwvU2l6ZSA1NS9Sb290IDEgMCBSL0luZm8gMjAgMCBSL0lEWzwyRTA1NzM5MkZDM0JCMTQxQjNDNDkzODNBODY4NDg5OD48MkUwNTczOTJGQzNCQjE0MUIzQzQ5MzgzQTg2ODQ4OTg+XSA+PgpzdGFydHhyZWYKMzE0NQolJUVPRgo=`; //
    try {
      const binaryString = window.atob(base64PDF);
      const len = binaryString.length;
      const bytes = new Uint8Array(len);
      for (let i = 0; i < len; i++) { bytes[i] = binaryString.charCodeAt(i); }
      const pdfBlob = new Blob([bytes.buffer], { type: 'application/pdf' });
      const file = new File([pdfBlob], fileName, { type: 'application/pdf' });
      setClientSidePdfFiles(prev => new Map(prev).set(fileName, file));
      return file;
    } catch (error) {
      console.error("Error creating dummy PDF:", error);
      const minimalPDF = 'JVBERi0xLjAKMSAwIG9iago8PC9UeXBlL0NhdGFsb2cvUGFnZXMgMiAwIFI+PgplbmRvYmoKMiAwIG9iago8PC9UeXBlL1BhZ2VzL0tpZHNbMyAwIFJdL0NvdW50IDE+PgplbmRvYmoKMyAwIG9iago8PC9UeXBlL1BhZ2UvTWVkaWFCb3hbMCAwIDMgM10+PgplbmRvYmoKdHJhaWxlcgo8PC9Sb290IDEgMCBSPj4K';
      const fallbackBytes = Uint8Array.from(window.atob(minimalPDF), c => c.charCodeAt(0));
      return new File([new Blob([fallbackBytes], { type: 'application/pdf' })], fileName, { type: 'application/pdf' });
    }
  };

  useEffect(() => {
    if (results.length === 0) {
      setSelectedFileForPdfPreview(null);
      setSelectedProcessingResult(null);
      return;
    }
    const newPdfFilesMap = new Map(clientSidePdfFiles);
    uniqueFileEntries.forEach(fileInfo => {
      if (fileInfo && fileInfo.fileName && !newPdfFilesMap.has(fileInfo.fileName)) {
        // This updates clientSidePdfFiles via its setState, which will trigger the other useEffect
        createDummyPDF(fileInfo.fileName); 
      }
    });
    if (!selectedProcessingResult && results.length > 0) {
        const firstValidResult = results.find(r => r != null);
        if (firstValidResult) setSelectedProcessingResult(firstValidResult);
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [results, retryPdfCounter]); // Removed clientSidePdfFiles to avoid potential loop if createDummyPDF directly sets it

   useEffect(() => { 
    if (selectedProcessingResult && selectedProcessingResult.fileName) {
        const pdf = clientSidePdfFiles.get(selectedProcessingResult.fileName);
        if (pdf) {
            setSelectedFileForPdfPreview(pdf);
        } else {
            const newPdf = createDummyPDF(selectedProcessingResult.fileName); // create if not in map
            setSelectedFileForPdfPreview(newPdf);
        }
    }
  }, [selectedProcessingResult, clientSidePdfFiles]);


  const handleFileSelect = (fileIdOrName: string, fileName: string) => {
    const pdf = clientSidePdfFiles.get(fileName) || createDummyPDF(fileName);
    setSelectedFileForPdfPreview(pdf);
    const fileResults = resultsByFile[fileIdOrName];
    if (fileResults && fileResults.length > 0) {
      setSelectedProcessingResult(fileResults[0]);
    }
  };

  const handleResultSelect = (result: ProcessingResult) => {
    setSelectedProcessingResult(result);
  };

  const handleRetryLoadingPdf = () => {
    setRetryPdfCounter(prev => prev + 1); 
    if (selectedProcessingResult?.fileName) {
      const newPdf = createDummyPDF(selectedProcessingResult.fileName);
      setSelectedFileForPdfPreview(newPdf);
    }
  };
  // ... (rest of the JSX from the previous correct version) ...
  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-lg font-semibold mb-1">Side by Side Comparison for {selectedBank}</h2>
        <p className="text-sm text-muted-foreground">Compare extracted data with the original document.</p>
      </div>
      
      <div className="grid grid-cols-1 lg:grid-cols-7 gap-4">
        {/* Left sidebar - File and Result selection */}
        <div className="lg:col-span-2">
          <Card className="overflow-hidden h-full flex flex-col dark:bg-gray-800 dark:border-gray-700">
            <div className="bg-black text-white p-2 text-sm font-medium">Processed Files & Prompts</div>
            <ScrollArea className="flex-grow">
              <div className="p-2">
                {uniqueFileEntries.map((fileInfo) => (
                  <div key={fileInfo.fileId || fileInfo.fileName} className="mb-3">
                    <div 
                      className="text-sm font-medium p-2 bg-muted dark:bg-gray-700 rounded-t-md cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600"
                      onClick={() => handleFileSelect(fileInfo.fileId || fileInfo.fileName, fileInfo.fileName)}
                    >
                      {fileInfo.fileName}
                    </div>
                    <div className="border border-t-0 rounded-b-md dark:border-gray-600">
                      {(resultsByFile[fileInfo.fileId || fileInfo.fileName] || []).map(result => (
                        <div 
                          key={result.id}
                          className={cn(
                            "flex items-center justify-between p-2 text-sm cursor-pointer border-b dark:border-gray-600 last:border-b-0",
                            selectedProcessingResult?.id === result.id 
                              ? "bg-yellow-100 dark:bg-yellow-700/50 border-l-4 border-yellow-500 dark:border-yellow-400 text-black dark:text-white" 
                              : "hover:bg-muted/50 dark:hover:bg-gray-700/30"
                          )}
                          onClick={() => handleResultSelect(result)}
                        >
                          <span className="truncate pr-2">{result.promptName}</span>
                          {result.status === 'success' && <Check className="h-4 w-4 text-green-500 flex-shrink-0" />}
                          {result.status === 'error' && <Info className="h-4 w-4 text-red-500 flex-shrink-0" />}
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </ScrollArea>
          </Card>
        </div>
        
        <div className="lg:col-span-2">
          <Card className="overflow-hidden h-full flex flex-col dark:bg-gray-800 dark:border-gray-700">
            <div className="bg-black text-white p-2 text-sm font-medium">Document Preview</div>
            <div className="flex-grow flex flex-col bg-gray-100 dark:bg-gray-700">
              <PDFViewer file={selectedFileForPdfPreview} className="flex-1"/>
              <div className="flex justify-center p-2 bg-card border-t dark:bg-gray-800 dark:border-gray-600">
                <Button variant="outline" size="sm" className="flex items-center gap-2" onClick={handleRetryLoadingPdf}>
                  <RefreshCw className="h-4 w-4" /> Reload PDF Preview
                </Button>
              </div>
            </div>
          </Card>
        </div>
        
        <div className="lg:col-span-3">
          <Card className="overflow-hidden h-full flex flex-col dark:bg-gray-800 dark:border-gray-700">
            <div className="bg-black text-white p-3 flex justify-between items-center">
              <div>
                <div className="font-medium">{selectedProcessingResult?.promptName || "No prompt selected"}</div>
                <div className="text-xs text-gray-400">From: {selectedProcessingResult?.fileName || "N/A"}</div>
              </div>
              {selectedProcessingResult && (
                <Badge className={cn("capitalize", 
                    selectedProcessingResult.status === 'success' && "bg-green-600 text-white",
                    selectedProcessingResult.status === 'error' && "bg-red-600 text-white",
                    selectedProcessingResult.status === 'pending' && "bg-blue-500 text-white",
                    selectedProcessingResult.status === 'processing' && "bg-purple-500 text-white"
                )}>
                  {selectedProcessingResult.status}
                </Badge>
              )}
            </div>
            
            <div className="p-3 flex-grow">
              {selectedProcessingResult && selectedProcessingResult.status === 'success' && selectedProcessingResult.data && selectedProcessingResult.data.length > 0 ? (
                <ScrollArea className="h-[calc(100vh_-_250px)] max-h-[550px]">
                  <Table>
                    <TableHeader className="bg-muted dark:bg-gray-700 sticky top-0">
                      <TableRow className="dark:border-gray-600">
                        <TableHead className="font-semibold dark:text-gray-200">Category</TableHead>
                        <TableHead className="font-semibold dark:text-gray-200">Stage</TableHead>
                        <TableHead className="font-semibold dark:text-gray-200">Field</TableHead>
                        <TableHead className="font-semibold dark:text-gray-200">Value</TableHead>
                      </TableRow>
                    </TableHeader>
                    <TableBody>
                      {selectedProcessingResult.data.map((item, index) => {
                        if (!item) return null;
                        return (
                          <TableRow key={index} className="dark:border-gray-600">
                            <TableCell className="dark:text-gray-300">{item.Category === 'ECL By Stage' ? 'ECL' : item.Category}</TableCell>
                            <TableCell className="dark:text-gray-300">{item.Stage}</TableCell>
                            <TableCell className="dark:text-gray-300">{item.Field}</TableCell>
                            <TableCell className="font-medium dark:text-gray-200">{item.Value}</TableCell>
                          </TableRow>
                        );
                      })}
                    </TableBody>
                  </Table>
                </ScrollArea>
              ) : selectedProcessingResult && selectedProcessingResult.status === 'error' ? (
                 <div className="flex flex-col items-center justify-center h-full text-center p-4">
                    <Info className="h-10 w-10 text-red-500 mb-3" />
                    <p className="font-semibold">Error in this extraction.</p>
                    <p className="text-xs text-muted-foreground mt-1">{selectedProcessingResult.error || "An unknown error occurred."}</p>
                 </div>
              ): (
                <div className="flex flex-col items-center justify-center h-full text-center p-4">
                  <Info className="h-10 w-10 text-muted-foreground mb-3" />
                  <p className="text-muted-foreground">
                    {selectedProcessingResult ? "No data extracted for this result or result not successful." : "Select a result to view extracted data."}
                  </p>
                </div>
              )}
            </div>
          </Card>
        </div>
      </div>
    </div>
  );
};

export default SideBySideTab;
```

# dataextract-ey-main\src\components\dashboard\TabNavigation.tsx

```tsx

import { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Upload, FileText, FileSpreadsheet, Download, LayoutPanelLeft } from 'lucide-react';
import { ThemeToggle } from '@/components/ThemeToggle';

interface TabNavigationProps {
  activeTab: string;
  setActiveTab: (value: string) => void;
}

const TabNavigation = ({ activeTab, setActiveTab }: TabNavigationProps) => {
  return (
    <div className="border-b dark:border-gray-700">
      <div className="container mx-auto px-4 flex items-center justify-between">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
          <TabsList className="grid grid-cols-5 w-full max-w-2xl mx-auto my-4">
            <TabsTrigger 
              value="upload" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <Upload className="h-4 w-4 mr-2" />
              Upload
            </TabsTrigger>
            <TabsTrigger 
              value="prompts" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <FileText className="h-4 w-4 mr-2" />
              Prompts
            </TabsTrigger>
            <TabsTrigger 
              value="results" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <FileSpreadsheet className="h-4 w-4 mr-2" />
              Results
            </TabsTrigger>
            <TabsTrigger 
              value="combined" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <Download className="h-4 w-4 mr-2" />
              Combined
            </TabsTrigger>
            <TabsTrigger 
              value="sidebyside" 
              className="data-[state=active]:bg-yellow-400 data-[state=active]:text-black dark:text-white dark:data-[state=active]:bg-yellow-400 dark:data-[state=active]:text-black"
            >
              <LayoutPanelLeft className="h-4 w-4 mr-2" />
              Side by Side
            </TabsTrigger>
          </TabsList>
        </Tabs>
        <ThemeToggle className="mr-4" />
      </div>
    </div>
  );
};

export default TabNavigation;

```

# dataextract-ey-main\src\components\dashboard\UploadTab.tsx

```tsx
// src/components/dashboard/UploadTab.tsx

import { Button } from '@/components/ui/button';
import FileUploader from '@/components/FileUploader';
import { UploadedFile } from '@/lib/types';
import { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { FileText, Eye, EyeOff, Loader2 } from 'lucide-react';
import PDFViewer from '@/components/PDFViewer';
import { motion } from 'framer-motion';
import { useToast } from '@/hooks/use-toast';

interface UploadTabProps {
  onFilesUploaded: (files: UploadedFile[]) => void;
  uploadedFiles: UploadedFile[];
  goToNextTab: () => void;
}

const UploadTab = ({ onFilesUploaded, uploadedFiles, goToNextTab }: UploadTabProps) => {
  const [selectedFileForPreview, setSelectedFileForPreview] = useState<UploadedFile | null>(null);
  const [showPreview, setShowPreview] = useState<boolean>(true);
  const [pdfFileForPreview, setPdfFileForPreview] = useState<File | null>(null);
  
  // Stores the mapping from a client-generated ID (from FileUploader) to the actual File object.
  // This is used to get the File object for upload and potentially for preview.
  const [clientRawFileMap, setClientRawFileMap] = useState<Map<string, File>>(new Map());
  const [isUploading, setIsUploading] = useState(false);
  const { toast } = useToast();

  // Effect to update preview when dashboard's uploadedFiles (backend confirmed) change
  useEffect(() => {
    if (uploadedFiles.length > 0) {
      const latestBackendFileMeta = uploadedFiles[uploadedFiles.length - 1];
      setSelectedFileForPreview(latestBackendFileMeta);

      // Attempt to find the raw file for preview using its name and size,
      // as backend IDs won't match client-side IDs in clientRawFileMap.
      let fileToPreview: File | null = null;
      for (const rawFile of clientRawFileMap.values()) {
        if (rawFile.name === latestBackendFileMeta.name && rawFile.size === latestBackendFileMeta.size) {
          fileToPreview = rawFile;
          break;
        }
      }
      setPdfFileForPreview(fileToPreview);

    } else {
      setSelectedFileForPreview(null);
      setPdfFileForPreview(null);
    }
  // Listen to uploadedFiles (from Dashboard) and clientRawFileMap (local state for raw files)
  }, [uploadedFiles, clientRawFileMap]);


  // This function is called by FileUploader when files are selected locally
  const handleFilesSelectedByUploader = async (
    clientSideFileMetadataList: UploadedFile[], // Metadata generated by FileUploader (client-side IDs)
    rawFileObjectsMap: Map<string, File> // The actual File objects, mapped by client-side ID
  ) => {
    // Store the raw files mapped by their client-side ID.
    // This map will be used to retrieve the actual File objects for upload.
    setClientRawFileMap(new Map([...clientRawFileMap, ...rawFileObjectsMap]));
    
    setIsUploading(true);
    toast({ title: "Uploading files...", description: `Attempting to upload ${rawFileObjectsMap.size} file(s).` });

    const formData = new FormData();
    let filesToUploadExist = false;
    
    // Iterate over the File objects from the map to append to FormData
    rawFileObjectsMap.forEach(file => {
      formData.append('files', file); 
      filesToUploadExist = true;
    });

    if (!filesToUploadExist) {
        setIsUploading(false);
        toast({ title: "No new files selected to upload.", variant: "default" });
        // Call onFilesUploaded with current backend-confirmed files if no new files were actually added.
        // This ensures consistency if the user re-selects existing files or an empty list.
        onFilesUploaded(uploadedFiles); // Pass the current state from Dashboard
        return;
    }

    try {
      const response = await fetch('http://localhost:5000/api/upload', {
        method: 'POST',
        body: formData,
      });

      const result = await response.json();

      if (response.ok && result.status === 'success' && result.files) {
        // `result.files` are the UploadedFile objects from the backend.
        // These have backend-generated IDs.
        // We should merge these with any existing uploaded files, handling potential duplicates if necessary.
        // For simplicity here, we'll assume new uploads replace or add.
        // A more robust solution might check for existing files by name/size if re-uploading is possible.
        
        // Create a map of existing files by their backend ID for quick lookup
        const existingFilesMap = new Map(uploadedFiles.map(f => [f.id, f]));
        const newBackendFiles = result.files as UploadedFile[];

        newBackendFiles.forEach(backendFile => {
            existingFilesMap.set(backendFile.id, backendFile); // Add or update file by backend ID
        });
        
        const updatedFilesForDashboard = Array.from(existingFilesMap.values());
        onFilesUploaded(updatedFilesForDashboard); // Update Dashboard state

        toast({
          title: "Upload Successful",
          description: `${newBackendFiles.length} file(s) processed by server. Total uploaded: ${updatedFilesForDashboard.length}`,
        });
      } else {
        throw new Error(result.error || 'Unknown upload error from server');
      }
    } catch (error) {
      console.error("Upload error:", error);
      toast({
        title: "Upload Failed",
        description: error instanceof Error ? error.message : "Could not upload files to server.",
        variant: "destructive",
      });
      // Optionally, you might want to revert clientRawFileMap or not call onFilesUploaded
      // depending on how you want to handle partial failures or retries.
      // For now, we don't change the dashboard's uploadedFiles state on failure here.
    } finally {
      setIsUploading(false);
    }
  };

  const togglePreview = () => {
    setShowPreview(!showPreview);
  };

  // Handle selection for preview from the `uploadedFiles` list (which are backend confirmed)
  const handleFileSelectionForPreview = (fileMetadata: UploadedFile) => {
    setSelectedFileForPreview(fileMetadata);
    // Attempt to find the corresponding raw file for preview from the clientRawFileMap
    // This relies on the raw files being available client-side.
    // If files are cleared from clientRawFileMap after upload, this preview might not work for older files.
    let fileToPreview: File | null = null;
    for (const rawFile of clientRawFileMap.values()) {
        // Match by name and size as IDs might differ (client vs backend)
        if (rawFile.name === fileMetadata.name && rawFile.size === fileMetadata.size) {
            fileToPreview = rawFile;
            break;
        }
    }
    if (fileToPreview) {
      setPdfFileForPreview(fileToPreview);
    } else {
      setPdfFileForPreview(null); 
      toast({title: "Preview unavailable", description: "Original file for preview not found locally.", variant: "default"})
    }
  };

  return (
    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div className="lg:col-span-1 space-y-6">
        <FileUploader 
          onFilesUploaded={handleFilesSelectedByUploader} 
          acceptedFileTypes={['.pdf']}
        />
        
        {isUploading && (
          <div className="flex items-center justify-center p-4 border rounded-md bg-muted">
            <Loader2 className="h-5 w-5 animate-spin mr-2" />
            <span>Uploading files...</span>
          </div>
        )}

        {uploadedFiles.length > 0 && !isUploading && (
          <motion.div 
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ duration: 0.3 }}
            className="border rounded-md"
          >
            <div className="bg-muted p-3 font-medium flex justify-between items-center">
              <div>Uploaded Files ({uploadedFiles.length}/10)</div>
              <Button 
                variant="ghost" 
                size="sm" 
                className="h-8 px-2 text-muted-foreground"
                onClick={togglePreview}
              >
                {showPreview ? <EyeOff className="h-4 w-4 mr-1" /> : <Eye className="h-4 w-4 mr-1" />}
                {showPreview ? "Hide Preview" : "Show Preview"}
              </Button>
            </div>
            <div className="divide-y max-h-[300px] overflow-y-auto">
              {uploadedFiles.map((file) => ( 
                <motion.div
                  key={file.id} 
                  className={`p-3 flex items-center justify-between cursor-pointer hover:bg-muted/50 transition-colors ${selectedFileForPreview?.id === file.id ? 'bg-yellow-50 border-l-2 border-yellow-400' : ''}`}
                  onClick={() => handleFileSelectionForPreview(file)}
                >
                  <div className="flex items-center">
                    <FileText className="h-4 w-4 text-muted-foreground mr-2" />
                    <span className="text-sm font-medium">{file.name}</span>
                  </div>
                  <div className="text-xs text-muted-foreground">
                    {Math.round(file.size / 1024).toLocaleString()} KB
                  </div>
                </motion.div>
              ))}
            </div>
          </motion.div>
        )}
      </div>

      {uploadedFiles.length > 0 && selectedFileForPreview && showPreview && !isUploading && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ duration: 0.3 }}
          className="lg:col-span-2"
        >
          <Card className="h-full">
            <CardHeader className="pb-3">
              <CardTitle className="text-base flex items-center justify-between">
                <div className="flex items-center">
                  <FileText className="h-4 w-4 mr-2" />
                  PDF Preview
                </div>
                <div className="text-sm font-normal">
                  {selectedFileForPreview.name}
                </div>
              </CardTitle>
            </CardHeader>
            <CardContent className="p-0">
              <div className="bg-muted/30 h-[750px] flex flex-col">
                <PDFViewer file={pdfFileForPreview} className="h-full" />
              </div>
            </CardContent>
          </Card>
        </motion.div>
      )}

      <div className="flex justify-end col-span-full">
        <motion.div>
          <Button 
            onClick={goToNextTab} 
            disabled={uploadedFiles.length === 0 || isUploading}
            className="bg-yellow-400 hover:bg-yellow-500 text-black"
          >
            {isUploading ? <Loader2 className="h-4 w-4 animate-spin mr-2" /> : null}
            {isUploading ? "Uploading..." : "Next: Select Prompts"}
          </Button>
        </motion.div>
      </div>
    </div>
  );
};

export default UploadTab;
```

# dataextract-ey-main\src\components\FileUploader.tsx

```tsx

import { useState, useRef, useCallback } from 'react';
import { Button } from '@/components/ui/button';
import { UploadedFile } from '@/lib/types';
import { Upload, FileText, X, Check, Loader } from 'lucide-react';
import { Progress } from '@/components/ui/progress';
import { cn } from '@/lib/utils';
import { useToast } from '@/hooks/use-toast';

interface FileUploaderProps {
  onFilesUploaded: (files: UploadedFile[], actualFiles: Map<string, File>) => void;
  acceptedFileTypes?: string[];
  maxFiles?: number;
}

const FileUploader = ({ 
  onFilesUploaded, 
  acceptedFileTypes = ['.pdf'], 
  maxFiles = 10 
}: FileUploaderProps) => {
  const [files, setFiles] = useState<UploadedFile[]>([]);
  const [isDragging, setIsDragging] = useState(false);
  const fileInputRef = useRef<HTMLInputElement>(null);
  const [actualFiles, setActualFiles] = useState<Map<string, File>>(new Map());
  const { toast } = useToast();

  const handleFileSelect = useCallback((selectedFiles: FileList | null) => {
    if (!selectedFiles || selectedFiles.length === 0) return;

    // Check if adding these files would exceed the maximum
    if (files.length + selectedFiles.length > maxFiles) {
      toast({
        title: "Too many files",
        description: `You can upload a maximum of ${maxFiles} files.`,
        variant: "destructive",
      });
      return;
    }

    const newFiles: UploadedFile[] = [];
    const newActualFiles = new Map(actualFiles);
    
    Array.from(selectedFiles).forEach(file => {
      // Check file type
      const fileExtension = `.${file.name.split('.').pop()?.toLowerCase()}`;
      if (!acceptedFileTypes.includes(fileExtension) && !acceptedFileTypes.includes('*')) {
        toast({
          title: "Invalid file type",
          description: `${file.name} is not a supported file type. Please upload ${acceptedFileTypes.join(", ")} files.`,
          variant: "destructive",
        });
        return;
      }
      
      // File is valid, add it to our list
      const fileId = `file-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
      const newFile: UploadedFile = {
        id: fileId,
        name: file.name,
        size: file.size,
        type: file.type,
        lastModified: file.lastModified,
        status: 'success' as const,  // Mark as success immediately for simplicity
        progress: 100,  // Set to 100% immediately
      };
      
      // Store the actual File object in our Map
      newActualFiles.set(fileId, file);
      newFiles.push(newFile);
    });
    
    if (newFiles.length > 0) {
      // Update state in a single batch
      const updatedFiles = [...files, ...newFiles];
      setFiles(updatedFiles);
      setActualFiles(newActualFiles);
      
      // Notify parent component after our state is updated
      setTimeout(() => {
        onFilesUploaded(updatedFiles, newActualFiles);
      }, 0);
    }
  }, [files, actualFiles, maxFiles, acceptedFileTypes, onFilesUploaded, toast]);

  const removeFile = useCallback((id: string) => {
    const updatedFiles = files.filter(file => file.id !== id);
    setFiles(updatedFiles);
    
    // Also remove the actual File object
    const newActualFiles = new Map(actualFiles);
    newActualFiles.delete(id);
    setActualFiles(newActualFiles);
    
    onFilesUploaded(updatedFiles, newActualFiles);
  }, [files, actualFiles, onFilesUploaded]);

  const formatFileSize = (sizeInBytes: number) => {
    if (sizeInBytes < 1024) return `${sizeInBytes} B`;
    else if (sizeInBytes < 1048576) return `${(sizeInBytes / 1024).toFixed(1)} KB`;
    else return `${(sizeInBytes / 1048576).toFixed(1)} MB`;
  };

  const handleDragOver = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(true);
  };

  const handleDragLeave = () => {
    setIsDragging(false);
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(false);
    handleFileSelect(e.dataTransfer.files);
  };

  return (
    <div className="w-full space-y-4">
      {/* File upload area */}
      <div
        className={cn(
          "border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors",
          isDragging ? "border-yellow-400 bg-yellow-50" : "border-muted-foreground/20",
          files.length >= maxFiles && "opacity-50 cursor-not-allowed"
        )}
        onDragOver={handleDragOver}
        onDragLeave={handleDragLeave}
        onDrop={handleDrop}
        onClick={() => files.length < maxFiles && fileInputRef.current?.click()}
      >
        <input
          type="file"
          ref={fileInputRef}
          className="hidden"
          accept={acceptedFileTypes.join(',')}
          multiple
          onChange={(e) => handleFileSelect(e.target.files)}
          disabled={files.length >= maxFiles}
        />
        <div className="flex flex-col items-center justify-center gap-2">
          <Upload className="h-12 w-12 text-muted-foreground" />
          <h3 className="text-lg font-medium">Upload PDF Financial Reports</h3>
          <p className="text-sm text-muted-foreground max-w-md mx-auto">
            Drag and drop files here, or click to browse. We accept PDF files with financial data.
          </p>
          <Button 
            variant="outline"
            className="mt-2"
            disabled={files.length >= maxFiles}
          >
            Select Files
          </Button>
        </div>
      </div>

      {/* File list */}
      {files.length > 0 && (
        <div className="mt-6">
          <h3 className="font-medium mb-2 text-sm">Uploaded Files ({files.length}/{maxFiles})</h3>
          <div className="space-y-2">
            {files.map(file => (
              <div 
                key={file.id} 
                className="flex items-center p-3 bg-muted/30 rounded-md border"
              >
                <FileText className="h-5 w-5 text-muted-foreground mr-3" />
                <div className="flex-1 min-w-0">
                  <div className="flex justify-between">
                    <p className="text-sm font-medium truncate">{file.name}</p>
                    <span className="text-xs text-muted-foreground">{formatFileSize(file.size)}</span>
                  </div>
                  {file.status === 'pending' && (
                    <Progress value={file.progress} className="h-1 mt-1" />
                  )}
                </div>
                <div className="ml-4 flex items-center">
                  {file.status === 'pending' && <Loader className="h-4 w-4 text-muted-foreground animate-spin" />}
                  {file.status === 'success' && <Check className="h-4 w-4 text-green-500" />}
                  {file.status === 'error' && <X className="h-4 w-4 text-destructive" />}
                  <button 
                    onClick={(e) => {
                      e.stopPropagation();
                      removeFile(file.id);
                    }}
                    className="ml-2 text-muted-foreground hover:text-destructive transition-colors"
                  >
                    <X className="h-4 w-4" />
                  </button>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
};

export default FileUploader;

```

# dataextract-ey-main\src\components\IntroScreen.tsx

```tsx
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { useNavigate } from 'react-router-dom';
import { Progress } from '@/components/ui/progress';
import { motion } from 'framer-motion';

const IntroScreen = () => {
  const navigate = useNavigate();
  const [loading, setLoading] = useState(true);
  const [loadingProgress, setLoadingProgress] = useState(0);
  
  useEffect(() => {
    // Simulate progressive loading
    const totalTime = 2000; // 2 seconds
    const intervalTime = 50; // update every 50ms
    const steps = totalTime / intervalTime;
    let currentStep = 0;
    
    const timer = setInterval(() => {
      currentStep += 1;
      const newProgress = Math.min(100, Math.floor((currentStep / steps) * 100));
      setLoadingProgress(newProgress);
      
      if (newProgress >= 100) {
        clearInterval(timer);
        setTimeout(() => setLoading(false), 200);
      }
    }, intervalTime);
    
    return () => clearInterval(timer);
  }, []);

  const handleEnterApp = () => {
    navigate('/select-bank');
  };

  // Animation variants for the logo and letters
  const containerVariants = {
    hidden: { opacity: 0 },
    visible: {
      opacity: 1,
      transition: {
        delayChildren: 0.3,
        staggerChildren: 0.1
      }
    }
  };

  const letterVariants = {
    hidden: { y: 20, opacity: 0 },
    visible: {
      y: 0,
      opacity: 1,
      transition: {
        type: "spring",
        damping: 12,
        stiffness: 100
      }
    }
  };

  const floatVariants = {
    animate: {
      y: [0, -10, 0],
      transition: {
        duration: 2,
        repeat: Infinity,
        repeatType: "reverse" as const,
        ease: "easeInOut"
      }
    }
  };

  const logoVariants = {
    hidden: { scale: 0.8, opacity: 0 },
    visible: {
      scale: 1,
      opacity: 1,
      transition: {
        type: "spring",
        damping: 12,
        stiffness: 100
      }
    }
  };

  // Combined animation for the logo that includes floating effect
  const logoAnimation = {
    scale: 1,
    opacity: 1,
    y: [0, -8, 0]
  };
  
  // Combined transition for the logo
  const logoTransition = {
    scale: {
      type: "spring",
      damping: 12,
      stiffness: 100
    },
    opacity: {
      type: "spring",
      damping: 12,
      stiffness: 100
    },
    y: {
      duration: 3,
      repeat: Infinity,
      repeatType: "reverse",
      ease: "easeInOut"
    }
  };
  
  const buttonVariants = {
    initial: { scale: 1 },
    hover: { 
      scale: 1.05,
      transition: { type: "spring", stiffness: 400, damping: 10 }
    },
    tap: { scale: 0.95 }
  };

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-ey-black text-white">
      <div className="w-full max-w-md px-6 py-12 text-center">
        <motion.div 
          className="mb-8"
          initial="hidden"
          animate="visible"
          variants={containerVariants}
        >
          <motion.div 
            className="flex justify-center mb-6"
          >
            <motion.div 
              className="h-16 w-16 bg-ey-yellow rounded-md"
              variants={logoVariants}
              initial="hidden"
              animate={logoAnimation}
              transition={logoTransition}
              whileHover={{ scale: 1.05 }}
            ></motion.div>
          </motion.div>
          
          <motion.h1 
            className="text-4xl font-bold mb-2 flex justify-center"
            variants={containerVariants}
          >
            {Array.from("AiDEx").map((letter, index) => (
              <motion.span
                key={index}
                className="inline-block"
                variants={letterVariants}
                custom={index}
                whileHover={floatVariants.animate}
              >
                {letter}
              </motion.span>
            ))}
          </motion.h1>
          
          <motion.p 
            className="text-ey-gray-400"
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.8 }}
          >
            AI powered Data Extraction
          </motion.p>
          
          <motion.p 
            className="text-ey-gray-500 text-sm mt-1"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 1 }}
          >
            Supported by EYQ
          </motion.p>
        </motion.div>
        
        {loading ? (
          <motion.div 
            className="space-y-3"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.5 }}
          >
            <Progress 
              value={loadingProgress} 
              className="h-2" 
              indicatorClassName="bg-ey-yellow" 
            />
            <p className="text-sm text-ey-gray-400 animate-pulse">
              Loading application... {loadingProgress}%
            </p>
          </motion.div>
        ) : (
          <motion.div
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2 }}
          >
            <motion.button
              onClick={handleEnterApp}
              className="w-full bg-ey-yellow hover:bg-ey-yellow/90 text-ey-black font-medium py-2 px-4 rounded"
              variants={buttonVariants}
              initial="initial"
              whileHover="hover"
              whileTap="tap"
            >
              Enter Application
            </motion.button>
          </motion.div>
        )}
        
        <motion.div 
          className="mt-12 text-xs text-ey-gray-500"
          initial={{ opacity: 0 }}
          animate={{ opacity: 0.7 }}
          transition={{ delay: 1.2 }}
        >
          <p>© {new Date().getFullYear()} EY | A better working world</p>
        </motion.div>
      </div>
    </div>
  );
};

export default IntroScreen;

```

# dataextract-ey-main\src\components\PDFViewer.tsx

```tsx

import { useState, useEffect, useRef } from 'react';
import * as pdfjs from 'pdfjs-dist';
import { Button } from '@/components/ui/button';
import { ChevronLeft, ChevronRight, Loader, RefreshCw } from 'lucide-react';
import { ScrollArea } from '@/components/ui/scroll-area';

// Fix worker import
import { GlobalWorkerOptions } from 'pdfjs-dist';

// Set worker source directly
GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.min.js`;

interface PDFViewerProps {
  file: File | null;
  className?: string;
}

const PDFViewer = ({ file, className = '' }: PDFViewerProps) => {
  const [pdfDoc, setPdfDoc] = useState<pdfjs.PDFDocumentProxy | null>(null);
  const [pageNum, setPageNum] = useState(1);
  const [totalPages, setTotalPages] = useState(0);
  const [isLoading, setIsLoading] = useState(false);
  const [renderError, setRenderError] = useState<string | null>(null);
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const [retryCount, setRetryCount] = useState(0); // Track retry attempts
  const containerRef = useRef<HTMLDivElement>(null);

  // Load the PDF when the file changes or when retryCount changes
  useEffect(() => {
    if (!file) {
      setPdfDoc(null);
      return;
    }

    let isMounted = true;
    
    // Reset states
    setIsLoading(true);
    setRenderError(null);
    
    console.log("Starting to load PDF file:", file.name);
    
    // Convert file to array buffer
    const fileReader = new FileReader();
    
    fileReader.onload = async (event) => {
      if (!isMounted) return;
      
      try {
        const arrayBuffer = event.target?.result;
        
        if (!arrayBuffer) {
          setRenderError("Failed to read file");
          setIsLoading(false);
          return;
        }
        
        // Load the PDF document
        const typedArray = new Uint8Array(arrayBuffer as ArrayBuffer);
        
        console.log("Creating PDF loading task");
        const loadingTask = pdfjs.getDocument(typedArray);
        
        loadingTask.promise
          .then(pdf => {
            if (!isMounted) return;
            
            console.log("PDF loaded successfully with", pdf.numPages, "pages");
            setPdfDoc(pdf);
            setTotalPages(pdf.numPages);
            setPageNum(1); // Reset to first page when loading new PDF
            setIsLoading(false);
          })
          .catch(error => {
            if (!isMounted) return;
            
            console.error('Error loading PDF:', error);
            setRenderError(`Error loading PDF: ${error.message}`);
            setIsLoading(false);
          });
      } catch (error: any) {
        if (!isMounted) return;
        
        console.error('Error processing PDF:', error);
        setRenderError(`Error processing PDF: ${error.message}`);
        setIsLoading(false);
      }
    };
    
    fileReader.onerror = () => {
      if (!isMounted) return;
      
      setRenderError("Error reading file");
      setIsLoading(false);
    };
    
    // Start reading the file
    fileReader.readAsArrayBuffer(file);
    
    return () => {
      isMounted = false;
      if (pdfDoc) {
        try {
          pdfDoc.destroy().catch(e => console.error("Error destroying PDF:", e));
        } catch (error) {
          console.error("Error destroying previous PDF:", error);
        }
      }
    };
  }, [file, retryCount]);

  // Render the PDF page
  useEffect(() => {
    if (!pdfDoc || !canvasRef.current) return;

    let isMounted = true;
    
    const renderPage = async () => {
      if (!isMounted) return;
      
      try {
        // Get the page
        console.log("Getting page", pageNum);
        const page = await pdfDoc.getPage(pageNum);
        
        if (!isMounted || !canvasRef.current) return;
        
        const canvas = canvasRef.current;
        const context = canvas.getContext('2d');
        
        if (!context) {
          setRenderError("Could not get canvas context");
          return;
        }
        
        // Calculate scale to fit width
        const containerWidth = containerRef.current?.clientWidth || canvas.parentElement?.clientWidth || 800;
        const viewport = page.getViewport({ scale: 1.0 });
        const scale = Math.min(containerWidth / viewport.width, 1.0); // Limit scale to 1.0 for better quality
        const scaledViewport = page.getViewport({ scale });

        // Set canvas dimensions
        canvas.height = scaledViewport.height;
        canvas.width = scaledViewport.width;
        
        // Improve rendering quality
        context.imageSmoothingEnabled = true;
        context.imageSmoothingQuality = 'high';
        
        // Set background color
        context.fillStyle = '#FFFFFF';
        context.fillRect(0, 0, canvas.width, canvas.height);
        
        // Render the page
        console.log("Rendering page", pageNum, "of PDF");
        const renderContext = {
          canvasContext: context,
          viewport: scaledViewport,
          background: 'rgba(255,255,255,1)',
        };
        
        await page.render(renderContext).promise;
        
        // Add subtle page border
        context.strokeStyle = '#e2e8f0';
        context.lineWidth = 1;
        context.strokeRect(0, 0, canvas.width, canvas.height);
      } catch (error: any) {
        if (isMounted) {
          console.error('Error rendering page:', error);
          setRenderError(`Error rendering page: ${error.message}`);
        }
      }
    };

    renderPage();
    
    return () => {
      isMounted = false;
    };
  }, [pdfDoc, pageNum]);

  // Effect to adjust canvas size when window resizes
  useEffect(() => {
    const handleResize = () => {
      // Re-render the current page to adjust for new container width
      if (pdfDoc) {
        // Simply update pageNum state to trigger re-render effect
        setPageNum(prevPage => prevPage);
      }
    };

    window.addEventListener('resize', handleResize);
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, [pdfDoc]);

  const goToPreviousPage = () => {
    if (pageNum <= 1) return;
    setPageNum(pageNum - 1);
  };

  const goToNextPage = () => {
    if (pageNum >= totalPages) return;
    setPageNum(pageNum + 1);
  };

  // Create a simple PDF retry button
  const handleRetry = () => {
    if (!file) return;
    setRetryCount(retryCount + 1); // Increment retry count to trigger useEffect
    setIsLoading(true);
    setRenderError(null);
  };

  return (
    <div className={`flex flex-col h-full ${className}`}>
      <ScrollArea className="flex-1 h-full bg-gray-50">
        <div ref={containerRef} className="flex justify-center p-4">
          {isLoading ? (
            <div className="flex flex-col items-center justify-center h-64 w-full">
              <Loader className="h-8 w-8 animate-spin text-yellow-400 mb-4" />
              <div className="text-muted-foreground">
                Loading PDF...
              </div>
            </div>
          ) : renderError ? (
            <div className="flex flex-col items-center justify-center h-64 w-full">
              <div className="text-red-500 mb-4">{renderError}</div>
              <Button 
                variant="outline" 
                size="sm"
                onClick={handleRetry}
                className="flex items-center gap-2"
              >
                <RefreshCw className="h-4 w-4" />
                Retry Loading PDF
              </Button>
            </div>
          ) : !pdfDoc ? (
            <div className="flex items-center justify-center h-64 w-full">
              <div className="text-center">
                <div className="text-muted-foreground mb-2">No PDF selected</div>
                <div className="text-xs text-muted-foreground">Upload a PDF document to view it here</div>
              </div>
            </div>
          ) : (
            <div className="relative shadow-lg bg-white rounded-lg p-1">
              <canvas ref={canvasRef} className="relative z-10 rounded-lg" />
            </div>
          )}
        </div>
      </ScrollArea>

      {pdfDoc && (
        <div className="p-2 border-t bg-white flex justify-between items-center">
          <div className="text-sm text-gray-600 truncate max-w-[150px]">
            {file?.name || "Document"}
          </div>
          <div className="flex items-center space-x-2">
            <Button
              variant="outline"
              size="icon"
              className="h-8 w-8"
              disabled={pageNum === 1}
              onClick={goToPreviousPage}
            >
              <ChevronLeft className="h-4 w-4" />
            </Button>
            <span className="text-sm font-medium min-w-[50px] text-center">
              {pageNum} / {totalPages}
            </span>
            <Button
              variant="outline"
              size="icon"
              className="h-8 w-8"
              disabled={pageNum === totalPages}
              onClick={goToNextPage}
            >
              <ChevronRight className="h-4 w-4" />
            </Button>
          </div>
        </div>
      )}
    </div>
  );
};

export default PDFViewer;

```

# dataextract-ey-main\src\components\ProcessingStatus.tsx

```tsx

import { Card, CardContent } from "@/components/ui/card";
import { Progress } from "@/components/ui/progress";
import { cn } from "@/lib/utils";
import { Loader } from "lucide-react";

interface ProcessingStatusProps {
  isProcessing: boolean;
  progress: number;
  currentStep: string;
  totalFiles?: number;
  processedFiles?: number;
  className?: string;
}

const ProcessingStatus = ({
  isProcessing,
  progress,
  currentStep,
  totalFiles = 1,
  processedFiles = 0,
  className
}: ProcessingStatusProps) => {
  if (!isProcessing) return null;

  return (
    <Card className={cn("border-yellow-400 bg-yellow-50", className)}>
      <CardContent className="p-4 space-y-3">
        <div className="flex items-center justify-between">
          <div>
            <div className="flex items-center text-sm">
              <span className="font-medium text-black">Processing</span>
              <span className="ml-2 text-black/70">{processedFiles}/{totalFiles} files</span>
            </div>
            <p className="text-xs text-black/70">Extracting financial data from reports</p>
          </div>
          <Loader className="h-4 w-4 text-yellow-500 animate-spin" />
        </div>
        
        <div className="space-y-2">
          <div className="text-sm font-medium text-black">{currentStep}</div>
          <div className="relative">
            <Progress 
              value={progress} 
              className="h-2" 
              indicatorClassName="bg-yellow-400" 
            />
            <div className="absolute right-0 top-0 -mt-5 text-xs font-medium text-black">
              {progress.toFixed(1)}%
            </div>
          </div>
          <div className="text-xs text-black/70">
            Processing financial data, please wait...
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

export default ProcessingStatus;

```

# dataextract-ey-main\src\components\PromptDescriptions.tsx

```tsx
// src/components/PromptDescriptions.tsx

import { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from "@/components/ui/accordion";
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { Building2, FileText, Newspaper, Info } from "lucide-react"; 
import { PromptOption } from "@/lib/types"; 
import { useEffect, useState, useMemo } from "react";

interface PromptDescriptionsProps {
  availablePrompts: PromptOption[]; 
  bankDisplay: string; 
}

interface GroupedPrompts {
  [groupTitle: string]: { 
    prompts: PromptOption[];
    isBankGroup?: boolean; 
    categories?: { 
        [categoryName: string]: PromptOption[];
    }
  };
}

// Helper function defined outside or at the top of the component file
const getCategoryIcon = (groupName: string, isBankGroup?: boolean): JSX.Element => {
  if (isBankGroup) return <Building2 className="h-5 w-5 text-yellow-500 flex-shrink-0" />;
  const lowerGroupName = groupName.toLowerCase();
  if (lowerGroupName.includes("ecl") || lowerGroupName.includes("credit risk")) return <FileText className="h-5 w-5 text-yellow-500 flex-shrink-0" />;
  if (lowerGroupName.includes("scenario")) return <Newspaper className="h-5 w-5 text-yellow-500 flex-shrink-0" />;
  if (lowerGroupName.includes("methodology")) return <Info className="h-5 w-5 text-yellow-500 flex-shrink-0" />;
  return <Info className="h-5 w-5 text-yellow-500 flex-shrink-0" />; 
};

const PromptDescriptions = ({ availablePrompts, bankDisplay }: PromptDescriptionsProps) => {
  const [isMultiBankMode, setIsMultiBankMode] = useState(false);
  
  useEffect(() => {
    setIsMultiBankMode(sessionStorage.getItem('enableMultiBanks') === 'true');
  }, []); // Run once on mount or when relevant session storage might change

  const groupedPrompts = useMemo(() => {
    const enableMulti = sessionStorage.getItem('enableMultiBanks') === 'true';
    // setIsMultiBankMode(enableMulti); // Setting state inside useMemo is an anti-pattern. Moved to useEffect.

    if (!availablePrompts || availablePrompts.length === 0) {
      return {};
    }

    const newGroupedPrompts: GroupedPrompts = {};
    if (enableMulti) {
      availablePrompts.forEach(prompt => {
        const bankKey = prompt.bankName || "Other Banks";
        if (!newGroupedPrompts[bankKey]) {
          newGroupedPrompts[bankKey] = { prompts: [], isBankGroup: true, categories: {} };
        }
        newGroupedPrompts[bankKey].prompts.push(prompt);
        
        const categoryKey = prompt.category || "Default Prompts";
        // Ensure categories object exists before pushing
        if (!newGroupedPrompts[bankKey].categories) {
            newGroupedPrompts[bankKey].categories = {};
        }
        if (!newGroupedPrompts[bankKey].categories![categoryKey]) {
          newGroupedPrompts[bankKey].categories![categoryKey] = [];
        }
        newGroupedPrompts[bankKey].categories![categoryKey].push(prompt);
      });
    } else {
      // Single bank mode: group by prompt.category directly
      let singleBankPromptsCategorized: Record<string, PromptOption[]> = {};
      availablePrompts.forEach(prompt => {
          const categoryKey = prompt.category || "Default Prompts";
           if (!singleBankPromptsCategorized[categoryKey]) {
            singleBankPromptsCategorized[categoryKey] = [];
          }
          singleBankPromptsCategorized[categoryKey].push(prompt);
      });
      // If single bank, the top-level group IS the category
      for(const categoryKey in singleBankPromptsCategorized) {
        newGroupedPrompts[categoryKey] = { prompts: singleBankPromptsCategorized[categoryKey], isBankGroup: false };
      }
    }
    return newGroupedPrompts;
  }, [availablePrompts, bankDisplay]); // isMultiBankMode will be stable from its own useEffect

  const renderPromptList = (prompts: PromptOption[]) => (
    prompts.map((prompt) => (
      <div key={prompt.id} className="bg-muted/40 dark:bg-slate-800/30 p-3 rounded-md border border-gray-200 dark:border-slate-700/60 space-y-1.5">
        <div className="font-semibold text-sm text-foreground">{prompt.name}</div>
        {prompt.description && (
          <p className="text-xs text-muted-foreground italic">
            {prompt.description}
          </p>
        )}
        <details className="text-xs">
          <summary className="cursor-pointer text-blue-600 dark:text-blue-400 hover:underline focus:outline-none">
            Show Actual Prompt Text
          </summary>
          <pre className="mt-1.5 p-2 bg-gray-100 dark:bg-slate-900/50 rounded text-xs whitespace-pre-wrap break-words overflow-x-auto max-h-48">
            {prompt.template}
          </pre>
        </details>
      </div>
    ))
  );

  // ... (rest of the JSX from the previous correct version) ...
  return (
    <Card className="shadow-sm border-gray-200 dark:border-gray-700 h-full flex flex-col">
      <CardHeader className="bg-gray-50 dark:bg-slate-800/50 border-b dark:border-gray-700">
        <CardTitle className="text-lg flex items-center">
          <Building2 className="mr-2 h-5 w-5 text-yellow-500 flex-shrink-0" />
          Available Extraction Prompts
        </CardTitle>
        <CardDescription className="dark:text-slate-400">
          Details of prompts loaded from the CSV for: <span className="font-medium">{bankDisplay}</span>.
        </CardDescription>
      </CardHeader>
      <CardContent className="pt-4 flex-grow overflow-y-auto">
        {availablePrompts.length === 0 ? (
          <div className="text-center py-10 h-full flex flex-col justify-center items-center">
            <Info className="h-10 w-10 text-muted-foreground mb-3" />
            <p className="text-muted-foreground">No predefined prompts loaded for {bankDisplay}.</p>
            <p className="text-sm text-muted-foreground mt-1">Prompts are sourced from the central CSV file via the backend.</p>
          </div>
        ) : (
          <Accordion type={isMultiBankMode ? "multiple" : "single"} collapsible className="w-full">
            {Object.entries(groupedPrompts).map(([groupTitle, groupData]) => (
              <AccordionItem key={groupTitle} value={groupTitle} className="border-b dark:border-slate-700 last:border-b-0">
                <AccordionTrigger className="hover:bg-gray-100 dark:hover:bg-slate-700/40 px-4 py-3 rounded-t-md text-left">
                  <div className="flex items-center">
                    {getCategoryIcon(groupTitle, groupData.isBankGroup)}
                    <span className="ml-3 font-medium text-foreground">{groupTitle} ({groupData.prompts.length})</span>
                  </div>
                </AccordionTrigger>
                <AccordionContent className="px-2 pt-1 pb-3 space-y-2 bg-background dark:bg-slate-800/10 rounded-b-md">
                  {groupData.isBankGroup && groupData.categories ? (
                    <Accordion type="multiple" className="w-full pl-2">
                      {Object.entries(groupData.categories).map(([categoryName, promptsInCategory]) => (
                         <AccordionItem key={`${groupTitle}-${categoryName}`} value={`${groupTitle}-${categoryName}`} className="border-none">
                           <AccordionTrigger className="text-sm hover:bg-gray-50 dark:hover:bg-slate-700/20 px-2 py-2 rounded-md text-left">
                             <div className="flex items-center">
                               {getCategoryIcon(categoryName, false)} {/* isBankGroup is false for categories */}
                               <span className="ml-2 font-normal">{categoryName} ({promptsInCategory.length})</span>
                             </div>
                           </AccordionTrigger>
                           <AccordionContent className="px-2 pt-1 pb-2 space-y-2">
                             {renderPromptList(promptsInCategory)}
                           </AccordionContent>
                         </AccordionItem>
                      ))}
                    </Accordion>
                  ) : (
                    renderPromptList(groupData.prompts)
                  )}
                </AccordionContent>
              </AccordionItem>
            ))}
          </Accordion>
        )}
      </CardContent>
      <CardFooter className="bg-gray-50 dark:bg-slate-800/30 text-xs text-center py-3 border-t dark:border-gray-700 mt-auto">
        <div className="w-full flex items-center justify-center">
          <span className="text-slate-500 dark:text-slate-400">Supported by</span>
          <span className="font-semibold text-black dark:text-white ml-1">EYQ</span>
          <span className="text-slate-500 dark:text-slate-400 ml-1">natural language processing</span>
        </div>
      </CardFooter>
    </Card>
  );
};

export default PromptDescriptions;
```

# dataextract-ey-main\src\components\PromptSelector.tsx

```tsx
// src/components/PromptSelector.tsx

import { useState, useEffect, useCallback } from 'react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'; //
import { Label } from '@/components/ui/label'; //
import { Input } from '@/components/ui/input'; //
import { Button } from '@/components/ui/button'; //
import { Check, FileText, Upload, Loader2 } from 'lucide-react';
import { PromptOption } from '@/lib/types';
import { ScrollArea } from '@/components/ui/scroll-area'; //
import { Badge } from '@/components/ui/badge'; //
import { cn } from '@/lib/utils'; //
import { parseExcelPrompts } from '@/lib/excelUtils'; //
import { useToast } from '@/hooks/use-toast'; //

interface PromptSelectorProps {
  onPromptsApplied: (prompts: PromptOption[]) => void; // Changed from onPromptSelected
  disabled?: boolean;
  availablePredefinedPrompts: PromptOption[];
  initiallyTickedPrompts?: PromptOption[]; // Renamed for clarity
  bankDisplay: string;
}

const PromptSelector = ({ 
  onPromptsApplied, 
  disabled = false,
  availablePredefinedPrompts,
  initiallyTickedPrompts = [],
  bankDisplay
}: PromptSelectorProps) => {
  // Local state for user's temporary selections before applying
  const [locallyTickedPrompts, setLocallyTickedPrompts] = useState<PromptOption[]>([]);
  
  const [customPromptFile, setCustomPromptFile] = useState<File | null>(null);
  const [customPrompts, setCustomPrompts] = useState<PromptOption[]>([]);
  const [isLoadingCustom, setIsLoadingCustom] = useState(false);
  const { toast } = useToast();
  
  // Sync local ticks when initiallyTickedPrompts (from Dashboard) or available prompts change
  useEffect(() => {
    // Filter initiallyTickedPrompts to only include those available for the current bank
    const relevantInitialTicks = initiallyTickedPrompts.filter(initPrompt =>
      availablePredefinedPrompts.some(availPrompt => availPrompt.id === initPrompt.id)
    );
    setLocallyTickedPrompts(relevantInitialTicks);
  }, [initiallyTickedPrompts, availablePredefinedPrompts]);
  
  const togglePrompt = (prompt: PromptOption) => {
    if (disabled) return;
    setLocallyTickedPrompts(prevSelected => {
      const isSelected = prevSelected.some(p => p.id === prompt.id);
      if (isSelected) {
        return prevSelected.filter(p => p.id !== prompt.id);
      } else {
        return [...prevSelected, prompt];
      }
    });
  };
  
  const selectAllPredefinedPrompts = () => {
    if (disabled || availablePredefinedPrompts.length === 0) return;
    setLocallyTickedPrompts([...availablePredefinedPrompts]);
  };
  
  const deselectAllPredefinedPrompts = () => {
    if (disabled) return;
    // Deselect only from the predefined ones, keep custom selections if any were merged previously (though UI separates this now)
    setLocallyTickedPrompts(locallyTickedPrompts.filter(p => !availablePredefinedPrompts.some(ap => ap.id === p.id)));
  };
  
  const handleApplyPredefined = () => {
    // Filter to ensure only available predefined prompts are applied
    const promptsToApply = locallyTickedPrompts.filter(ltp => 
      availablePredefinedPrompts.some(ap => ap.id === ltp.id)
    );
    onPromptsApplied(promptsToApply);
     toast({
        title: "Predefined Prompts Applied",
        description: `${promptsToApply.length} predefined prompt(s) now selected for processing.`,
      });
  };
  
  const handleCustomPromptUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    if (e.target.files && e.target.files[0]) {
      const file = e.target.files[0];
      setCustomPromptFile(file);
      setIsLoadingCustom(true);
      try {
        const parsedPrompts = await parseExcelPrompts(file);
        setCustomPrompts(parsedPrompts);
        toast({
          title: "Excel File Processed",
          description: `${parsedPrompts.length} custom prompts loaded. Click 'Apply Custom Prompts'.`,
        });
      } catch (error) {
        toast({
          title: "Error Processing Excel File",
          description: error instanceof Error ? error.message : "Unknown error occurred",
          variant: "destructive",
        });
        setCustomPrompts([]);
      } finally {
        setIsLoadingCustom(false);
      }
    }
  };
  
  const handleApplyCustomPrompts = () => {
    if (customPrompts.length > 0) {
      onPromptsApplied(customPrompts); 
      setLocallyTickedPrompts(customPrompts); // Update local selection to reflect this choice
      toast({
        title: "Custom Prompts Applied",
        description: `${customPrompts.length} custom prompt(s) are now selected for processing.`,
      });
    }
  };

  const predefinedPromptsByCategory = (availablePredefinedPrompts || []).reduce((acc, prompt) => {
    const category = prompt.category || "Default";
    if (!acc[category]) acc[category] = [];
    acc[category].push(prompt);
    return acc;
  }, {} as Record<string, PromptOption[]>);

  const customPromptsForDisplayByCategory = customPrompts.reduce((acc, prompt) => {
    const category = prompt.category || "Custom";
    if (!acc[category]) acc[category] = [];
    acc[category].push(prompt);
    return acc;
  }, {} as Record<string, PromptOption[]>);

  return (
    <div className="space-y-6">
      {/* Info Section - This layout can be adjusted as per your original design if it was part of a two-column layout */}
      <div className="space-y-4 lg:col-span-1"> {/* Assuming it's stacked or adjust grid if needed */}
        <div>
          <h2 className="text-lg font-semibold mb-1">Select Data to Extract</h2>
          <p className="text-sm text-muted-foreground">
            Choose financial data points to extract from PDFs for: <span className="font-medium">{bankDisplay}</span>.
          </p>
        </div>
        <div className="bg-muted p-4 rounded-lg border">
          <h3 className="font-medium mb-2">How It Works</h3>
          <p className="text-sm text-muted-foreground">
            Select predefined prompts relevant to {bankDisplay}, or upload an Excel file with your own custom prompts. Selections here will be used for the "Process Files" step.
          </p>
        </div>
      </div>

      {/* Prompt Selection Tabs */}
      <div className="lg:col-span-1"> {/* Assuming it's stacked or adjust grid if needed */}
        <Tabs defaultValue="predefined" className="w-full">
          <TabsList className="grid grid-cols-2 mb-4 w-full">
            <TabsTrigger value="predefined" className="text-sm">Predefined Prompts ({availablePredefinedPrompts.length})</TabsTrigger>
            <TabsTrigger value="custom" className="text-sm">Custom Excel Prompts</TabsTrigger>
          </TabsList>
          
          <TabsContent value="predefined">
            <div className="space-y-4">
              {availablePredefinedPrompts.length === 0 && !disabled ? (
                 <div className="text-center py-10 border rounded-md">
                    <p className="text-muted-foreground">No predefined prompts found for {bankDisplay}.</p>
                    <p className="text-sm text-muted-foreground mt-1">Check the CSV or use the "Custom Excel Prompts" tab.</p>
                 </div>
              ) : (
                <>
                  <div className="flex justify-between items-center mb-2">
                    <div>
                      <span className="text-sm font-medium">
                        {locallyTickedPrompts.filter(p => availablePredefinedPrompts.some(ap => ap.id === p.id)).length} of {availablePredefinedPrompts.length} selected
                      </span>
                    </div>
                    <div className="space-x-2">
                      <Button 
                        variant="outline" size="sm" onClick={selectAllPredefinedPrompts} 
                        disabled={disabled || availablePredefinedPrompts.length === 0 || locallyTickedPrompts.length === availablePredefinedPrompts.length}
                      >Select All</Button>
                      <Button 
                        variant="outline" size="sm" onClick={deselectAllPredefinedPrompts} 
                        disabled={disabled || locallyTickedPrompts.filter(p => availablePredefinedPrompts.some(ap => ap.id === p.id)).length === 0}
                      >Deselect All</Button>
                    </div>
                  </div>
                  
                  <ScrollArea className="h-[300px] pr-1 border rounded-md p-2"> {/* Adjusted height & padding */}
                    {Object.entries(predefinedPromptsByCategory).map(([category, promptsInCategory]) => (
                      <div key={category} className="mb-4">
                        <h4 className="text-xs font-semibold text-muted-foreground mb-2 uppercase tracking-wider px-1">{category}</h4>
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2"> {/* Two columns for prompt cards */}
                          {promptsInCategory.map((prompt) => (
                            <div 
                              key={prompt.id}
                              className={cn(
                                "border rounded-lg p-3 cursor-pointer transition-all hover:shadow-lg", // More card-like
                                locallyTickedPrompts.some(p => p.id === prompt.id) 
                                  ? "border-yellow-500 bg-yellow-100 dark:bg-yellow-700/30 text-black dark:text-white ring-2 ring-yellow-400" 
                                  : "border-gray-300 dark:border-gray-700 bg-card hover:bg-muted/70",
                                disabled ? "opacity-60 cursor-not-allowed" : ""
                              )}
                              onClick={() => !disabled && togglePrompt(prompt)}
                              role="checkbox"
                              aria-checked={locallyTickedPrompts.some(p => p.id === prompt.id)}
                              tabIndex={disabled ? -1 : 0}
                              onKeyDown={(e) => { if (e.key === ' ' || e.key === 'Enter') !disabled && togglePrompt(prompt); }}
                            >
                              <div className="flex justify-between items-start mb-1">
                                <div className="font-semibold text-sm text-foreground">{prompt.name}</div>
                                {locallyTickedPrompts.some(p => p.id === prompt.id) && (
                                  <Check className="h-5 w-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0" />
                                )}
                              </div>
                              <p className="text-xs text-muted-foreground line-clamp-2"> {/* Ensure description class matches styling */}
                                {prompt.description}
                              </p>
                            </div>
                          ))}
                        </div>
                      </div>
                    ))}
                  </ScrollArea>
                  
                  <Button 
                    className="w-full bg-yellow-400 hover:bg-yellow-500 text-black mt-4" 
                    onClick={handleApplyPredefined}
                    disabled={disabled || availablePredefinedPrompts.length === 0}
                  >
                    Apply Selected Predefined Prompts
                  </Button>
                </>
              )}
            </div>
          </TabsContent>
          
          {/* Custom Prompts Tab - styling remains similar, ensure functionality */}
          <TabsContent value="custom">
            {/* ... (Custom Prompts UI - largely unchanged from your previous version) ... */}
            <div className="space-y-6">
                <div className="bg-muted/50 p-4 rounded-md border">
                  <div className="flex items-start">
                    <FileText className="h-6 w-6 text-muted-foreground mr-3 mt-1" />
                    <div>
                      <h4 className="font-medium text-sm">Upload Custom Prompts via Excel</h4>
                      <p className="text-xs text-muted-foreground mt-1">
                        The Excel file should contain columns: `Bank`, `PromptName`, `PromptText`, and optionally `Category`.
                      </p>
                    </div>
                  </div>
                </div>
                
                <div>
                  <Label htmlFor="promptFile">Upload Prompt Excel File (.xlsx, .xls)</Label>
                  <div className="mt-2 flex items-center space-x-3">
                    <div className="flex-1 relative">
                      <Input 
                        id="promptFile" type="file" onChange={handleCustomPromptUpload} 
                        accept=".xlsx,.xls" disabled={disabled || isLoadingCustom} className="flex-1"
                      />
                      {isLoadingCustom && (
                        <div className="absolute inset-0 flex items-center justify-center bg-background/70">
                          <Loader2 className="h-5 w-5 animate-spin text-yellow-500" />
                        </div>
                      )}
                    </div>
                    <Button 
                      variant="outline" size="icon" disabled={disabled || isLoadingCustom}
                      onClick={() => (document.getElementById('promptFile') as HTMLInputElement)?.click()}
                      aria-label="Upload custom prompt file"
                    ><Upload className="h-4 w-4" /></Button>
                  </div>
                  {customPromptFile && (
                    <div className="mt-2 flex items-center text-sm">
                      <FileText className="h-4 w-4 text-yellow-500 mr-2 flex-shrink-0" />
                      <span className="truncate">{customPromptFile.name}</span>
                      <Badge variant="outline" className="ml-2 text-xs">
                        {isLoadingCustom ? 'Processing...' : `${customPrompts.length} prompts loaded`}
                      </Badge>
                    </div>
                  )}
                </div>
                
                {customPrompts.length > 0 && !isLoadingCustom && (
                  <div className="border rounded-md p-4">
                    <h3 className="text-sm font-medium mb-3">Loaded Custom Prompts Preview</h3>
                    <ScrollArea className="h-[150px]">
                      <div className="space-y-1">
                        {Object.entries(customPromptsForDisplayByCategory).map(([category, prompts]) => (
                          <div key={category} className="mb-2">
                            <h4 className="text-xs font-semibold text-muted-foreground mb-1 uppercase tracking-wider">{category}</h4>
                            {prompts.map((prompt) => (
                              <div key={prompt.id} className="text-sm py-0.5 px-1 rounded-sm truncate" title={prompt.name}>
                                - {prompt.name}
                              </div>
                            ))}
                          </div>
                        ))}
                      </div>
                    </ScrollArea>
                  </div>
                )}
                
                <Button 
                  className="w-full bg-yellow-400 hover:bg-yellow-500 text-black" 
                  disabled={!customPromptFile || disabled || isLoadingCustom || customPrompts.length === 0}
                  onClick={handleApplyCustomPrompts}
                > Apply Custom Prompts
                </Button>
              </div>
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
};

export default PromptSelector;
```

# dataextract-ey-main\src\components\ResultsViewer.tsx

```tsx
// src/components/ResultsViewer.tsx

import { useState, useEffect, useMemo } from 'react'; // Added useMemo
import { Card, CardContent } from '@/components/ui/card';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { Button } from '@/components/ui/button';
import { AlertCircle, Check, Download, Loader2, Info, ChevronsUpDown, Star } from 'lucide-react';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { ProcessingResult } from '@/lib/types';
import { cn } from '@/lib/utils';
import { Badge } from '@/components/ui/badge';
import { ScrollArea } from '@/components/ui/scroll-area';
import ProcessingStatus from './ProcessingStatus';
import {
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
} from "@/components/ui/collapsible";

export interface ResultsViewerProps {
  results: ProcessingResult[];
  onDownloadResults: () => void;
  isProcessing?: boolean;
  processingProgress?: number;
  processingStep?: string;
  totalFiles?: number;
  processedFiles?: number;
  selectedBank: string;
}

const ResultsViewer = ({ 
  results, 
  onDownloadResults, 
  isProcessing = false, 
  processingProgress = 0, 
  processingStep = '',
  totalFiles = 1,
  processedFiles = 0,
  selectedBank
}: ResultsViewerProps) => {
  const [selectedResultId, setSelectedResultId] = useState<string | null>(null);
  const [isNotesOpen, setIsNotesOpen] = useState(false);

  useEffect(() => {
    if (results.length > 0) {
      if (!selectedResultId || !results.find(r => r.id === selectedResultId)) {
        setSelectedResultId(results[0].id); 
      }
    } else {
      setSelectedResultId(null); 
    }
    // Only reset notes if the selected result actually changes or results become empty
    // This prevents notes from closing if results array is updated but selection remains the same valid item.
  }, [results]); // Removed selectedResultId from deps to avoid loop with setIsNotesOpen

  useEffect(() => {
    setIsNotesOpen(false); // Close notes when the selected result changes
  }, [selectedResultId]);


  const currentResult = useMemo(() => results.find(result => result && result.id === selectedResultId), [results, selectedResultId]);
  
  const resultsByFile = useMemo(() => results.reduce((acc, result) => {
    if (!result) return acc;
    const fileKey = result.fileId || result.fileName; 
    if (!acc[fileKey]) {
      acc[fileKey] = [];
    }
    acc[fileKey].push(result);
    return acc;
  }, {} as Record<string, ProcessingResult[]>), [results]);

  const isEclByStageCategory = currentResult?.data?.some(item => item?.Category === 'ECL By Stage');
  
  // ... (if (results.length === 0 && !isProcessing) ... block )
  // ... (if (isProcessing && results.length === 0) ... block )
  if (results.length === 0 && !isProcessing) {
    return (
      <div className="space-y-6">
        <div>
          <h2 className="text-lg font-semibold mb-1">Extraction Results</h2>
          <p className="text-sm text-muted-foreground">View and download extracted financial data for {selectedBank}</p>
        </div>
        <Card className="dark:border-gray-700">
          <CardContent className="flex flex-col items-center justify-center p-12 text-center">
            <Info className="h-10 w-10 text-muted-foreground mb-4"/>
            <div className="text-muted-foreground mb-2">No extraction results yet.</div>
            <div className="text-sm text-muted-foreground">Process files to see extraction results.</div>
          </CardContent>
        </Card>
      </div>
    );
  }

  if (isProcessing && results.length === 0) {
    return (
      <div className="space-y-6">
        <div>
          <h2 className="text-lg font-semibold mb-1">Extraction Results</h2>
          <p className="text-sm text-muted-foreground">View and download extracted financial data for {selectedBank}</p>
        </div>
        <ProcessingStatus
          isProcessing={isProcessing}
          progress={processingProgress}
          currentStep={processingStep}
          totalFiles={totalFiles}
          processedFiles={processedFiles}
        />
        <div className="flex items-center justify-center h-[300px] border rounded-lg dark:border-gray-700">
            <div className="text-center p-8">
                <Loader2 className="mx-auto h-12 w-12 text-yellow-500 animate-spin mb-4" />
                <h3 className="text-lg font-medium mb-2">Processing Data...</h3>
                <p className="text-sm text-muted-foreground">
                    {processingStep || "Extracting information from your documents..."}
                </p>
            </div>
        </div>
      </div>
    );
  }


  return (
    <div className="space-y-6">
      {/* ... (Header and Download button section remains the same) ... */}
      <div className="flex justify-between items-center">
        <div>
          <h2 className="text-lg font-semibold mb-1">Extraction Results</h2>
          <p className="text-sm text-muted-foreground">View and download extracted financial data for {selectedBank}</p>
        </div>
        <Button 
          variant="outline" size="sm" onClick={onDownloadResults}
          disabled={isProcessing || results.length === 0}
          className="flex items-center gap-1 border-yellow-400 bg-white text-black hover:bg-yellow-50 dark:text-black dark:hover:bg-yellow-100 dark:border-yellow-500"
        >
          <Download className="h-4 w-4" />
          <span>Download All Results</span>
        </Button>
      </div>
      
      {isProcessing && (
          <ProcessingStatus
            isProcessing={isProcessing}
            progress={processingProgress}
            currentStep={processingStep}
            totalFiles={totalFiles}
            processedFiles={processedFiles}
            className="mb-6"
          />
      )}

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div className="lg:col-span-1">
           {/* ... (Processed Files & Prompts list logic remains the same) ... */}
           <Card className="overflow-hidden h-full flex flex-col dark:bg-gray-800 dark:border-gray-700">
            <div className="bg-black text-white p-2 text-sm font-medium">Processed Files & Prompts</div>
            <ScrollArea className="h-[400px] flex-grow">
              <div className="p-2">
                {Object.entries(resultsByFile).map(([fileKey, fileResults]) => {
                  const fileInfo = fileResults[0];
                  if (!fileInfo) return null;
                  return (
                    <div key={fileKey} className="mb-4">
                      <div className="text-sm font-medium p-2 bg-muted dark:bg-gray-700 rounded-t-md">
                        {fileInfo.fileName}
                      </div>
                      <div className="border border-t-0 rounded-b-md dark:border-gray-600">
                        {fileResults.map(result => {
                          if (!result) return null;
                          const isSelected = selectedResultId === result.id;
                          return (
                            <div 
                              key={result.id}
                              className={cn(
                                "flex items-center justify-between p-2 text-sm rounded-sm cursor-pointer border-b dark:border-gray-600 last:border-b-0",
                                isSelected ? "bg-yellow-100 dark:bg-yellow-700/50 border-l-4 border-yellow-500 dark:border-yellow-400 text-black dark:text-white" : "hover:bg-muted/50 dark:hover:bg-gray-700/30"
                              )}
                              onClick={() => {setSelectedResultId(result.id); /* setIsNotesOpen will be reset by useEffect now */}}
                            >
                              <div className="truncate pr-2">{result.promptName}</div>
                              <div className="flex items-center flex-shrink-0">
                                {result.status === 'success' && <Check className="h-4 w-4 text-green-500" />}
                                {result.status === 'error' && <AlertCircle className="h-4 w-4 text-red-500" />}
                                {(result.status === 'pending' || result.status === 'processing') && <Loader2 className="h-4 w-4 text-blue-500 animate-spin" />}
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  );
                })}
              </div>
            </ScrollArea>
          </Card>
        </div>
        
        <div className="lg:col-span-2">
          {currentResult ? (
            <Card className="overflow-hidden h-full flex flex-col dark:bg-gray-800 dark:border-gray-700">
              {/* ... (Card Header with promptName, fileName, status Badge remains the same) ... */}
              <div className="bg-black text-white p-3 flex justify-between items-center">
                <div>
                  <div className="font-medium">{currentResult.promptName}</div>
                  <div className="text-xs text-gray-400">From: {currentResult.fileName}</div>
                </div>
                <Badge 
                  className={cn("capitalize text-white", currentResult.status === 'success' && "bg-green-600", currentResult.status === 'error' && "bg-red-600", (currentResult.status === 'pending' || currentResult.status === 'processing') && "bg-blue-500")}>
                  {currentResult.status}
                </Badge>
              </div>
              
              <div className="p-3 flex-grow overflow-y-auto">
                {/* ... (status handling for processing and error remains the same) ... */}
                {currentResult.status === 'processing' && ( <div className="flex flex-col items-center justify-center h-full py-8"><Loader2 className="h-8 w-8 text-yellow-500 animate-spin mb-2" /><div className="text-sm text-muted-foreground">Processing...</div></div>)}
                {currentResult.status === 'error' && currentResult.error && ( <Alert variant="destructive" className="my-4"><AlertCircle className="h-4 w-4" /><AlertTitle>Extraction Error</AlertTitle><AlertDescription>{currentResult.error}</AlertDescription></Alert>)}
                
                {currentResult.notes && (
                  <Collapsible open={isNotesOpen} onOpenChange={setIsNotesOpen} className="w-full space-y-1 mb-4">
                    <CollapsibleTrigger asChild>
                      <Button variant="ghost" className="flex items-center justify-start p-0 h-auto text-blue-600 dark:text-blue-400 hover:underline focus-visible:ring-0 focus-visible:ring-offset-0">
                        <Info className="h-4 w-4 mr-2 flex-shrink-0" />
                        <span className="text-sm font-medium">{isNotesOpen ? "Hide Notes" : "Show Notes from LLM"}</span>
                        <ChevronsUpDown className={`h-4 w-4 ml-1 transition-transform duration-200 ${isNotesOpen ? 'rotate-180' : ''} flex-shrink-0`} />
                      </Button>
                    </CollapsibleTrigger>
                    <CollapsibleContent>
                      <Alert variant="default" className="mt-1 bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800">
                        <AlertDescription className="text-blue-700 dark:text-blue-300 text-xs whitespace-pre-wrap max-h-48 overflow-y-auto">
                            {currentResult.notes}
                        </AlertDescription>
                      </Alert>
                    </CollapsibleContent>
                  </Collapsible>
                )}
                
                {currentResult.status === 'success' && currentResult.data && currentResult.data.length > 0 && (
                  <Tabs defaultValue="table" className="flex flex-col h-full">
                    {/* ... (TabsList remains the same) ... */}
                    <TabsList className="mb-4 shrink-0">
                      <TabsTrigger value="table">Table View</TabsTrigger>
                      <TabsTrigger value="json">JSON View</TabsTrigger>
                      {isEclByStageCategory && (<TabsTrigger value="by-stage">By Stage</TabsTrigger>)}
                    </TabsList>
                    
                    <ScrollArea className="flex-grow min-h-0">
                      {/* ... (TabsContent for "table" and "json" remain the same) ... */}
                      <TabsContent value="table" className="mt-0">
                        <Table>
                          <TableHeader className="bg-muted dark:bg-gray-700/80 sticky top-0 z-10">
                            <TableRow className="dark:border-gray-600">
                              <TableHead className="font-semibold dark:text-gray-200">Category</TableHead>
                              <TableHead className="font-semibold dark:text-gray-200">Stage</TableHead>
                              <TableHead className="font-semibold dark:text-gray-200">Field</TableHead>
                              <TableHead className="font-semibold dark:text-gray-200">Value</TableHead>
                            </TableRow>
                          </TableHeader>
                          <TableBody>
                            {currentResult.data.map((item, index) => {
                              if (!item) return null;
                              return (
                                <TableRow key={`table-item-${index}`} className="dark:border-gray-600">
                                  <TableCell className="dark:text-gray-300">{item.Category === 'ECL By Stage' ? 'ECL' : String(item.Category)}</TableCell>
                                  <TableCell className="dark:text-gray-300">{String(item.Stage)}</TableCell>
                                  <TableCell className="dark:text-gray-300">{String(item.Field)}</TableCell>
                                  <TableCell className="font-medium dark:text-gray-200">{String(item.Value)}</TableCell>
                                </TableRow>
                              );
                            })}
                          </TableBody>
                        </Table>
                      </TabsContent>
                      <TabsContent value="json" className="mt-0">
                          <pre className="bg-muted dark:bg-gray-700/50 p-4 rounded-md text-xs overflow-x-auto">
                            {JSON.stringify(currentResult.data, null, 2)}
                          </pre>
                      </TabsContent>
                      
                      {isEclByStageCategory && (
                        <TabsContent value="by-stage" className="mt-0">
                            <div className="space-y-4">
                              {(() => {
                                // CORRECTED LINE FOR STAGES:
                                const stages = Array.from(new Set(currentResult.data?.filter(item => item && item.Category === 'ECL By Stage').map(item => item?.Stage).filter((stage): stage is string => Boolean(stage)) ));
                                
                                return stages.map(stage => {
                                  const stageData = currentResult.data?.filter(d => d && d.Stage === stage && d.Category === 'ECL By Stage');
                                  if (!stageData || stageData.length === 0) return null;
                                  
                                  return (
                                    <div key={`stage-group-${stage}`} className="border rounded-md overflow-hidden dark:border-gray-600">
                                      <div className="bg-muted dark:bg-gray-700 p-2"><h4 className="font-medium dark:text-gray-200">Stage {stage}</h4></div>
                                      <Table>
                                        <TableHeader><TableRow className="dark:border-gray-600"><TableHead className="dark:text-gray-300">Category</TableHead><TableHead className="dark:text-gray-300">Field</TableHead><TableHead className="dark:text-gray-300">Value</TableHead></TableRow></TableHeader>
                                        <TableBody>
                                          {stageData.map((item, index) => {
                                              const itemField = (item && typeof item.Field === 'string') ? item.Field : 'N/A';
                                              const itemValue = (item && (typeof item.Value === 'string' || typeof item.Value === 'number')) ? String(item.Value) : 'N/A';
                                              return (
                                                <TableRow key={`by-stage-item-${stage}-${index}`} className="dark:border-gray-600">
                                                    <TableCell className="dark:text-gray-300">ECL</TableCell>
                                                    <TableCell className="dark:text-gray-300">{itemField}</TableCell>
                                                    <TableCell className="font-medium dark:text-gray-200">{itemValue}</TableCell>
                                                </TableRow>
                                            );
                                          })}
                                        </TableBody>
                                      </Table>
                                    </div>
                                  );
                                });
                              })()}
                            </div>
                        </TabsContent>
                      )}
                    </ScrollArea>
                  </Tabs>
                )}
                 {currentResult.status === 'success' && (!currentResult.data || currentResult.data.length === 0) && ( <div className="flex flex-col items-center justify-center h-full py-8"><Info className="h-8 w-8 text-muted-foreground mb-2" /><div className="text-sm text-muted-foreground">No data points were extracted for this prompt.</div></div> )}
              </div>
            </Card>
          ) : ( /* ... (No currentResult selected placeholder remains the same) ... */ 
            <Card className="flex flex-col items-center justify-center h-full dark:bg-gray-800 dark:border-gray-700">
              <CardContent className="text-center">
                <Info className="h-10 w-10 text-muted-foreground mx-auto mb-4" />
                <p className="text-muted-foreground">Select a result from the list on the left to view details.</p>
              </CardContent>
            </Card>
          )}
        </div>
      </div>
    </div>
  );
};

export default ResultsViewer;
```

# dataextract-ey-main\src\components\ThemeProvider.tsx

```tsx

"use client";

import * as React from "react";
import { createContext, useContext, useEffect, useState } from "react";

type Theme = "dark" | "light" | "system";

type ThemeProviderProps = {
  children: React.ReactNode;
  defaultTheme?: Theme;
  storageKey?: string;
};

type ThemeProviderState = {
  theme: Theme;
  setTheme: (theme: Theme) => void;
};

const initialState: ThemeProviderState = {
  theme: "system",
  setTheme: () => null,
};

const ThemeProviderContext = createContext<ThemeProviderState>(initialState);

export function ThemeProvider({
  children,
  defaultTheme = "system",
  storageKey = "vite-ui-theme",
  ...props
}: ThemeProviderProps) {
  const [theme, setTheme] = useState<Theme>(
    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme
  );

  useEffect(() => {
    const root = window.document.documentElement;
    root.classList.remove("light", "dark");

    if (theme === "system") {
      const systemTheme = window.matchMedia("(prefers-color-scheme: dark)")
        .matches
        ? "dark"
        : "light";

      root.classList.add(systemTheme);
      return;
    }

    root.classList.add(theme);
  }, [theme]);

  const value = {
    theme,
    setTheme: (theme: Theme) => {
      localStorage.setItem(storageKey, theme);
      setTheme(theme);
    },
  };

  return (
    <ThemeProviderContext.Provider {...props} value={value}>
      {children}
    </ThemeProviderContext.Provider>
  );
}

export const useTheme = () => {
  const context = useContext(ThemeProviderContext);

  if (context === undefined)
    throw new Error("useTheme must be used within a ThemeProvider");

  return context;
};

```

# dataextract-ey-main\src\components\ThemeToggle.tsx

```tsx

import { Moon, Sun } from "lucide-react";
import { Button } from "@/components/ui/button";
import { useTheme } from "@/components/ThemeProvider";
import { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from "@/components/ui/dropdown-menu";

export function ThemeToggle({ className }: { className?: string }) {
  const { setTheme, theme } = useTheme();

  return (
    <div className={className}>
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <Button variant="outline" size="icon" className="rounded-full bg-white dark:bg-yellow-400">
            <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0 dark:text-black" />
            <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100 dark:text-black" />
            <span className="sr-only">Toggle theme</span>
          </Button>
        </DropdownMenuTrigger>
        <DropdownMenuContent align="end">
          <DropdownMenuItem onClick={() => setTheme("light")}>
            Light
          </DropdownMenuItem>
          <DropdownMenuItem onClick={() => setTheme("dark")}>
            Dark
          </DropdownMenuItem>
          <DropdownMenuItem onClick={() => setTheme("system")}>
            System
          </DropdownMenuItem>
        </DropdownMenuContent>
      </DropdownMenu>
    </div>
  );
}

```

# dataextract-ey-main\src\components\ui\accordion.tsx

```tsx
import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn("border-b", className)}
    {...props}
  />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))

AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }

```

# dataextract-ey-main\src\components\ui\alert-dialog.tsx

```tsx
import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

const AlertDialog = AlertDialogPrimitive.Root

const AlertDialogTrigger = AlertDialogPrimitive.Trigger

const AlertDialogPortal = AlertDialogPrimitive.Portal

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    />
  </AlertDialogPortal>
))
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName

const AlertDialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
AlertDialogHeader.displayName = "AlertDialogHeader"

const AlertDialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
AlertDialogFooter.displayName = "AlertDialogFooter"

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold", className)}
    {...props}
  />
))
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action
    ref={ref}
    className={cn(buttonVariants(), className)}
    {...props}
  />
))
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    )}
    {...props}
  />
))
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}

```

# dataextract-ey-main\src\components\ui\alert.tsx

```tsx
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive:
          "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
))
Alert.displayName = "Alert"

const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn("mb-1 font-medium leading-none tracking-tight", className)}
    {...props}
  />
))
AlertTitle.displayName = "AlertTitle"

const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm [&_p]:leading-relaxed", className)}
    {...props}
  />
))
AlertDescription.displayName = "AlertDescription"

export { Alert, AlertTitle, AlertDescription }

```

# dataextract-ey-main\src\components\ui\aspect-ratio.tsx

```tsx
import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio"

const AspectRatio = AspectRatioPrimitive.Root

export { AspectRatio }

```

# dataextract-ey-main\src\components\ui\avatar.tsx

```tsx
import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    )}
    {...props}
  />
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image
    ref={ref}
    className={cn("aspect-square h-full w-full", className)}
    {...props}
  />
))
AvatarImage.displayName = AvatarPrimitive.Image.displayName

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn(
      "flex h-full w-full items-center justify-center rounded-full bg-muted",
      className
    )}
    {...props}
  />
))
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName

export { Avatar, AvatarImage, AvatarFallback }

```

# dataextract-ey-main\src\components\ui\badge.tsx

```tsx
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  )
}

export { Badge, badgeVariants }

```

# dataextract-ey-main\src\components\ui\breadcrumb.tsx

```tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"

const Breadcrumb = React.forwardRef<
  HTMLElement,
  React.ComponentPropsWithoutRef<"nav"> & {
    separator?: React.ReactNode
  }
>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)
Breadcrumb.displayName = "Breadcrumb"

const BreadcrumbList = React.forwardRef<
  HTMLOListElement,
  React.ComponentPropsWithoutRef<"ol">
>(({ className, ...props }, ref) => (
  <ol
    ref={ref}
    className={cn(
      "flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",
      className
    )}
    {...props}
  />
))
BreadcrumbList.displayName = "BreadcrumbList"

const BreadcrumbItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentPropsWithoutRef<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    className={cn("inline-flex items-center gap-1.5", className)}
    {...props}
  />
))
BreadcrumbItem.displayName = "BreadcrumbItem"

const BreadcrumbLink = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentPropsWithoutRef<"a"> & {
    asChild?: boolean
  }
>(({ asChild, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      className={cn("transition-colors hover:text-foreground", className)}
      {...props}
    />
  )
})
BreadcrumbLink.displayName = "BreadcrumbLink"

const BreadcrumbPage = React.forwardRef<
  HTMLSpanElement,
  React.ComponentPropsWithoutRef<"span">
>(({ className, ...props }, ref) => (
  <span
    ref={ref}
    role="link"
    aria-disabled="true"
    aria-current="page"
    className={cn("font-normal text-foreground", className)}
    {...props}
  />
))
BreadcrumbPage.displayName = "BreadcrumbPage"

const BreadcrumbSeparator = ({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) => (
  <li
    role="presentation"
    aria-hidden="true"
    className={cn("[&>svg]:size-3.5", className)}
    {...props}
  >
    {children ?? <ChevronRight />}
  </li>
)
BreadcrumbSeparator.displayName = "BreadcrumbSeparator"

const BreadcrumbEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    role="presentation"
    aria-hidden="true"
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More</span>
  </span>
)
BreadcrumbEllipsis.displayName = "BreadcrumbElipssis"

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}

```

# dataextract-ey-main\src\components\ui\button.tsx

```tsx

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-500",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground dark:border-gray-600",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80 dark:bg-yellow-400 dark:text-black dark:hover:bg-yellow-500",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
        eyOutline: "border border-ey-gray-400 text-white hover:bg-ey-gray-800 hover:border-ey-gray-500 transition-colors",
        eyPrimary: "bg-ey-yellow text-ey-black hover:bg-ey-yellow/90 font-medium transition-colors",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }

```

# dataextract-ey-main\src\components\ui\calendar.tsx

```tsx
import * as React from "react";
import { ChevronLeft, ChevronRight } from "lucide-react";
import { DayPicker } from "react-day-picker";

import { cn } from "@/lib/utils";
import { buttonVariants } from "@/components/ui/button";

export type CalendarProps = React.ComponentProps<typeof DayPicker>;

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: CalendarProps) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",
        month: "space-y-4",
        caption: "flex justify-center pt-1 relative items-center",
        caption_label: "text-sm font-medium",
        nav: "space-x-1 flex items-center",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-y-1",
        head_row: "flex",
        head_cell:
          "text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",
        day: cn(
          buttonVariants({ variant: "ghost" }),
          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"
        ),
        day_range_end: "day-range-end",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle:
          "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ ..._props }) => <ChevronLeft className="h-4 w-4" />,
        IconRight: ({ ..._props }) => <ChevronRight className="h-4 w-4" />,
      }}
      {...props}
    />
  );
}
Calendar.displayName = "Calendar";

export { Calendar };

```

# dataextract-ey-main\src\components\ui\card.tsx

```tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }

```

# dataextract-ey-main\src\components\ui\carousel.tsx

```tsx
import * as React from "react"
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react"
import { ArrowLeft, ArrowRight } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: "horizontal" | "vertical"
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />")
  }

  return context
}

const Carousel = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & CarouselProps
>(
  (
    {
      orientation = "horizontal",
      opts,
      setApi,
      plugins,
      className,
      children,
      ...props
    },
    ref
  ) => {
    const [carouselRef, api] = useEmblaCarousel(
      {
        ...opts,
        axis: orientation === "horizontal" ? "x" : "y",
      },
      plugins
    )
    const [canScrollPrev, setCanScrollPrev] = React.useState(false)
    const [canScrollNext, setCanScrollNext] = React.useState(false)

    const onSelect = React.useCallback((api: CarouselApi) => {
      if (!api) {
        return
      }

      setCanScrollPrev(api.canScrollPrev())
      setCanScrollNext(api.canScrollNext())
    }, [])

    const scrollPrev = React.useCallback(() => {
      api?.scrollPrev()
    }, [api])

    const scrollNext = React.useCallback(() => {
      api?.scrollNext()
    }, [api])

    const handleKeyDown = React.useCallback(
      (event: React.KeyboardEvent<HTMLDivElement>) => {
        if (event.key === "ArrowLeft") {
          event.preventDefault()
          scrollPrev()
        } else if (event.key === "ArrowRight") {
          event.preventDefault()
          scrollNext()
        }
      },
      [scrollPrev, scrollNext]
    )

    React.useEffect(() => {
      if (!api || !setApi) {
        return
      }

      setApi(api)
    }, [api, setApi])

    React.useEffect(() => {
      if (!api) {
        return
      }

      onSelect(api)
      api.on("reInit", onSelect)
      api.on("select", onSelect)

      return () => {
        api?.off("select", onSelect)
      }
    }, [api, onSelect])

    return (
      <CarouselContext.Provider
        value={{
          carouselRef,
          api: api,
          opts,
          orientation:
            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
          scrollPrev,
          scrollNext,
          canScrollPrev,
          canScrollNext,
        }}
      >
        <div
          ref={ref}
          onKeyDownCapture={handleKeyDown}
          className={cn("relative", className)}
          role="region"
          aria-roledescription="carousel"
          {...props}
        >
          {children}
        </div>
      </CarouselContext.Provider>
    )
  }
)
Carousel.displayName = "Carousel"

const CarouselContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div ref={carouselRef} className="overflow-hidden">
      <div
        ref={ref}
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className
        )}
        {...props}
      />
    </div>
  )
})
CarouselContent.displayName = "CarouselContent"

const CarouselItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { orientation } = useCarousel()

  return (
    <div
      ref={ref}
      role="group"
      aria-roledescription="slide"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className
      )}
      {...props}
    />
  )
})
CarouselItem.displayName = "CarouselItem"

const CarouselPrevious = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute  h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-left-12 top-1/2 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft className="h-4 w-4" />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
})
CarouselPrevious.displayName = "CarouselPrevious"

const CarouselNext = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-right-12 top-1/2 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight className="h-4 w-4" />
      <span className="sr-only">Next slide</span>
    </Button>
  )
})
CarouselNext.displayName = "CarouselNext"

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}

```

# dataextract-ey-main\src\components\ui\chart.tsx

```tsx
import * as React from "react"
import * as RechartsPrimitive from "recharts"

import { cn } from "@/lib/utils"

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />")
  }

  return context
}

const ChartContainer = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    config: ChartConfig
    children: React.ComponentProps<
      typeof RechartsPrimitive.ResponsiveContainer
    >["children"]
  }
>(({ id, className, children, config, ...props }, ref) => {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-chart={chartId}
        ref={ref}
        className={cn(
          "flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",
          className
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
})
ChartContainer.displayName = "Chart"

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([_, config]) => config.theme || config.color
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join("\n")}
}
`
          )
          .join("\n"),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

const ChartTooltipContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
    React.ComponentProps<"div"> & {
      hideLabel?: boolean
      hideIndicator?: boolean
      indicator?: "line" | "dot" | "dashed"
      nameKey?: string
      labelKey?: string
    }
>(
  (
    {
      active,
      payload,
      className,
      indicator = "dot",
      hideLabel = false,
      hideIndicator = false,
      label,
      labelFormatter,
      labelClassName,
      formatter,
      color,
      nameKey,
      labelKey,
    },
    ref
  ) => {
    const { config } = useChart()

    const tooltipLabel = React.useMemo(() => {
      if (hideLabel || !payload?.length) {
        return null
      }

      const [item] = payload
      const key = `${labelKey || item.dataKey || item.name || "value"}`
      const itemConfig = getPayloadConfigFromPayload(config, item, key)
      const value =
        !labelKey && typeof label === "string"
          ? config[label as keyof typeof config]?.label || label
          : itemConfig?.label

      if (labelFormatter) {
        return (
          <div className={cn("font-medium", labelClassName)}>
            {labelFormatter(value, payload)}
          </div>
        )
      }

      if (!value) {
        return null
      }

      return <div className={cn("font-medium", labelClassName)}>{value}</div>
    }, [
      label,
      labelFormatter,
      payload,
      hideLabel,
      labelClassName,
      config,
      labelKey,
    ])

    if (!active || !payload?.length) {
      return null
    }

    const nestLabel = payload.length === 1 && indicator !== "dot"

    return (
      <div
        ref={ref}
        className={cn(
          "grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",
          className
        )}
      >
        {!nestLabel ? tooltipLabel : null}
        <div className="grid gap-1.5">
          {payload.map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`
            const itemConfig = getPayloadConfigFromPayload(config, item, key)
            const indicatorColor = color || item.payload.fill || item.color

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",
                  indicator === "dot" && "items-center"
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn(
                            "shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",
                            {
                              "h-2.5 w-2.5": indicator === "dot",
                              "w-1": indicator === "line",
                              "w-0 border-[1.5px] border-dashed bg-transparent":
                                indicator === "dashed",
                              "my-0.5": nestLabel && indicator === "dashed",
                            }
                          )}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center"
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">
                          {itemConfig?.label || item.name}
                        </span>
                      </div>
                      {item.value && (
                        <span className="font-mono font-medium tabular-nums text-foreground">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            )
          })}
        </div>
      </div>
    )
  }
)
ChartTooltipContent.displayName = "ChartTooltip"

const ChartLegend = RechartsPrimitive.Legend

const ChartLegendContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> &
    Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
      hideIcon?: boolean
      nameKey?: string
    }
>(
  (
    { className, hideIcon = false, payload, verticalAlign = "bottom", nameKey },
    ref
  ) => {
    const { config } = useChart()

    if (!payload?.length) {
      return null
    }

    return (
      <div
        ref={ref}
        className={cn(
          "flex items-center justify-center gap-4",
          verticalAlign === "top" ? "pb-3" : "pt-3",
          className
        )}
      >
        {payload.map((item) => {
          const key = `${nameKey || item.dataKey || "value"}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)

          return (
            <div
              key={item.value}
              className={cn(
                "flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"
              )}
            >
              {itemConfig?.icon && !hideIcon ? (
                <itemConfig.icon />
              ) : (
                <div
                  className="h-2 w-2 shrink-0 rounded-[2px]"
                  style={{
                    backgroundColor: item.color,
                  }}
                />
              )}
              {itemConfig?.label}
            </div>
          )
        })}
      </div>
    )
  }
)
ChartLegendContent.displayName = "ChartLegend"

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}

```

# dataextract-ey-main\src\components\ui\checkbox.tsx

```tsx
import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }

```

# dataextract-ey-main\src\components\ui\collapsible.tsx

```tsx
import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

const Collapsible = CollapsiblePrimitive.Root

const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger

const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent

export { Collapsible, CollapsibleTrigger, CollapsibleContent }

```

# dataextract-ey-main\src\components\ui\command.tsx

```tsx
import * as React from "react"
import { type DialogProps } from "@radix-ui/react-dialog"
import { Command as CommandPrimitive } from "cmdk"
import { Search } from "lucide-react"

import { cn } from "@/lib/utils"
import { Dialog, DialogContent } from "@/components/ui/dialog"

const Command = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive>
>(({ className, ...props }, ref) => (
  <CommandPrimitive
    ref={ref}
    className={cn(
      "flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",
      className
    )}
    {...props}
  />
))
Command.displayName = CommandPrimitive.displayName

interface CommandDialogProps extends DialogProps {}

const CommandDialog = ({ children, ...props }: CommandDialogProps) => {
  return (
    <Dialog {...props}>
      <DialogContent className="overflow-hidden p-0 shadow-lg">
        <Command className="[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

const CommandInput = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Input>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
>(({ className, ...props }, ref) => (
  <div className="flex items-center border-b px-3" cmdk-input-wrapper="">
    <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
    <CommandPrimitive.Input
      ref={ref}
      className={cn(
        "flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    />
  </div>
))

CommandInput.displayName = CommandPrimitive.Input.displayName

const CommandList = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.List
    ref={ref}
    className={cn("max-h-[300px] overflow-y-auto overflow-x-hidden", className)}
    {...props}
  />
))

CommandList.displayName = CommandPrimitive.List.displayName

const CommandEmpty = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Empty>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>
>((props, ref) => (
  <CommandPrimitive.Empty
    ref={ref}
    className="py-6 text-center text-sm"
    {...props}
  />
))

CommandEmpty.displayName = CommandPrimitive.Empty.displayName

const CommandGroup = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Group>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Group
    ref={ref}
    className={cn(
      "overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",
      className
    )}
    {...props}
  />
))

CommandGroup.displayName = CommandPrimitive.Group.displayName

const CommandSeparator = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 h-px bg-border", className)}
    {...props}
  />
))
CommandSeparator.displayName = CommandPrimitive.Separator.displayName

const CommandItem = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",
      className
    )}
    {...props}
  />
))

CommandItem.displayName = CommandPrimitive.Item.displayName

const CommandShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
CommandShortcut.displayName = "CommandShortcut"

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}

```

# dataextract-ey-main\src\components\ui\context-menu.tsx

```tsx
import * as React from "react"
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const ContextMenu = ContextMenuPrimitive.Root

const ContextMenuTrigger = ContextMenuPrimitive.Trigger

const ContextMenuGroup = ContextMenuPrimitive.Group

const ContextMenuPortal = ContextMenuPrimitive.Portal

const ContextMenuSub = ContextMenuPrimitive.Sub

const ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup

const ContextMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <ContextMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </ContextMenuPrimitive.SubTrigger>
))
ContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName

const ContextMenuSubContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
ContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName

const ContextMenuContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Portal>
    <ContextMenuPrimitive.Content
      ref={ref}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </ContextMenuPrimitive.Portal>
))
ContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName

const ContextMenuItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName

const ContextMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <ContextMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.CheckboxItem>
))
ContextMenuCheckboxItem.displayName =
  ContextMenuPrimitive.CheckboxItem.displayName

const ContextMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <ContextMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.RadioItem>
))
ContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName

const ContextMenuLabel = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold text-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName

const ContextMenuSeparator = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-border", className)}
    {...props}
  />
))
ContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName

const ContextMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
ContextMenuShortcut.displayName = "ContextMenuShortcut"

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}

```

# dataextract-ey-main\src\components\ui\dialog.tsx

```tsx
import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}

```

# dataextract-ey-main\src\components\ui\drawer.tsx

```tsx
import * as React from "react"
import { Drawer as DrawerPrimitive } from "vaul"

import { cn } from "@/lib/utils"

const Drawer = ({
  shouldScaleBackground = true,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (
  <DrawerPrimitive.Root
    shouldScaleBackground={shouldScaleBackground}
    {...props}
  />
)
Drawer.displayName = "Drawer"

const DrawerTrigger = DrawerPrimitive.Trigger

const DrawerPortal = DrawerPrimitive.Portal

const DrawerClose = DrawerPrimitive.Close

const DrawerOverlay = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Overlay
    ref={ref}
    className={cn("fixed inset-0 z-50 bg-black/80", className)}
    {...props}
  />
))
DrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName

const DrawerContent = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DrawerPortal>
    <DrawerOverlay />
    <DrawerPrimitive.Content
      ref={ref}
      className={cn(
        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",
        className
      )}
      {...props}
    >
      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted" />
      {children}
    </DrawerPrimitive.Content>
  </DrawerPortal>
))
DrawerContent.displayName = "DrawerContent"

const DrawerHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}
    {...props}
  />
)
DrawerHeader.displayName = "DrawerHeader"

const DrawerFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("mt-auto flex flex-col gap-2 p-4", className)}
    {...props}
  />
)
DrawerFooter.displayName = "DrawerFooter"

const DrawerTitle = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DrawerTitle.displayName = DrawerPrimitive.Title.displayName

const DrawerDescription = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DrawerDescription.displayName = DrawerPrimitive.Description.displayName

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}

```

# dataextract-ey-main\src\components\ui\dropdown-menu.tsx

```tsx
import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const DropdownMenu = DropdownMenuPrimitive.Root

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger

const DropdownMenuGroup = DropdownMenuPrimitive.Group

const DropdownMenuPortal = DropdownMenuPrimitive.Portal

const DropdownMenuSub = DropdownMenuPrimitive.Sub

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </DropdownMenuPrimitive.SubTrigger>
))
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
))
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
))
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  )
}
DropdownMenuShortcut.displayName = "DropdownMenuShortcut"

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
}

```

# dataextract-ey-main\src\components\ui\form.tsx

```tsx
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  ControllerProps,
  FieldPath,
  FieldValues,
  FormProvider,
  useFormContext,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState, formState } = useFormContext()

  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn("space-y-2", className)} {...props} />
    </FormItemContext.Provider>
  )
})
FormItem.displayName = "FormItem"

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField()

  return (
    <Label
      ref={ref}
      className={cn(error && "text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
})
FormLabel.displayName = "FormLabel"

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
})
FormControl.displayName = "FormControl"

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField()

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn("text-sm text-muted-foreground", className)}
      {...props}
    />
  )
})
FormDescription.displayName = "FormDescription"

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message) : children

  if (!body) {
    return null
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn("text-sm font-medium text-destructive", className)}
      {...props}
    >
      {body}
    </p>
  )
})
FormMessage.displayName = "FormMessage"

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}

```

# dataextract-ey-main\src\components\ui\hover-card.tsx

```tsx
import * as React from "react"
import * as HoverCardPrimitive from "@radix-ui/react-hover-card"

import { cn } from "@/lib/utils"

const HoverCard = HoverCardPrimitive.Root

const HoverCardTrigger = HoverCardPrimitive.Trigger

const HoverCardContent = React.forwardRef<
  React.ElementRef<typeof HoverCardPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <HoverCardPrimitive.Content
    ref={ref}
    align={align}
    sideOffset={sideOffset}
    className={cn(
      "z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
HoverCardContent.displayName = HoverCardPrimitive.Content.displayName

export { HoverCard, HoverCardTrigger, HoverCardContent }

```

# dataextract-ey-main\src\components\ui\input-otp.tsx

```tsx
import * as React from "react"
import { OTPInput, OTPInputContext } from "input-otp"
import { Dot } from "lucide-react"

import { cn } from "@/lib/utils"

const InputOTP = React.forwardRef<
  React.ElementRef<typeof OTPInput>,
  React.ComponentPropsWithoutRef<typeof OTPInput>
>(({ className, containerClassName, ...props }, ref) => (
  <OTPInput
    ref={ref}
    containerClassName={cn(
      "flex items-center gap-2 has-[:disabled]:opacity-50",
      containerClassName
    )}
    className={cn("disabled:cursor-not-allowed", className)}
    {...props}
  />
))
InputOTP.displayName = "InputOTP"

const InputOTPGroup = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("flex items-center", className)} {...props} />
))
InputOTPGroup.displayName = "InputOTPGroup"

const InputOTPSlot = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div"> & { index: number }
>(({ index, className, ...props }, ref) => {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]

  return (
    <div
      ref={ref}
      className={cn(
        "relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",
        isActive && "z-10 ring-2 ring-ring ring-offset-background",
        className
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="h-4 w-px animate-caret-blink bg-foreground duration-1000" />
        </div>
      )}
    </div>
  )
})
InputOTPSlot.displayName = "InputOTPSlot"

const InputOTPSeparator = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ ...props }, ref) => (
  <div ref={ref} role="separator" {...props}>
    <Dot />
  </div>
))
InputOTPSeparator.displayName = "InputOTPSeparator"

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }

```

# dataextract-ey-main\src\components\ui\input.tsx

```tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }

```

# dataextract-ey-main\src\components\ui\label.tsx

```tsx
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }

```

# dataextract-ey-main\src\components\ui\menubar.tsx

```tsx
import * as React from "react"
import * as MenubarPrimitive from "@radix-ui/react-menubar"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const MenubarMenu = MenubarPrimitive.Menu

const MenubarGroup = MenubarPrimitive.Group

const MenubarPortal = MenubarPrimitive.Portal

const MenubarSub = MenubarPrimitive.Sub

const MenubarRadioGroup = MenubarPrimitive.RadioGroup

const Menubar = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Root
    ref={ref}
    className={cn(
      "flex h-10 items-center space-x-1 rounded-md border bg-background p-1",
      className
    )}
    {...props}
  />
))
Menubar.displayName = MenubarPrimitive.Root.displayName

const MenubarTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      className
    )}
    {...props}
  />
))
MenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName

const MenubarSubTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <MenubarPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </MenubarPrimitive.SubTrigger>
))
MenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName

const MenubarSubContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
MenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName

const MenubarContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>
>(
  (
    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },
    ref
  ) => (
    <MenubarPrimitive.Portal>
      <MenubarPrimitive.Content
        ref={ref}
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
          className
        )}
        {...props}
      />
    </MenubarPrimitive.Portal>
  )
)
MenubarContent.displayName = MenubarPrimitive.Content.displayName

const MenubarItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarItem.displayName = MenubarPrimitive.Item.displayName

const MenubarCheckboxItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <MenubarPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.CheckboxItem>
))
MenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName

const MenubarRadioItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <MenubarPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.RadioItem>
))
MenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName

const MenubarLabel = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarLabel.displayName = MenubarPrimitive.Label.displayName

const MenubarSeparator = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
MenubarSeparator.displayName = MenubarPrimitive.Separator.displayName

const MenubarShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
MenubarShortcut.displayname = "MenubarShortcut"

export {
  Menubar,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarItem,
  MenubarSeparator,
  MenubarLabel,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarPortal,
  MenubarSubContent,
  MenubarSubTrigger,
  MenubarGroup,
  MenubarSub,
  MenubarShortcut,
}

```

# dataextract-ey-main\src\components\ui\navigation-menu.tsx

```tsx
import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const NavigationMenu = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Root
    ref={ref}
    className={cn(
      "relative z-10 flex max-w-max flex-1 items-center justify-center",
      className
    )}
    {...props}
  >
    {children}
    <NavigationMenuViewport />
  </NavigationMenuPrimitive.Root>
))
NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName

const NavigationMenuList = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.List
    ref={ref}
    className={cn(
      "group flex flex-1 list-none items-center justify-center space-x-1",
      className
    )}
    {...props}
  />
))
NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName

const NavigationMenuItem = NavigationMenuPrimitive.Item

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50"
)

const NavigationMenuTrigger = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Trigger
    ref={ref}
    className={cn(navigationMenuTriggerStyle(), "group", className)}
    {...props}
  >
    {children}{" "}
    <ChevronDown
      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"
      aria-hidden="true"
    />
  </NavigationMenuPrimitive.Trigger>
))
NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName

const NavigationMenuContent = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Content
    ref={ref}
    className={cn(
      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",
      className
    )}
    {...props}
  />
))
NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName

const NavigationMenuLink = NavigationMenuPrimitive.Link

const NavigationMenuViewport = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
>(({ className, ...props }, ref) => (
  <div className={cn("absolute left-0 top-full flex justify-center")}>
    <NavigationMenuPrimitive.Viewport
      className={cn(
        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",
        className
      )}
      ref={ref}
      {...props}
    />
  </div>
))
NavigationMenuViewport.displayName =
  NavigationMenuPrimitive.Viewport.displayName

const NavigationMenuIndicator = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Indicator
    ref={ref}
    className={cn(
      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",
      className
    )}
    {...props}
  >
    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md" />
  </NavigationMenuPrimitive.Indicator>
))
NavigationMenuIndicator.displayName =
  NavigationMenuPrimitive.Indicator.displayName

export {
  navigationMenuTriggerStyle,
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
}

```

# dataextract-ey-main\src\components\ui\pagination.tsx

```tsx
import * as React from "react"
import { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"
import { ButtonProps, buttonVariants } from "@/components/ui/button"

const Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn("mx-auto flex w-full justify-center", className)}
    {...props}
  />
)
Pagination.displayName = "Pagination"

const PaginationContent = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    className={cn("flex flex-row items-center gap-1", className)}
    {...props}
  />
))
PaginationContent.displayName = "PaginationContent"

const PaginationItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li ref={ref} className={cn("", className)} {...props} />
))
PaginationItem.displayName = "PaginationItem"

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<ButtonProps, "size"> &
  React.ComponentProps<"a">

const PaginationLink = ({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) => (
  <a
    aria-current={isActive ? "page" : undefined}
    className={cn(
      buttonVariants({
        variant: isActive ? "outline" : "ghost",
        size,
      }),
      className
    )}
    {...props}
  />
)
PaginationLink.displayName = "PaginationLink"

const PaginationPrevious = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to previous page"
    size="default"
    className={cn("gap-1 pl-2.5", className)}
    {...props}
  >
    <ChevronLeft className="h-4 w-4" />
    <span>Previous</span>
  </PaginationLink>
)
PaginationPrevious.displayName = "PaginationPrevious"

const PaginationNext = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to next page"
    size="default"
    className={cn("gap-1 pr-2.5", className)}
    {...props}
  >
    <span>Next</span>
    <ChevronRight className="h-4 w-4" />
  </PaginationLink>
)
PaginationNext.displayName = "PaginationNext"

const PaginationEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    aria-hidden
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More pages</span>
  </span>
)
PaginationEllipsis.displayName = "PaginationEllipsis"

export {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
}

```

# dataextract-ey-main\src\components\ui\popover.tsx

```tsx
import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

const Popover = PopoverPrimitive.Root

const PopoverTrigger = PopoverPrimitive.Trigger

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
))
PopoverContent.displayName = PopoverPrimitive.Content.displayName

export { Popover, PopoverTrigger, PopoverContent }

```

# dataextract-ey-main\src\components\ui\progress.tsx

```tsx

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

interface ProgressProps extends React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root> {
  indicatorClassName?: string;
}

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  ProgressProps
>(({ className, value, indicatorClassName, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-4 w-full overflow-hidden rounded-full bg-secondary",
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className={cn(
        "h-full w-full flex-1 bg-primary transition-all",
        indicatorClassName
      )}
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }

```

# dataextract-ey-main\src\components\ui\radio-group.tsx

```tsx
import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Root
      className={cn("grid gap-2", className)}
      {...props}
      ref={ref}
    />
  )
})
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
})
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName

export { RadioGroup, RadioGroupItem }

```

# dataextract-ey-main\src\components\ui\resizable.tsx

```tsx
import { GripVertical } from "lucide-react"
import * as ResizablePrimitive from "react-resizable-panels"

import { cn } from "@/lib/utils"

const ResizablePanelGroup = ({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (
  <ResizablePrimitive.PanelGroup
    className={cn(
      "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
      className
    )}
    {...props}
  />
)

const ResizablePanel = ResizablePrimitive.Panel

const ResizableHandle = ({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) => (
  <ResizablePrimitive.PanelResizeHandle
    className={cn(
      "relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
      className
    )}
    {...props}
  >
    {withHandle && (
      <div className="z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border">
        <GripVertical className="h-2.5 w-2.5" />
      </div>
    )}
  </ResizablePrimitive.PanelResizeHandle>
)

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }

```

# dataextract-ey-main\src\components\ui\scroll-area.tsx

```tsx
import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root
    ref={ref}
    className={cn("relative overflow-hidden", className)}
    {...props}
  >
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">
      {children}
    </ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
))
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName

const ScrollBar = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
>(({ className, orientation = "vertical", ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      "flex touch-none select-none transition-colors",
      orientation === "vertical" &&
        "h-full w-2.5 border-l border-l-transparent p-[1px]",
      orientation === "horizontal" &&
        "h-2.5 flex-col border-t border-t-transparent p-[1px]",
      className
    )}
    {...props}
  >
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
))
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName

export { ScrollArea, ScrollBar }

```

# dataextract-ey-main\src\components\ui\select.tsx

```tsx
import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}

```

# dataextract-ey-main\src\components\ui\separator.tsx

```tsx
import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }

```

# dataextract-ey-main\src\components\ui\sheet.tsx

```tsx
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"
import * as React from "react"

import { cn } from "@/lib/utils"

const Sheet = SheetPrimitive.Root

const SheetTrigger = SheetPrimitive.Trigger

const SheetClose = SheetPrimitive.Close

const SheetPortal = SheetPrimitive.Portal

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName

const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom:
          "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right:
          "inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
)

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
  VariantProps<typeof sheetVariants> { }

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(({ side = "right", className, children, ...props }, ref) => (
  <SheetPortal>
    <SheetOverlay />
    <SheetPrimitive.Content
      ref={ref}
      className={cn(sheetVariants({ side }), className)}
      {...props}
    >
      {children}
      <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </SheetPrimitive.Close>
    </SheetPrimitive.Content>
  </SheetPortal>
))
SheetContent.displayName = SheetPrimitive.Content.displayName

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
SheetHeader.displayName = "SheetHeader"

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
SheetFooter.displayName = "SheetFooter"

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold text-foreground", className)}
    {...props}
  />
))
SheetTitle.displayName = SheetPrimitive.Title.displayName

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
SheetDescription.displayName = SheetPrimitive.Description.displayName

export {
  Sheet, SheetClose,
  SheetContent, SheetDescription, SheetFooter, SheetHeader, SheetOverlay, SheetPortal, SheetTitle, SheetTrigger
}


```

# dataextract-ey-main\src\components\ui\sidebar.tsx

```tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { VariantProps, cva } from "class-variance-authority"
import { PanelLeft } from "lucide-react"

import { useIsMobile } from "@/hooks/use-mobile"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Separator } from "@/components/ui/separator"
import { Sheet, SheetContent } from "@/components/ui/sheet"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip"

const SIDEBAR_COOKIE_NAME = "sidebar:state"
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = "16rem"
const SIDEBAR_WIDTH_MOBILE = "18rem"
const SIDEBAR_WIDTH_ICON = "3rem"
const SIDEBAR_KEYBOARD_SHORTCUT = "b"

type SidebarContext = {
  state: "expanded" | "collapsed"
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContext | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.")
  }

  return context
}

const SidebarProvider = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    defaultOpen?: boolean
    open?: boolean
    onOpenChange?: (open: boolean) => void
  }
>(
  (
    {
      defaultOpen = true,
      open: openProp,
      onOpenChange: setOpenProp,
      className,
      style,
      children,
      ...props
    },
    ref
  ) => {
    const isMobile = useIsMobile()
    const [openMobile, setOpenMobile] = React.useState(false)

    // This is the internal state of the sidebar.
    // We use openProp and setOpenProp for control from outside the component.
    const [_open, _setOpen] = React.useState(defaultOpen)
    const open = openProp ?? _open
    const setOpen = React.useCallback(
      (value: boolean | ((value: boolean) => boolean)) => {
        const openState = typeof value === "function" ? value(open) : value
        if (setOpenProp) {
          setOpenProp(openState)
        } else {
          _setOpen(openState)
        }

        // This sets the cookie to keep the sidebar state.
        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
      },
      [setOpenProp, open]
    )

    // Helper to toggle the sidebar.
    const toggleSidebar = React.useCallback(() => {
      return isMobile
        ? setOpenMobile((open) => !open)
        : setOpen((open) => !open)
    }, [isMobile, setOpen, setOpenMobile])

    // Adds a keyboard shortcut to toggle the sidebar.
    React.useEffect(() => {
      const handleKeyDown = (event: KeyboardEvent) => {
        if (
          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
          (event.metaKey || event.ctrlKey)
        ) {
          event.preventDefault()
          toggleSidebar()
        }
      }

      window.addEventListener("keydown", handleKeyDown)
      return () => window.removeEventListener("keydown", handleKeyDown)
    }, [toggleSidebar])

    // We add a state so that we can do data-state="expanded" or "collapsed".
    // This makes it easier to style the sidebar with Tailwind classes.
    const state = open ? "expanded" : "collapsed"

    const contextValue = React.useMemo<SidebarContext>(
      () => ({
        state,
        open,
        setOpen,
        isMobile,
        openMobile,
        setOpenMobile,
        toggleSidebar,
      }),
      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]
    )

    return (
      <SidebarContext.Provider value={contextValue}>
        <TooltipProvider delayDuration={0}>
          <div
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH,
                "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
                ...style,
              } as React.CSSProperties
            }
            className={cn(
              "group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",
              className
            )}
            ref={ref}
            {...props}
          >
            {children}
          </div>
        </TooltipProvider>
      </SidebarContext.Provider>
    )
  }
)
SidebarProvider.displayName = "SidebarProvider"

const Sidebar = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    side?: "left" | "right"
    variant?: "sidebar" | "floating" | "inset"
    collapsible?: "offcanvas" | "icon" | "none"
  }
>(
  (
    {
      side = "left",
      variant = "sidebar",
      collapsible = "offcanvas",
      className,
      children,
      ...props
    },
    ref
  ) => {
    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

    if (collapsible === "none") {
      return (
        <div
          className={cn(
            "flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",
            className
          )}
          ref={ref}
          {...props}
        >
          {children}
        </div>
      )
    }

    if (isMobile) {
      return (
        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
          <SheetContent
            data-sidebar="sidebar"
            data-mobile="true"
            className="w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden"
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
              } as React.CSSProperties
            }
            side={side}
          >
            <div className="flex h-full w-full flex-col">{children}</div>
          </SheetContent>
        </Sheet>
      )
    }

    return (
      <div
        ref={ref}
        className="group peer hidden md:block text-sidebar-foreground"
        data-state={state}
        data-collapsible={state === "collapsed" ? collapsible : ""}
        data-variant={variant}
        data-side={side}
      >
        {/* This is what handles the sidebar gap on desktop */}
        <div
          className={cn(
            "duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear",
            "group-data-[collapsible=offcanvas]:w-0",
            "group-data-[side=right]:rotate-180",
            variant === "floating" || variant === "inset"
              ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon]"
          )}
        />
        <div
          className={cn(
            "duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex",
            side === "left"
              ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
              : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
            // Adjust the padding for floating and inset variants.
            variant === "floating" || variant === "inset"
              ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",
            className
          )}
          {...props}
        >
          <div
            data-sidebar="sidebar"
            className="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"
          >
            {children}
          </div>
        </div>
      </div>
    )
  }
)
Sidebar.displayName = "Sidebar"

const SidebarTrigger = React.forwardRef<
  React.ElementRef<typeof Button>,
  React.ComponentProps<typeof Button>
>(({ className, onClick, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      ref={ref}
      data-sidebar="trigger"
      variant="ghost"
      size="icon"
      className={cn("h-7 w-7", className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeft />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
})
SidebarTrigger.displayName = "SidebarTrigger"

const SidebarRail = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button">
>(({ className, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      ref={ref}
      data-sidebar="rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex",
        "[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className
      )}
      {...props}
    />
  )
})
SidebarRail.displayName = "SidebarRail"

const SidebarInset = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"main">
>(({ className, ...props }, ref) => {
  return (
    <main
      ref={ref}
      className={cn(
        "relative flex min-h-svh flex-1 flex-col bg-background",
        "peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",
        className
      )}
      {...props}
    />
  )
})
SidebarInset.displayName = "SidebarInset"

const SidebarInput = React.forwardRef<
  React.ElementRef<typeof Input>,
  React.ComponentProps<typeof Input>
>(({ className, ...props }, ref) => {
  return (
    <Input
      ref={ref}
      data-sidebar="input"
      className={cn(
        "h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",
        className
      )}
      {...props}
    />
  )
})
SidebarInput.displayName = "SidebarInput"

const SidebarHeader = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarHeader.displayName = "SidebarHeader"

const SidebarFooter = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarFooter.displayName = "SidebarFooter"

const SidebarSeparator = React.forwardRef<
  React.ElementRef<typeof Separator>,
  React.ComponentProps<typeof Separator>
>(({ className, ...props }, ref) => {
  return (
    <Separator
      ref={ref}
      data-sidebar="separator"
      className={cn("mx-2 w-auto bg-sidebar-border", className)}
      {...props}
    />
  )
})
SidebarSeparator.displayName = "SidebarSeparator"

const SidebarContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarContent.displayName = "SidebarContent"

const SidebarGroup = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  )
})
SidebarGroup.displayName = "SidebarGroup"

const SidebarGroupLabel = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "div"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-label"
      className={cn(
        "duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupLabel.displayName = "SidebarGroupLabel"

const SidebarGroupAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-action"
      className={cn(
        "absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupAction.displayName = "SidebarGroupAction"

const SidebarGroupContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="group-content"
    className={cn("w-full text-sm", className)}
    {...props}
  />
))
SidebarGroupContent.displayName = "SidebarGroupContent"

const SidebarMenu = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu"
    className={cn("flex w-full min-w-0 flex-col gap-1", className)}
    {...props}
  />
))
SidebarMenu.displayName = "SidebarMenu"

const SidebarMenuItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    data-sidebar="menu-item"
    className={cn("group/menu-item relative", className)}
    {...props}
  />
))
SidebarMenuItem.displayName = "SidebarMenuItem"

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:!p-0",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const SidebarMenuButton = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    isActive?: boolean
    tooltip?: string | React.ComponentProps<typeof TooltipContent>
  } & VariantProps<typeof sidebarMenuButtonVariants>
>(
  (
    {
      asChild = false,
      isActive = false,
      variant = "default",
      size = "default",
      tooltip,
      className,
      ...props
    },
    ref
  ) => {
    const Comp = asChild ? Slot : "button"
    const { isMobile, state } = useSidebar()

    const button = (
      <Comp
        ref={ref}
        data-sidebar="menu-button"
        data-size={size}
        data-active={isActive}
        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
        {...props}
      />
    )

    if (!tooltip) {
      return button
    }

    if (typeof tooltip === "string") {
      tooltip = {
        children: tooltip,
      }
    }

    return (
      <Tooltip>
        <TooltipTrigger asChild>{button}</TooltipTrigger>
        <TooltipContent
          side="right"
          align="center"
          hidden={state !== "collapsed" || isMobile}
          {...tooltip}
        />
      </Tooltip>
    )
  }
)
SidebarMenuButton.displayName = "SidebarMenuButton"

const SidebarMenuAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    showOnHover?: boolean
  }
>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-action"
      className={cn(
        "absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuAction.displayName = "SidebarMenuAction"

const SidebarMenuBadge = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="menu-badge"
    className={cn(
      "absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none",
      "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
      "peer-data-[size=sm]/menu-button:top-1",
      "peer-data-[size=default]/menu-button:top-1.5",
      "peer-data-[size=lg]/menu-button:top-2.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuBadge.displayName = "SidebarMenuBadge"

const SidebarMenuSkeleton = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    showIcon?: boolean
  }
>(({ className, showIcon = false, ...props }, ref) => {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      ref={ref}
      data-sidebar="menu-skeleton"
      className={cn("rounded-md h-8 flex gap-2 px-2 items-center", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 flex-1 max-w-[--skeleton-width]"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  )
})
SidebarMenuSkeleton.displayName = "SidebarMenuSkeleton"

const SidebarMenuSub = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu-sub"
    className={cn(
      "mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuSub.displayName = "SidebarMenuSub"

const SidebarMenuSubItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ ...props }, ref) => <li ref={ref} {...props} />)
SidebarMenuSubItem.displayName = "SidebarMenuSubItem"

const SidebarMenuSubButton = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentProps<"a"> & {
    asChild?: boolean
    size?: "sm" | "md"
    isActive?: boolean
  }
>(({ asChild = false, size = "md", isActive, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuSubButton.displayName = "SidebarMenuSubButton"

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}

```

# dataextract-ey-main\src\components\ui\skeleton.tsx

```tsx
import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      {...props}
    />
  )
}

export { Skeleton }

```

# dataextract-ey-main\src\components\ui\slider.tsx

```tsx
import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

const Slider = React.forwardRef<
  React.ElementRef<typeof SliderPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
>(({ className, ...props }, ref) => (
  <SliderPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex w-full touch-none select-none items-center",
      className
    )}
    {...props}
  >
    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-secondary">
      <SliderPrimitive.Range className="absolute h-full bg-primary" />
    </SliderPrimitive.Track>
    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
  </SliderPrimitive.Root>
))
Slider.displayName = SliderPrimitive.Root.displayName

export { Slider }

```

# dataextract-ey-main\src\components\ui\sonner.tsx

```tsx
import { useTheme } from "next-themes"
import { Toaster as Sonner, toast } from "sonner"

type ToasterProps = React.ComponentProps<typeof Sonner>

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      toastOptions={{
        classNames: {
          toast:
            "group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",
          description: "group-[.toast]:text-muted-foreground",
          actionButton:
            "group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",
          cancelButton:
            "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",
        },
      }}
      {...props}
    />
  )
}

export { Toaster, toast }

```

# dataextract-ey-main\src\components\ui\switch.tsx

```tsx
import * as React from "react"
import * as SwitchPrimitives from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

const Switch = React.forwardRef<
  React.ElementRef<typeof SwitchPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
>(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
      className
    )}
    {...props}
    ref={ref}
  >
    <SwitchPrimitives.Thumb
      className={cn(
        "pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"
      )}
    />
  </SwitchPrimitives.Root>
))
Switch.displayName = SwitchPrimitives.Root.displayName

export { Switch }

```

# dataextract-ey-main\src\components\ui\table.tsx

```tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props}
    />
  </div>
))
Table.displayName = "Table"

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
))
TableHeader.displayName = "TableHeader"

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props}
  />
))
TableBody.displayName = "TableBody"

const TableFooter = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn(
      "border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",
      className
    )}
    {...props}
  />
))
TableFooter.displayName = "TableFooter"

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    )}
    {...props}
  />
))
TableRow.displayName = "TableRow"

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
      className
    )}
    {...props}
  />
))
TableHead.displayName = "TableHead"

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}
    {...props}
  />
))
TableCell.displayName = "TableCell"

const TableCaption = React.forwardRef<
  HTMLTableCaptionElement,
  React.HTMLAttributes<HTMLTableCaptionElement>
>(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn("mt-4 text-sm text-muted-foreground", className)}
    {...props}
  />
))
TableCaption.displayName = "TableCaption"

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}

```

# dataextract-ey-main\src\components\ui\tabs.tsx

```tsx
import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }

```

# dataextract-ey-main\src\components\ui\textarea.tsx

```tsx
import * as React from "react"

import { cn } from "@/lib/utils"

export interface TextareaProps
  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}

const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, ...props }, ref) => {
    return (
      <textarea
        className={cn(
          "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Textarea.displayName = "Textarea"

export { Textarea }

```

# dataextract-ey-main\src\components\ui\toast.tsx

```tsx
import * as React from "react"
import * as ToastPrimitives from "@radix-ui/react-toast"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
      className
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
  {
    variants: {
      variant: {
        default: "border bg-background text-foreground",
        destructive:
          "destructive group border-destructive bg-destructive text-destructive-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
      className
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      "absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
      className
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn("text-sm font-semibold", className)}
    {...props}
  />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn("text-sm opacity-90", className)}
    {...props}
  />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}

```

# dataextract-ey-main\src\components\ui\toaster.tsx

```tsx
import { useToast } from "@/hooks/use-toast"
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from "@/components/ui/toast"

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}

```

# dataextract-ey-main\src\components\ui\toggle-group.tsx

```tsx
import * as React from "react"
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"
import { type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { toggleVariants } from "@/components/ui/toggle"

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
})

const ToggleGroup = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, children, ...props }, ref) => (
  <ToggleGroupPrimitive.Root
    ref={ref}
    className={cn("flex items-center justify-center gap-1", className)}
    {...props}
  >
    <ToggleGroupContext.Provider value={{ variant, size }}>
      {children}
    </ToggleGroupContext.Provider>
  </ToggleGroupPrimitive.Root>
))

ToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName

const ToggleGroupItem = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &
    VariantProps<typeof toggleVariants>
>(({ className, children, variant, size, ...props }, ref) => {
  const context = React.useContext(ToggleGroupContext)

  return (
    <ToggleGroupPrimitive.Item
      ref={ref}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        className
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  )
})

ToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName

export { ToggleGroup, ToggleGroupItem }

```

# dataextract-ey-main\src\components\ui\toggle.tsx

```tsx
import * as React from "react"
import * as TogglePrimitive from "@radix-ui/react-toggle"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const toggleVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-10 px-3",
        sm: "h-9 px-2.5",
        lg: "h-11 px-5",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const Toggle = React.forwardRef<
  React.ElementRef<typeof TogglePrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, ...props }, ref) => (
  <TogglePrimitive.Root
    ref={ref}
    className={cn(toggleVariants({ variant, size, className }))}
    {...props}
  />
))

Toggle.displayName = TogglePrimitive.Root.displayName

export { Toggle, toggleVariants }

```

# dataextract-ey-main\src\components\ui\tooltip.tsx

```tsx
import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className
    )}
    {...props}
  />
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }

```

# dataextract-ey-main\src\components\ui\use-toast.ts

```ts
import { useToast, toast } from "@/hooks/use-toast";

export { useToast, toast };

```

# dataextract-ey-main\src\hooks\use-mobile.tsx

```tsx
import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}

```

# dataextract-ey-main\src\hooks\use-toast.ts

```ts
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }

```

# dataextract-ey-main\src\index.css

```css

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 240 10% 14%;

    --card: 0 0% 100%;
    --card-foreground: 240 10% 14%;

    --popover: 0 0% 100%;
    --popover-foreground: 240 10% 14%;

    --primary: 52 100% 50%;
    --primary-foreground: 0 0% 0%;

    --secondary: 0 0% 96%;
    --secondary-foreground: 240 10% 14%;

    --muted: 240 5% 96%;
    --muted-foreground: 240 3.8% 46.1%;

    --accent: 0 0% 96%;
    --accent-foreground: 240 10% 14%;

    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 100%;

    --border: 240 5.9% 90%;
    --input: 240 5.9% 90%;
    --ring: 52 100% 50%;

    --radius: 0.5rem;

    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }

  .dark {
    --background: 0 0% 28%; /* #474747 - Outer Space */
    --foreground: 0 0% 98%;

    --card: 0 0% 28%;
    --card-foreground: 0 0% 98%;

    --popover: 0 0% 28%;
    --popover-foreground: 0 0% 98%;

    --primary: 52 100% 50%;
    --primary-foreground: 0 0% 0%;

    --secondary: 240 3.7% 15.9%;
    --secondary-foreground: 0 0% 98%;

    --muted: 240 3.7% 15.9%;
    --muted-foreground: 240 5% 64.9%;

    --accent: 240 3.7% 15.9%;
    --accent-foreground: 0 0% 98%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;

    --border: 240 3.7% 15.9%;
    --input: 240 3.7% 15.9%;
    --ring: 52 100% 50%;
    
    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
  }
  
  /* Apply dark mode universally to ensure all elements get the dark background */
  .dark body,
  .dark .bg-white {
    @apply bg-[#474747];
  }
  
  /* Make buttons yellow with black text in dark mode - fixed to avoid circular dependency */
  .dark button[data-state="active"] {
    background-color: #FFE600;
    color: black;
  }
  
  .dark .bg-yellow-400 {
    background-color: #FFE600;
    color: black;
  }
  
  /* Ensure yellow backgrounds always use black text for contrast */
  .bg-yellow-50, 
  .bg-yellow-100, 
  .bg-yellow-200, 
  .bg-yellow-300, 
  .bg-yellow-400, 
  .bg-yellow-500 {
    color: black;
  }
}

@layer components {
  .ey-button {
    @apply bg-ey-yellow hover:bg-ey-yellow/90 text-ey-black font-semibold py-2 px-4 rounded-md transition-colors;
  }
  
  .ey-input {
    @apply border border-ey-gray-400 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-ey-yellow;
  }

  .ey-card {
    @apply bg-white rounded-lg shadow-md p-6 border border-ey-gray-300 hover:shadow-lg transition-shadow dark:bg-background dark:border-ey-gray-700;
  }
}

```

# dataextract-ey-main\src\lib\excelUtils.ts

```ts

import * as XLSX from 'xlsx';
import { PromptOption } from './types';

// Parse Excel file and extract prompts
export const parseExcelPrompts = async (file: File): Promise<PromptOption[]> => {
  try {
    // Read the Excel file
    const data = await file.arrayBuffer();
    const workbook = XLSX.read(data);
    
    // Get the first worksheet
    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
    
    // Convert the worksheet to JSON
    const jsonData = XLSX.utils.sheet_to_json(worksheet);
    
    // Map the JSON data to PromptOption format
    const prompts: PromptOption[] = jsonData.map((row: any, index) => {
      return {
        id: `custom-${index}`,
        name: row['Prompt Name'] || row['Name'] || `Custom Prompt ${index + 1}`,
        description: row['Description'] || 'Custom prompt from Excel file',
        template: row['Template'] || 'Custom_Template',
        category: row['Category'] || 'Custom'
      };
    });
    
    return prompts;
  } catch (error) {
    console.error('Error parsing Excel file:', error);
    throw new Error('Failed to parse Excel file. Please check the format.');
  }
};

// Generate more realistic extraction results based on prompts
export const generateRealisticResults = (promptName: string) => {
  // Create more realistic data based on prompt name/type
  switch (promptName.toLowerCase()) {
    case 'ecl by stage':
      return [
        { Category: "ECL by Stage", Stage: "Stage 1", Field: "Gross Carrying Amount", Value: "$1,245.67m" },
        { Category: "ECL by Stage", Stage: "Stage 1", Field: "Loss Allowance", Value: "$12.45m" },
        { Category: "ECL by Stage", Stage: "Stage 1", Field: "Coverage Ratio", Value: "1.00%" },
        { Category: "ECL by Stage", Stage: "Stage 2", Field: "Gross Carrying Amount", Value: "$428.91m" },
        { Category: "ECL by Stage", Stage: "Stage 2", Field: "Loss Allowance", Value: "$21.45m" },
        { Category: "ECL by Stage", Stage: "Stage 2", Field: "Coverage Ratio", Value: "5.00%" },
        { Category: "ECL by Stage", Stage: "Stage 3", Field: "Gross Carrying Amount", Value: "$85.34m" },
        { Category: "ECL by Stage", Stage: "Stage 3", Field: "Loss Allowance", Value: "$42.67m" },
        { Category: "ECL by Stage", Stage: "Stage 3", Field: "Coverage Ratio", Value: "50.00%" }
      ];
    case 'management adjustments':
      return [
        { Category: "Management Adjustments", Stage: "N/A", Field: "Economic Uncertainty", Value: "$24.5m" },
        { Category: "Management Adjustments", Stage: "N/A", Field: "Model Limitations", Value: "$12.3m" },
        { Category: "Management Adjustments", Stage: "N/A", Field: "Other Adjustments", Value: "$5.8m" },
        { Category: "Management Adjustments", Stage: "N/A", Field: "Total Overlays", Value: "$42.6m" }
      ];
    case 'scenario weights':
      return [
        { Category: "Scenario Weights", Stage: "N/A", Field: "Baseline", Value: "40%" },
        { Category: "Scenario Weights", Stage: "N/A", Field: "Upside", Value: "30%" },
        { Category: "Scenario Weights", Stage: "N/A", Field: "Downside", Value: "30%" }
      ];
    case 'macro variables':
      return [
        { Category: "Macro Variables", Stage: "Baseline", Field: "GDP Growth", Value: "1.3%" },
        { Category: "Macro Variables", Stage: "Baseline", Field: "Unemployment", Value: "4.2%" },
        { Category: "Macro Variables", Stage: "Baseline", Field: "HPI Growth", Value: "1.8%" },
        { Category: "Macro Variables", Stage: "Upside", Field: "GDP Growth", Value: "2.5%" },
        { Category: "Macro Variables", Stage: "Upside", Field: "Unemployment", Value: "3.7%" },
        { Category: "Macro Variables", Stage: "Upside", Field: "HPI Growth", Value: "3.2%" },
        { Category: "Macro Variables", Stage: "Downside", Field: "GDP Growth", Value: "-0.5%" },
        { Category: "Macro Variables", Stage: "Downside", Field: "Unemployment", Value: "5.8%" },
        { Category: "Macro Variables", Stage: "Downside", Field: "HPI Growth", Value: "-2.1%" }
      ];
    default:
      return [
        { Category: promptName, Stage: "N/A", Field: "Value 1", Value: "$123.45m" },
        { Category: promptName, Stage: "N/A", Field: "Value 2", Value: "$67.89m" },
        { Category: promptName, Stage: "N/A", Field: "Ratio", Value: "55.00%" }
      ];
  }
};

```

# dataextract-ey-main\src\lib\types.ts

```ts
// src/lib/types.ts

export interface UploadedFile {
  id: string;
  name: string;
  size: number;
  type: string;
  lastModified: number;
  status: 'pending' | 'processing' | 'success' | 'error';
  progress?: number;
}

export interface PromptOption {
  id: string;
  name: string;
  description: string;
  template: string;
  category: string;
  bankName?: string; // <-- ENSURE THIS LINE IS PRESENT AND CORRECT
}

export interface ExtractedData {
  Category: string;
  Stage: string;
  Field: string;
  Value: string;
}

export interface ProcessingResult {
  id: string;
  fileId: string;
  fileName: string;
  promptId: string;
  promptName: string;
  status: 'pending' | 'processing' | 'success' | 'error';
  timestamp: string;
  data?: ExtractedData[];
  notes?: string;
  error?: string;
}
```

# dataextract-ey-main\src\lib\utils.ts

```ts

import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

/**
 * Ensures proper text contrast on colored backgrounds
 * @param bgColor - The background color class (e.g., 'bg-yellow-400')
 * @returns string - The appropriate text color class
 */
export function getTextColorForBackground(bgColor: string): string {
  // Yellow backgrounds should always have black text
  if (
    bgColor.includes('yellow') || 
    bgColor.includes('lime') || 
    bgColor.includes('green-300') ||
    bgColor.includes('amber')
  ) {
    return 'text-black';
  }
  
  // Dark backgrounds should have white text
  if (
    bgColor.includes('black') || 
    bgColor.includes('gray-800') || 
    bgColor.includes('gray-900') ||
    bgColor.includes('slate-800') ||
    bgColor.includes('slate-900')
  ) {
    return 'text-white';
  }
  
  // Default - use the current text color
  return '';
}

```

# dataextract-ey-main\src\main.tsx

```tsx

import { createRoot } from 'react-dom/client'
import App from './App.tsx'
import './index.css'

// Create root and render app
createRoot(document.getElementById("root")!).render(<App />);

```

# dataextract-ey-main\src\pages\BankSelection.tsx

```tsx

import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Button } from '@/components/ui/button';
import { 
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue
} from '@/components/ui/select';
import { ArrowRight, Check } from 'lucide-react';
import { Checkbox } from '@/components/ui/checkbox';
import { Label } from '@/components/ui/label';

const banks = [
  { id: 'barclays', name: 'Barclays' },
  { id: 'hsbc', name: 'HSBC' },
  { id: 'lloyds', name: 'Lloyds Banking Group' },
  { id: 'natwest', name: 'NatWest Group' },
  { id: 'santander', name: 'Santander UK' },
  { id: 'standard', name: 'Standard Chartered' }
];

const BankSelection = () => {
  const navigate = useNavigate();
  const [selectedBank, setSelectedBank] = useState<string>('');
  const [selectedBanks, setSelectedBanks] = useState<string[]>([]);
  const [enableMultiBanks, setEnableMultiBanks] = useState<boolean>(false);

  // Update selected banks when toggling multi-bank mode
  useEffect(() => {
    if (enableMultiBanks) {
      // If switching to multi-bank mode, initialize with the current selection
      if (selectedBank && !selectedBanks.includes(selectedBank)) {
        setSelectedBanks([selectedBank]);
      }
    } else {
      // If switching to single bank mode, use the first selected bank or empty
      setSelectedBank(selectedBanks.length > 0 ? selectedBanks[0] : '');
    }
  }, [enableMultiBanks]);

  const handleContinue = () => {
    if ((enableMultiBanks && selectedBanks.length > 0) || (!enableMultiBanks && selectedBank)) {
      // Store the selected bank(s) in session storage for use across the application
      sessionStorage.setItem('selectedBank', enableMultiBanks ? selectedBanks[0] : selectedBank);
      sessionStorage.setItem('selectedBanks', JSON.stringify(enableMultiBanks ? selectedBanks : [selectedBank]));
      sessionStorage.setItem('enableMultiBanks', enableMultiBanks.toString());
      navigate('/dashboard');
    }
  };

  const toggleBankSelection = (bankId: string) => {
    setSelectedBanks(prevSelected => {
      if (prevSelected.includes(bankId)) {
        return prevSelected.filter(id => id !== bankId);
      } else {
        return [...prevSelected, bankId];
      }
    });
  };

  // Check if a bank is selected in multi-bank mode
  const isBankSelected = (bankId: string) => {
    return selectedBanks.includes(bankId);
  };

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-ey-black text-white">
      <div className="w-full max-w-md px-6 py-12 text-center">
        <div className="mb-8">
          <div className="flex justify-center mb-6">
            <div className="h-16 w-16 bg-ey-yellow rounded-md"></div>
          </div>
          
          <h1 className="text-4xl font-bold mb-2">AiDEx</h1>
          <p className="text-ey-gray-400">
            AI powered Data Extraction
          </p>
          <p className="text-ey-gray-500 text-sm mt-1">
            Supported by EYQ
          </p>
        </div>
        
        <div className="border border-ey-gray-700 rounded-lg p-6 mb-8">
          <h2 className="text-xl font-semibold mb-6">Select Bank</h2>
          <p className="text-sm text-ey-gray-400 mb-6">
            Choose the bank you want to analyze for data extraction.
          </p>
          
          <div className="space-y-4">
            <div className="flex items-center space-x-3 mt-4 mb-4 p-3 bg-ey-gray-800/50 rounded-md">
              <Checkbox 
                id="enableMultiBanks" 
                checked={enableMultiBanks} 
                onCheckedChange={(checked) => setEnableMultiBanks(checked as boolean)}
                className="data-[state=checked]:bg-ey-yellow data-[state=checked]:text-black"
              />
              <Label htmlFor="enableMultiBanks" className="text-sm cursor-pointer">
                Enable multi-bank analysis & comparison
              </Label>
            </div>

            {enableMultiBanks ? (
              // Multi-bank selection UI
              <div className="space-y-2">
                <label className="text-sm font-medium mb-1 block text-left">
                  Financial Institutions
                </label>
                <div className="border border-ey-gray-600 bg-ey-black text-white rounded-md p-1">
                  <div className="space-y-1">
                    {banks.map(bank => (
                      <div 
                        key={bank.id}
                        onClick={() => toggleBankSelection(bank.id)}
                        className={`flex items-center justify-between p-3 rounded-md cursor-pointer transition-colors ${
                          isBankSelected(bank.id) ? 'bg-ey-yellow/20 border border-ey-yellow' : 'hover:bg-ey-gray-800'
                        }`}
                      >
                        <span className="text-sm">{bank.name}</span>
                        {isBankSelected(bank.id) && (
                          <Check className="h-4 w-4 text-ey-yellow" />
                        )}
                      </div>
                    ))}
                  </div>
                </div>
                {selectedBanks.length === 0 && (
                  <p className="text-xs text-ey-yellow mt-1">Please select at least one bank</p>
                )}
              </div>
            ) : (
              // Single bank selection UI
              <div className="text-left">
                <label className="text-sm font-medium mb-1 block">
                  Financial Institution
                </label>
                <Select onValueChange={setSelectedBank} value={selectedBank}>
                  <SelectTrigger className="w-full border-ey-gray-600 bg-ey-black text-white">
                    <SelectValue placeholder="Select a bank" />
                  </SelectTrigger>
                  <SelectContent className="bg-ey-black text-white border-ey-gray-700">
                    {banks.map(bank => (
                      <SelectItem key={bank.id} value={bank.id} className="hover:bg-ey-gray-800">
                        {bank.name}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
            )}
            
            <Button 
              onClick={handleContinue}
              disabled={enableMultiBanks ? selectedBanks.length === 0 : !selectedBank}
              className="w-full bg-ey-yellow hover:bg-ey-yellow/90 text-ey-black font-medium mt-6"
            >
              Continue to Dashboard
              <ArrowRight className="ml-2 h-4 w-4" />
            </Button>
          </div>
        </div>
        
        <div className="text-xs text-ey-gray-500">
          <p>© {new Date().getFullYear()} EY | A better working world</p>
        </div>
      </div>
    </div>
  );
};

export default BankSelection;

```

# dataextract-ey-main\src\pages\Dashboard.tsx

```tsx
// src/pages/Dashboard.tsx
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Tabs, TabsContent } from '@/components/ui/tabs'; //
import { useToast } from '@/hooks/use-toast'; //
import { UploadedFile, PromptOption, ProcessingResult } from '@/lib/types'; //
import TabNavigation from '@/components/dashboard/TabNavigation'; //
import UploadTab from '@/components/dashboard/UploadTab'; //
import PromptsTab from '@/components/dashboard/PromptsTab'; //
import ResultsTab from '@/components/dashboard/ResultsTab'; //
import CombinedTab from '@/components/dashboard/CombinedTab'; //
import SideBySideTab from '@/components/dashboard/SideBySideTab'; //
import Footer from '@/components/dashboard/Footer'; //
import { Button } from '@/components/ui/button'; //
import { Loader2 } from 'lucide-react';

const Dashboard = () => {
  const [uploadedFiles, setUploadedFiles] = useState<UploadedFile[]>([]);
  const [selectedPrompts, setSelectedPrompts] = useState<PromptOption[]>([]);
  const [results, setResults] = useState<ProcessingResult[]>([]);
  const [isProcessing, setIsProcessing] = useState(false);
  const [processingStep, setProcessingStep] = useState('');
  const [processingProgress, setProcessingProgress] = useState(0);
  const [activeTab, setActiveTab] = useState('upload');
  const { toast } = useToast();
  const [currentSessionId, setCurrentSessionId] = useState<string | null>(null);
  const navigate = useNavigate();

  const [bankDisplayInfo, setBankDisplayInfo] = useState<string>('banks');
  
  useEffect(() => {
    const enableMulti = sessionStorage.getItem('enableMultiBanks') === 'true';
    const singleBank = sessionStorage.getItem('selectedBank') || 'Selected Bank';
    const multiBanksString = sessionStorage.getItem('selectedBanks');

    let displayInfo = singleBank.charAt(0).toUpperCase() + singleBank.slice(1);
    if (enableMulti && multiBanksString) {
      try {
        const banksArray = JSON.parse(multiBanksString) as string[];
        if (banksArray.length > 0) {
          displayInfo = banksArray.map((b:string) => b.charAt(0).toUpperCase() + b.slice(1)).join(', ');
        } else {
           displayInfo = "No banks selected"; 
        }
      } catch { /* Keep singleBank displayInfo as fallback */ }
    }
    setBankDisplayInfo(displayInfo);
  }, []);

  const handleFilesUploaded = (backendConfirmedFiles: UploadedFile[]) => {
    setUploadedFiles(backendConfirmedFiles);
  };

  const handlePromptSelectedForProcessing = (promptsToProcess: PromptOption[]) => {
    setSelectedPrompts(promptsToProcess);
    if (promptsToProcess.length > 0) {
      toast({
        title: "Prompts Ready for Processing",
        description: `${promptsToProcess.length} prompt(s) selected. Click 'Process Files'.`,
      });
    }
  };

  const processFiles = async () => {
    if (uploadedFiles.length === 0) {
      toast({ title: "No Files Uploaded", description: "Please upload PDF file(s) first.", variant: "destructive" });
      return;
    }
    if (selectedPrompts.length === 0) {
      toast({ title: "No Prompts Selected", description: "Please select at least one extraction prompt.", variant: "destructive" });
      return;
    }

    setIsProcessing(true);
    setResults([]); 
    const newSessionId = `session-${Date.now()}-${Math.random().toString(36).substring(2, 10)}`;
    setCurrentSessionId(newSessionId);
    
    setProcessingStep(`Initializing processing for ${uploadedFiles.length} file(s)...`);
    setProcessingProgress(5);
    setActiveTab('results');

    try {
      const response = await fetch('http://localhost:5000/api/process', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          files: uploadedFiles.map(f => ({ id: f.id, name: f.name })), 
          prompts: selectedPrompts.map(p => ({ id: p.id, name: p.name, template: p.template })), 
          sessionId: newSessionId 
        })
      });

      if (!response.ok) {
        const errorData = await response.json().catch(() => ({ error: "Server error during processing setup."}));
        throw new Error(errorData.error || `Processing request failed: ${response.statusText}`);
      }
      const data = await response.json();
      if (data.status === 'success' && data.results) {
        setResults(data.results);
        setProcessingStep('Processing complete!');
        setProcessingProgress(100);
        toast({ title: "Processing Complete", description: `Session ${newSessionId} finished.`});
      } else {
         throw new Error(data.error || "Processing finished with an unexpected status or no results.");
      }
    } catch (error) {
      console.error("Processing Error:", error);
      setProcessingStep('Error during processing.');
      setProcessingProgress(100);
      toast({ title: "Processing Error", description: error instanceof Error ? error.message : "An unknown error occurred.", variant: "destructive" });
    } finally {
      setIsProcessing(false);
    }
  };

  const handleDownloadResults = async () => {
    if (!currentSessionId) {
      toast({ title: "Cannot Download", description: "No processing session found. Please process files first.", variant: "destructive" }); return;
    }
     if (results.length === 0 && !isProcessing) {
       toast({ title: "No Results to Download", description: "Process files to generate results first.", variant: "default"}); return;
     }
     if (isProcessing) {
        toast({ title: "Processing in Progress", description: "Please wait for processing to complete before downloading.", variant: "default"}); return;
     }
    toast({ title: "Preparing Download...", description: "Your Excel file is being generated." });
    try {
      const response = await fetch(`http://localhost:5000/api/download/${currentSessionId}`);
      if (!response.ok) {
        const errorData = await response.json().catch(() => ({ error: "Download request failed with status: " + response.status }));
        throw new Error(errorData.error || `Server error: ${response.statusText}`);
      }
      const blob = await response.blob();
      const contentDisposition = response.headers.get('content-disposition');
      let filename = `IFRS9_Results_${currentSessionId}.xlsx`;
      if (contentDisposition) {
        const filenameMatch = contentDisposition.match(/filename="?(.+)"?/i);
        if (filenameMatch && filenameMatch.length > 1) filename = filenameMatch[1];
      }
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a); a.click(); a.remove();
      window.URL.revokeObjectURL(url);
      toast({ title: "Download Started!", description: `${filename} is downloading.` });
    } catch (error) {
      console.error("Download Error:", error);
      toast({ title: "Download Failed", description: (error instanceof Error ? error.message : "Could not download results."), variant: "destructive" });
    }
  };

  const handleReset = () => {
    setUploadedFiles([]); setSelectedPrompts([]); setResults([]);
    setCurrentSessionId(null); setActiveTab('upload');
    setProcessingProgress(0); setProcessingStep('');
    toast({ title: "Application Reset", description: "All selections and results cleared." });
  };
  
  const goToNextTab = () => {
    if (activeTab === 'upload' && uploadedFiles.length > 0) setActiveTab('prompts');
    else if (activeTab === 'upload' && uploadedFiles.length === 0) {
        toast({title: "No Files Uploaded", description: "Please upload files to proceed.", variant: "default"});
    }
  };

  const goToPreviousTab = () => {
    if (activeTab === 'prompts') setActiveTab('upload');
    else if (['results', 'combined', 'sidebyside'].includes(activeTab)) setActiveTab('prompts');
  };

  // Line 229: Check for typos or missing commas if error persists around here
  return (
    <div className="min-h-screen flex flex-col bg-background text-foreground">
      <div className="bg-yellow-400 text-black py-1 px-4 text-sm flex justify-between items-center">
        <div>
          Selected Bank(s): <span className="font-semibold">{bankDisplayInfo}</span>
        </div>
        <Button 
          variant="link" size="sm" onClick={() => navigate('/')}
          className="h-auto p-0 text-black underline text-xs hover:text-gray-700"
        >Change Bank(s)</Button>
      </div>
      
      <TabNavigation activeTab={activeTab} setActiveTab={setActiveTab} />

      <main className="flex-grow container mx-auto px-4 py-6">
        <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
          {/* ... UploadTab and PromptsTab ... */}
          <TabsContent value="upload" className="space-y-6">
            <UploadTab 
              onFilesUploaded={handleFilesUploaded}
              uploadedFiles={uploadedFiles}
              goToNextTab={goToNextTab}
            />
          </TabsContent>
          
          <TabsContent value="prompts" className="space-y-6">
            <div className="flex flex-col space-y-4">
              <PromptsTab 
                onPromptSelected={handlePromptSelectedForProcessing}
                isProcessing={isProcessing}
                selectedPrompts={selectedPrompts}
              />
              <div className="flex justify-between items-center mt-4 pt-4 border-t dark:border-gray-700">
                <Button onClick={goToPreviousTab} variant="outline" disabled={isProcessing}>
                  Back to Upload
                </Button>
                <Button 
                  onClick={processFiles}
                  disabled={isProcessing || selectedPrompts.length === 0 || uploadedFiles.length === 0}
                  className="bg-yellow-400 hover:bg-yellow-500 text-black font-semibold"
                >
                  {isProcessing && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
                  {isProcessing ? "Processing..." : `Process ${uploadedFiles.length} File(s)`}
                </Button>
              </div>
            </div>
          </TabsContent>
          
          <TabsContent value="results" className="space-y-6">
            <ResultsTab 
              results={results}
              onDownloadResults={handleDownloadResults}
              isProcessing={isProcessing}
              processingProgress={processingProgress}
              processingStep={processingStep}
              selectedBank={bankDisplayInfo}
              totalUploadedFiles={uploadedFiles.length}
            />
          </TabsContent>
          
          <TabsContent value="combined" className="space-y-6">
            <CombinedTab 
              results={results} 
              onDownloadResults={handleDownloadResults} 
              selectedBank={bankDisplayInfo}
            />
          </TabsContent>
        {/* Line 244: Where SideBySideTab is rendered */}
          <TabsContent value="sidebyside" className="space-y-6">
            <SideBySideTab 
              results={results} 
              selectedBank={bankDisplayInfo} 
              // No other props seem to be passed here
            />
          </TabsContent>
        </Tabs>
      </main>
      
      <Footer />
    </div>
  );
};

export default Dashboard;
```

# dataextract-ey-main\src\pages\Index.tsx

```tsx

import { useState } from 'react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { UploadedFile, PromptOption, ProcessingResult } from '@/lib/types';
import { Button } from '@/components/ui/button';
import FileUploader from '@/components/FileUploader';
import PromptSelector from '@/components/PromptSelector';
import ResultsViewer from '@/components/ResultsViewer';
import { useToast } from '@/hooks/use-toast';
import { Download, Upload, FileText, FileSpreadsheet } from 'lucide-react';
import { generateRealisticResults } from '@/lib/excelUtils';

const Index = () => {
  const [uploadedFiles, setUploadedFiles] = useState<UploadedFile[]>([]);
  const [selectedPrompts, setSelectedPrompts] = useState<PromptOption[]>([]);
  const [results, setResults] = useState<ProcessingResult[]>([]);
  const [isProcessing, setIsProcessing] = useState(false);
  const [processingStep, setProcessingStep] = useState('');
  const [processingProgress, setProcessingProgress] = useState(0);
  const [activeTab, setActiveTab] = useState('upload');
  const { toast } = useToast();

  // Handle uploaded files
  const handleFilesUploaded = (files: UploadedFile[]) => {
    setUploadedFiles(files);
  };

  // Handle prompt selection
  const handlePromptSelected = (prompts: PromptOption[]) => {
    setSelectedPrompts(prompts);
    if (prompts.length > 0) {
      toast({
        title: "Prompts Selected",
        description: `${prompts.length} extraction ${prompts.length === 1 ? 'prompt' : 'prompts'} selected`,
      });
    }
  };

  // Simulate the processing function
  const processFiles = async () => {
    if (uploadedFiles.length === 0) {
      toast({
        title: "No files to process",
        description: "Please upload at least one PDF file.",
        variant: "destructive",
      });
      return;
    }

    if (selectedPrompts.length === 0) {
      toast({
        title: "No prompts selected",
        description: "Please select at least one extraction prompt.",
        variant: "destructive",
      });
      return;
    }

    // Start processing
    setIsProcessing(true);
    setProcessingStep('Initializing extraction process...');
    setProcessingProgress(5);
    setActiveTab('results');

    const newResults: ProcessingResult[] = [];

    // Simulate processing for each file and prompt
    let completedItems = 0;
    const totalItems = uploadedFiles.length * selectedPrompts.length;

    for (const file of uploadedFiles) {
      // Simulate parsing the file
      setProcessingStep(`Parsing ${file.name}...`);
      await new Promise(resolve => setTimeout(resolve, 1000));
      setProcessingProgress(10 + (completedItems / totalItems) * 30);

      // For each prompt, create a result
      for (const prompt of selectedPrompts) {
        setProcessingStep(`Extracting ${prompt.name} from ${file.name}...`);
        
        // Simulate API request delay
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // Create a result with either success or random error
        const isSuccess = Math.random() > 0.05; // 95% success rate for demo
        
        const result: ProcessingResult = {
          id: `result-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
          fileId: file.id,
          fileName: file.name,
          promptId: prompt.id,
          promptName: prompt.name,
          status: isSuccess ? 'success' : 'error',
          timestamp: new Date().toISOString(),
          data: isSuccess ? generateRealisticResults(prompt.name) : undefined,
          notes: isSuccess 
            ? `Extraction completed successfully for ${prompt.name}.` 
            : undefined,
          error: isSuccess 
            ? undefined 
            : "Could not find relevant information in the document or the format was not recognized."
        };
        
        newResults.push(result);
        completedItems++;
        setProcessingProgress(10 + (completedItems / totalItems) * 80);
      }
    }

    // Final processing step
    setProcessingStep('Finalizing results...');
    await new Promise(resolve => setTimeout(resolve, 1000));
    setProcessingProgress(100);

    // Update results and finish processing
    setResults([...results, ...newResults]);
    setIsProcessing(false);
    
    toast({
      title: "Processing Complete",
      description: `Processed ${uploadedFiles.length} files with ${selectedPrompts.length} prompts`,
      variant: "default",
    });
  };

  // Simulate downloading results
  const handleDownloadResults = () => {
    toast({
      title: "Downloading Results",
      description: "Your results would download as an Excel file in a real implementation.",
    });
  };

  // Reset everything
  const handleReset = () => {
    setUploadedFiles([]);
    setSelectedPrompts([]);
    setResults([]);
    setActiveTab('upload');
    toast({
      title: "Reset Complete",
      description: "All files and prompts have been cleared.",
    });
  };

  // Navigate to the next tab
  const goToNextTab = () => {
    if (activeTab === 'upload') setActiveTab('prompts');
    else if (activeTab === 'prompts') {
      processFiles();
    }
  };

  // Go back to previous tab
  const goToPreviousTab = () => {
    if (activeTab === 'prompts') setActiveTab('upload');
    else if (activeTab === 'results') setActiveTab('prompts');
  };

  return (
    <div className="min-h-screen flex flex-col bg-white">
      {/* Tabs header */}
      <div className="border-b">
        <div className="container mx-auto px-4">
          <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
            <TabsList className="grid grid-cols-4 w-full max-w-2xl mx-auto my-4">
              <TabsTrigger 
                value="upload" 
                className={activeTab === 'upload' ? 'bg-yellow-400 text-black' : ''}
              >
                <Upload className="h-4 w-4 mr-2" />
                Upload
              </TabsTrigger>
              <TabsTrigger 
                value="prompts" 
                className={activeTab === 'prompts' ? 'bg-yellow-400 text-black' : ''}
              >
                <FileText className="h-4 w-4 mr-2" />
                Prompts
              </TabsTrigger>
              <TabsTrigger 
                value="results" 
                className={activeTab === 'results' ? 'bg-yellow-400 text-black' : ''}
              >
                <FileSpreadsheet className="h-4 w-4 mr-2" />
                Results
              </TabsTrigger>
              <TabsTrigger 
                value="combined" 
                className={activeTab === 'combined' ? 'bg-yellow-400 text-black' : ''}
              >
                <Download className="h-4 w-4 mr-2" />
                Combined
              </TabsTrigger>
            </TabsList>
          </Tabs>
        </div>
      </div>

      {/* Main Content */}
      <main className="flex-grow container mx-auto px-4 py-6">
        <Tabs value={activeTab}>
          {/* Upload Tab */}
          <TabsContent value="upload" className="space-y-6">
            <div className="grid grid-cols-1 gap-6">
              <FileUploader 
                onFilesUploaded={handleFilesUploaded}
                acceptedFileTypes={['.pdf']}
              />
              
              <div className="flex justify-end">
                <Button 
                  onClick={goToNextTab} 
                  disabled={uploadedFiles.length === 0}
                  className="bg-yellow-400 hover:bg-yellow-500 text-black"
                >
                  Next: Select Prompts
                </Button>
              </div>
            </div>
          </TabsContent>
          
          {/* Prompts Tab */}
          <TabsContent value="prompts" className="space-y-6">
            <PromptSelector 
              onPromptSelected={handlePromptSelected} 
              disabled={isProcessing}
            />
          </TabsContent>
          
          {/* Results Tab */}
          <TabsContent value="results" className="space-y-6">
            <ResultsViewer 
              results={results}
              onDownloadResults={handleDownloadResults}
              isProcessing={isProcessing}
              processingProgress={processingProgress}
              processingStep={processingStep}
            />
          </TabsContent>
          
          {/* Combined Tab */}
          <TabsContent value="combined" className="space-y-6">
            <div className="space-y-6">
              <div className="flex justify-between items-center">
                <div>
                  <h2 className="text-lg font-semibold mb-1">IFRS9 Combined Results</h2>
                  <p className="text-sm text-muted-foreground">
                    View and download the final processed IFRS9 data in Excel format
                  </p>
                </div>
                <Button 
                  variant="outline" 
                  size="sm" 
                  onClick={handleDownloadResults}
                  className="flex items-center gap-1 border-yellow-400 bg-white text-black hover:bg-yellow-50"
                >
                  <Download className="h-4 w-4" />
                  <span>Download Excel</span>
                </Button>
              </div>
              
              <div className="border rounded-lg overflow-hidden">
                <div className="flex justify-between items-center p-3 bg-muted border-b">
                  <Button 
                    variant="outline" 
                    size="sm" 
                    className="py-1 h-8 bg-yellow-400 hover:bg-yellow-500 border-none text-black"
                  >
                    Combined View
                  </Button>
                  <div className="text-sm text-muted-foreground">
                    28 rows
                  </div>
                </div>
                
                <div className="h-[500px] overflow-y-auto">
                  <table className="w-full text-sm">
                    <thead className="bg-muted/70 sticky top-0">
                      <tr>
                        <th className="p-3 text-left font-semibold text-black">Category</th>
                        <th className="p-3 text-left font-semibold text-black">Stage</th>
                        <th className="p-3 text-left font-semibold text-black">Field</th>
                        <th className="p-3 text-left font-semibold text-black">Value</th>
                        <th className="p-3 text-left font-semibold text-black">Source</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 1</td>
                        <td className="p-3">Gross Carrying Amount</td>
                        <td className="p-3">$1,029.66m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 1</td>
                        <td className="p-3">Loss Allowance</td>
                        <td className="p-3">$12.64m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 1</td>
                        <td className="p-3">Coverage Ratio</td>
                        <td className="p-3">0.94%</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 2</td>
                        <td className="p-3">Gross Carrying Amount</td>
                        <td className="p-3">$502.11m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 2</td>
                        <td className="p-3">Loss Allowance</td>
                        <td className="p-3">$20.71m</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                      <tr className="border-b">
                        <td className="p-3">ECL by Stage</td>
                        <td className="p-3">Stage 2</td>
                        <td className="p-3">Coverage Ratio</td>
                        <td className="p-3">6.35%</td>
                        <td className="p-3">FY24-Barclays-Results-RA.pdf - ECL by Stage</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </TabsContent>
        </Tabs>
      </main>
      
      {/* Footer */}
      <footer className="bg-gray-100 border-t mt-auto py-4">
        <div className="container mx-auto px-4">
          <div className="flex justify-between items-center text-sm text-muted-foreground">
            <div>IFRS9 Data Extraction Tool</div>
            <div>© {new Date().getFullYear()} Barclays Financial Services</div>
          </div>
        </div>
      </footer>
    </div>
  );
};

export default Index;

```

# dataextract-ey-main\src\pages\NotFound.tsx

```tsx
import { useLocation } from "react-router-dom";
import { useEffect } from "react";

const NotFound = () => {
  const location = useLocation();

  useEffect(() => {
    console.error(
      "404 Error: User attempted to access non-existent route:",
      location.pathname
    );
  }, [location.pathname]);

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100">
      <div className="text-center">
        <h1 className="text-4xl font-bold mb-4">404</h1>
        <p className="text-xl text-gray-600 mb-4">Oops! Page not found</p>
        <a href="/" className="text-blue-500 hover:text-blue-700 underline">
          Return to Home
        </a>
      </div>
    </div>
  );
};

export default NotFound;

```

# dataextract-ey-main\src\vite-env.d.ts

```ts
/// <reference types="vite/client" />

```

# dataextract-ey-main\tailwind.config.ts

```ts

import type { Config } from "tailwindcss";

export default {
	darkMode: ["class"],
	content: [
		"./pages/**/*.{ts,tsx}",
		"./components/**/*.{ts,tsx}",
		"./app/**/*.{ts,tsx}",
		"./src/**/*.{ts,tsx}",
	],
	prefix: "",
	theme: {
		container: {
			center: true,
			padding: '2rem',
			screens: {
				'2xl': '1400px'
			}
		},
		extend: {
			colors: {
				border: 'hsl(var(--border))',
				input: 'hsl(var(--input))',
				ring: 'hsl(var(--ring))',
				background: 'hsl(var(--background))',
				foreground: 'hsl(var(--foreground))',
				primary: {
					DEFAULT: 'hsl(var(--primary))',
					foreground: 'hsl(var(--primary-foreground))'
				},
				secondary: {
					DEFAULT: 'hsl(var(--secondary))',
					foreground: 'hsl(var(--secondary-foreground))'
				},
				destructive: {
					DEFAULT: 'hsl(var(--destructive))',
					foreground: 'hsl(var(--destructive-foreground))'
				},
				muted: {
					DEFAULT: 'hsl(var(--muted))',
					foreground: 'hsl(var(--muted-foreground))'
				},
				accent: {
					DEFAULT: 'hsl(var(--accent))',
					foreground: 'hsl(var(--accent-foreground))'
				},
				popover: {
					DEFAULT: 'hsl(var(--popover))',
					foreground: 'hsl(var(--popover-foreground))'
				},
				card: {
					DEFAULT: 'hsl(var(--card))',
					foreground: 'hsl(var(--card-foreground))'
				},
				sidebar: {
					DEFAULT: 'hsl(var(--sidebar-background))',
					foreground: 'hsl(var(--sidebar-foreground))',
					primary: 'hsl(var(--sidebar-primary))',
					'primary-foreground': 'hsl(var(--sidebar-primary-foreground))',
					accent: 'hsl(var(--sidebar-accent))',
					'accent-foreground': 'hsl(var(--sidebar-accent-foreground))',
					border: 'hsl(var(--sidebar-border))',
					ring: 'hsl(var(--sidebar-ring))'
				},
				ey: {
					black: '#000000',
					yellow: '#FFE600',
					white: '#FFFFFF',
					gray: {
						100: '#F6F6F7',
						200: '#F1F1F1', 
						300: '#EAEAEA',
						400: '#C8C8C9',
						500: '#9F9EA1',
						600: '#8A898C',
						700: '#555555',
						800: '#403E43',
						900: '#221F26'
					}
				}
			},
			borderRadius: {
				lg: 'var(--radius)',
				md: 'calc(var(--radius) - 2px)',
				sm: 'calc(var(--radius) - 4px)'
			},
			keyframes: {
				'accordion-down': {
					from: {
						height: '0'
					},
					to: {
						height: 'var(--radix-accordion-content-height)'
					}
				},
				'accordion-up': {
					from: {
						height: 'var(--radix-accordion-content-height)'
					},
					to: {
						height: '0'
					}
				},
				'pulse-gentle': {
					'0%, 100%': { opacity: '1' },
					'50%': { opacity: '0.7' }
				},
				'fade-in': {
					'0%': { opacity: '0' },
					'100%': { opacity: '1' }
				},
				'slide-up': {
					'0%': { transform: 'translateY(20px)', opacity: '0' },
					'100%': { transform: 'translateY(0)', opacity: '1' }
				},
				'float-1': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-5px)' }
				},
				'float-2': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-7px)' }
				},
				'float-3': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-4px)' }
				},
				'float-4': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-6px)' }
				},
				'float-5': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-3px)' }
				},
				'float-6': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-5px)' }
				},
				'float-7': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-4px)' }
				},
				'float-8': {
					'0%, 100%': { transform: 'translateY(0)' },
					'50%': { transform: 'translateY(-6px)' }
				},
				'page-transition-in': {
					'0%': { transform: 'translateX(20px)', opacity: '0' },
					'100%': { transform: 'translateX(0)', opacity: '1' }
				},
				'page-transition-out': {
					'0%': { transform: 'translateX(0)', opacity: '1' },
					'100%': { transform: 'translateX(-20px)', opacity: '0' }
				}
			},
			animation: {
				'accordion-down': 'accordion-down 0.2s ease-out',
				'accordion-up': 'accordion-up 0.2s ease-out',
				'pulse-gentle': 'pulse-gentle 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
				'fade-in': 'fade-in 0.6s ease-in-out',
				'slide-up': 'slide-up 0.6s ease-out',
				'float-1': 'float-1 3s ease-in-out infinite',
				'float-2': 'float-2 3.2s ease-in-out infinite 0.1s',
				'float-3': 'float-3 2.8s ease-in-out infinite 0.2s',
				'float-4': 'float-4 3.5s ease-in-out infinite 0.3s',
				'float-5': 'float-5 2.9s ease-in-out infinite 0.4s',
				'float-6': 'float-6 3.1s ease-in-out infinite 0.5s',
				'float-7': 'float-7 3.3s ease-in-out infinite 0.6s',
				'float-8': 'float-8 3.0s ease-in-out infinite 0.7s',
				'page-transition-in': 'page-transition-in 0.3s ease-out',
				'page-transition-out': 'page-transition-out 0.3s ease-out'
			}
		}
	},
	plugins: [require("tailwindcss-animate")],
} satisfies Config;

```

# dataextract-ey-main\tsconfig.app.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": false,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noImplicitAny": false,
    "noFallthroughCasesInSwitch": false,

    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"]
}

```

# dataextract-ey-main\tsconfig.json

```json
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ],
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    },
    "noImplicitAny": false,
    "noUnusedParameters": false,
    "skipLibCheck": true,
    "allowJs": true,
    "noUnusedLocals": false,
    "strictNullChecks": false
  }
}

```

# dataextract-ey-main\tsconfig.node.json

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["vite.config.ts"]
}

```

# dataextract-ey-main\vite.config.ts

```ts
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react-swc";
import path from "path";
import { componentTagger } from "lovable-tagger";

// https://vitejs.dev/config/
export default defineConfig(({ mode }) => ({
  server: {
    host: "::",
    port: 8080,
  },
  plugins: [
    react(),
    mode === 'development' &&
    componentTagger(),
  ].filter(Boolean),
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
}));

```

# DE_Optimzed.py

```py
#!/usr/bin/env python3
"""
IFRS9 Data Extraction API Server (Refactored for Clarity and Future Scalability)

This Flask API server processes IFRS9 PDFs, extracts data using a custom LLM and embedding system,
and returns results in JSON format for the frontend application.
"""

import os
import json
import re
import shutil
import time
import traceback
import tempfile
from datetime import datetime
from typing import List, Tuple, Optional, Dict, Any
from flask import Flask, request, jsonify, send_file
from flask_cors import CORS
from werkzeug.utils import secure_filename
import uuid
import logging  # For better logging
import threading  # For backend PID/ThreadID logging
from io import BytesIO

import requests
import pandas as pd
import openpyxl  # type: ignore
from dotenv import load_dotenv
import nest_asyncio

from langchain_community.vectorstores import Chroma  # Chroma not actively used by current /process flow but kept
from langchain.schema import Document as LangchainDocument  # Alias to avoid conflict
from chromadb.api.types import EmbeddingFunction  # type: ignore
from llama_index.readers.llama_parse import LlamaParse

# Apply nest_asyncio to allow nested event loops
nest_asyncio.apply()

# Initialize Flask app & Logging
app = Flask(__name__)
CORS(app)
logging.basicConfig(level=logging.INFO,
                    format='%(asctime)s - %(name)s - %(levelname)s - [%(threadName)s:%(thread)d] - %(message)s')
logger = logging.getLogger(__name__)

# =============================================================================
# Configuration and Global Constants
# =============================================================================
# Ensure ENV_PATH is correctly pointing to your .env file
ENV_PATH = os.path.join(os.path.dirname(__file__), "ATT27768.env")  # Or your actual .env filename
if not os.path.exists(ENV_PATH):
    logger.warning(f".env file not found at {ENV_PATH}. Relying on environment variables.")
load_dotenv(ENV_PATH)

LLAMA_PARSE_API_KEY = os.getenv("LLAMA_PARSE_API_KEY")
if not LLAMA_PARSE_API_KEY:
    logger.error("LLAMA_PARSE_API_KEY not found. PDF parsing will fail.")
    # Consider if this is critical enough to raise ValueError for your setup
    # raise ValueError("LLAMA_PARSE_API_KEY not found in .env file.")

EYQ_INCUBATOR_KEY = os.getenv("EYQ_INCUBATOR_KEY")
EYQ_BASE_URL = os.getenv("EYQ_BASE_URL", "https://eyq-incubator.europe.fabric.ey.com/eyq/eu/api")
EYQ_CHAT_MODEL_NAME = os.getenv("EYQ_CHAT_MODEL", "gpt-4o")
EYQ_EMBEDDING_MODEL_NAME = os.getenv("EYQ_EMBEDDING_MODEL", "text-embedding-3-large")
EYQ_API_VERSION = os.getenv("EYQ_API_VERSION", "2023-05-15")
AUTH_HEADER_NAME = "api-key"
USE_BEARER = os.getenv("USE_BEARER", "false").lower() == "true"

TEMP_DIR = tempfile.gettempdir()
UPLOAD_FOLDER = os.path.join(TEMP_DIR, 'ifrs9_api_uploads')
# OUTPUT_DIRECTORY not directly used by API routes for saving, but kept for consistency if needed elsewhere
OUTPUT_DIRECTORY = os.path.join(TEMP_DIR, 'ifrs9_api_outputs')

for directory in [UPLOAD_FOLDER, OUTPUT_DIRECTORY]:
    os.makedirs(directory, exist_ok=True)

PAGE_THRESHOLD: int = 150
CHAR_THRESHOLD: int = 1_000_000  # Max chars before chunking content for LLM
ALLOWED_EXTENSIONS: set = {'pdf'}

# In-memory store for processing status. For production, use Redis or a database.
processing_status: Dict[str, Dict[str, Any]] = {}
processing_status_lock = threading.Lock()  # To ensure thread-safe updates to processing_status


# =============================================================================
# Utility Functions
# =============================================================================
def allowed_file(filename: str) -> bool:
    """Check if the filename has an allowed extension."""
    return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS


def clean_ocr_text(text: str) -> str:
    """Clean common OCR errors from text. Replaces all newlines with spaces."""
    # IMPORTANT: Replace 'GARBLED_CHAR_X' with actual garbled characters from your OCR.
    replacements = {
        'GARBLED_CHAR_6': '6', 'GARBLED_CHAR_5': '5', 'GARBLED_CHAR_7': '7',
        'GARBLED_CHAR_4': '4', 'GARBLED_CHAR_3': '3', 'GARBLED_CHAR_0': '0',
        'GARBLED_CHAR_9': '9', 'GARBLED_CHAR_8': '8', 'GARBLED_CHAR_1': '1',
        'GARBLED_CHAR_2': '2', 'GARBLED_EMPTY': '', 'GARBLED_DOT': '.',
        'GARBLED_ZERO_ALT': '0',
        '|': ' ',
        # Specific replacements that seem plausible from original code
        ' S': ' 5', ' I': ' 1', ' O': ' 0', ' B': ' 8'
    }
    processed_text = text
    for garbled, replacement in replacements.items():
        # Only apply replacements that are not placeholders
        if not garbled.startswith('GARBLED_'):
            processed_text = processed_text.replace(garbled, replacement)

    # Replace all newline characters with spaces which is often better for LLM context windows
    return processed_text.replace('\n', ' ')


def standardize_json_structure_in_prompt(prompt_str: str) -> str:
    """Attempts to fix common JSON syntax issues within a prompt string."""
    # Using a more general regex to find a JSON-like block
    json_match = re.search(r'(\{[\s\S]*\})', prompt_str)
    if not json_match: return prompt_str
    try:
        json_template = json_match.group(1)  # group(1) because of the capturing group in regex
        # Basic cleaning steps
        fixed = json_template.replace('" ', '"').replace(' "', '"')
        fixed = fixed.replace(': ', ':').replace(' :', ':')
        # Attempt to fix missing commas between `}` and `{` or `"` and `{` more robustly
        fixed = re.sub(r'\}\s*(?=\{)', '},{', fixed)  # Comma between } and {
        fixed = re.sub(r'"\s*(?=\{)', '",{', fixed)  # Comma between " and {
        return prompt_str.replace(json_template, fixed)
    except Exception as e:
        logger.warning(f"Could not standardize JSON in prompt: {e}")
        return prompt_str


def split_text_into_chunks(content: str, max_chars: int, overlap: int = 200) -> List[str]:
    """Splits text into chunks with overlap, attempting to respect sentence boundaries."""
    if not content.strip(): return []  # Handle empty or whitespace-only content
    if len(content) <= max_chars: return [content.strip()]

    # Split by common sentence terminators followed by space, trying to keep delimiters with sentence
    sentences = re.split(r'(?<=[.!?])\s+', content.replace('\n', ' '))

    chunks = []
    current_chunk_text = ""
    for sentence in sentences:
        sentence = sentence.strip()
        if not sentence: continue

        if len(current_chunk_text) + len(sentence) + (1 if current_chunk_text else 0) <= max_chars:
            current_chunk_text += (" " if current_chunk_text else "") + sentence
        else:
            # Current chunk is full, or sentence is too long to add
            if current_chunk_text: chunks.append(current_chunk_text)

            # Handle sentence that is too long by itself
            if len(sentence) > max_chars:
                logger.warning(
                    f"A single sentence of length {len(sentence)} exceeds max_chars {max_chars}. Hard splitting.")
                for i in range(0, len(sentence), max_chars - overlap):
                    chunks.append(sentence[i: i + max_chars].strip())
                current_chunk_text = ""  # Reset
            else:
                current_chunk_text = sentence  # Start new chunk with this sentence

    if current_chunk_text: chunks.append(current_chunk_text)  # Add the last formed chunk

    return chunks if chunks else [content.strip()]  # Fallback if no chunks were made


def flatten_json_to_rows(json_data: Any, parent_category: str = "", parent_stage: str = "") -> List[Dict[str, str]]:
    # ... (Using the version from the previous full code response as it was more complete) ...
    rows: List[Dict[str, str]] = []
    if isinstance(json_data, str): return [
        {"Category": parent_category or "Error", "Stage": parent_stage or "N/A", "Field": "Response",
         "Value": json_data}]
    if not isinstance(json_data, dict): return [
        {"Category": parent_category or "Error", "Stage": parent_stage or "N/A", "Field": "Invalid JSON",
         "Value": str(json_data)}]
    if not json_data: return []

    is_likely_leaf_node_map = all(not isinstance(v, dict) for v in json_data.values())

    for key, value in json_data.items():
        key_str = str(key)
        if isinstance(value, dict):
            # Determine if current key is a category or stage based on context and structure
            if not parent_category:  # Top level, key is category
                rows.extend(flatten_json_to_rows(value, parent_category=key_str, parent_stage=""))
            elif not parent_stage:  # One level down, key is stage
                rows.extend(flatten_json_to_rows(value, parent_category=parent_category, parent_stage=key_str))
            else:  # Two levels down, key is field (assuming Category -> Stage -> Field:Value)
                # This case might occur if a "Field" itself has a dict value, which should be flattened as sub-fields or noted.
                # For now, treating it as a complex value.
                logger.warning(
                    f"Unexpected dict found for Field '{key_str}' under Category '{parent_category}', Stage '{parent_stage}'. Stringifying.")
                rows.append({"Category": parent_category, "Stage": parent_stage, "Field": key_str, "Value": str(value)})
        else:
            # Assign to Category/Stage/Field based on current recursion depth
            cat = parent_category if parent_category else "Summary"
            stg = parent_stage if parent_stage else (
                "N/A" if parent_category else key_str)  # If no parent_cat, key is field under Summary
            fld = key_str if parent_category and parent_stage else (
                "N/A" if is_likely_leaf_node_map and not parent_category else key_str)

            if not parent_category and not parent_stage:  # Flat JSON {"key": "value"}
                cat = "Main"
                stg = "N/A"
                fld = key_str
            elif parent_category and not parent_stage:  # Category -> Field:Value
                stg = "N/A"
                fld = key_str
            # else: Category -> Stage -> Field:Value is handled when value is a dict

            rows.append({"Category": cat, "Stage": stg, "Field": fld, "Value": str(value)})
    return rows


def merge_json_responses(responses: List[Optional[Dict[Any, Any]]]) -> Dict[Any, Any]:
    # ... (Using the version from the previous full code response with deep_update_with_na_preference) ...
    valid_responses = [r for r in responses if isinstance(r, dict)]
    if not valid_responses: return {}
    if len(valid_responses) == 1: return valid_responses[0]

    merged: Dict[Any, Any] = {}

    def deep_update_with_na_preference(target: Dict, source: Dict):
        for key, value in source.items():
            str_key = str(key)  # Ensure key is string for merged dict
            if isinstance(value, dict) and str_key in target and isinstance(target[str_key], dict):
                deep_update_with_na_preference(target[str_key], value)
            elif str_key not in target or \
                    (target.get(str_key) is None or str(target.get(str_key)).strip().upper() == "N/A") and \
                    (value is not None and str(value).strip().upper() != "N/A"):
                target[str_key] = value
            # If target has a non-N/A value, and new value is also non-N/A, decide on overwrite strategy.
            # Current logic: if new value is not "N/A", it overwrites. This might need refinement.
            # For example, only overwrite if existing_val is "N/A" (already handled by elif above)
            # or if you want to prioritize later responses:
            elif value is not None and str(value).strip().upper() != "N/A":
                target[str_key] = value
            # If new value is "N/A", don't overwrite an existing concrete value
            elif value is None or str(value).strip().upper() == "N/A":
                if str_key not in target:  # If key doesn't exist, add N/A
                    target[str_key] = value
                    # else: do nothing, keep existing concrete value

    for response in valid_responses:
        deep_update_with_na_preference(merged, response)
    return merged


def all_values_na(json_data: Optional[Dict[Any, Any]]) -> bool:
    if not isinstance(json_data, dict) or not json_data: return True

    for value in json_data.values():
        if isinstance(value, dict):
            if not all_values_na(value): return False
        elif value is not None and str(value).strip().upper() != "N/A":  # Check for None explicitly
            return False
    return True


def enhance_ecl_prompt(original_prompt: str) -> str:
    if not original_prompt or not any(
            term in original_prompt.lower() for term in ["ecl", "stage", "impairment", "credit risk"]):
        return original_prompt
    return f"""
I need to extract credit risk stage data from this financial report. Focus specifically on:
1. Tables showing loan quality or credit risk metrics
2. Sections with ECL (Expected Credit Loss) data
3. Information broken down by Stage 1, Stage 2, and Stage 3
4. Values for: ECL/provisions, gross exposures/balances, and coverage ratios
For clarity: Stage 1 is performing, Stage 2 is significantly increased risk, Stage 3 is credit-impaired.
First, scan the document for sections containing phrases like "credit quality", "loan impairment", "ECL", "credit risk" or tables with "Stage 1/2/3" headers.
{original_prompt}
IMPORTANT EXTRACTION TIPS:
- Values should be in millions (£m or $m)
- Coverage ratios are typically percentages (%)
- Look for the most recent reporting period data
- If a value is not found, use "N/A" rather than making an estimate
"""


# =============================================================================
# Core Processing Classes
# =============================================================================
class EYQEmbeddings(EmbeddingFunction):  # type: ignore
    def __init__(self, model_name: str, api_key: str, api_base_url: str, api_version: str,
                 auth_header: str = AUTH_HEADER_NAME, use_bearer_token: bool = USE_BEARER):
        self.model_name, self.api_key, self.api_base_url, self.api_version = model_name, api_key, api_base_url, api_version
        self.auth_header, self.use_bearer_token = auth_header, use_bearer_token
        self.http_session = requests.Session()
        self.request_headers = {"Content-Type": "application/json",
                                self.auth_header: f"Bearer {self.api_key}" if self.use_bearer_token else self.api_key}
        self.api_endpoint = f"{self.api_base_url}/openai/deployments/{self.model_name}/embeddings?api-version={self.api_version}"

    def __call__(self, texts_to_embed: List[str]) -> List[List[float]]:
        all_embeddings: List[List[float]] = []
        for text_content in texts_to_embed:
            payload = {"input": text_content}
            try:
                response = self.http_session.post(self.api_endpoint, headers=self.request_headers, json=payload,
                                                  timeout=60)
                response.raise_for_status()
                response_data = response.json()
                all_embeddings.append(response_data["data"][0]["embedding"])
            except requests.exceptions.RequestException as req_err:
                logger.error(
                    f"Embedding API request error: {req_err} - Response: {getattr(req_err.response, 'text', 'No response text')}")
                raise
            except (KeyError, IndexError, TypeError) as parse_err:
                logger.error(
                    f"Error parsing embedding API response: {parse_err} - Data: {response_data if 'response_data' in locals() else 'N/A'}")
                raise
        return all_embeddings

    def embed_documents(self, texts: List[str]) -> List[List[float]]:
        return self.__call__(texts)

    def embed_query(self, text: str) -> List[float]:
        return self.__call__([text])[0]


class EYQChat:
    def __init__(self, deployment: str, key: str, base_url: str, version: str, temp: float = 0.0,
                 verb: bool = True):  # Set default temp to 0.0 for consistency
        self.deployment, self.key, self.base_url, self.version = deployment, key, base_url, version
        self.temp, self.verb = temp, verb
        self.http_session = requests.Session()
        self.request_headers = {AUTH_HEADER_NAME: self.key, "Content-Type": "application/json"}
        self.api_endpoint = f"{self.base_url}/openai/deployments/{self.deployment}/chat/completions?api-version={self.version}"

    def __call__(self, chat_messages: List[Dict[str, str]], max_retries: int = 3, base_delay: int = 5,
                 **api_params: Any) -> str:
        req_timeout = api_params.pop('timeout', 300)  # Increased default client-side timeout

        payload: Dict[str, Any] = {"messages": chat_messages, "temperature": self.temp}
        valid_api_params = ['max_tokens', 'top_p', 'stop', 'presence_penalty', 'frequency_penalty', 'model',
                            'stream']  # Common params
        for param_key in valid_api_params:
            if param_key in api_params:
                payload[param_key] = api_params.pop(param_key)
        if api_params: logger.warning(f"Unused API parameters passed to EYQChat: {api_params}")

        if self.verb: logger.info(f"EYQChat Request to {self.api_endpoint}:\nPayload: {json.dumps(payload, indent=2)}")

        for attempt in range(max_retries):
            try:
                response = self.http_session.post(self.api_endpoint, headers=self.request_headers, json=payload,
                                                  timeout=req_timeout)
                response.raise_for_status()
                response_data = response.json()
                content = response_data.get("choices", [{}])[0].get("message", {}).get("content")
                if content is None: raise ValueError("LLM response content is missing or structure is invalid.")
                return content
            except requests.exceptions.Timeout:
                logger.warning(f"EYQChat Timeout (Attempt {attempt + 1}/{max_retries}), waited {req_timeout}s.")
                if attempt >= max_retries - 1: logger.error("Max timeout retries reached for EYQChat."); raise
            except requests.exceptions.RequestException as req_err:
                status_code = getattr(req_err.response, 'status_code', 'N/A')
                response_text = getattr(req_err.response, 'text', 'N/A')
                logger.error(
                    f"EYQChat API Error (Attempt {attempt + 1}/{max_retries}): {req_err} - Status: {status_code}, Text: {response_text[:500]}...")  # Limit response text logging
                if status_code == 429:  # Rate limit
                    logger.warning("Rate limit hit. Increasing delay.")
                    time.sleep(base_delay * (2 ** (attempt + 1)) * 5)  # Longer sleep for rate limit
                    continue  # Continue to next attempt without re-raising immediately
                if attempt >= max_retries - 1: logger.error("Max API error retries reached for EYQChat."); raise
            except (KeyError, IndexError, ValueError, json.JSONDecodeError) as parse_err:
                logger.error(
                    f"EYQChat Response Parse Error (Attempt {attempt + 1}/{max_retries}): {parse_err} - Text: {getattr(response, 'text', 'N/A') if 'response' in locals() else 'No response object'}")
                if attempt >= max_retries - 1: logger.error("Max parsing error retries reached for EYQChat."); raise

            if attempt < max_retries - 1: time.sleep(base_delay * (2 ** attempt))  # Exponential backoff

        # This line should ideally not be reached if exceptions are re-raised properly
        return "Error: LLM call failed after multiple retries and did not return valid content."


class IFRS9Processor:
    def __init__(self, embedding_model_name: str, chat_model_name: str,
                 eyq_key: str, eyq_base_url: str, eyq_api_version: str):
        self.eyq_chat_llm = EYQChat(chat_model_name, eyq_key, eyq_base_url, eyq_api_version, temp=0.0, verbose=True)
        # self.embedding_provider = EYQEmbeddings(embedding_model_name, eyq_key, eyq_base_url, eyq_api_version)
        try:
            self.parser = LlamaParse(api_key=str(LLAMA_PARSE_API_KEY), result_type="markdown", verbose=True,
                                     gpt_4o_mode=True)
        except Exception as e:
            logger.error(f"Failed to initialize LlamaParse: {e}. PDF parsing will not work.")
            self.parser = None  # Set to None if initialization fails
        logger.info("IFRS9Processor initialized.")

    def load_document_content(self, file_path: str, company_name: str, debug: bool = False) -> List[LangchainDocument]:
        if not self.parser:
            logger.error("LlamaParse is not initialized. Cannot load document.")
            return []
        if not (os.path.exists(file_path) and os.access(file_path, os.R_OK)):
            logger.error(f"File {file_path} is missing or not readable.")
            return []

        logger.info(f"Starting LlamaParse for {file_path}...")
        try:
            # LlamaParse load_data can take time. This is a major I/O and potential processing bottleneck.
            llama_parsed_docs = self.parser.load_data(file_path)
        except Exception as e:
            logger.error(f"LlamaParse failed for {file_path}: {e}", exc_info=debug)
            return []

        if not llama_parsed_docs:
            logger.warning(f"LlamaParse returned no documents for {file_path}.")
            return []

        langchain_docs = [
            LangchainDocument(page_content=ldoc.text, metadata={
                "source": os.path.basename(file_path), "page": i, "name": company_name
            }) for i, ldoc in enumerate(llama_parsed_docs)
        ]
        if debug: logger.info(f"LlamaParse loaded {len(langchain_docs)} pages from {file_path}.")
        return langchain_docs

    def _extract_json_from_llm_response(self, llm_response: str, part_id: str) -> Tuple[Optional[Dict[Any, Any]], str]:
        # ... (This function can remain as provided in the previous "Optimized" response)
        json_str: Optional[str] = None;
        notes = "No specific notes from LLM."
        match_markdown = re.search(r'\`\`\`json\s*(\{[\s\S]*?\})\s*\`\`\`', llm_response, re.DOTALL)
        if match_markdown:
            json_str = match_markdown.group(1).strip()
            potential_notes_section = llm_response[match_markdown.end():].strip()
            if potential_notes_section: notes = potential_notes_section
        else:
            match_braces = re.search(r'(\{[\s\S]*\})', llm_response)
            if match_braces:
                json_str = match_braces.group(1).strip()
                potential_notes_section = llm_response[match_braces.end():].strip()
                if potential_notes_section: notes = potential_notes_section
            else:
                notes = f"LLM response for {part_id} did not contain a recognizable JSON structure. Response snippet: {llm_response[:200]}"
                logger.warning(notes);
                return None, notes
        try:
            json_str_cleaned = json_str.replace('\\n', '\n').replace('\\"', '"')
            parsed_json = json.loads(json_str_cleaned)
            if not isinstance(parsed_json, dict): raise ValueError(
                f"Parsed content for {part_id} is not a dictionary (type: {type(parsed_json)}).")
            return parsed_json, notes
        except json.JSONDecodeError as e:
            error_note = f"JSON parsing error for {part_id}: {e}. Attempted to parse: '{json_str[:100]}...'"
            logger.error(error_note);
            return None, f"{notes}\n{error_note}"

    def _call_llm_for_extraction(self, content_to_process: str, prompt_template: str) -> str:
        # ... (This function can remain as provided in the previous "Optimized" response)
        standardized_prompt = standardize_json_structure_in_prompt(prompt_template)
        full_llm_prompt = (
            f"{standardized_prompt}\n\n"
            f"Document Content Extract:\n{content_to_process}\n\n"
            "Instruction: Based on the prompt and content, provide the extracted information ONLY as a JSON string. "
            "If specific information is not found, use 'N/A' as the value for that field within the JSON structure."
        )
        return self.eyq_chat_llm([{"role": "user", "content": full_llm_prompt}], timeout=300)

    def _process_text_chunk_with_llm(self, text_chunk: str, company: str, prompt_str: str,
                                     part_id: str, debug: bool = False) -> Tuple[
        Optional[Dict[Any, Any]], str, List[Dict[str, str]]]:
        # ... (This function can remain as provided in the previous "Optimized" response)
        if debug: logger.info(f"LLM processing for {part_id} (Company: {company}), text length: {len(text_chunk)}")
        try:
            llm_raw_response = self._call_llm_for_extraction(text_chunk, prompt_str)
            if debug: logger.debug(f"LLM Raw Response ({part_id}): {llm_raw_response[:500]}...")
            extracted_json, notes = self._extract_json_from_llm_response(llm_raw_response, part_id)
            if extracted_json: return extracted_json, notes, flatten_json_to_rows(extracted_json)
            return None, notes, [{"Category": "Error", "Field": "Extraction",
                                  "Value": f"No JSON extracted for {part_id}. Notes: {notes}"}]
        except Exception as e:
            error_note = f"Error in LLM call for {part_id}: {e}"
            logger.error(error_note, exc_info=debug)
            return None, error_note, [{"Category": "Error", "Field": "LLM Call", "Value": error_note}]

    def _process_document_parts(self, doc_parts: List[List[LangchainDocument]], company: str,
                                prompt_template: str, prompt_name: str, session_id: str, debug: bool) -> Tuple[
        Optional[Dict[Any, Any]], str, List[Dict[str, str]]]:
        # ... (This function can remain as provided in the previous "Optimized" response, ensuring it updates processing_status) ...
        all_part_jsons, all_part_notes, aggregated_flat_data = [], [], []
        total_parts = len(doc_parts)
        for i, part_docs in enumerate(doc_parts):
            part_id_str = f"Part {i + 1}/{total_parts}"  # Renamed part_id to part_id_str to avoid conflict
            logger.info(f"Processing {part_id_str} for {company} - Prompt: {prompt_name} ({len(part_docs)} pages)")
            with processing_status_lock:  # Thread-safe update
                if session_id in processing_status:
                    processing_status[session_id]['step'] = f'Processing {part_id_str} of prompt {prompt_name}'
            content_for_part = clean_ocr_text("\n\n".join([doc.page_content for doc in part_docs]))
            # ... (rest of the logic for sub-chunking if needed, and calling _process_text_chunk_with_llm) ...
            # This simplified version assumes _process_text_chunk_with_llm handles content > CHAR_THRESHOLD if not pre-chunked
            json_r, notes_r, flat_r = self._process_text_chunk_with_llm(content_for_part, company, prompt_template,
                                                                        part_id_str, debug)
            if json_r: all_part_jsons.append(json_r)
            all_part_notes.append(f"-- {part_id_str} --\n{notes_r if notes_r else 'No specific notes.'}")
            if flat_r: aggregated_flat_data.extend(d for d in flat_r if isinstance(d, dict))

        final_json_response: Optional[Dict[Any, Any]] = None;
        final_notes = "\n\n".join(all_part_notes)
        if all_part_jsons:
            final_json_response = merge_json_responses(all_part_jsons)
            final_flattened_data = flatten_json_to_rows(
                final_json_response) if final_json_response else aggregated_flat_data
            logger.info(f"Merged {len(all_part_jsons)} JSONs for {prompt_name} of {company}.")
        else:
            logger.warning(f"No valid JSONs from any part for {prompt_name} of {company}.")
            final_flattened_data = aggregated_flat_data
        return final_json_response, final_notes, final_flattened_data

    def process_single_file_with_prompt(self, file_path: str, company_name: str,
                                        prompt_template: str, prompt_name: str,
                                        session_id: str, debug: bool = False) -> Dict[str, Any]:
        # ... (This function can remain largely as provided in the previous "Optimized" response,
        # ensure it calls the helper methods correctly and updates processing_status) ...
        try:
            with processing_status_lock:
                if session_id in processing_status:
                    processing_status[session_id].update(
                        {'current_file': os.path.basename(file_path), 'current_prompt': prompt_name,
                         'step': f'Loading: {os.path.basename(file_path)} for {prompt_name}'})

            docs = self.load_document_content(file_path, company_name, debug=debug)
            if not docs: return {"status": "error", "error": "Doc load failed (LlamaParse)", "data": [],
                                 "notes": "PDF parsing no content."}

            num_pages = len(docs)
            logger.info(f"Pages for {company_name}: {num_pages}. Prompt: {prompt_name}")
            current_pt = enhance_ecl_prompt(prompt_template) if any(
                k in prompt_name.lower() for k in ["ecl", "stage"]) else prompt_template

            final_json: Optional[Dict[Any, Any]] = None;
            final_notes = "";
            final_flat_data: List[Dict[str, str]] = []

            if num_pages >= PAGE_THRESHOLD:
                logger.info(f"'{company_name}' >= {PAGE_THRESHOLD} pages, chunking.")
                use_ecl_chunking = any(k in prompt_name.lower() for k in ["ecl", "stage", "credit"]) or (
                            "credit" in str(current_pt).lower())
                doc_parts = self.find_relevant_sections(docs) if use_ecl_chunking else \
                    [docs[i:i + max(1, num_pages // 3)] for i in
                     range(0, num_pages, max(1, num_pages // 3))]  # Generic chunking
                if not doc_parts or not any(doc_parts): doc_parts = [docs]; logger.warning(
                    "Chunking no parts, using whole doc.")
                logger.info(f"Split into {len(doc_parts)} parts.")
                final_json, final_notes, final_flat_data = self._process_document_parts(doc_parts, company_name,
                                                                                        current_pt, prompt_name,
                                                                                        session_id, debug)
            else:
                logger.info(f"'{company_name}' < {PAGE_THRESHOLD} pages, single pass.")
                with processing_status_lock:
                    if session_id in processing_status: processing_status[session_id][
                        'step'] = f'Full Content for {prompt_name}'
                full_txt = clean_ocr_text("\n\n".join([d.page_content for d in docs]))
                final_json, final_notes, final_flat_data = self._process_text_chunk_with_llm(full_txt, company_name,
                                                                                             current_pt,
                                                                                             "Full Document", debug)

            if final_json and not all_values_na(final_json):
                return {"status": "success", "data": final_flat_data, "notes": final_notes}
            elif final_json:
                return {"status": "error", "error": "All values N/A.", "data": final_flat_data,
                        "notes": f"{final_notes}\nAll values N/A."}
            else:
                return {"status": "error", "error": "No valid JSON extracted.", "data": final_flat_data or [],
                        "notes": final_notes}
        except Exception as e:
            logger.critical(f"Failure in process_single_file_with_prompt for {company_name} ({prompt_name}): {e}",
                            exc_info=True)
            return {"status": "error", "error": str(e), "data": [],
                    "notes": f"Critical Error: {e}\n{traceback.format_exc()}"}


# =============================================================================
# Flask API Routes
# =============================================================================
@app.route('/api/health', methods=['GET'])
def health_check() -> Any: return jsonify(
    {"status": "healthy", "service": "IFRS9 API", "version": "1.2.0"})  # Version Bump


@app.route('/api/upload', methods=['POST'])
def upload_files_route() -> Any:
    # ... (This route can remain as is, it's fairly optimal for its purpose) ...
    # Using the version from your last full backend code is fine here.
    try:
        if 'files' not in request.files: return jsonify({"error": "No files part in request"}), 400
        received_files = request.files.getlist('files')
        if not received_files: return jsonify({"error": "No files received"}), 400
        uploaded_metadata_list = []
        for fs in received_files:
            if fs and fs.filename and allowed_file(fs.filename):
                filename = secure_filename(fs.filename);
                unique_fn = f"{uuid.uuid4()}_{filename}"
                filepath = os.path.join(UPLOAD_FOLDER, unique_fn);
                fs.save(filepath);
                stats = os.stat(filepath)
                uploaded_metadata_list.append({"id": unique_fn, "name": filename, "size": stats.st_size,
                                               "type": fs.mimetype or "application/octet-stream",
                                               "lastModified": int(stats.st_mtime * 1000), "status": "success",
                                               "progress": 100})
            else:
                logger.warning(f"File not allowed or no filename: {getattr(fs, 'filename', 'N/A')}")
        if not uploaded_metadata_list: return jsonify({"error": "No valid files were processed."}), 400
        return jsonify({"status": "success", "files": uploaded_metadata_list})
    except Exception as e:
        logger.error(f"Upload error: {e}", exc_info=True); return jsonify(
            {"error": str(e), "trace": traceback.format_exc()}), 500


@app.route('/api/process', methods=['POST'])
def process_files_api_route() -> Any:
    default_session_id = f"api_session_{uuid.uuid4().hex[:6]}"  # Shorter default SID
    session_id = default_session_id
    pid = os.getpid();
    tid = threading.get_ident()

    try:
        data_req = request.json
        if not data_req: logger.error(
            f"/api/process - ERROR: Missing JSON request body (PID:{pid},TID:{tid})"); return jsonify(
            {"error": "Missing JSON request body"}), 400

        session_id = data_req.get('sessionId', default_session_id)
        logger.info(f"/api/process ENTRY - Session: {session_id}, PID: {pid}, ThreadID: {tid}")

        files_to_process = data_req.get('files', [])
        prompts_to_use = data_req.get('prompts', [])

        if not (files_to_process and prompts_to_use):
            logger.error(
                f"Files and prompts required. Files: {len(files_to_process)}, Prompts: {len(prompts_to_use)} (Session: {session_id})")
            return jsonify({"error": "Files and prompts are required in the request"}), 400

        total_tasks = len(files_to_process) * len(prompts_to_use)
        with processing_status_lock:
            processing_status[session_id] = {
                "status": "processing", "progress": 0, "step": f"Initializing {total_tasks} tasks...",
                "total_items": total_tasks, "completed_items": 0, "results": []}
        logger.info(f"Initialized processing_status for session: {session_id} with {total_tasks} total tasks.")

        processor_instance = IFRS9Processor(
            embedding_model_name=str(EYQ_EMBEDDING_MODEL_NAME),
            chat_model_name=str(EYQ_CHAT_MODEL_NAME),
            eyq_key=str(EYQ_INCUBATOR_KEY),
            eyq_base_url=str(EYQ_BASE_URL),
            eyq_api_version=str(EYQ_API_VERSION)
        )

        all_request_results, tasks_done_count = [], 0

        for file_info in files_to_process:
            file_id = file_info.get('id')
            original_file_name = file_info.get('name', 'UnknownFile.pdf')

            if not file_id:  # Handle missing file_id robustly
                logger.warning(f"File info missing 'id': {file_info} (Session: {session_id})")
                tasks_to_skip = len(prompts_to_use)
                with processing_status_lock:
                    processing_status[session_id]['completed_items'] += tasks_to_skip
                    tasks_done_count += tasks_to_skip
                    if total_tasks > 0: processing_status[session_id]['progress'] = int(
                        (tasks_done_count / total_tasks) * 100)
                for p_info_skip in prompts_to_use:  # Add error result for each prompt for this file
                    err_res = {"id": f"res-err-skip-{uuid.uuid4()}", "fileId": "N/A", "fileName": original_file_name,
                               "promptId": p_info_skip.get('id', 'N/A'), "promptName": p_info_skip.get('name', 'N/A'),
                               "status": "error", "timestamp": datetime.now().isoformat(),
                               "error": "File ID missing in request.", "data": []}
                    all_request_results.append(err_res);
                    processing_status[session_id]['results'].append(err_res)
                continue

            file_path = os.path.join(UPLOAD_FOLDER, file_id)
            if not os.path.exists(file_path):  # Handle file not found on server
                logger.error(f"File path {file_path} does not exist for ID {file_id} (Session: {session_id})")
                tasks_to_skip = len(prompts_to_use)
                with processing_status_lock:
                    processing_status[session_id]['completed_items'] += tasks_to_skip
                    tasks_done_count += tasks_to_skip
                    if total_tasks > 0: processing_status[session_id]['progress'] = int(
                        (tasks_done_count / total_tasks) * 100)
                for p_info_skip in prompts_to_use:
                    err_res = {"id": f"res-err-nofile-{uuid.uuid4()}", "fileId": file_id,
                               "fileName": original_file_name, "promptId": p_info_skip.get('id', 'N/A'),
                               "promptName": p_info_skip.get('name', 'N/A'), "status": "error",
                               "timestamp": datetime.now().isoformat(),
                               "error": f"File {original_file_name} (id:{file_id}) not found on server.", "data": []}
                    all_request_results.append(err_res);
                    processing_status[session_id]['results'].append(err_res)
                continue

            for prompt_info in prompts_to_use:
                tasks_done_count += 1
                step_message = f"Task {tasks_done_count}/{total_tasks}: '{prompt_info['name']}' for '{original_file_name}'"
                logger.info(f"{step_message} (Session: {session_id})")
                with processing_status_lock:  # Thread-safe update
                    if session_id in processing_status:  # Check if session still exists (might be cleaned up)
                        processing_status[session_id].update({
                            'step': step_message,
                            'progress': int((tasks_done_count / total_tasks) * 100) if total_tasks > 0 else 0,
                            'completed_items': tasks_done_count
                        })

                result_data = processor_instance.process_single_file_with_prompt(
                    file_path, original_file_name.replace('.pdf', ''),
                    prompt_info.get('template', prompt_info['name']),
                    prompt_info['name'], session_id, debug=True
                )

                single_task_result = {
                    "id": f"res-task-{uuid.uuid4()}", "fileId": file_id, "fileName": original_file_name,
                    "promptId": prompt_info.get('id', 'N/A'), "promptName": prompt_info['name'],
                    "status": result_data['status'], "timestamp": datetime.now().isoformat(),
                    "data": result_data.get('data', []), "notes": result_data.get('notes', ''),
                    "error": result_data.get('error')
                }
                all_request_results.append(single_task_result)
                with processing_status_lock:
                    if session_id in processing_status:
                        processing_status[session_id]['results'].append(single_task_result)
                logger.info(f"Finished Task: {step_message} - Status: {result_data['status']} (Session: {session_id})")

        with processing_status_lock:
            if session_id in processing_status:
                processing_status[session_id].update(
                    {"status": 'complete', "progress": 100, "step": 'All tasks processed.'})
        logger.info(f"/api/process for session {session_id} COMPLETED all tasks.")
        return jsonify({"status": "success", "sessionId": session_id, "results": all_request_results})

    except Exception as e:
        err_trace = traceback.format_exc()
        logger.critical(f"CRITICAL EXCEPTION in /api/process setup for session {session_id}: {e}\n{err_trace}")
        with processing_status_lock:
            if session_id in processing_status:
                processing_status[session_id].update(
                    {"status": 'error', "step": f'Critical Server Error: {e}', "progress": 100,
                     "error_trace": err_trace})
        return jsonify(
            {"error": str(e), "trace": err_trace, "sessionId": session_id, "status": "error", "results": []}), 500


@app.route('/api/status/<session_id>', methods=['GET'])
def get_processing_status(session_id: str) -> Any:
    # ... (Using the version from your last full backend code is fine here, ensure thread lock for access) ...
    pid = os.getpid();
    tid = threading.get_ident()
    logger.info(f"/api/status called for session_id: {session_id} (PID: {pid}, Thread: {tid})")
    with processing_status_lock:  # Thread-safe read
        status_data = processing_status.get(session_id)
        logger.debug(f"Current processing_status keys: {list(processing_status.keys())}")

    if not status_data:
        logger.warning(f"Session {session_id} NOT FOUND in processing_status.")
        return jsonify({"error": "Session not found", "status": "error", "progress": 0,
                        "step": "Session ID invalid or expired."}), 404
    logger.info(
        f"Session {session_id} found. Status: {status_data.get('status')}, Progress: {status_data.get('progress')}%")
    return jsonify(status_data)


@app.route('/api/download/<session_id>', methods=['GET'])
def download_results(session_id: str) -> Any:
    # ... (Using the version from your last full backend code is fine here, ensure thread lock for access) ...
    try:
        with processing_status_lock:  # Thread-safe read
            s_data = processing_status.get(session_id)
        # ... (rest of the download logic from the previous response) ...
        if not (s_data and 'results' in s_data):
            logger.warning(f"Download attempt for non-existent or empty session results: {session_id}")
            return jsonify({"error": "Session or results data not found for download"}), 404

        results_list = s_data.get('results', [])
        out_buf = BytesIO()
        # ... (Excel writing logic from previous response) ...
        with pd.ExcelWriter(out_buf, engine='openpyxl') as writer:
            summary_data = [{"File": r.get('fileName', 'N/A'), "Prompt": r.get('promptName', 'N/A'),
                             "Status": r.get('status', 'N/A'), "Timestamp": r.get('timestamp', 'N/A'),
                             "Error": r.get('error', '')} for r in results_list]
            pd.DataFrame(summary_data if summary_data else [{"Message": "No summary data"}]).to_excel(writer,
                                                                                                      sheet_name="Summary",
                                                                                                      index=False)
            combined_data = []
            for r_val in results_list:
                if r_val.get('status') == 'success' and r_val.get('data'):
                    for item_raw in r_val['data']:
                        if isinstance(item_raw, dict):
                            combined_data.append(
                                {"Category": item_raw.get('Category', 'N/A'), "Stage": item_raw.get('Stage', 'N/A'),
                                 "Field": item_raw.get('Field', 'N/A'), "Value": item_raw.get('Value', 'N/A'),
                                 "SourceFile": r_val.get('fileName', 'N/A'),
                                 "SourcePrompt": r_val.get('promptName', 'N/A')})
                        else:
                            logger.warning(f"Non-dict item in data for download: {item_raw}")
            if combined_data:
                pd.DataFrame(combined_data).to_excel(writer, sheet_name="Combined Results", index=False)
            else:
                pd.DataFrame([{"Message": "No successful data"}]).to_excel(writer, sheet_name="Combined Results",
                                                                           index=False)
        out_buf.seek(0);
        ts = datetime.now().strftime('%Y%m%d_%H%M%S');
        fn = f"IFRS9_Results_{session_id}_{ts}.xlsx"
        logger.info(f"Sending Excel: {fn} for session {session_id}")
        return send_file(out_buf, mimetype='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                         as_attachment=True, download_name=fn)

    except Exception as e:
        logger.error(f"Download error for session {session_id}: {e}", exc_info=True)
        return jsonify({"error": str(e), "trace": traceback.format_exc()}), 500


@app.route('/api/prompts/default/<bank_name>', methods=['GET'])
def get_default_prompts(bank_name: str) -> Any:
    # ... (Using the version from your last full backend code with 'bankName' added is fine) ...
    csv_p = os.path.join(os.path.dirname(__file__), "EY_FinSight_Prompts3.csv")
    prompts_l: List[Dict[str, str]] = [];
    df_csv = None
    try:
        try:
            df_csv = pd.read_csv(csv_p, encoding='utf-8')
        except UnicodeDecodeError:
            logger.warning(f"UTF-8 failed for {csv_p}. Trying 'latin1'."); df_csv = pd.read_csv(csv_p,
                                                                                                encoding='latin1')
        if df_csv is None: raise FileNotFoundError("Could not read CSV.")
        bank_spec_prompts = df_csv[df_csv['Bank'].astype(str).str.lower() == bank_name.lower()]
        for _, row in bank_spec_prompts.iterrows():
            prompts_l.append({
                                 "id": f"default-{str(row.get('Bank', 'Unk')).lower()}-{str(row.get('PromptName', 'NoName')).lower().replace(' ', '-')}-{uuid.uuid4().hex[:4]}",
                                 "name": str(row.get('PromptName')), "bankName": str(row.get('Bank')),
                                 "description": f"Prompt for {row.get('Bank', bank_name)}: {row.get('PromptName', '')}",
                                 "template": str(row.get('PromptText')),
                                 "category": str(row.get('Category', "Default Prompts"))})
        msg = f"Found {len(prompts_l)} prompts for {bank_name}." if prompts_l else f"No default prompts for {bank_name}."
        if not prompts_l: logger.info(msg)
        return jsonify({"status": "success", "prompts": prompts_l, "message": msg})
    except FileNotFoundError:
        logger.error(f"CSV not found: {csv_p}"); return jsonify({"error": "Prompt CSV not found."}), 500
    except Exception as e:
        logger.error(f"Error loading prompts for {bank_name}: {e}", exc_info=True); return jsonify(
            {"error": f"Could not load prompts: {e}"}), 500


# ... (load_prompts_from_excel_route, cleanup_session, error handlers, and main block remain as previously provided,
# just ensure logging is used instead of print where appropriate and thread locks for processing_status if needed) ...
@app.route('/api/prompts/load', methods=['POST'])
def load_prompts_from_excel_route() -> Any:
    # ... (Logic from your last version)
    return jsonify({})  # Placeholder


@app.route('/api/cleanup/<session_id>', methods=['DELETE'])
def cleanup_session(session_id: str) -> Any:
    # ... (Logic from your last version with logging and processing_status_lock)
    try:
        with processing_status_lock:
            if session_id in processing_status:
                logger.info(f"Cleaning up session: {session_id}")
                del processing_status[session_id]
                return jsonify({"status": "success", "message": f"Session {session_id} data cleared."})
            else:
                logger.warning(f"Cleanup attempt for non-existent session: {session_id}")
                return jsonify({"status": "not_found", "message": f"Session {session_id} not found."}), 404
    except Exception as e:
        logger.error(f"Cleanup error for session {session_id}: {e}", exc_info=True)
        return jsonify({"error": str(e), "trace": traceback.format_exc()}), 500


@app.errorhandler(404)
def resource_not_found(e: Any) -> Any:
    logger.warning(f"404 Not Found: {request.url} - {e}")
    return jsonify(error="Endpoint Not Found", details=str(e)), 404


@app.errorhandler(500)
def internal_server_error_handler(e: Any) -> Any:  # Renamed to avoid conflict
    logger.error(f"500 Internal Server Error: {request.url} - {e}", exc_info=True)
    # Check if the original exception has a response attribute (e.g. from Werkzeug for HTTP exceptions)
    original_exception = getattr(e, "original_exception", e)
    return jsonify(error="Internal Server Error", details=str(original_exception)), 500


if __name__ == '__main__':
    logger.info("Flask API server starting...")
    # Important: For development with threading and in-memory status,
    # ensure only one worker process if using a production server like Gunicorn for testing.
    # The default Flask dev server with threaded=True runs in a single process.
    app.run(host='0.0.0.0', port=5000, debug=True, use_reloader=False, threaded=True)
```

# EY_DataExtract.py

```py
#!/usr/bin/env python3
"""
IFRS9 Data Extraction API Server

This Flask API server processes IFRS9 PDFs, extracts data using a custom LLM and embedding system,
and returns results in JSON format for the frontend application.
"""

import os
import json
import re
import shutil
import time
import traceback
import tempfile
from datetime import datetime
from typing import List, Tuple, Optional, Dict, Any
from flask import Flask, request, jsonify, send_file
from flask_cors import CORS
from werkzeug.utils import secure_filename
import uuid

import requests
import pandas as pd
import openpyxl  # type: ignore
from dotenv import load_dotenv
import nest_asyncio

import concurrent.futures
from functools import partial
from io import BytesIO

from langchain_community.vectorstores import Chroma
from langchain.schema import Document
from chromadb.api.types import EmbeddingFunction  # type: ignore
from llama_index.readers.llama_parse import LlamaParse

# Apply nest_asyncio to allow nested event loops
nest_asyncio.apply()

# Initialize Flask app
app = Flask(__name__)
CORS(app)  # Enable CORS for frontend communication

# =============================================================================
# Configuration and Global Constants
# =============================================================================
ENV_PATH = os.path.join(os.path.dirname(__file__), "ATT27768.env")
load_dotenv(ENV_PATH)

LLAMA_PARSE_API_KEY = os.getenv("LLAMA_PARSE_API_KEY")
if not LLAMA_PARSE_API_KEY:
    raise ValueError("LLAMA_PARSE_API_KEY not found in .env file.")

EYQ_INCUBATOR_KEY = os.getenv("EYQ_INCUBATOR_KEY")
EYQ_BASE_URL = "https://eyq-incubator.europe.fabric.ey.com/eyq/eu/api"
EYQ_CHAT_MODEL = "gpt-4o"
EYQ_EMBEDDING_MODEL = "text-embedding-3-large"
EYQ_API_VERSION = "2023-05-15"
AUTH_HEADER_NAME = "api-key"
USE_BEARER = False

# Use temporary directories for web server
TEMP_DIR = tempfile.gettempdir()
PERSIST_DIRECTORY = os.path.join(TEMP_DIR, 'ifrs9_chroma')
UPLOAD_FOLDER = os.path.join(TEMP_DIR, 'ifrs9_uploads')
OUTPUT_DIRECTORY = os.path.join(TEMP_DIR, 'ifrs9_outputs')
BACKUP_FOLDER = os.path.join(TEMP_DIR, 'ifrs9_backup')

# Create directories
for directory in [PERSIST_DIRECTORY, UPLOAD_FOLDER, OUTPUT_DIRECTORY, BACKUP_FOLDER]:
    os.makedirs(directory, exist_ok=True)

# Thresholds
PAGE_THRESHOLD = 150
CHAR_THRESHOLD = 1_000_000  # Maximum characters per chunk

# Allowed file extensions
ALLOWED_EXTENSIONS = {'pdf'}

# Store processing status
processing_status: Dict[str, Dict[str, Any]] = {}


# =============================================================================
# Utility Functions
# =============================================================================
def allowed_file(filename: str) -> bool:
    return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS


def create_backup_folder(src_folder: str, dest_folder: str) -> None:
    """Create backup folder with retry logic for concurrent access."""
    os.makedirs(dest_folder, exist_ok=True)
    timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')

    for attempt in range(5):
        try:
            dest_path = os.path.join(dest_folder, f".chromadb_{timestamp}_{attempt}")
            shutil.copytree(src_folder, dest_path)
            print(f"Backup created at: {dest_path}")
            return
        except FileExistsError:
            print(f"Backup folder {dest_path} already exists, trying another name")
            continue

    print("Warning: Could not create backup folder, proceeding without backup")


def clean_ocr_text(text: str) -> str:
    # IMPORTANT: The original empty string keys ('') are problematic.
    # They have been replaced with placeholders like 'GARBLED_CHAR_X'.
    # You MUST replace these placeholders with the *actual specific garbled characters*
    # that need to be corrected from your PDF's OCR output.
    # For example, if '◇' is misread and needs to be '6', then use: '◇': '6'.
    replacements = {
        'GARBLED_CHAR_6': '6', 'GARBLED_CHAR_5': '5', 'GARBLED_CHAR_7': '7',
        'GARBLED_CHAR_4': '4', 'GARBLED_CHAR_3': '3', 'GARBLED_CHAR_0': '0',
        'GARBLED_CHAR_9': '9', 'GARBLED_CHAR_8': '8', 'GARBLED_CHAR_1': '1',
        'GARBLED_CHAR_2': '2', 'GARBLED_EMPTY': '', 'GARBLED_DOT': '.',
        'GARBLED_ZERO_ALT': '0',
        '|': ' ',  # This replacement seems reasonable
        # '\n': ' ', # Replacing all newlines with spaces might be too aggressive depending on context.
        # Consider if this is always desired.
        # Character specific replacements (these seem more plausible)
        ' S': ' 5', ' I': ' 1', ' O': ' 0', ' B': ' 8'
        # Add more specific garbled character to correct character mappings here
    }
    # First, handle specific garbled characters
    for garbled, replacement in replacements.items():
        if not garbled.startswith('GARBLED_'):  # Apply actual replacements
            text = text.replace(garbled, replacement)

    # Replace all newline characters with spaces for LLM processing
    text = text.replace('\n', ' ')
    return text


def standardize_json_structure(prompt_str: str) -> str:
    """Standardize JSON structure in prompts to prevent parsing issues."""
    json_match = re.search(r'\{.*\}', prompt_str, re.DOTALL)
    if not json_match:
        return prompt_str

    try:
        json_template = json_match.group(0)
        fixed_template = (json_template
                          .replace('" ', '"')
                          .replace(' "', '"')
                          )
        fixed_template = re.sub(r'}\s*{', '},{', fixed_template)
        fixed_template = re.sub(r'"\s*{', '",{', fixed_template)
        return prompt_str.replace(json_template, fixed_template)
    except Exception as e:
        print(f"Warning: Could not standardize JSON in prompt: {e}")
        return prompt_str


def split_content_by_chars(content: str, char_threshold: int) -> List[str]:
    if len(content) <= char_threshold:
        return [content]
    chunks = []
    start = 0
    while start < len(content):
        end = min(start + char_threshold, len(content))
        break_point = content.rfind('\n', start, end)
        if break_point == -1 or break_point <= start:  # ensure break_point is after start
            break_point = content.rfind(' ', start, end)
        if break_point == -1 or break_point <= start:  # ensure break_point is after start
            break_point = end
        chunks.append(content[start:break_point])
        start = break_point + 1  # Move past the break character
        if start < len(content) and content[start - 1] == '\n':  # if break was newline, skip it
            pass
        elif start < len(content) and content[start - 1] == ' ':  # if break was space, skip it
            pass

    return chunks


def flatten_json_to_rows(json_data: Any) -> List[Dict[str, str]]:
    """Flatten nested JSON into a list of rows for Excel, handling various JSON structures."""
    rows: List[Dict[str, str]] = []

    if isinstance(json_data, str):
        return [{"Category": "Error", "Stage": "N/A", "Field": "Response", "Value": json_data}]

    if not isinstance(json_data, dict):
        return [{"Category": "Error", "Stage": "N/A", "Field": "Invalid JSON", "Value": str(json_data)}]

    if all(not isinstance(val, dict) for val in json_data.values()):
        for key, value in json_data.items():
            rows.append({
                "Category": "Main",
                "Stage": "N/A",
                "Field": key,
                "Value": str(value)
            })
        return rows

    for category, content in json_data.items():
        if isinstance(content, dict):
            for field, value in content.items():
                if isinstance(value, dict):
                    for subfield, subvalue in value.items():
                        rows.append({
                            "Category": str(category),
                            "Stage": str(field),
                            "Field": str(subfield),
                            "Value": str(subvalue)
                        })
                else:
                    rows.append({
                        "Category": str(category),
                        "Stage": "N/A",
                        "Field": str(field),
                        "Value": str(value)
                    })
        else:
            rows.append({
                "Category": "Summary",
                "Stage": "N/A",
                "Field": str(category),
                "Value": str(content)
            })

    return rows


def merge_json_responses(responses: List[Dict[Any, Any]]) -> Dict[Any, Any]:
    """Merge multiple JSON responses, prioritizing non-N/A values."""
    if not responses:
        return {}

    # Filter out None or non-dict responses
    valid_responses = [r for r in responses if isinstance(r, dict)]
    if not valid_responses:
        return {}
    if len(valid_responses) == 1:
        return valid_responses[0]

    merged: Dict[Any, Any] = {}

    for response in valid_responses:
        for category, content in response.items():
            if category not in merged:
                merged[category] = content
            else:
                if isinstance(content, dict) and isinstance(merged.get(category), dict):
                    current_category_data = merged[category]
                    for stage, stage_content in content.items():
                        if stage not in current_category_data:
                            current_category_data[stage] = stage_content
                        else:
                            if isinstance(stage_content, dict) and isinstance(current_category_data.get(stage), dict):
                                current_stage_data = current_category_data[stage]
                                for field, value in stage_content.items():
                                    existing_val = current_stage_data.get(field, "N/A")
                                    if (str(existing_val).strip() == "N/A" or not existing_val) and \
                                            (str(value).strip() != "N/A" and value is not None):
                                        current_stage_data[field] = value
                            elif str(current_category_data.get(stage, "N/A")).strip() == "N/A" and \
                                    (str(stage_content).strip() != "N/A" and stage_content is not None):
                                current_category_data[stage] = stage_content
                elif (str(merged.get(category, "N/A")).strip() == "N/A" or not merged.get(category)) and \
                        (str(content).strip() != "N/A" and content is not None):
                    merged[category] = content
    return merged


def count_na_values(json_data: Dict[Any, Any]) -> int:
    na_count = 0
    if not isinstance(json_data, dict):
        return 0

    for cat_value in json_data.values():
        if isinstance(cat_value, dict):
            for stage_value in cat_value.values():
                if isinstance(stage_value, dict):
                    for field_value in stage_value.values():
                        if str(field_value).strip() == "N/A":
                            na_count += 1
                elif str(stage_value).strip() == "N/A":
                    na_count += 1
        elif str(cat_value).strip() == "N/A":
            na_count += 1
    return na_count


def all_values_na(json_data: Dict[Any, Any]) -> bool:
    """Check if all values in the JSON data are 'N/A'"""
    if not isinstance(json_data, dict):  # Should not happen if parsing is correct
        return str(json_data).strip() == "N/A"

    if not json_data:  # Empty dict
        return False  # Or True, depending on definition, let's say False as no values are N/A

    if all(not isinstance(val, dict) for val in json_data.values()):
        return all(str(val).strip() == "N/A" for val in json_data.values())

    for category_content in json_data.values():
        if isinstance(category_content, dict):
            for stage_content in category_content.values():
                if isinstance(stage_content, dict):
                    for field_value in stage_content.values():
                        if str(field_value).strip() != "N/A":
                            return False
                elif str(stage_content).strip() != "N/A":
                    return False
        elif str(category_content).strip() != "N/A":
            return False
    return True


def enhance_ecl_prompt(original_prompt: str) -> str:
    """Enhance any ECL-related prompt to focus extraction on credit risk data."""
    if not original_prompt or not any(term in original_prompt.lower() for term in
                                      ["ecl", "stage", "impairment", "credit risk"]):
        return original_prompt

    # JSON structure is part of the original_prompt, no need to re-extract here.
    # The original_prompt itself is embedded in the enhanced_prompt.

    enhanced_prompt = f"""
I need to extract credit risk stage data from this financial report. Focus specifically on:

1. Tables showing loan quality or credit risk metrics
2. Sections with ECL (Expected Credit Loss) data
3. Information broken down by Stage 1, Stage 2, and Stage 3
4. Values for: ECL/provisions, gross exposures/balances, and coverage ratios

For clarity: Stage 1 is performing, Stage 2 is significantly increased risk, Stage 3 is credit-impaired.

First, scan the document for sections containing phrases like "credit quality", "loan impairment", "ECL", "credit risk" or tables with "Stage 1/2/3" headers.

{original_prompt}

IMPORTANT EXTRACTION TIPS:
- Values should be in millions (£m or $m)
- Coverage ratios are typically percentages (%)
- Look for the most recent reporting period data
- If a value is not found, use "N/A" rather than making an estimate
"""
    return enhanced_prompt


# =============================================================================
# Custom Classes
# =============================================================================
class EYQEmbeddings(EmbeddingFunction):  # type: ignore
    def __init__(self, model: str, api_key: str, api_base: str, api_version: str,
                 auth_header_name: str = "Authorization", use_bearer: bool = True):
        self.model = model
        self.api_key = api_key
        self.api_base = api_base
        self.api_version = api_version
        self.auth_header_name = auth_header_name
        self.use_bearer = use_bearer
        self.session = requests.Session()

    def __call__(self, inputs: List[str]) -> List[List[float]]:
        headers = {"Content-Type": "application/json",
                   self.auth_header_name: f"Bearer {self.api_key}" if self.use_bearer else self.api_key}
        embeddings_list: List[List[float]] = []
        for text in inputs:
            # EYQ specific payload might only need 'input' if model is in URL
            payload = {"input": text}
            endpoint = f"{self.api_base}/openai/deployments/{self.model}/embeddings?api-version={self.api_version}"
            try:
                response = self.session.post(endpoint, headers=headers, json=payload, timeout=30)
                response.raise_for_status()
                data = response.json()
                embeddings_list.append(data["data"][0]["embedding"])
            except requests.exceptions.RequestException as e:
                print(f"Embedding request failed: {e}")
                if 'response' in locals() and response is not None:
                    print(f"Response content: {response.text}")
                raise
            except (KeyError, IndexError) as e:
                print(f"Failed to parse embedding response: {e}")
                if 'data' in locals():
                    print(f"Problematic data: {data}")
                raise
        return embeddings_list

    def embed_documents(self, texts: List[str]) -> List[List[float]]:
        return self.__call__(texts)

    def embed_query(self, text: str) -> List[float]:
        return self.__call__([text])[0]


# In EY_DataExtract.py

class EYQChat:
    def __init__(self, deployment_name: str, api_key: str, api_base: str, api_version: str,
                 temperature: float = 0, verbose: bool = False):
        self.deployment_name = deployment_name
        self.api_key = api_key
        self.api_base = api_base
        self.api_version = api_version
        self.temperature = temperature
        self.verbose = verbose
        self.session = requests.Session()

    def __call__(self, messages: List[Dict[str, str]], retries: int = 3, delay: int = 2, **kwargs: Any) -> str:
        headers = {AUTH_HEADER_NAME: self.api_key, "Content-Type": "application/json"}

        # Extract client-side timeout from kwargs, or use a default (e.g., 180 seconds).
        # This removes 'timeout' from kwargs so it won't be added to the api_payload.
        client_side_timeout = kwargs.pop('timeout', 180)

        # Construct the payload for the API.
        # Only include parameters that the API endpoint actually expects.
        api_payload: Dict[str, Any] = {
            "messages": messages,
            "temperature": self.temperature,
            # "model": self.deployment_name # Optional: Some Azure OpenAI setups might expect 'model' in payload.
            # Usually, if deployment_name is in URL, this isn't needed.
            # Test without it first. If you get errors about missing 'model' field, uncomment it.
        }

        # If there are other kwargs that ARE meant for the API payload (e.g., max_tokens, stop sequences),
        # you can add them here from the remaining 'kwargs'.
        # Example:
        # if 'max_tokens' in kwargs:
        #     api_payload['max_tokens'] = kwargs['max_tokens']
        # For now, we'll assume only messages and temperature are primary, and model is handled by URL.
        # You can add other valid API parameters from the remaining `kwargs` to `api_payload` if needed:
        api_payload.update(
            kwargs)  # This adds any remaining kwargs to the payload (after 'timeout' and optionally 'model' were popped)

        endpoint = f"{self.api_base}/openai/deployments/{self.deployment_name}/chat/completions?api-version={self.api_version}"

        if self.verbose:
            print(f"Sending request to {endpoint} with headers: {headers}")
            print(f"Payload (to be sent to API): {json.dumps(api_payload, indent=2)}")  # Log the actual payload

        for attempt in range(retries):
            try:
                # Use the extracted client_side_timeout for the requests.post call
                response = self.session.post(endpoint, headers=headers, json=api_payload, timeout=client_side_timeout)
                response.raise_for_status()  # Raise HTTPError for bad responses (4xx or 5xx)

                response_json = response.json()
                if "choices" not in response_json or not response_json["choices"]:
                    raise ValueError("LLM response missing 'choices' or 'choices' is empty.")
                if "message" not in response_json["choices"][0] or "content" not in response_json["choices"][0][
                    "message"]:
                    raise ValueError("LLM response choices missing 'message' or 'content'.")

                return response_json["choices"][0]["message"]["content"]

            except requests.exceptions.Timeout:
                print(
                    f"Chat request timed out (Attempt {attempt + 1}/{retries}). Client waited for {client_side_timeout}s.")
                if attempt < retries - 1:
                    sleep_duration = delay * (2 ** attempt)
                    print(f"Retrying in {sleep_duration} seconds...")
                    time.sleep(sleep_duration)
                else:
                    print(f"Failed after {retries} timeout attempts.")
                    raise  # Re-raise the timeout error
            except requests.exceptions.RequestException as e:
                print(f"Chat request failed (Attempt {attempt + 1}/{retries}): {e}")
                if 'response' in locals() and response is not None:
                    print(f"Status Code: {response.status_code}, Response Text: {response.text}")
                if attempt < retries - 1:
                    sleep_duration = delay * (2 ** attempt)
                    print(f"Retrying in {sleep_duration} seconds...")
                    time.sleep(sleep_duration)
                else:
                    print(f"Failed after {retries} attempts.")
                    raise
            except (KeyError, IndexError, ValueError) as e:  # Added ValueError for parsing issues
                print(
                    f"Failed to parse chat response or response structure invalid (Attempt {attempt + 1}/{retries}): {e}")
                if 'response' in locals() and response is not None:
                    try:
                        print(f"Problematic chat response JSON: {response.json()}")
                    except json.JSONDecodeError:
                        print(f"Problematic chat response text (not valid JSON): {response.text}")
                if attempt < retries - 1:
                    sleep_duration = delay * (2 ** attempt)
                    print(f"Retrying in {sleep_duration} seconds...")
                    time.sleep(sleep_duration)
                else:
                    print(f"Failed after {retries} attempts due to response parsing issues.")
                    raise
        return "Error: LLM call failed after multiple retries and did not return a valid response."  # Should not be reached if an exception is raised

class IFRS9Processor:
    def __init__(self, embedding: EYQEmbeddings, chat_model_name: str, incubator_key: str):
        self.embedding = embedding
        self.chat_model_name = chat_model_name  # Store the model name
        self.incubator_key = incubator_key
        # self.chroma_client = Chroma( # Chroma client not used in this version of process_single_file_prompt
        #     persist_directory=PERSIST_DIRECTORY,
        #     embedding_function=embedding,
        #     collection_name='IFRS9'
        # )
        self.parser = LlamaParse(api_key=LLAMA_PARSE_API_KEY, result_type="markdown", verbose=True, gpt_4o_mode=True)
        self.total_prompts_run = 0
        self.total_successful_results = 0
        self.total_failed_results = 0

    def load_single_document(self, file_path: str, company_name: str, debug: bool = False,
                             retries: int = 3, delay: int = 5) -> List[Document]:
        if not os.path.exists(file_path) or not os.access(file_path, os.R_OK):
            print(f"Error: File {file_path} does not exist or is not readable")
            return []
        for attempt in range(retries):
            try:
                print(f"Attempt {attempt + 1}/{retries}: Parsing {file_path} with LlamaParse...")
                llama_documents = self.parser.load_data(file_path)  # llama_documents is List[LlamaIndexDocument]
                if not llama_documents:
                    print(f"Warning: No content extracted from {file_path}")
                    return []

                # Convert LlamaIndex Documents to Langchain Documents
                docs: List[Document] = []
                for i, ldoc in enumerate(llama_documents):
                    # CORRECTED LINE: Use ldoc.text instead of ldoc.get_text()
                    docs.append(Document(page_content=ldoc.text,
                                         metadata={"source": os.path.basename(file_path), "page": i,
                                                   "name": company_name}))

                if debug:
                    print(f"Loaded {len(docs)} pages.")
                return docs
            except Exception as e:
                print(f"Attempt {attempt + 1}/{retries} - Error parsing {file_path}: {e}")
                print(traceback.format_exc())
                if attempt < retries - 1:
                    time.sleep(delay * (2 ** attempt))
                else:
                    print(f"Failed to parse {file_path} after {retries} attempts")
                    return []
        return []
    # create_embedding_pdf might not be needed if not using Chroma for retrieval in this flow
    # def create_embedding_pdf(self, pdf_path: str, company_name: str, debug: bool = False):
    #     ...

    def llm_extract_field(self, content: str, prompt: str) -> str:
        llm = EYQChat(
            deployment_name=self.chat_model_name,  # Use stored model name
            api_key=self.incubator_key,
            api_base=str(EYQ_BASE_URL),  # Ensure EYQ_BASE_URL is string
            api_version=str(EYQ_API_VERSION),  # Ensure EYQ_API_VERSION is string
            verbose=True
        )
        # Standardize the prompt before using it
        standardized_prompt = standardize_json_structure(prompt)

        full_prompt = (
            f"{standardized_prompt}\n\nHere is the content, please extract the information based on the prompt. Only provide the JSON output. Do not add any introductory text or explanations. \n\nFull Document Content:\n{content}\n"
            "Return ONLY the result as a JSON string. If a value is not found, use 'N/A'."
        )
        messages = [{"role": "user", "content": full_prompt}]
        return llm(messages, timeout=180)

    def process_content_chunk(self, content: str, company: str, prompt_str: str, part_name: str, debug: bool = False) -> \
    Tuple[Optional[Dict[Any, Any]], str, List[Dict[str, str]]]:
        if debug:
            print(f"Processing {part_name} for {company}: {content[:500]}...")

        json_str_response: Optional[str] = None
        llm_response_content = ""  # Initialize to prevent reference before assignment in except block
        try:
            llm_response_content = self.llm_extract_field(content, prompt_str)
            print(f"LLM response for {company} ({part_name}) (first 500 chars): {llm_response_content[:500]}...")

            json_match = re.search(r'\`\`\`json\s*(.*?)\s*\`\`\`', llm_response_content, re.DOTALL)
            if json_match:
                json_str_response = json_match.group(1).strip()
            else:
                # Fallback to finding the first '{' and last '}'
                start_brace = llm_response_content.find('{')
                end_brace = llm_response_content.rfind('}')
                if start_brace != -1 and end_brace != -1 and end_brace > start_brace:
                    json_str_response = llm_response_content[start_brace: end_brace + 1].strip()
                else:
                    raise ValueError("No valid JSON structure (neither \`\`\`json...\`\`\` nor {.*}) found in LLM response.")

            if json_str_response is None:  # Should be caught by ValueError above, but as a safeguard
                raise ValueError("JSON string extraction failed.")

            # Clean up potential issues like escaped newlines or quotes if necessary
            json_str_response = json_str_response.replace('\\n', '\n').replace('\\"', '"')
            # Ensure "N/A" (if meant as a string literal) is properly quoted.
            # This regex is a bit aggressive, be careful.
            # json_str_response = re.sub(r'(?<!")N/A(?!")', '"N/A"', json_str_response)

            notes_start = llm_response_content.find('**Note:') if '**Note:' in llm_response_content else len(
                llm_response_content)
            notes = llm_response_content[notes_start:].strip() if notes_start < len(
                llm_response_content) else "No notes provided"

            parsed_json_response = json.loads(json_str_response)

            if not isinstance(parsed_json_response, dict):
                raise ValueError(f"JSON response is not a dictionary: {type(parsed_json_response)}")

            flattened_data = flatten_json_to_rows(parsed_json_response)
            return parsed_json_response, notes, flattened_data

        except json.JSONDecodeError as e:
            error_message = f"JSON parsing error for {company} ({part_name}): {e}. Problematic string: '{json_str_response if json_str_response else 'Not found/extracted'}'"
            print(error_message)
            return None, f"Failed to parse JSON response: {e}", [
                {"Category": "Error", "Stage": "N/A", "Field": "JSON Parsing", "Value": error_message}]
        except Exception as e:
            error_message = f"Error processing response for {company} ({part_name}): {str(e)}. LLM Response (start): {llm_response_content[:200] if 'llm_response_content' in locals() else 'N/A'}"
            print(error_message)
            print(traceback.format_exc())
            return None, f"Error: {str(e)}", [
                {"Category": "Error", "Stage": "N/A", "Field": "Processing", "Value": error_message}]

    def process_pdf_part(self, docs: List[Document], company: str, prompt_str: str,
                         part_name: str, debug: bool = False) -> Tuple[
        Optional[Dict[Any, Any]], str, List[Dict[str, str]]]:
        full_content = "\n\n".join(doc.page_content for doc in docs)
        cleaned = clean_ocr_text(full_content)

        if len(cleaned) > CHAR_THRESHOLD:
            print(f"{company} ({part_name}) content exceeds limit ({len(cleaned)} chars), splitting into chunks...")
            chunks = split_content_by_chars(cleaned, CHAR_THRESHOLD)
            print(f"Created {len(chunks)} chunks for {company} ({part_name})")

            valid_responses_list: List[Dict[Any, Any]] = []
            valid_notes_list: List[str] = []
            all_chunk_flattened_data: List[Dict[str, str]] = []

            for i, chunk_content in enumerate(chunks):
                chunk_name = f"{part_name} Chunk {i + 1}"
                print(f"\n{'=' * 50}\nPROCESSING {chunk_name} ({len(chunk_content) // 1000}K chars)\n{'=' * 50}")
                try:
                    res_json, notes, flat_data = self.process_content_chunk(
                        chunk_content, company, prompt_str, chunk_name, debug
                    )
                    if res_json is not None:
                        na_count = count_na_values(res_json)
                        total_fields_val = sum(
                            len(stage_value) if isinstance(stage_value, dict) else 1 for cat_value in res_json.values()
                            if isinstance(cat_value, dict) for stage_value in cat_value.values()) or len(res_json)
                        print(
                            f"SUCCESS: {chunk_name} returned valid JSON with {na_count} N/A values out of {total_fields_val or 'N/A'} fields")
                        print(f"Structure: {list(res_json.keys())}")
                        valid_responses_list.append(res_json)
                        valid_notes_list.append(notes)
                        if flat_data and isinstance(flat_data, list):
                            all_chunk_flattened_data.extend(flat_data)
                    else:
                        print(f"FAILURE: {chunk_name} did not return valid JSON. Notes: {notes}")
                        if flat_data and isinstance(flat_data, list):  # still collect error data
                            all_chunk_flattened_data.extend(flat_data)

                except Exception as e:
                    print(f"ERROR processing {chunk_name}: {e}")
                    print(traceback.format_exc())

            if not valid_responses_list:
                print(f"No valid responses from any chunk in {part_name}")
                # Return all collected (error) data from chunks if no valid JSON was produced from any.
                return None, f"All chunks failed to produce valid JSON for {part_name}", all_chunk_flattened_data or [
                    {"Category": "Error", "Stage": "N/A", "Field": "N/A",
                     "Value": "No valid data extracted from chunks"}]

            merged_response = merge_json_responses(valid_responses_list)
            combined_notes = "\n\n".join([f"--- Notes from {part_name} Chunk {idx + 1} ---\n{n}"
                                          for idx, n in enumerate(valid_notes_list)])

            final_flattened_data = flatten_json_to_rows(
                merged_response) if merged_response else all_chunk_flattened_data

            print(f"Successfully processed {len(valid_responses_list)} responses for {part_name}")
            return merged_response, combined_notes, final_flattened_data
        else:
            return self.process_content_chunk(cleaned, company, prompt_str, part_name, debug)

    def find_relevant_sections(self, docs: List[Document]) -> List[List[Document]]:
        keywords = [
            "credit risk", "expected credit loss", "ecl", "loan impairment",
            "stage 1", "stage 2", "stage 3", "provision", "credit quality",
            "coverage ratio", "loan to value", "ltv", "impairment allowance",
            "credit-impaired", "performing", "non-performing", "significant increase"
        ]
        keyword_pages_indices: List[int] = []
        keyword_found_info: Dict[int, List[str]] = {}

        for i, doc in enumerate(docs):
            content_lower = doc.page_content.lower()
            found_on_page = [kw for kw in keywords if kw in content_lower]
            if found_on_page:
                keyword_pages_indices.append(i)
                keyword_found_info[i] = found_on_page

        section_chunks: List[List[Document]] = []
        if not keyword_pages_indices:
            print("No specific ECL content found by keywords - creating standard chunks")
            chunk_size = max(1, len(docs) // 10) if len(docs) > 0 else 1
            if len(docs) == 0: return []
            for i in range(0, len(docs), chunk_size):
                section_chunks.append(docs[i: i + chunk_size])
            return section_chunks

        print(f"Found {len(keyword_pages_indices)} pages with ECL-related content: {sorted(keyword_pages_indices)}")

        page_groups: List[List[int]] = []
        if keyword_pages_indices:  # Should always be true if we are in this block
            current_group = [keyword_pages_indices[0]]
            for i in range(1, len(keyword_pages_indices)):
                if keyword_pages_indices[i] <= current_group[-1] + 3:  # Group if pages are consecutive or close
                    current_group.append(keyword_pages_indices[i])
                else:
                    page_groups.append(current_group)
                    current_group = [keyword_pages_indices[i]]
            if current_group:
                page_groups.append(current_group)

        context_size = 2
        for group in page_groups:
            group_start_page = min(group)
            group_end_page = max(group)
            chunk_start_index = max(0, group_start_page - context_size)
            chunk_end_index = min(len(docs), group_end_page + context_size + 1)
            section_chunks.append(docs[chunk_start_index:chunk_end_index])

        return section_chunks

    def process_single_file_prompt(self, file_path: str, company: str, prompt_template: str,
                                   prompt_name: str, session_id: str, debug: bool = False):
        """Process a single file with a single prompt."""
        try:
            if session_id in processing_status:
                processing_status[session_id]['current_file'] = os.path.basename(file_path)
                processing_status[session_id]['current_prompt'] = prompt_name
                processing_status[session_id]['step'] = f'Processing {prompt_name} from {os.path.basename(file_path)}'

            docs = self.load_single_document(file_path, company, debug=debug)
            if not docs:
                return {"status": "error", "error": "Failed to load document", "data": [],
                        "notes": "Could not parse PDF file"}

            num_pages = len(docs)
            print(f"PDF for {company} has {num_pages} pages")

            current_prompt_template = prompt_template
            if "ecl" in prompt_name.lower() or "stage" in prompt_name.lower():
                current_prompt_template = enhance_ecl_prompt(prompt_template)

            final_json_response: Optional[Dict[Any, Any]] = None
            final_notes: str = ""
            final_flattened_data: List[Dict[str, str]] = []

            if num_pages >= PAGE_THRESHOLD:
                print(f"Document has {num_pages} pages, exceeding threshold {PAGE_THRESHOLD}. Using chunking.")
                parts: List[List[Document]]
                if "ecl" in prompt_name.lower() or "stage" in prompt_name.lower() or (
                "credit" in current_prompt_template.lower() if isinstance(current_prompt_template, str) else False):
                    print(f"Using ECL-targeted document chunking for {company} ({num_pages} pages)")
                    parts = self.find_relevant_sections(docs)
                else:
                    chunk_size = num_pages // 10 if num_pages > 200 else num_pages // 3
                    chunk_size = max(1, chunk_size)
                    parts = [docs[i: i + chunk_size] for i in range(0, num_pages, chunk_size)]

                if not parts:
                    parts = [docs]
                    print("Warning: Chunking resulted in no parts. Processing document as a single part.")

                all_part_json_responses: List[Dict[Any, Any]] = []
                all_part_notes: List[str] = []
                # aggregated_flattened_data stores data from all chunks, successful or not, for potential partial results
                aggregated_flattened_data: List[Dict[str, str]] = []

                for i, part_docs in enumerate(parts):
                    part_name = f"Part {i + 1}/{len(parts)}"
                    json_response, notes, flattened_data_chunk = self.process_pdf_part(
                        part_docs, company, current_prompt_template, part_name, debug=debug  # Pass debug
                    )
                    if json_response:  # if json_response is a dict and not None
                        all_part_json_responses.append(json_response)
                    # Always collect notes and flattened_data, even if json_response is None (e.g. error from chunk)
                    all_part_notes.append(f"--- Notes from {part_name} ---\n{notes}")
                    if flattened_data_chunk:
                        aggregated_flattened_data.extend(d for d in flattened_data_chunk if isinstance(d, dict))

                if all_part_json_responses:  # If at least one part yielded a valid JSON response
                    final_json_response = merge_json_responses(all_part_json_responses)
                    final_notes = "\n\n".join(all_part_notes)
                    final_flattened_data = flatten_json_to_rows(
                        final_json_response) if final_json_response else aggregated_flattened_data
                else:
                    final_notes = "Failed to extract valid JSON data from any part of the document.\n" + "\n\n".join(
                        all_part_notes)
                    final_flattened_data = aggregated_flattened_data
            else:
                print(f"Document has {num_pages} pages. Processing as a single unit.")
                full_content = "\n\n".join([doc.page_content for doc in docs])
                cleaned_content = clean_ocr_text(full_content)
                final_json_response, final_notes, final_flattened_data = self.process_content_chunk(
                    cleaned_content, company, current_prompt_template, "Full Content", debug=debug  # Pass debug
                )

            if final_json_response and not all_values_na(final_json_response):
                return {"status": "success", "data": final_flattened_data, "notes": final_notes}
            elif final_json_response and all_values_na(final_json_response):  # Has JSON but all values are "N/A"
                return {"status": "error", "error": "All extracted values are 'N/A'", "data": final_flattened_data,
                        "notes": final_notes + "\nExtraction likely failed - all values returned as N/A"}
            else:  # No JSON response at all or other failure (final_json_response is None)
                # Ensure final_flattened_data is at least an empty list if it's None
                return {"status": "error", "error": "Extraction failed to produce valid JSON",
                        "data": final_flattened_data if final_flattened_data is not None else [], "notes": final_notes}

        except Exception as e:
            print(f"Critical Error in process_single_file_prompt for {company}, prompt {prompt_name}: {str(e)}")
            print(traceback.format_exc())
            return {"status": "error", "error": str(e), "data": [],
                    "notes": f"Error: {str(e)}\n{traceback.format_exc()}"}


# =============================================================================
# Flask API Routes
# =============================================================================

@app.route('/api/health', methods=['GET'])
def health_check() -> Any:
    """Health check endpoint."""
    return jsonify({
        "status": "healthy",
        "service": "IFRS9 Data Extraction API",
        "version": "1.0.0"
    })


@app.route('/api/upload', methods=['POST'])
def upload_files_route() -> Any:
    """Handle file uploads."""
    try:
        if 'files' not in request.files:
            return jsonify({"error": "No files provided"}), 400

        received_files = request.files.getlist('files')
        uploaded_file_metadata_list = []

        for file_storage in received_files:
            if file_storage and file_storage.filename and allowed_file(file_storage.filename):
                filename = secure_filename(file_storage.filename)
                unique_filename = f"{uuid.uuid4()}_{filename}"
                filepath = os.path.join(UPLOAD_FOLDER, unique_filename)
                file_storage.save(filepath)

                file_stats = os.stat(filepath)
                uploaded_file_metadata_list.append({
                    "id": unique_filename,
                    "name": filename,
                    "size": file_stats.st_size,
                    "type": file_storage.mimetype or "application/octet-stream",
                    "lastModified": int(file_stats.st_mtime * 1000),
                    "status": "success",
                    "progress": 100
                })
            else:
                error_msg = f"File {file_storage.filename if file_storage.filename else 'Unknown'} not allowed or has no name."
                print(error_msg)

        if not uploaded_file_metadata_list and received_files:
            return jsonify({"error": "No valid files were uploaded (check extensions or filenames)."}), 400
        elif not received_files:
            return jsonify({"error": "No files received in the request."}), 400

        return jsonify({
            "status": "success",
            "files": uploaded_file_metadata_list
        })

    except Exception as e:
        print(traceback.format_exc())
        return jsonify({"error": str(e), "trace": traceback.format_exc()}), 500


@app.route('/api/process', methods=['POST'])
def process_files_route() -> Any:
    """Process files with selected prompts."""
    session_id = "default_session"
    try:
        data = request.json
        if not data:
            return jsonify({"error": "Request data is missing or not JSON"}), 400

        files_to_process = data.get('files', [])
        prompts_to_use = data.get('prompts', [])
        session_id = data.get('sessionId', str(uuid.uuid4()))

        if not files_to_process or not prompts_to_use:
            return jsonify({"error": "Files and prompts are required"}), 400

        processing_status[session_id] = {
            "status": "processing", "progress": 0, "step": "Initializing...",
            "total_items": len(files_to_process) * len(prompts_to_use),
            "completed_items": 0, "results": []
        }

        embedding_instance = EYQEmbeddings(
            model=EYQ_EMBEDDING_MODEL, api_key=str(EYQ_INCUBATOR_KEY), api_base=str(EYQ_BASE_URL),
            api_version=str(EYQ_API_VERSION), auth_header_name=AUTH_HEADER_NAME, use_bearer=USE_BEARER
        )
        processor_instance = IFRS9Processor(embedding_instance, str(EYQ_CHAT_MODEL), str(EYQ_INCUBATOR_KEY))

        current_results = []
        completed_count = 0

        for file_info in files_to_process:
            file_id = file_info.get('id')
            original_file_name = file_info.get('name', 'UnknownFile.pdf')

            if not file_id:
                print(f"Warning: File info missing 'id': {file_info}")
                for _ in prompts_to_use:  # Account for skipped prompts
                    completed_count += 1
                processing_status[session_id]['completed_items'] = completed_count
                processing_status[session_id]['progress'] = int(
                    (completed_count / processing_status[session_id]['total_items']) * 100) if \
                processing_status[session_id]['total_items'] > 0 else 0
                # Add error result for this file
                error_result_for_file = {
                    "id": f"result-file-error-{uuid.uuid4()}", "fileId": "N/A", "fileName": original_file_name,
                    "promptId": "N/A", "promptName": "File Error", "status": "error",
                    "timestamp": datetime.now().isoformat(), "data": [], "notes": "File ID missing, cannot process.",
                    "error": "File ID missing in request."
                }
                current_results.append(error_result_for_file)
                processing_status[session_id]['results'].append(error_result_for_file)
                continue

            file_path = os.path.join(UPLOAD_FOLDER, file_id)

            if not os.path.exists(file_path):
                print(
                    f"Error: File {file_path} (id: {file_id}, original name: {original_file_name}) not found on server for processing.")
                for prompt_info_skip in prompts_to_use:
                    completed_count += 1
                    error_result = {
                        "id": f"result-{uuid.uuid4()}", "fileId": file_id, "fileName": original_file_name,
                        "promptId": prompt_info_skip.get('id', 'N/A'),
                        "promptName": prompt_info_skip.get('name', 'N/A'), "status": "error",
                        "timestamp": datetime.now().isoformat(), "data": [], "notes": "",
                        "error": f"File {original_file_name} (id: {file_id}) not found on server."
                    }
                    current_results.append(error_result)
                    processing_status[session_id]['results'].append(error_result)

                processing_status[session_id]['completed_items'] = completed_count
                processing_status[session_id]['progress'] = int(
                    (completed_count / processing_status[session_id]['total_items']) * 100) if \
                processing_status[session_id]['total_items'] > 0 else 0
                continue

            for prompt_info in prompts_to_use:
                completed_count += 1
                processing_status[session_id][
                    'step'] = f"Extracting {prompt_info['name']} from {original_file_name} ({completed_count}/{processing_status[session_id]['total_items']})"
                processing_status[session_id]['progress'] = int(
                    (completed_count / processing_status[session_id]['total_items']) * 100) if \
                processing_status[session_id]['total_items'] > 0 else 0

                result_data = processor_instance.process_single_file_prompt(
                    file_path,
                    original_file_name.replace('.pdf', ''),
                    prompt_info.get('template', prompt_info['name']),
                    prompt_info['name'],
                    session_id,
                    debug=True
                )

                single_processing_result = {
                    "id": f"result-{uuid.uuid4()}", "fileId": file_id, "fileName": original_file_name,
                    "promptId": prompt_info.get('id', 'N/A'), "promptName": prompt_info['name'],
                    "status": result_data['status'], "timestamp": datetime.now().isoformat(),
                    "data": result_data.get('data', []), "notes": result_data.get('notes', ''),
                    "error": result_data.get('error', None)
                }
                current_results.append(single_processing_result)
                processing_status[session_id]['results'].append(single_processing_result)
                processing_status[session_id]['completed_items'] = completed_count
                print(f"Finished: {processing_status[session_id]['step']} - Status: {result_data['status']}")

        processing_status[session_id]['status'] = 'complete'
        processing_status[session_id]['progress'] = 100
        processing_status[session_id]['step'] = 'Processing complete'
        print("Processing complete for session:", session_id)

        return jsonify({"status": "success", "sessionId": session_id, "results": current_results})

    except Exception as e:
        print(traceback.format_exc())
        if session_id in processing_status:
            processing_status[session_id]['status'] = 'error'
            processing_status[session_id]['step'] = f'Critical Error: {str(e)}'
        return jsonify({"error": str(e), "trace": traceback.format_exc()}), 500


@app.route('/api/status/<session_id>', methods=['GET'])
def get_processing_status(session_id: str) -> Any:
    """Get processing status for a session."""
    if session_id not in processing_status:
        return jsonify({"error": "Session not found"}), 404
    return jsonify(processing_status[session_id])


@app.route('/api/download/<session_id>', methods=['GET'])
def download_results(session_id: str) -> Any:
    """Download results as Excel file."""
    try:
        if session_id not in processing_status or 'results' not in processing_status[session_id]:
            return jsonify({"error": "Session or results not found"}), 404

        results_list = processing_status[session_id]['results']
        if not results_list:
            return jsonify({"error": "No results to download for this session"}), 400

        output_buffer = BytesIO()
        with pd.ExcelWriter(output_buffer, engine='openpyxl') as writer:
            summary_data_for_df = []
            combined_data_for_df = []

            for res in results_list:
                summary_data_for_df.append({
                    "File": res.get('fileName', 'N/A'), "Prompt": res.get('promptName', 'N/A'),
                    "Status": res.get('status', 'N/A'), "Timestamp": res.get('timestamp', 'N/A'),
                    "Error": res.get('error', '')
                })
                if res.get('status') == 'success' and res.get('data'):
                    for item in res['data']:
                        combined_data_for_df.append({
                            "Category": item.get('Category', 'N/A'), "Stage": item.get('Stage', 'N/A'),
                            "Field": item.get('Field', 'N/A'), "Value": item.get('Value', 'N/A'),
                            "Source": f"{res.get('fileName', 'N/A')} - {res.get('promptName', 'N/A')}"
                        })

            pd.DataFrame(summary_data_for_df).to_excel(writer, sheet_name="Summary", index=False)
            if combined_data_for_df:
                pd.DataFrame(combined_data_for_df).to_excel(writer, sheet_name="Combined Results", index=False)
            else:
                pd.DataFrame([{"Message": "No successful data to display"}]).to_excel(writer,
                                                                                      sheet_name="Combined Results",
                                                                                      index=False)

        output_buffer.seek(0)
        timestamp_str = datetime.now().strftime('%Y%m%d_%H%M%S')
        filename = f"IFRS9_Results_{session_id}_{timestamp_str}.xlsx"
        return send_file(
            output_buffer,
            mimetype='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
            as_attachment=True, download_name=filename
        )
    except Exception as e:
        print(traceback.format_exc())
        return jsonify({"error": str(e), "trace": traceback.format_exc()}), 500


@app.route('/api/prompts/load', methods=['POST'])
def load_prompts_from_excel_route() -> Any:
    """Load prompts from Excel file."""
    try:
        if 'file' not in request.files:
            return jsonify({"error": "No file provided"}), 400

        file_storage = request.files['file']
        if not file_storage or not file_storage.filename or not file_storage.filename.endswith(('.xlsx', '.xls')):
            return jsonify({"error": "Invalid file format. Please upload .xlsx or .xls"}), 400

        df = pd.read_excel(file_storage)
        required_columns = ['Bank', 'PromptName', 'PromptText']
        if not all(col in df.columns for col in required_columns):
            missing = [col for col in required_columns if col not in df.columns]
            return jsonify({"error": f"Missing required columns: {', '.join(missing)}"}), 400

        bank_filter = request.form.get('bank')
        if not bank_filter:
            return jsonify({"error": "Bank name not provided in form data"}), 400

        bank_prompts_df = df[df['Bank'].str.lower() == bank_filter.lower()]

        loaded_prompts = []
        for _, row in bank_prompts_df.iterrows():
            loaded_prompts.append({
                "id": f"custom-{uuid.uuid4()}", "name": row['PromptName'],
                "description": f"Custom prompt for {row['Bank']}",
                "template": row['PromptText'], "category": row.get('Category', "Custom")
            })

        if not loaded_prompts:
            return jsonify({"status": "success", "prompts": [], "message": f"No prompts found for bank: {bank_filter}"})

        return jsonify({"status": "success", "prompts": loaded_prompts})
    except Exception as e:
        print(traceback.format_exc())
        return jsonify({"error": str(e), "trace": traceback.format_exc()}), 500


@app.route('/api/prompts/default/<bank_name>', methods=['GET'])
def get_default_prompts(bank_name: str) -> Any:
    """Get default prompts for a specific bank by loading from EY_FinSight_Prompts3.csv."""
    csv_path = os.path.join(os.path.dirname(__file__), "EY_FinSight_Prompts3.csv")  #
    prompts_list = []
    df = None  # Initialize df to None

    try:
        # Attempt to read with UTF-8 first
        try:
            df = pd.read_csv(csv_path, encoding='utf-8')  #
        except UnicodeDecodeError:
            print(f"UTF-8 decoding failed for {csv_path}. Trying 'latin1' encoding.")
            # Fallback to 'latin1' (ISO-8859-1) which is common for such characters
            df = pd.read_csv(csv_path, encoding='latin1')  #
        except Exception as e:  # Catch other potential pandas read errors
            raise e  # Re-raise other read errors to be caught by the outer try-except

        # Ensure case-insensitive comparison for bank_name
        bank_specific_prompts = df[df['Bank'].astype(str).str.lower() == bank_name.lower()]  #

        if not bank_specific_prompts.empty:
            for _, row in bank_specific_prompts.iterrows():  #
                prompts_list.append({
                    "id": f"default-{str(row.get('Bank', 'UnkBank')).lower().replace(' ', '-')}-{str(row['PromptName']).lower().replace(' ', '-')}-{uuid.uuid4().hex[:4]}",
                    "name": str(row['PromptName']),
                    "bankName": str(row['Bank']),  # <<--- ADD THIS LINE TO INCLUDE THE BANK NAME
                    "description": f"Default prompt for {row.get('Bank', bank_name)}: {row.get('PromptName', '')}",
                    "template": str(row['PromptText']),
                    "category": str(row.get('Category', "Default Prompts"))
                    # Changed "Default" to "Default Prompts" for clarity
                })

        if not prompts_list:
            return jsonify({"status": "success", "prompts": [],
                            "message": f"No default prompts configured for bank: {bank_name} in the CSV."})

        return jsonify({"status": "success", "prompts": prompts_list})

    except FileNotFoundError:
        print(f"Prompt CSV file not found at {csv_path}")
        return jsonify({"error": "Prompt configuration file (CSV) not found on server."}), 500
    except Exception as e:
        print(f"Error loading default prompts for {bank_name} from CSV: {e}")
        print(traceback.format_exc())
        return jsonify({"error": f"Could not load default prompts from CSV: {str(e)}"}), 500

@app.route('/api/cleanup/<session_id>', methods=['DELETE'])
def cleanup_session(session_id: str) -> Any:
    """Clean up session data and temporary files."""
    try:
        if session_id in processing_status:
            results_to_clean = processing_status[session_id].get('results', [])
            for result_info in results_to_clean:
                file_id_to_clean = result_info.get('fileId')
                if file_id_to_clean:
                    file_path_to_clean = os.path.join(UPLOAD_FOLDER, file_id_to_clean)
                    if os.path.exists(file_path_to_clean):
                        try:
                            os.remove(file_path_to_clean)
                            print(f"Cleaned up uploaded file: {file_path_to_clean}")
                        except OSError as e_os:
                            print(f"Error deleting file {file_path_to_clean}: {e_os}")
            del processing_status[session_id]

        return jsonify({"status": "success", "message": f"Session {session_id} cleaned up."})
    except Exception as e:
        print(traceback.format_exc())
        return jsonify({"error": str(e), "trace": traceback.format_exc()}), 500


# =============================================================================
# Error Handlers
# =============================================================================

@app.errorhandler(404)
def not_found(error: Any) -> Any:
    return jsonify({"error": "Endpoint not found", "details": str(error)}), 404


@app.errorhandler(500)
def internal_error(error: Any) -> Any:
    print(traceback.format_exc())
    return jsonify({"error": "Internal server error", "details": str(error)}), 500


# =============================================================================
# Main Entry Point
# =============================================================================

if __name__ == '__main__':
    app.run(
        host='0.0.0.0',
        port=5000,
        debug=True,  # Keep debug mode for error messages
        threaded=True,
        use_reloader=False  # Add this line to disable the reloader
    )
```

# EY_FinSight_Prompts3.csv

```csv
Bank,PromptName,PromptText
HSBC,Scenario ECL,"Given the full document content provided, extract the Reported ECL, Central scenario, Upside scenario , Downside scenario , Downside 2 scenario  ECL (Provisions)  for the following categories: Retail analysis and Wholesale analysis, as reported for the latest period presented in the document. Focus specifically on sections titled ""Wholesale and retail sensitivity analysis"" within the document, as these sections contain the detailed breakdown of Reported ECL, Central scenario, Upside scenario , Downside scenario , Downside 2 scenario by category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each category (Reported ECL, Central scenario, Upside scenario , Downside scenario , Downside 2 scenario), expressed in �m.
4. Locate and extract the data directly from sections titled ""Wholesale and retail sensitivity analysis"". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. ""Retail & Business Banking"" is split into Mortgages,EDB - Credit Cards, EDB - Other as separate rows within the table. validate totals against provided aggregates where possible.
7. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers. 
8. Return the result as a JSON string with the following structure:
   {
       ""Wholesale analysis"": {
       ""Reported ECL "": {""ECL"": ""<value>""},
       ""Central scenario "": {""ECL"": ""<value>""},
       ""Upside scenario "": {""ECL"": ""<value>""}
       ""Downside scenario "": {""ECL"": ""<value>""}
       ""Downside 2 scenario "": {""ECL"": ""<value>""}
     },
       ""Retail analysis"": {
       ""Reported ECL "": {""ECL"": ""<value>""},
       ""Central scenario "": {""ECL"": ""<value>""},
       ""Upside scenario "": {""ECL"": ""<value>""}
       ""Downside scenario "": {""ECL"": ""<value>""}
       ""Downside 2 scenario "": {""ECL"": ""<value>""}   
   },
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
HSBC,Scenario Weight,"Given the full document content provided, extract the scenario weight for the  Central scenario, Upside scenario , Downside scenario , Downside 2 scenario  as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       ""Scenario weights %"": {

       ""Central "": {""Weight"": ""<value>""},
       ""Upside "": {""Weight"": ""<value>""}
       ""Downside "": {""Weight"": ""<value>""}
       ""Downside 2  "": {""Weight"": ""<value>""}
     }
   }"
Santander,Scenario ECL,"Given the full document content provided, extract the Upside, Base case, Downside 1, Downside 2 and Weighted ECL (Provisions) and Balance (Exposure) for the following categories: Retail & Business Banking, Mortgages, Consumer Finance, Corporate & Commercial Banking and Corporate Centre , as reported for the latest period presented in the document. Focus specifically on sections titled ""Scenario sensitivity"" within the document, as these sections contain the detailed breakdown of Upside, Base case, Downside 1, Downside 2 and Weighted by category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each category (Retail & Business Banking, Mortgages, Consumer Finance, Corporate & Commercial Banking and Corporate Centre), expressed in �m.
2. Balance refers to the Exposure for each stage and category, expressed in �m.
4. Locate and extract the data directly from sections titled ""Scenario sensitivity"". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. ""Retail & Business Banking"" is split into Mortgages,EDB - Credit Cards, EDB - Other as separate rows within the table. validate totals against provided aggregates where possible.
7. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers. 
8. Return the result as a JSON string with the following structure:
   {
       ""Retail & Business Banking"": {
       ""Upside"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Base"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     },
""Mortgages"": {
       ""Upside"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Base"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     },
     "" Consumer Finance"": {
       ""Upside"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Base"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     },
     "" Corporate & Commercial Banking "": {
       ""Upside"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Base"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     },
     "" Corporate Centre "": {
       ""Upside"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Base"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     },
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Santander,Scenario Weight,"Given the full document content provided, extract the scenario weight for the  Upside , Base case , Downside 1 , Downside 2 scenario  as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       ""Scenario weights %"": {

       ""Upside "": {""Weight"": ""<value>""},
       ""Base case "": {""Weight"": ""<value>""}
       ""Downside 1"": {""Weight"": ""<value>""}
       ""Downside 2  "": {""Weight"": ""<value>""}
     }
   }"
Nationwide,Scenario ECL,"Given the full document content provided, extract the Upside scenario  , Base case scenario , Downside scenario , Severe Downside  scenario and reported Provisions  for the following categories: Residential mortgages, Consumer banking � credit cards , Consumer banking � personal loans and overdraft, Commercial lending, as reported for the latest period presented in the document. Focus specifically on sections titled ""ECL under 100% weighted scenarios "" within the document, as these sections contain the detailed breakdown of Upside scenario  , Base case scenario , Downside scenario , Severe Downside  scenario and reported Provisions. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each category (Residential mortgages, Consumer banking � credit cards , Consumer banking � personal loans and overdraft, Commercial lending), expressed in �m.
4. Locate and extract the data directly from sections titled ""ECL under 100% weighted scenarios "". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.

7. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers. 
8. Return the result as a JSON string with the following structure:
   {
       ""Residential mortgages "": {
       ""Upside scenario"": {""ECL"": ""<value>""},
       ""Base case scenario"": {""ECL"": ""<value>""},
       ""Downside scenario"": {""ECL"": ""<value>""}
       ""Severe Downside scenario"": {""ECL"": ""<value>""}
       ""Reported provisions"": {""ECL"": ""<value>""}
     },
       ""Consumer banking � credit cards "": {
       ""Upside scenario"": {""ECL"": ""<value>""},
       ""Base case scenario"": {""ECL"": ""<value>""},
       ""Downside scenario"": {""ECL"": ""<value>""}
       ""Severe Downside scenario"": {""ECL"": ""<value>""}
       ""Reported provisions"": {""ECL"": ""<value>""}
     },
       ""Consumer banking � personal loans and overdraft "": {
       ""Upside scenario"": {""ECL"": ""<value>""},
       ""Base case scenario"": {""ECL"": ""<value>""},
       ""Downside scenario"": {""ECL"": ""<value>""}
       ""Severe Downside scenario"": {""ECL"": ""<value>""}
       ""Reported provisions"": {""ECL"": ""<value>""}
     },
       ""Commercial lending "": {
       ""Upside scenario"": {""ECL"": ""<value>""},
       ""Base case scenario"": {""ECL"": ""<value>""},
       ""Downside scenario"": {""ECL"": ""<value>""}
       ""Severe Downside scenario"": {""ECL"": ""<value>""}
       ""Reported provisions"": {""ECL"": ""<value>""}
     },
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Nationwide,Scenario Weight,"Given the full document content provided, extract the Scenario probability weighting (%)  for the  Upside scenario  , Base case scenario , Downside scenario , Severe Downside  scenario  as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       ""Scenario weights %"": {
       ""Upside scenario "": {""Weight"": ""<value>""},
       ""Base case scenario"": {""Weight"": ""<value>""}
       ""Downside scenario"": {""Weight"": ""<value>""}
       ""Severe Downside scenario  "": {""Weight"": ""<value>""}
     }
   }"
VMUK,Scenario ECL,"Given the full document content provided extract the Upside, Base, Downside, Severe Downside, and Probability Weighted impairment provisions for the following categories: Mortgages, Unsecured Lending � Cards, Unsecured Lending � Personal Loans and Overdrafts, and Business Lending, as reported for the latest period presented. Focus specifically on the table titled ""Economic scenarios"" under the section ""The calculation of the Group�s impairment provision,"" which contains the detailed breakdown of Upside, Base, Downside, Severe Downside, and Probability Weighted modelled provisions. Use the following guidelines:

Locate and extract the data directly from the ""Economic scenarios"" table. The table provides the latest period data, so use only that period�s data. For the ""Unsecured"" category, break down the data into subcategories ""Cards"" and ""Personal loans and overdrafts"" as provided.
If OCR errors or inconsistencies are detected (e.g., totals not aligning with category sums), adjust values to align with totals or logical consistency, and note adjustments.
Show only on balance sheet numbers (the table does not indicate off balance sheet numbers, so this is assumed to be on balance sheet).
Return the result as a JSON string with the following structure:  
{
    ""Mortgages"": {
        ""Upside"": {""Impairment Provisions"": ""<value>""},
        ""Base"": {""Impairment Provisions"": ""<value>""},
        ""Downside"": {""Impairment Provisions"": ""<value>""},
        ""Severe Downside"": {""Impairment Provisions"": ""<value>""},
        ""Probability Weighted"": {""Impairment Provisions"": ""<value>""}
    },
    ""Unsecured Lending � Cards"": {
        ""Upside"": {""Impairment Provisions"": ""<value>""},
        ""Base"": {""Impairment Provisions"": ""<value>""},
        ""Downside"": {""Impairment Provisions"": ""<value>""},
        ""Severe Downside"": {""Impairment Provisions"": ""<value>""},
        ""Probability Weighted"": {""Impairment Provisions"": ""<value>""}
    },
    ""Unsecured Lending � Personal Loans and Overdrafts"": {
        ""Upside"": {""Impairment Provisions"": ""<value>""},
        ""Base"": {""Impairment Provisions"": ""<value>""},
        ""Downside"": {""Impairment Provisions"": ""<value>""},
        ""Severe Downside"": {""Impairment Provisions"": ""<value>""},
        ""Probability Weighted"": {""Impairment Provisions"": ""<value>""}
    },
    ""Business Lending"": {
        ""Upside"": {""Impairment Provisions"": ""<value>""},
        ""Base"": {""Impairment Provisions"": ""<value>""},
        ""Downside"": {""Impairment Provisions"": ""<value>""},
        ""Severe Downside"": {""Impairment Provisions"": ""<value>""},
        ""Probability Weighted"": {""Impairment Provisions"": ""<value>""}
    }
}
Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m).
Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated totals), and validation against totals if applicable.
If the required data is not found, state that the information is unavailable and explain why (e.g., missing section, lack of scenario breakdown)."
VMUK,Scenario Weight,"Given the full document content provided  extract the scenario probability weightings (%) for the Upside, Base, Downside, and Severe Downside scenarios as reported for the latest period presented i nthe document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
{
    ""Scenario weights %"": {
        ""Upside"": {""Weight"": ""<value>""},
        ""Base"": {""Weight"": ""<value>""},
        ""Downside"": {""Weight"": ""<value>""},
        ""Severe Downside"": {""Weight"": ""<value>""}
    }
}"
NWG,Scenario ECL,"Given the full document content provided, extract the Moderate Upside Scenario, Base Scenario, Moderate Downside Scenario, Extreme Downside Scenario, and Actual Stage 1 and Stage 2 modelled ECL for the following categories: Mortgages, Unsecured Lending, Business Lending � Property, and Business Lending � Non-Property, as reported for the latest period presented in the table . Focus specifically on the table titled ""Measuring uncertainty and ECL sensitivity analysis (audited),"" which contains the detailed breakdown of Stage 1 and Stage 2 modelled ECL under the Base Scenario, Moderate Upside Scenario, Moderate Downside Scenario, Extreme Downside Scenario, and Actual values. Use the following guidelines:

Locate and extract the data directly from the ""Measuring uncertainty and ECL sensitivity analysis (audited)"" table. The table provides the latest period data, so use only that period�s data. For the ""Retail Banking - unsecured"" category, use the total ECL provided (do not break down into subcategories like Cards or Personal Loans and Overdrafts, as the table does not provide this breakdown). For ""Business Lending,"" break down the data into ""Property"" and ""Non-Property"" subcategories as provided (using ""Non-personal - property"" and ""Non-personal - non-property"").
If OCR errors or inconsistencies are detected (e.g., totals not aligning with category sums), adjust values to align with totals or logical consistency, and note adjustments.
Show only on balance sheet numbers (the table does not indicate off balance sheet numbers, so this is assumed to be on balance sheet).
Return the result as a JSON string with the following structure:
{
    ""Mortgages"": {
        ""Moderate Upside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Base Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Moderate Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Extreme Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Actual"": {""Stage 1 and Stage 2 ECL"": ""<value>""}
    },
    ""Unsecured Lending"": {
        ""Moderate Upside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Base Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Moderate Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Extreme Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Actual"": {""Stage 1 and Stage 2 ECL"": ""<value>""}
    },
    ""Business Lending � Property"": {
        ""Moderate Upside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Base Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Moderate Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Extreme Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Actual"": {""Stage 1 and Stage 2 ECL"": ""<value>""}
    },
    ""Business Lending � Non-Property"": {
        ""Moderate Upside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Base Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Moderate Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Extreme Downside Scenario"": {""Stage 1 and Stage 2 ECL"": ""<value>""},
        ""Actual"": {""Stage 1 and Stage 2 ECL"": ""<value>""}
    }
}
Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m).
Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated totals), and validation against totals if applicable.
If the required data is not found, state that the information is unavailable and explain why (e.g., missing section, lack of scenario breakdown)."
NWG,Scenario Weight,"Given the full document content provided, extract the scenario probability weightings (%) for the Moderate Upside Scenario, Base Scenario, Moderate Downside Scenario, and Extreme Downside Scenario as reported in the document. Use the following guidelines:

Search the document for a section or table that provides the scenario probability weightings for the scenarios labeled as ""Moderate Upside Scenario,"" ""Base Scenario,"" ""Moderate Downside Scenario,"" and ""Extreme Downside Scenario"" (as used in the ""Measuring uncertainty and ECL sensitivity analysis (audited)"" table). If the weightings are not found in the document, note that they are unavailable and refer to any previously provided data (e.g., a ""Scenario"" table with weightings for these scenarios).
Return the result as a JSON string with the following structure:
{
    ""Scenario weights %"": {
        ""Moderate Upside Scenario"": {""Weight"": ""<value>""},
        ""Base Scenario"": {""Weight"": ""<value>""},
        ""Moderate Downside Scenario"": {""Weight"": ""<value>""},
        ""Extreme Downside Scenario"": {""Weight"": ""<value>""}
    }
}
Express the weights as percentage strings without the '%' symbol (e.g., ""10"" for 10%).
Include a note after the JSON detailing the data source (e.g., specific table or section) and any adjustments made if applicable. If the weightings are not found in the document, explicitly state this and reference any previously provided data (e.g., a ""Scenario"" table with weightings: Upside 10%, Base 55%, Downside 20%, Severe Downside 15%) that may align with the scenarios after adjusting for terminology differences.
If the required data is not found, state that the information is unavailable and explain why (e.g., missing table, lack of scenario weights)."
LBG,Scenario ECL,"Given the full document content provided , extract the Upside, Base, Downside, Severe Downside, and Probability-weighted ECL provisions for the following categories: UK Mortgages, Credit cards, Other Retail, and Commercial Banking, as reported for the latest period presented in the document. Focus specifically on the table titled ""Total expected credit loss allowance sensitivity to economic assumptions � statutory and underlying basis"", as this table contains the detailed breakdown of Upside, Base, Downside, Severe Downside, and Probability-weighted ECL provisions. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each category (UK Mortgages, Credit cards, Other Retail, Commercial Banking), expressed in �m.
2. Locate and extract the data  from the table titled ""Total expected credit loss allowance sensitivity to economic assumptions � statutory and underlying basis"" . Use the latest period presented,""
3. If OCR errors or inconsistencies are detected (e.g., totals not aligning with category sums), adjust values to align with totals or logical consistency, and note adjustments.
4. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers.
5. Return the result as a JSON string with the following structure:
   {
       ""UK Mortgages"": {
           ""Upside"": {""ECL"": ""<value>""},
           ""Base"": {""ECL"": ""<value>""},
           ""Downside"": {""ECL"": ""<value>""},
           ""Severe Downside"": {""ECL"": ""<value>""},
           ""Probability-weighted"": {""ECL"": ""<value>""}
       },
       ""Credit cards"": {
           ""Upside"": {""ECL"": ""<value>""},
           ""Base"": {""ECL"": ""<value>""},
           ""Downside"": {""ECL"": ""<value>""},
           ""Severe Downside"": {""ECL"": ""<value>""},
           ""Probability-weighted"": {""ECL"": ""<value>""}
       },
       ""Other Retail"": {
           ""Upside"": {""ECL"": ""<value>""},
           ""Base"": {""ECL"": ""<value>""},
           ""Downside"": {""ECL"": ""<value>""},
           ""Severe Downside"": {""ECL"": ""<value>""},
           ""Probability-weighted"": {""ECL"": ""<value>""}
       },
       ""Commercial Banking"": {
           ""Upside"": {""ECL"": ""<value>""},
           ""Base"": {""ECL"": ""<value>""},
           ""Downside"": {""ECL"": ""<value>""},
           ""Severe Downside"": {""ECL"": ""<value>""},
           ""Probability-weighted"": {""ECL"": ""<value>""}
       },
       ""Other"": {
           ""Upside"": {""ECL"": ""<value>""},
           ""Base"": {""ECL"": ""<value>""},
           ""Downside"": {""ECL"": ""<value>""},
           ""Severe Downside"": {""ECL"": ""<value>""},
           ""Probability-weighted"": {""ECL"": ""<value>""}
       },
   }

6. Express monetary values in �m (millions) as strings without commas (e.g., ""1064"" for �1,064m).
7. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated totals), and validation against totals if applicable.
8. If the required data is not found, state that the information is unavailable and explain why (e.g., missing section, lack of scenario breakdown)."
LBG,Scenario Weight,"Given the full document content provided, extract the scenario probability weightings (%) for the **Upside**, **Base**, **Downside**, and **Severe Downside** scenarios as reported in the document. Use the following guidelines:

1. Search the document for a section or table that provides the scenario probability weightings, focusing on the ""Risk management"" section . If the weightings are not found in the document, note that they are unavailable and refer to any previously provided data (e.g., a ""Scenario"" table with weightings for these scenarios).
2. Return the result as a JSON string with the following structure:

   {
       ""Scenario weights %"": {
           ""Upside"": {""Weight"": ""<value>""},
           ""Base"": {""Weight"": ""<value>""},
           ""Downside"": {""Weight"": ""<value>""},
           ""Severe Downside"": {""Weight"": ""<value>""}
       }
   }
Express the weights as percentage strings without the '%' symbol (e.g., ""10"" for 10%).
Include a note after the JSON detailing the data source (e.g., specific table or section) and any adjustments made if applicable. If the weightings are not found in the document, explicitly state this and reference any previously provided data (e.g., a ""Scenario"" table with weightings: Upside 10%, Base 55%, Downside 20%, Severe Downside 15%) that may align with the scenarios after adjusting for terminology differences.
If the required data is not found, state that the information is unavailable and explain why (e.g., missing table, lack of scenario weights)."
Principality,IFRS9 Data by Stage,"Given the full document content provided, extract the Gross loan balance,Loss allowance,by stage as well as total. Use the following guidelines:''is the ratio of Loss allowance to Gross loan balance (expressed as a percentage) for each stage and category. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.  Focus on sections titled:  "" Provision for impairment losses"" For Stage 2, use the total values (e.g., 'Stage 2 total' or sum of subcategories like up to date, 1-30 DPD, >30 DPD) unless otherwise specified. If subcategories are present, sum them for Gross loan balance and Loss allowance and recalculate  if table percentages are inconsistent.  Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").  Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.  If you don't know the answer, just say that you don�t know, don�t try to make up an answer.  Extract data for the following portfolios: Group,,,,. Output the result as a JSON string with the following structure :
   {
     'Group': {
       'Stage 1': {'Loss allowance': '<value>', 'Gross loan balance': '<value>', 'Coverage': '<value>'},
       'Stage 2': {'Loss allowance': '<value>', 'Gross loan balance': '<value>', 'Coverage': '<value>'},
       'Stage 3': {'Loss allowance': '<value>', 'Gross loan balance': '<value>', 'Coverage': '<value>'}
     }
   } 
"
Principality,Arrears Rates,"Given the full document content provided, extract the payment due status for the following categories:Group, as reported for the latest period presented in the document.Focus specifically on tables that  ""provides further information on the first and second charge retail loans secured on residential property by payment due status:"" within the document, as these sections contain the detailed breakdown of Gross exposure by payment due status. Use the following guidelines:
1. Locate and extract the data directly from tables that ""provides further information on the first and second charge retail loans secured on residential property by payment due status: "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. 
2. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
3. Return the result as a JSON string with the following structure:
   {
     ""Group"": {
       ""Current"": {""Balance"": ""<value>""},
       ""Past due up to 3 months"": {""Balance"": ""<value>""},
       ""Past due 3 months up to 6 months"": {""Balance"": ""<value>""},
       ""Past due 6 months up to 12 months"":{""Balance"": ""<value>""},
       ""Past due over 12 months "": {""Balance"": ""<value>""},
       ""Possessions "": {""Balance"": ""<value>""},
     }
   }
4. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
5. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
6. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Coventry,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (Provisions), Balance (Gross Balances), and Coverage (Provisions as a % of total balance) for the following categories: Group, as reported for the latest period presented in the document. Focus specifically on tables labeled ""Movements in gross exposure and ECL provision"" within the document, as these tables contain the detailed breakdown of Provisions and Gross Balances by stage and category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each stage (1, 2, 3) and category (Group), expressed in �m.
2. Balance refers to the gross balances for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables titled""""Movements in gross exposure and ECL provision"". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. For Stage 2, use the total values (e.g., ""Stage 2 total"" or sum of subcategories like up to date, Not past due, Past due) unless otherwise specified. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Return the result as a JSON string with the following structure:
   {
     ""Group"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
   }
7. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
8. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
9. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Leeds,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (Impairment loss provision), Balance (Gross exposure ) and Coverage (Provision 
coverage) for the following categories: Retail mortgages and Loan commitments, as reported for the latest period presented in the document. Focus specifically on tables that  ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions"" within the document, as these tables contain the detailed breakdown of Impairment loss provision, Gross exposure and Provision coverage by stage and category. Use the following guidelines:

1. ECL refers to Impairment loss provision on credit exposures for each stage (1, 2, 3) and category (Retail mortgages and Loan commitments), expressed in �m.
2. Balance refers to the Gross exposure for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables that ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. For Stage 2, use the total values (e.g., ""Stage 2 total"" or sum of subcategories like Stage 2 and <30 days past due, Stage 2 and 30+ days past due ) unless otherwise specified.  For Stage 3, use the total values (e.g., ""Stage 3 total"" or sum of subcategories like Stage 3 and <90 days past due, Stage 3 and 90+ days past due ) unless otherwise specified If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Return the result as a JSON string with the following structure:
   {
     ""Retail mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Loan commitments"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
   }
8. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
9. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
10. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Leeds,Arrears Rates,"Given the full document content provided, extract the Stage 1, Stage 2 and Stage 3 days past due for the following categories:Retail mortgages and Loan commitments, as reported for the latest period presented in the document.Focus specifically on tables that  ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions"" within the document, as these tables contain the detailed breakdown of Impairment loss provision, Gross exposure and Provision coverage by stage and category. Use the following guidelines:

1. ECL refers to Impairment loss provision on credit exposures for each stage (1, 2, 3) and category (Retail mortgages and Loan commitments), expressed in �m.
2. Balance refers to the Gross exposure for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables that ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. 
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Return the result as a JSON string with the following structure:
   {
     ""Retail mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2 and <30 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2 and 30+ days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3 and <90 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3 and 90+ days past due "": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Loan commitments"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2 and <30 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2 and 30+ days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3 and <90 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3 and 90+ days past due "": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
   }
4. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
5. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
6. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Nationwide,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (Provisions), Balance (Gross Balances), and Coverage (Provisions as a % of total balance) for the following categories: Owner-occupied, buy-to-let and legacy, Overdrawn current accounts, Personal Loans and Credit Cards, as reported for the latest period presented in the document. Focus specifically on tables labeled ""Consumer banking product and staging analysis""and ""Residential mortgages staging analysis"" within the document, as these tables contain the detailed breakdown of Provisions, Gross Balances and Provisions as a % of total balance by stage and category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each stage (1, 2, 3) and category (Owner-occupied, buy-to-let and legacy, Overdrawn current accounts, Personal Loans and Credit Cards), expressed in �m.
2. Balance refers to the gross balances for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables titled""Consumer banking product and staging analysis""and ""Residential mortgages staging analysis"". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. For Stage 2, use the total values (e.g., ""Stage 2 total"" or sum of subcategories like up to date, 1-30 DPD, >30 DPD) unless otherwise specified. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Assume ""Unsecured"" is split into Overdrawn current accounts, Personal Loans and Credit Cards as separate rowa within the table, and validate totals against provided aggregates where possible.
7. Return the result as a JSON string with the following structure:
   {
     ""Owner-occupied"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Buy-to-let and legacy"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Overdrawn current accounts"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Personal loans"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
     ""Credit cards"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
   }
8. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
9. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
10. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Santander,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (Provisions), Balance (Exposures), and Coverage  (Coverage Ratio) for the following categories: Mortgages,EDB - Credit Cards, EDB - Other, Consumer Finance, Corporate & Commercial Banking and Corporate Centre , as reported for the latest period presented in the document. Focus specifically on tables labeled ""Credit quality"" within the document, as these tables contain the detailed breakdown of ECL, Exposure and Coverage Ratio by stage and category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each stage (1, 2, 3) and category (Mortgages,EDB - Credit Cards, EDB - Other, Consumer Finance, Corporate & Commercial Banking and Corporate Centre), expressed in �m.
2. Balance refers to the Exposure for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables titled""Credit quality"""". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. ""Retail & Business Banking"" is split into Mortgages,EDB - Credit Cards, EDB - Other as separate rows within the table. validate totals against provided aggregates where possible.
7. If both on balance sheet and off balance sheet numvbers are present, show only the on balance shete numbers. 
8. Return the result as a JSON string with the following structure:
   {
     ""Mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""EDB - Credit Cards"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""EDB - Other"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     "" Consumer Finance"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
     "" Corporate & Commercial Banking "": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
     "" Corporate Centre "": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Skipton,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (Loss allowance), Balance (Gross carrying amount) for the following categories: Residential mortgages, Other lending and Commercial mortgages, as reported for the latest period presented in the document. Focus specifically on tables that provide ""information on movements in the gross carrying amount"" and ""information on movements in the impairment loss allowance"" within the document, as these tables contain the detailed breakdown of Loss allowance and Gross carrying amount by stage and category. Use the following guidelines:

1. ECL refers to Loss allowance on credit exposures for each stage (1, 2, 3) and category (Residential mortgages, Other lending and Commercial mortgages), expressed in �m.
2. Balance refers to the Gross carrying amount for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables that provide ""information on movements in the gross carrying amount"" and ""information on movements in the impairment loss allowance"" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. If both Group and Society numbers are presented, provide results for the Group. 
7. Return the result as a JSON string with the following structure:
   {
     ""Residential mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Commercial mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Other lending"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
   }
8. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
9. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
10. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Skipton,Arrears Rates,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 days past due for the following categories: Residential mortgages, Other lending and Commercial mortgages, as reported for the latest period presented in the document. Focus specifically on tables that provide ""loans and advances by payment due status"" within the document, as these tables contain the detailed breakdown of days past due by stage and category. Use the following guidelines:

1. Locate and extract the data directly from tables that provide ""loans and advances by payment due status"" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.
2. If both Group and Society numbers are presented, provide results for the Group. 
3. Return the result as a JSON string with the following structure:
   {
     ""Residential mortgages"": {
       ""Stage 1"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 2"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 3"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" }
     },
     ""Commercial mortgages"": {
       ""Stage 1"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 2"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 3"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" }
     },
     ""Other lending"": {
       ""Stage 1"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 2"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" },
       ""Stage 3"": {""Not past due "": ""<value>"", ""Up to 30 days past due"": ""<value>"", ""31 to 60 days past due"": ""<value>"", ""61 to 90 days past due"": ""<value>"", ""Over 90 days past due"": ""<value>"" }
     },
   }
4. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
5. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
6. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
VMUK,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 Expected Credit Loss (ECL), Balance (gross loans and advances), and Coverage (provision-to-loan ratio) for the following categories: Mortgages, Cards, Loans and Overdrafts, and Business, as reported for the latest period presented in the document. Focus specifically on tables labeled ""Gross loans and advances (1) ECL and coverage"" within the document, as these tables contain the detailed breakdown of ECL, Balance, and Coverage by stage and category. Use the following guidelines:

1. ECL refers to impairment provisions on credit exposures for each stage (1, 2, 3) and category (Mortgages, Cards, Loans and Overdrafts, Business), expressed in �m.
2. Balance refers to the gross loans and advances for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables titled ""Gross loans and advances (1) ECL and coverage."" If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. For Stage 2, use the total values (e.g., ""Stage 2 - total"" or sum of subcategories like 0 DPD, <30 DPD, >30 DPD) unless otherwise specified. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Assume ""Unsecured"" is split into ""Cards"" and ""Loans and Overdrafts"" as separate columns within the table, and validate totals against provided aggregates where possible.
7. Return the result as a JSON string with the following structure:
   {
     ""Mortgages"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Cards"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Loans and Overdrafts"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
     ""Business"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     }
   }
8. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
9. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
10. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Yorkshire,IFRS9 Data by Stage,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 ECL (ECL), Balance (Gross exposure ) and Coverage (Coverage) for the following categories: Retail mortgages and Loan commitments, as reported for the latest period presented in the document. Focus specifically on tables titled  ""Staging and POCI"" within the document, as these tables contain the detailed breakdown of ECL, Gross exposure and Coverage by stage and category. Use the following guidelines:

1. ECL for each stage (1, 2, 3) and category (Retail mortgages and Loan commitments), expressed in �m.
2. Balance refers to the Gross exposure for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables that ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. 
5. Return the result as a JSON string with the following structure:
   {
     ""Group"": {
       ""Stage 1"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 2"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""},
       ""Stage 3"": {""ECL"": ""<value>"", ""Balance"": ""<value>"", ""Coverage"": ""<value>""}
     },
   }
8. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
9. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
10. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Yorkshire,Arrears Rates,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 Balance (Gross exposure ) for the following categories: Group, as reported for the latest period presented in the document. Focus specifically on tables titled  ""Staging and POCI"" within the document, as these tables contain the detailed breakdown of  Gross exposure . Use the following guidelines:

2. Balance refers to the Gross exposure for each stage and category, expressed in �m.
4. Locate and extract the data directly from tables that ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. 
6. Return the result as a JSON string with the following structure:
   {
     ""Group"": {
       ""Stage 1"": {""Balance"": ""<value>""},
       ""Stage 2"": {""Balance"": ""<value>""},
       ""Less than 30 days past due"": {""Balance"": ""<value>""},
       ""More than 30 days past due"": {"" ""Balance"": ""<value>""},
       ""Stage 3"": {"" ""Balance"": ""<value>""},
       ""Less than 30 days past due"": {""Balance"": ""<value>""},
       ""30-90 days past due"": {""Balance"": ""<value>""}'
       ""More than 90 days past due"": {""Balance"": ""<value>""}'
     }
   }
4. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
5. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
6. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Nottingham,IFRS9 Data by Stage,"Given the full document content provided, extract the Gross carrying amount,Expected credit loss allowance,Coverage by stage as well as total. Use the following guidelines:'Coverage 'is the ratio of Expected credit loss allowance to Gross carrying amount (expressed as a percentage) for each stage and category. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.  Focus on sections titled:  ""Provision for impairment losses on loans
and advances to members"" For Stage 2, use the total values (e.g., 'Stage 2 total' or sum of subcategories like up to date, 1-30 DPD, >30 DPD) unless otherwise specified. If subcategories are present, sum them for Gross carrying amount and Expected credit loss allowance and recalculate Coverage  if table percentages are inconsistent.  Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").  Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.  If you don't know the answer, just say that you don�t know, don�t try to make up an answer.  Extract data for the following portfolios: Group and Society,,,,. Output the result as a JSON string with the following structure :
   {
     'Group and Society': {
       'Stage 1': {'Expected credit loss allowance': '<value>', 'Gross carrying amount': '<value>', 'Coverage': '<value>'},
       'Stage 2': {'Expected credit loss allowance': '<value>', 'Gross carrying amount': '<value>', 'Coverage': '<value>'},
       'Stage 3': {'Expected credit loss allowance': '<value>', 'Gross carrying amount': '<value>', 'Coverage': '<value>'}
     }
   } 
"
Nottingham,Arrears Rates,"Given the full document content provided, extract the Stage 1, Stage 2 and Stage 3 days past due for the following categories:Group and Society, as reported for the latest period presented in the document.Focus specifically on tables that  ""provides information on retail gross loans and ECL stages split by the number of DPD:"" within the document, as these tables contain the detailed breakdown of Expected Credit Loss and Gross loans by stage and category. Use the following guidelines:

1. ECL refers to Expected Credit Loss on credit exposures for each stage (1, 2, 3) and category (Group and Society), expressed in �m.
2. Balance refers to the Gross loans for each stage and category, expressed in �m.
3. Coverage is the ratio of ECL to Balance (expressed as a percentage) for each stage and category.
4. Locate and extract the data directly from tables that ""provides information on retail gross loans and ECL stages split by the number of DPD: "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. 
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. Return the result as a JSON string with the following structure:
   {
     ""Group and Society"": {
       ""Stage 1 and < 30 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Stage 2 and <30 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Stage 2 and > 30 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Stage 3 and <90 days past due"": {""ECL"": ""<value>"", ""Balance"": ""<value>""},
       ""Stage 3 and > 90 days past due "": {""ECL"": ""<value>"", ""Balance"": ""<value>""}
     }
   }
4. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
5. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
6. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Nottingham,Scenario ECL,"Given the full document content provided, extract the  IFRS 9 weighted average, Base , Downside  , Severe Downside and Upside  scenario and reported ECL provision  for the following categories: Group and Society, as reported for the latest period presented in the document. Focus specifically on sections titled ""the impact of applying 100% of a particular scenario on the 31st December 2024 reported ECL position output is shown below "" within the document, as these sections contain the detailed breakdown of FRS 9 weighted average, Base , Downside  , Severe Downside and Upside  scenario and reported ECL provision. Use the following guidelines:

1. ECL refers to ECL provisions on credit exposures for each category (Group and Society), expressed in �m.
4. Locate and extract the data directly from sections titled ""the impact of applying 100% of a particular scenario "". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.

7. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers. 
8. Return the result as a JSON string with the following structure:
   {
       ""Group and Society "": {
       ""IFRS 9 weighted average"": {""ECL"": ""<value>""},
       ""Base"": {""ECL"": ""<value>""},
       ""Downside "": {""ECL"": ""<value>""},
       ""Severe Downside"": {""ECL"": ""<value>""},
       ""Upside"": {""ECL"": ""<value>""}
     }
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Nottingham,Scenario Weight,"Given the full document content provided, extract the Scenario probability weighting (%)  for the  Upside  , Base  , Downside and Severe Downside   as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       ""Scenario weights %"": {
       ""Upside "": {""Weight"": ""<value>""},
       ""Base"": {""Weight"": ""<value>""}
       ""Downside"": {""Weight"": ""<value>""}
       ""Severe Downside"": {""Weight"": ""<value>""}
     }
   }"
Leeds,Scenario ECL,"Given the full document content provided, extract the (Decrease)/increase in impairment loss provisions if scenarios are weighted 100%: for the follwoing scenarios: Central scenario, Growth scenario , Downside scenario , Alternative Downside scenario  for the following categories: Group, as reported for the latest period presented in the document. Focus specifically on sections titled ""(Decrease)/increase in impairment loss provisions if scenarios are weighted 100%:"" within the document, as these sections contain the detailed breakdown of Central scenario, Growth scenario , Downside scenario , Alternative Downside scenario  by category. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each category (Reported ECL, Central scenario, Growth scenario , Downside scenario , Alternative Downside scenario), expressed in �m.
4. Locate and extract the data directly from sections titled ""(Decrease)/increase in impairment loss provisions if scenarios are weighted 100%"". If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. If subcategories are present, sum them for Balance and ECL, and recalculate Coverage if table percentages are inconsistent.
5. If OCR errors or inconsistencies are detected (e.g., Coverage percentages not matching ECL/Balance, unclear ECL values), prioritize calculated Coverage (ECL/Balance) over table-provided percentages, adjusting ECL or Balance where necessary to align with totals or logical consistency, and note adjustments.
6. If cannot find the data by category, show the aggregate numbers. validate totals against provided aggregates where possible.
7. If both on balance sheet and off balance sheet numbers are present, show only the on balance sheet numbers.
8. Return the result as a JSON string with the following structure:
   {
       ""Group"": {
       ""Reported ECL "": {""ECL"": ""<value>""},
       ""Central scenario "": {""100% Impact"": ""<value>""},
       ""Growth scenario "": {""100% Impact"": ""<value>""},
       ""Downside scenario "": {""100% Impact"": ""<value>""},
       ""Alternative Downside scenario "": {""100% Impact"": ""<value>""}
     }
   }
9. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
10. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
11. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Leeds,Scenario Weight,"Given the full document content provided, extract the scenario weight for the  Central scenario, Upside scenario , Downside scenario , Alternative Downside scenario  as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       ""Scenario weights %"": {
       ""Central scenario "": {""Weight"": ""<value>""},
       ""Growth scenario"": {""Weight"": ""<value>""}
       ""Downside scenario"": {""Weight"": ""<value>""}
       ""Alternative Downside  scenario"": {""Weight"": ""<value>""}
     }
   }"
Coventry,Scenario ECL,"Given the full document content provided, extract the Weighted average ECL, Base scenario ECL, Upside scenario ECL, Downside scenario ECL, and Severe downside scenario ECL (Provisions) for the category **Retail analysis** (representing the total mortgage portfolio ECL), as reported for the latest period (31 December 2024) presented in the document. Focus specifically on tables within the section titled **""14. Impairment on loans and advances to customers""**, particularly the table on **page 156 under ""31 December 2024 Scenarios"" showing ""Total ECL (�m)"" by scenario** OR the table on **page 155 showing ""IFRS 9 provision �m"" for 31 December 2024**. Use the following guidelines:

1. ECL refers to provisions on credit exposures for each scenario category (Weighted average, Base, Upside, Downside, Severe downside), expressed in �m.
2. Locate and extract the data directly from the specified tables. The table on page 156 (""31 December 2024 Scenarios"") is the preferred source for ""Total ECL (�m)"". If this specific breakdown is not found, the table on page 155 (""IFRS 9 provision �m"" for 31 December 2024 scenarios) can be used.
3. If OCR errors or inconsistencies are detected (e.g., unclear ECL values), prioritize values that align with totals or logical consistency if possible, and note adjustments.
4. As Coventry Building Society's primary business is retail mortgages and savings, ""Retail analysis"" will represent the total portfolio ECLs. ""Wholesale analysis"" is not expected to be detailed in the same manner for scenario ECLs.
5. If both on balance sheet and off balance sheet numbers are present for these specific scenario ECLs, show only the on balance sheet numbers. (Note: For Coventry, the ECL tables referenced are typically aggregated).
6. Return the result as a JSON string with the following structure. If ""Wholesale analysis"" data is not found for scenario ECLs, provide an empty object for it.
   {
       ""Wholesale analysis"": {},
       ""Retail analysis"": {
           ""Weighted average ECL"": {""ECL"": ""<value>""},
           ""Base scenario ECL"": {""ECL"": ""<value>""},
           ""Upside scenario ECL"": {""ECL"": ""<value>""},
           ""Downside scenario ECL"": {""ECL"": ""<value>""},
           ""Severe downside scenario ECL"": {""ECL"": ""<value>""}
       }
   }
7. Express monetary values in �m (millions) as strings without commas (e.g., ""24.3"" for �24.3m).
8. Include a note after the JSON detailing the data source (e.g., specific table and page number), any adjustments made due to OCR errors or inconsistencies, and state that ""Retail analysis"" represents the total portfolio for Coventry Building Society as per the available scenario ECL breakdown.
9. If you don't know the answer for a specific value, use ""null"" or state that the specific breakdown is not available. Do not try to make up an answer."
Coventry,Scenario Weight,"""Given the full document content provided, extract the scenario weight for the  Central scenario, Upside scenario , Downside scenario , Alternative Downside scenario  as reported for the latest period presented in the document. Use the following guidelines:
1. Return the result as a JSON string with the following structure:
   {
       """"Scenario weights %"""": {

       """"Central """": {""""Weight"""": """"<value>""""},
       """"Upside """": {""""Weight"""": """"<value>""""}
       """"Downside """": {""""Weight"""": """"<value>""""}
       """"Alternative Downside  """": {""""Weight"""": """"<value>""""}
     }
   }"""
Yorkshire,Arrears Rates,"Given the full document content provided, extract the Stage 1, Stage 2, and Stage 3 Balance (Gross exposure ) for the following categories: Group, as reported for the latest period presented in the document. Focus specifically on tables titled  ""Staging and POCI"" within the document, as these tables contain the detailed breakdown of  Gross exposure . Use the following guidelines:

2. Balance refers to the Gross exposure for each stage and category, expressed in �m.
4. Locate and extract the data directly from tables that ""summarises the Group�s retail mortgage balances, loan commitments and associated impairment loss provisions "" within the document. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data. 
6. Return the result as a JSON string with the following structure:
   {
     ""Group"": {
       ""Stage 1"": {""Balance"": ""<value>""},
       ""Stage 2"": {""Balance"": ""<value>""},
       ""Less than 30 days past due"": {""Balance"": ""<value>""},
       ""More than 30 days past due"": {"" ""Balance"": ""<value>""},
       ""Stage 3"": {"" ""Balance"": ""<value>""},
       ""Less than 30 days past due"": {""Balance"": ""<value>""},
       ""30-90 days past due"": {""Balance"": ""<value>""}'
       ""More than 90 days past due"": {""Balance"": ""<value>""}'
     }
   }
4. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").
5. Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.
6. If you don't know the answer, just say that you don�t know, don�t try to make up an answer."
Yorkshire,Scenario Weight,"Given the full document content provided, extract the scenario probability weightings (%) for the Upside Scenario, Core Scenario,  Downside Scenario, and Severe Downside Scenario as reported for the latest period in the document. Use the following guidelines:

1. Search the document for a section or table that provides the scenario probability weightings for the scenarios labeled as ""Upside ,"" ""Core,"" ""Downside,"" and ""Severe Downside "" . This should be in the table that is found under the following text ""For completeness they have been included as a uniform adjustment across each scenario"". If the weightings are not found in the document, note that they are unavailable and refer to any previously provided data (e.g., a ""Scenario"" table with weightings for these scenarios).
Return the result as a JSON string with the following structure:
{
    ""Weighting %"": {
        ""Upside"": {""Weight"": ""<value>""},
        ""Core"": {""Weight"": ""<value>""},
        ""Downside"": {""Weight"": ""<value>""},
        ""Severe Downside"": {""Weight"": ""<value>""}
    }
}
Express the weights as percentage strings without the '%' symbol (e.g., ""10"" for 10%).
Include a note after the JSON detailing the data source (e.g., specific table or section) and any adjustments made if applicable. If the weightings are not found in the document, explicitly state this and reference any previously provided data (e.g., a ""Scenario"" table with weightings: Upside 10%, Base 55%, Downside 20%, Severe Downside 15%) that may align with the scenarios after adjusting for terminology differences.
If the required data is not found, state that the information is unavailable and explain why (e.g., missing table, lack of scenario weights)."
Klarna,IFRS9 Data by Stage,"Given the full document content provided, extract the Gross Exposures,Allowance,Coverageby stage as well as total. Use the following guidelines:'Coverage'is the ratio of Allowance to Gross Exposures (expressed as a percentage) for each stage and category. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.  Focus on sections titled:  "" Note 20, Loan to the public. Group Level."" For Stage 2, use the total values (e.g., 'Stage 2 total' or sum of subcategories like up to date, 1-30 DPD, >30 DPD) unless otherwise specified. If subcategories are present, sum them for Gross Exposures and Allowance and recalculate Coverage if table percentages are inconsistent.  Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").  Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.  If you don't know the answer, just say that you don�t know, don�t try to make up an answer.  Extract data for the following portfolios: Group. Output the result as a JSON string with the following structure :
   {
     'Group': {
       'Stage 1': {'Allowance': '<value>', 'Gross Exposures': '<value>', 'Coverage': '<value>'},
       'Stage 2': {'Allowance': '<value>', 'Gross Exposures': '<value>', 'Coverage': '<value>'},
       'Stage 3': {'Allowance': '<value>', 'Gross Exposures': '<value>', 'Coverage': '<value>'}
     }
   } 
"
Revolut,IFRS9 Data by Stage,"Given the full document content provided, extract the Gross carrying amount,ECL,ECL Coverage % by stage as well as total. Use the following guidelines:'ECL Coverage %'is the ratio of ECL to Gross carrying amount (expressed as a percentage) for each stage and category. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.  Focus on sections titled:  "" Note 31.1 ""Credit Risk"" (specifically in the ""Credit quality analysis"" tables)"" For Stage 2, use the total values (e.g., 'Stage 2 total' or sum of subcategories like up to date, 1-30 DPD, >30 DPD) unless otherwise specified. If subcategories are present, sum them for Gross carrying amount and ECL and recalculate ECL Coverage % if table percentages are inconsistent.  Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").  Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.  If you don't know the answer, just say that you don�t know, don�t try to make up an answer.  Extract data for the following portfolios: Treasury investments,Loans (including BNPL),Credit Cards. Output the result as a JSON string with the following structure :
   {
     'Treasury investments': {
       'Stage 1': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 2': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 3': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'}
     },
     'Loans (including BNPL)': {
       'Stage 1': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 2': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 3': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'}
     },
     'Credit Cards': {
       'Stage 1': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 2': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 3': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'}
     },
   } "
Revolut,Scenario ECL,"Given the full document content provided, extract the Baseline,Optimistic,Pessimistic, and reported provisions.  Use the following guidelines: If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.  Focus on sections titled:  ""Sensitivity analysis towards macroeconomic scenarios"" 
 Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").  Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.  If you don't know the answer, just say that you don�t know, don�t try to make up an answer.  Extract data for the following portfolios: Treasury investments,Loans (including BNPL),Credit Cards. Return the result as a JSON string with the following structure:
   {
       ""Treasury investments "": {
       ""100% Baseline"": {""ECL"": ""<value>""},
       ""100% Optimistic "": {""ECL"": ""<value>""}
       ""100% Pessimistic"": {""ECL"": ""<value>""}
       ""Current weights"": {""ECL"": ""<value>""}
     },
       ""Loans (including BNPL)"": {
       ""100% Baseline"": {""ECL"": ""<value>""},
       ""100% Optimistic "": {""ECL"": ""<value>""}
       ""100% Pessimistic"": {""ECL"": ""<value>""}
       ""Current weights"": {""ECL"": ""<value>""}
     },
       ""Credit Cards "": {
       ""100% Baseline"": {""ECL"": ""<value>""},
       ""100% Optimistic "": {""ECL"": ""<value>""}
       ""100% Pessimistic"": {""ECL"": ""<value>""}
       ""Current weights"": {""ECL"": ""<value>""}
     }
   }"
Revolut,Scenario Weight,"Given the full document content provided, extract the Scenario weights for the Baseline,Optimistic and Pessimistic scenario. Use the following guidelines: If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.  Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").  Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.  If you don't know the answer, just say that you don�t know, don�t try to make up an answer. Output the result as a JSON string with the following structure:
   {
       ""Scenario weights %"": {
       ""Baseline "": {""Weight"": ""<value>""},
       ""Optimistic"": {""Weight"": ""<value>""}
       ""Pessimistic"": {""Weight"": ""<value>""}
     }
   }"
Monzo,IFRS9 Data by Stage,"Given the full document content provided, extract the Gross carrying amount,Impairment allowance,Coverage by stage as well as total. Use the following guidelines:ECL is defined as the Impairment allowance ,Balance is defined as Gross carrying amount,Coverageis the ratio of ECL to Balance (expressed as a percentage) for each stage and category. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.  Focus on sections titled:  "" Analysis of overdrafts and loans by stage"" For Stage 2, use the total values (e.g., 'Stage 2 total' or sum of subcategories like up to date, 1-30 DPD, >30 DPD) unless otherwise specified. If subcategories are present, sum them for Gross carrying amount and Impairment allowance and recalculate Coverage if table percentages are inconsistent.  If overdrafts, loans or flex impairment allowance includes values for undrawn elements, add the undrawn element to the impairment by stage for each porduct and each stage and recalculate coverage. Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").  Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.  If you don't know the answer, just say that you don�t know, don�t try to make up an answer.  Extract data for the following portfolios: Overdrafts�,Loans,Flex. Output the result as a JSON string with the following structure :
   {
     'Overdrafts': {
       'Stage 1': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 2': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 3': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'}
     },
     'Loans': {
       'Stage 1': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 2': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 3': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'}
     },
     'Flex': {
       'Stage 1': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 2': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 3': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'}
     },
   } 
"
Monzo,Scenario ECL,"Given the full document content provided, extract the Upside,Base,Downside 1,Downside 2 and reported provisions.  Use the following guidelines: If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.  Focus on sections titled: "" Sensitivity tables show the modelled ECL (including in-model adjustments but excluding post- model adjustments)""
 Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").  Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.  If you don't know the answer, just say that you don�t know, don�t try to make up an answer.  Extract data for the following portfolios: Overdrafts�,Loans,Flex. Return the result as a JSON string with the following structure:
   {
       ""Overdrafts "": {
       ""Upside "": {""ECL"": ""<value>""},
       ""Base"": {""ECL"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>""}
       "" Downside 2"": {""ECL"": ""<value>""}
       ""Reported provisions"": {""ECL"": ""<value>""}
     },
       ""Loans"": {
       ""Upside"": {""ECL"": ""<value>""},
       ""Base"": {""ECL"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>""}
       ""Reported provisions"": {""ECL"": ""<value>""}
     },
       ""Flex "": {
       ""Upside"": {""ECL"": ""<value>""},
       ""Base"": {""ECL"": ""<value>""},
       ""Downside 1"": {""ECL"": ""<value>""}
       ""Downside 2"": {""ECL"": ""<value>""}
       ""Reported provisions"": {""ECL"": ""<value>""}
     }
   }"
Monzo,Scenario Weight,"Given the full document content provided, extract the Scenario weight for the Upside,Base,Downside 1and Downside 2. Use the following guidelines: If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.  Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").  Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.  If you don't know the answer, just say that you don�t know, don�t try to make up an answer. Output the result as a JSON string with the following structure:
   {
       ""Scenario weights %"": {
       ""Upside "": {""Weight"": ""<value>""},
       ""Base"": {""Weight"": ""<value>""}
       ""Downside 1"": {""Weight"": ""<value>""}
       ""Downside 2  "": {""Weight"": ""<value>""}
     }
   }"
Starling,IFRS9 Data by Stage,"Given the full document content provided, extract the Gross carrying value,Impairment provision,Coverageby stage as well as total. Use the following guidelines:ECL is defined as the Impairment provision ,Balance is defined as Exposure after Gaurantee, Coverageis the ratio of ECL to Balance (expressed as a percentage) for each stage and category. If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.  Focus on sections titled:  "" Staging profile of customer lending (audited)"" For Stage 2, use the total values (e.g., 'Stage 2 total' or sum of subcategories like up to date, 1-30 DPD, >30 DPD) unless otherwise specified. If subcategories are present, sum them for Balance and ECL and recalculate Coverage if table percentages are inconsistent.  Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").  Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.  If you don't know the answer, just say that you don�t know, don�t try to make up an answer.  Extract data for the following portfolios: Mortgage,SME ,Retail and Undrawn. Output the result as a JSON string with the following structure :
   {
     'Mortgage': {
       'Stage 1': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 2': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 3': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'}
     },
     'SME ': {
       'Stage 1': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 2': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 3': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'}
     },
     'Retail ': {
       'Stage 1': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 2': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 3': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'}
     },
     'Undrawn ': {
       'Stage 1': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 2': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'},
       'Stage 3': {'ECL': '<value>', 'Balance': '<value>', 'Coverage': '<value>'}
     }
   } 
"
Starling,Scenario ECL,"Given the full document content provided, extract the Upside,Base,Downside,Severe Downside and Weighted provisions.  Use the following guidelines: If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.  Focus on sections titled: ""ECL Sensitivities""
 Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").  Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.  If you don't know the answer, just say that you don�t know, don�t try to make up an answer.  Extract data for the following portfolios: Mortgage ,SME ,Retail ,. Return the result as a JSON string with the following structure:
   {
       ""Mortgage  "": {
       ""Upside "": {""ECL"": ""<value>""},
       ""Base"": {""ECL"": ""<value>""},
       ""Downside"": {""ECL"": ""<value>""}
       ""Severe Downside"": {""ECL"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>""}
     },
       ""SME "": {
       ""Upside"": {""ECL"": ""<value>""},
       ""Base"": {""ECL"": ""<value>""},
       ""Downside"": {""ECL"": ""<value>""}
       ""Severe Downside"": {""ECL"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>""}
     },
       ""Retail  "": {
       ""Upside"": {""ECL"": ""<value>""},
       ""Base"": {""ECL"": ""<value>""},
       ""Downside"": {""ECL"": ""<value>""}
       ""Severe Downside"": {""ECL"": ""<value>""}
       ""Weighted"": {""ECL"": ""<value>""}
     }
   }"
Starling,Scenario Weight,"Given the full document content provided, extract the Scenario weight for the Upside,Base,Downside and Severe Downside. Use the following guidelines: If multiple periods are present, identify the latest period by the most recent date (e.g., ""As at [date]"") or context (e.g., ""current period"" vs. ""prior period""), and use only that period�s data.  Express monetary values in �m (millions) as strings without commas (e.g., ""52370"" for �52,370m), and Coverage as a percentage string with two decimal places (e.g., ""0.84%"").  Include a note after the JSON detailing the data source (e.g., specific table), any adjustments made due to OCR errors or inconsistencies (e.g., recalculated Coverage, adjusted ECL), and validation against totals if applicable.  If you don't know the answer, just say that you don�t know, don�t try to make up an answer. Output the result as a JSON string with the following structure:
   {
       ""Scenario weights %"": {
       ""Upside "": {""Weight"": ""<value>""},
       ""Base"": {""Weight"": ""<value>""}
       ""Downside"": {""Weight"": ""<value>""}
       ""Severe Downside "": {""Weight"": ""<value>""}
     }
   }"

```

# EY_FinSight_V5.py

```py
#!/usr/bin/env python3
"""
Optimized IFRS9 Automation Script

This script processes IFRS9 PDFs, extracts data using a custom LLM and embedding system,
and writes results to Excel files. The code is optimized for performance, efficiency, and clarity.
"""

import os
import json
import re
import shutil
import time
import traceback
from datetime import datetime
from typing import List, Tuple, Optional, Dict, Any

import requests
import pandas as pd
import openpyxl
from dotenv import load_dotenv
import nest_asyncio

import concurrent.futures
from functools import partial

from langchain_community.vectorstores import Chroma
from langchain.schema import Document
from chromadb.api.types import EmbeddingFunction
from llama_index.readers.llama_parse import LlamaParse

# Apply nest_asyncio to allow nested event loops
nest_asyncio.apply()

# =============================================================================
# Configuration and Global Constants
# =============================================================================
ENV_PATH = os.path.join(os.path.dirname(__file__), "ATT27768.env")
load_dotenv(ENV_PATH)

LLAMA_PARSE_API_KEY = os.getenv("LLAMA_PARSE_API_KEY")
if not LLAMA_PARSE_API_KEY:
    raise ValueError("LLAMA_PARSE_API_KEY not found in .env file.")

EYQ_INCUBATOR_KEY = os.getenv("EYQ_INCUBATOR_KEY")
EYQ_BASE_URL = "https://eyq-incubator.europe.fabric.ey.com/eyq/eu/api"
EYQ_CHAT_MODEL = "gpt-4o"
EYQ_EMBEDDING_MODEL = "text-embedding-3-large"
EYQ_API_VERSION = "2023-05-15"
AUTH_HEADER_NAME = "api-key"
USE_BEARER = False

PERSIST_DIRECTORY = './IFRS9/.chroma'
SOURCE_DIRECTORY = os.path.abspath("./IFRS9/reports")
BACKUP_FOLDER = "./IFRS9/backup"
OUTPUT_DIRECTORY = os.path.abspath("./IFRS9/outputs")

# Thresholds
PAGE_THRESHOLD = 150
CHAR_THRESHOLD = 1_000_000  # Maximum characters per chunk

# Ensure output directory exists
os.makedirs(OUTPUT_DIRECTORY, exist_ok=True)


# =============================================================================
# Utility Functions
# =============================================================================
def create_backup_folder(src_folder: str, dest_folder: str) -> None:
    """Create backup folder with retry logic for concurrent access."""
    os.makedirs(dest_folder, exist_ok=True)
    timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')

    # Try multiple timestamps if needed
    for attempt in range(5):  # Try up to 5 different timestamps
        try:
            dest_path = os.path.join(dest_folder, f".chromadb_{timestamp}_{attempt}")
            shutil.copytree(src_folder, dest_path)
            print(f"Backup created at: {dest_path}")
            return
        except FileExistsError:
            print(f"Backup folder {dest_path} already exists, trying another name")
            continue

    # If all attempts fail, continue without backup
    print("Warning: Could not create backup folder, proceeding without backup")


def clean_ocr_text(text: str) -> str:
    replacements = {
        '': '6', '': '5', '': '7', '': '4', '': '3',
        '': '0', '': '9', '': '8', '': '1', '': '2',
        '': '', '': '.', '': '0', '|': ' ', '\n': ' ',
        ' S': ' 5', ' I': ' 1', ' O': ' 0', ' B': ' 8'
    }
    for garbled, replacement in replacements.items():
        text = text.replace(garbled, replacement)
    return text


def standardize_json_structure(prompt_str: str) -> str:
    """Standardize JSON structure in prompts to prevent parsing issues."""
    # Look for JSON structure in the prompt
    json_match = re.search(r'\{.*\}', prompt_str, re.DOTALL)
    if not json_match:
        return prompt_str

    try:
        # Extract JSON template
        json_template = json_match.group(0)

        # Fix common issues
        fixed_template = (json_template
                          .replace('" ', '"')  # Remove extra spaces in keys
                          .replace(' "', '"')
                          )

        # Try to ensure valid JSON by fixing missing commas
        # This is a best-effort approach
        fixed_template = re.sub(r'}\s*{', '},{', fixed_template)
        fixed_template = re.sub(r'"\s*{', '",{', fixed_template)

        # Return the prompt with the fixed template
        return prompt_str.replace(json_template, fixed_template)
    except Exception as e:
        print(f"Warning: Could not standardize JSON in prompt: {e}")
        return prompt_str  # Return original if fixing fails


def split_content_by_chars(content: str, char_threshold: int) -> List[str]:
    if len(content) <= char_threshold:
        return [content]
    chunks = []
    start = 0
    while start < len(content):
        end = min(start + char_threshold, len(content))
        # Try to find a natural break
        break_point = content.rfind('\n', start, end)
        if break_point == -1:
            break_point = content.rfind(' ', start, end)
        if break_point == -1 or break_point <= start:
            break_point = end
        chunks.append(content[start:break_point])
        start = break_point + 1
    return chunks


def flatten_json_to_rows(json_data):
    """Flatten nested JSON into a list of rows for Excel, handling various JSON structures."""
    rows = []

    # Handle string input (possibly incorrectly returned text)
    if isinstance(json_data, str):
        return [{"Category": "Error", "Stage": "N/A", "Field": "Response", "Value": json_data}]

    # Handle flat structures (like Writeoff Policy and ECL Methodology)
    if all(not isinstance(val, dict) for val in json_data.values()):
        for key, value in json_data.items():
            rows.append({
                "Category": "Main",
                "Stage": "N/A",
                "Field": key,
                "Value": str(value)
            })
        return rows

    # Handle single-level nesting
    for category, content in json_data.items():
        if isinstance(content, dict):
            for field, value in content.items():
                if isinstance(value, dict):
                    # Handle double nesting
                    for subfield, subvalue in value.items():
                        rows.append({
                            "Category": category,
                            "Stage": field,
                            "Field": subfield,
                            "Value": str(subvalue)
                        })
                else:
                    # Handle single nesting
                    rows.append({
                        "Category": category,
                        "Stage": "N/A",
                        "Field": field,
                        "Value": str(value)
                    })
        else:
            # Handle direct value
            rows.append({
                "Category": "Summary",
                "Stage": "N/A",
                "Field": category,
                "Value": str(content)
            })

    return rows


def diagnose_json_merge(json_responses: List[dict]) -> None:
    """
    Print diagnostic information about JSON responses to help debug merge issues.
    """
    print(f"\n=== MERGE DIAGNOSTICS ({len(json_responses)} responses) ===")

    if not json_responses:
        print("No responses to merge!")
        return

    for i, resp in enumerate(json_responses):
        print(f"Response #{i + 1}:")
        if not isinstance(resp, dict):
            print(f"  NOT A DICTIONARY: {type(resp)}")
            continue

        print(f"  Top-level keys: {list(resp.keys())}")

        # Count N/A values
        na_count = 0
        total_values = 0

        for category, content in resp.items():
            if isinstance(content, dict):
                for stage, stage_content in content.items():
                    if isinstance(stage_content, dict):
                        for field, value in stage_content.items():
                            total_values += 1
                            if value == "N/A":
                                na_count += 1
                    else:
                        total_values += 1
                        if stage_content == "N/A":
                            na_count += 1
            else:
                total_values += 1
                if content == "N/A":
                    na_count += 1

        print(f"  N/A values: {na_count}/{total_values} ({na_count / total_values * 100:.1f}%)")

    print("=== END DIAGNOSTICS ===\n")


def merge_json_responses(responses: List[dict]) -> dict:
    """
    Merge multiple JSON responses, prioritizing non-N/A values.
    Handles empty lists and None values gracefully.
    """
    if not responses:
        return {}  # Return empty dict if no responses

    # If we only have one response, return it directly
    if len(responses) == 1:
        return responses[0]

    merged = {}

    for response in responses:
        if not isinstance(response, dict):
            continue  # Skip non-dictionary responses

        for category, content in response.items():
            if category not in merged:
                merged[category] = content
            else:
                if isinstance(content, dict):
                    for stage, stage_content in content.items():
                        if stage not in merged[category]:
                            merged[category][stage] = stage_content
                        else:
                            if isinstance(stage_content, dict):
                                for field, value in stage_content.items():
                                    existing_val = merged[category][stage].get(field, "N/A")
                                    # Only replace if we have a non-N/A value and existing is N/A
                                    if existing_val == "N/A" and value != "N/A":
                                        merged[category][stage][field] = value
                            else:
                                existing_val = merged[category].get(stage, "N/A")
                                if existing_val == "N/A" and stage_content != "N/A":
                                    merged[category][stage] = stage_content
                else:
                    existing_val = merged.get(category, "N/A")
                    if existing_val == "N/A" and content != "N/A":
                        merged[category] = content

    return merged


def count_na_values(json_data: dict) -> int:
    return sum(
        1 for cat in json_data.values()
        for stage in cat.values()
        for value in stage.values()
        if value == "N/A"
    )


def all_values_na(json_data):
    """Check if all values in the JSON data are 'N/A'"""
    # Handle flat structures
    if all(not isinstance(val, dict) for val in json_data.values()):
        return all(str(val).strip() == "N/A" for val in json_data.values())

    # Handle nested structures
    for category in json_data:
        if isinstance(json_data[category], dict):
            for stage in json_data[category]:
                if isinstance(json_data[category][stage], dict):
                    for field in json_data[category][stage]:
                        if str(json_data[category][stage][field]).strip() != "N/A":
                            return False
                elif str(json_data[category][stage]).strip() != "N/A":
                    return False
        elif str(json_data[category]).strip() != "N/A":
            return False

    return True


def extract_field_from_prompt(prompt: Any) -> str:
    """Extract the prompt name or field from the JSON string in the prompt."""
    # Handle non-string inputs
    if not isinstance(prompt, str):
        print(f"Warning: prompt is not a string but {type(prompt)}")
        return "unknown"
    # First try to find the prompt type from standard naming patterns
    if "ECL_By_Stage" in prompt:
        return "ECL_By_Stage"
    elif "Management_Adjustments" in prompt:
        return "Management_Adjustments"
    elif "Scenario_Weights" in prompt:
        return "Scenario_Weights"
    elif "Macro_Variables" in prompt:
        return "Macro_Variables"
    elif "Credit_Quality" in prompt:
        return "Credit_Quality"
    elif "Loan_Loss_Rate" in prompt:
        return "Loan_Loss_Rate"
    elif "Staging_Criteria" in prompt:
        return "Staging_Criteria"
    elif "Sensitivity_Analysis" in prompt:
        return "Sensitivity_Analysis"

    # If not found through standard patterns, try JSON parsing as a fallback
    try:
        json_match = re.search(r'\{.*?\}', prompt)
        if json_match:
            json_str = json_match.group(0)
            json_obj = json.loads(json_str.replace('x', '"x"'))
            return list(json_obj.keys())[0]
    except Exception as e:
        pass

    return "unknown"


def write_to_excel(data: List[Dict[str, str]], notes: str, output_file: str) -> None:
    with pd.ExcelWriter(output_file, engine="xlsxwriter") as writer:
        pd.DataFrame(data).to_excel(writer, index=False, sheet_name="IFRS9 Data")
        pd.DataFrame({"Notes": [notes]}).to_excel(writer, index=False, sheet_name="Notes")
    print(f"Data written to {output_file}")


# Combine all outputs in one single file
# Find this function in your EY_FinSight.py file
def combine_excel_outputs(results, output_file):
    """Combine all results into a single Excel workbook with improved sheet naming"""
    workbook = openpyxl.Workbook()
    # Remove default sheet
    if "Sheet" in workbook.sheetnames:
        workbook.remove(workbook["Sheet"])

    print("Creating combined Excel file with standardized sheet names...")

    # Add summary sheet
    summary = workbook.create_sheet("Summary")
    summary.append(["Bank", "Report", "Prompt", "Status", "Timestamp", "File"])

    row = 2

    # Extract year from bank or company name if available
    def extract_year_from_name(name):
        """Extract year from bank, company, or file name."""
        # Look for patterns like FY21, FY22, etc.
        year_match = re.search(r'FY(\d{2})', name)
        if year_match:
            return "20" + year_match.group(1)  # Convert FY21 to 2021

        # Look for patterns like 2021, 2022, etc.
        direct_year_match = re.search(r'20(\d{2})', name)
        if direct_year_match:
            return "20" + direct_year_match.group(1)

        return None

    for bank, bank_data in results.items():
        for company, company_data in bank_data.items():
            # Extract year from company name if available
            year = extract_year_from_name(company)

            for prompt_name, prompt_result in company_data.items():
                summary.append([
                    bank,
                    company,
                    prompt_name,
                    prompt_result["status"],
                    prompt_result["timestamp"],
                    prompt_result.get("file", "N/A")
                ])

                # Create detailed sheet for each successful extraction
                if prompt_result["status"] == "Success" and "data" in prompt_result:
                    # Create shorter sheet name
                    bank_short = bank[:3].upper()  # First 3 letters of bank name

                    # Extract the last part of the prompt name (after the last underscore)
                    prompt_parts = prompt_name.split('_')
                    prompt_short = prompt_parts[-1][:8] if len(prompt_parts) > 1 else prompt_name[:8]

                    # Combine for a short, meaningful sheet name that includes the year if available
                    if year:
                        sheet_name = f"{bank_short}_{prompt_short}_{year}"
                    else:
                        sheet_name = f"{bank_short}_{prompt_short}"

                    # Handle duplicates by adding a number
                    original_name = sheet_name
                    counter = 1
                    while sheet_name in workbook.sheetnames:
                        sheet_name = f"{original_name}_{counter}"[:31]
                        counter += 1

                    detail_sheet = workbook.create_sheet(sheet_name)

                    # Add headers
                    detail_sheet.append(["Category", "Stage", "Field", "Value"])

                    # Add data
                    for item in prompt_result["data"]:
                        detail_sheet.append([
                            item.get("Category", "N/A"),
                            item.get("Stage", "N/A"),
                            item.get("Field", "N/A"),
                            item.get("Value", "N/A")
                        ])

                    # Add notes
                    if "notes" in prompt_result and prompt_result["notes"]:
                        detail_sheet.append([])
                        detail_sheet.append(["Notes", "", "", ""])
                        detail_sheet.append([prompt_result["notes"], "", "", ""])

                row += 1

    # Save the workbook
    try:
        workbook.save(output_file)
        print(f"Combined results saved to {output_file}")
        return True
    except Exception as e:
        print(f"Error saving combined results: {e}")
        return False


# =============================================================================
# Custom Classes
# =============================================================================
class EYQEmbeddings(EmbeddingFunction):
    def __init__(self, model: str, api_key: str, api_base: str, api_version: str,
                 auth_header_name: str = "Authorization", use_bearer: bool = True):
        self.model = model
        self.api_key = api_key
        self.api_base = api_base
        self.api_version = api_version
        self.auth_header_name = auth_header_name
        self.use_bearer = use_bearer
        self.session = requests.Session()

    def __call__(self, inputs: List[str]) -> List[List[float]]:
        headers = {"Content-Type": "application/json",
                   self.auth_header_name: f"Bearer {self.api_key}" if self.use_bearer else self.api_key}
        embeddings = []
        for text in inputs:
            payload = {"model": self.model, "input": text, "api_version": self.api_version}
            endpoint = f"{self.api_base}/openai/deployments/{self.model}/embeddings"
            response = self.session.post(endpoint, headers=headers, json=payload, timeout=30)
            if response.ok:
                data = response.json()
                embeddings.append(data["data"][0]["embedding"])
            else:
                raise Exception(f"Embedding request failed: {response.text}")
        return embeddings

    def embed_documents(self, texts: List[str]) -> List[List[float]]:
        return self.__call__(texts)

    def embed_query(self, text: str) -> List[float]:
        return self.__call__([text])[0]


class EYQChat:
    def __init__(self, deployment_name: str, api_key: str, api_base: str, api_version: str,
                 temperature: float = 0, verbose: bool = False):
        self.deployment_name = deployment_name
        self.api_key = api_key
        self.api_base = api_base
        self.api_version = api_version
        self.temperature = temperature
        self.verbose = verbose
        self.session = requests.Session()

    def __call__(self, messages: List[Dict[str, str]], retries: int = 3, delay: int = 2, **kwargs) -> str:
        headers = {AUTH_HEADER_NAME: self.api_key, "Content-Type": "application/json"}
        payload = {"model": self.deployment_name, "messages": messages, "temperature": self.temperature}
        endpoint = f"{self.api_base}/openai/deployments/{self.deployment_name}/chat/completions"

        # Increase timeout for larger documents
        timeout = kwargs.get('timeout', 60)  # Default to 60 seconds instead of 30

        if self.verbose:
            print(f"Sending request to {endpoint} with headers: {headers}")

        for attempt in range(retries):
            try:
                response = self.session.post(endpoint, headers=headers, json=payload, timeout=timeout)
                if response.ok:
                    return response.json()["choices"][0]["message"]["content"]
                else:
                    raise Exception(f"Chat request failed: {response.status_code} - {response.text}")
            except Exception as e:
                if attempt < retries - 1:
                    print(
                        f"Attempt {attempt + 1}/{retries} failed: {e}. Retrying in {delay * (2 ** attempt)} seconds...")
                    time.sleep(delay * (2 ** attempt))
                else:
                    raise Exception(f"Failed after {retries} attempts: {e}")


def enhance_ecl_prompt(original_prompt: str) -> str:
    """Enhance any ECL-related prompt to focus extraction on credit risk data."""
    # Only enhance if it looks like an ECL-related prompt
    if not original_prompt or not any(term in original_prompt.lower() for term in
                                      ["ecl", "stage", "impairment", "credit risk"]):
        return original_prompt

    # Keep any existing JSON structure from the original prompt
    json_pattern = r'(\{[^{]*"[^"]+"\s*:\s*\{[^}]*\}[^}]*\})'
    json_match = re.search(json_pattern, original_prompt, re.DOTALL)
    json_structure = json_match.group(0) if json_match else ""

    # Enhanced instruction that works with any existing structure
    enhanced_prompt = f"""
I need to extract credit risk stage data from this financial report. Focus specifically on:

1. Tables showing loan quality or credit risk metrics
2. Sections with ECL (Expected Credit Loss) data
3. Information broken down by Stage 1, Stage 2, and Stage 3
4. Values for: ECL/provisions, gross exposures/balances, and coverage ratios

For clarity: Stage 1 is performing, Stage 2 is significantly increased risk, Stage 3 is credit-impaired.

First, scan the document for sections containing phrases like "credit quality", "loan impairment", "ECL", "credit risk" or tables with "Stage 1/2/3" headers.

{original_prompt}

IMPORTANT EXTRACTION TIPS:
- Values should be in millions (£m or $m)
- Coverage ratios are typically percentages (%)
- Look for the most recent reporting period data
- If a value is not found, use "N/A" rather than making an estimate
"""

    return enhanced_prompt


class IFRS9Processor:
    def __init__(self, embedding: EYQEmbeddings, chat_model: str, incubator_key: str):
        self.embedding = embedding
        self.chat_model = chat_model
        self.incubator_key = incubator_key
        self.chroma_client = Chroma(
            persist_directory=PERSIST_DIRECTORY,
            embedding_function=embedding,
            collection_name='IFRS9'
        )
        self.parser = LlamaParse(api_key=LLAMA_PARSE_API_KEY, result_type="markdown", verbose=True)
        self.total_prompts_run = 0
        self.total_successful_results = 0
        self.total_failed_results = 0

    def load_single_document(self, file_path: str, company_name: str, debug: bool = False,
                             retries: int = 3, delay: int = 5) -> List[Document]:
        if not os.path.exists(file_path) or not os.access(file_path, os.R_OK):
            print(f"Error: File {file_path} does not exist or is not readable")
            return []
        for attempt in range(retries):
            try:
                documents = self.parser.load_data(file_path)
                if not documents:
                    print(f"Warning: No content extracted from {file_path}")
                    return []
                docs = [
                    Document(page_content=doc.text,
                             metadata={"source": os.path.basename(file_path), "page": i, "name": company_name})
                    for i, doc in enumerate(documents)
                ]
                if debug:
                    for i, d in enumerate(docs):
                        print(f"Page {i}: {d.page_content[:500]}...")
                return docs
            except Exception as e:
                print(f"Attempt {attempt + 1}/{retries} - Error parsing {file_path}: {e}")
                print(traceback.format_exc())
                time.sleep(delay)
        print(f"Failed to parse {file_path} after {retries} attempts")
        return []

    def create_embedding_pdf(self, pdf_path: str, company_name: str, debug: bool = False):
        docs = self.load_single_document(pdf_path, company_name, debug=debug)
        if not docs:
            print(f"Skipping embedding creation for {pdf_path}")
            return None
        print(f"Loaded {len(docs)} pages from {pdf_path}")
        vectordb = Chroma.from_documents(
            docs,
            embedding=self.embedding,
            persist_directory=PERSIST_DIRECTORY,
            collection_name='IFRS9'
        )
        print("Embeddings created and persisted")
        return vectordb

    def llm_extract_field(self, content: str, prompt: str) -> str:
        llm = EYQChat(
            deployment_name=self.chat_model,
            api_key=self.incubator_key,
            api_base=EYQ_BASE_URL,
            api_version=EYQ_API_VERSION,
            verbose=True
        )
        full_prompt = (
            f"{prompt}\nFull Document Content:\n{content}\n"
            "Return the result as a JSON string with the field populated. If not found, return 'N/A'."
        )
        messages = [{"role": "user", "content": full_prompt}]
        return llm(messages)

    def process_content_chunk(self, content: str, company: str, prompt_str: str, part_name: str, debug: bool = False):
        """Process a chunk of content and extract JSON data with improved error handling."""
        if debug:
            print(f"Processing {part_name} for {company}: {content[:1000]}...")

        response = self.llm_extract_field(content, prompt_str)
        print(f"LLM response for {company} ({part_name}): {response}")

        try:
            # First try to find JSON blocks in the markdown format
            json_match = re.search(r'\`\`\`json\s*(.*?)\s*\`\`\`', response, re.DOTALL)
            if json_match:
                json_str = json_match.group(1).strip()
            else:
                # Try to find JSON within braces
                json_match = re.search(r'\{.*\}', response, re.DOTALL)
                if json_match:
                    json_str = json_match.group(0).strip()
                else:
                    raise ValueError("No valid JSON found in response")

            # Extract notes if present
            notes_start = response.find('**Note:') if '**Note:' in response else len(response)
            notes = response[notes_start:].strip() if notes_start < len(response) else "No notes provided"

            # Parse JSON and validate
            json_response = json.loads(json_str)

            # ADD THIS DEBUGGING LINE HERE:
            print(f"DEBUG: Categories found in response: {list(json_response.keys())}")

            # Ensure we have a valid dictionary
            if not isinstance(json_response, dict):
                raise ValueError(f"JSON response is not a dictionary: {type(json_response)}")

            # Flatten the JSON structure for Excel
            flattened_data = flatten_json_to_rows(json_response)

            return json_response, notes, flattened_data

        except json.JSONDecodeError as e:
            print(f"JSON parsing error for {company} ({part_name}): {e}")
            print(f"Problematic JSON string: {json_str if 'json_str' in locals() else 'Not found'}")
            return None, f"Failed to parse JSON response: {e}", [
                {"Category": "Error", "Stage": "N/A", "Field": "N/A", "Value": "Error"}]

        except Exception as e:
            print(f"Error processing response for {company} ({part_name}): {str(e)}")
            print(f"Full response: {response}")
            return None, f"Error: {str(e)}", [{"Category": "Error", "Stage": "N/A", "Field": "N/A", "Value": "Error"}]

    def process_pdf_part(self, docs: List[Document], company: str, prompt_str: str,
                         part_name: str, debug: bool = False) -> Tuple[Optional[dict], str, List[dict]]:
        """
        Process a subset of PDF documents and handle character limits.
        Returns merged results from chunks if content is split.
        """
        full_content = "\n\n".join(doc.page_content for doc in docs)
        cleaned = clean_ocr_text(full_content)

        if len(cleaned) > CHAR_THRESHOLD:
            print(f"{company} ({part_name}) content exceeds limit ({len(cleaned)} chars), splitting into chunks...")
            chunks = split_content_by_chars(cleaned, CHAR_THRESHOLD)
            print(f"Created {len(chunks)} chunks for {company} ({part_name})")

            # Track valid responses, their notes, and counts of N/A values
            valid_responses = []
            valid_notes = []
            valid_data = []

            # Process each chunk
            for i, chunk in enumerate(chunks):
                chunk_name = f"{part_name} Chunk {i + 1}"
                print(f"\n{'=' * 50}\nPROCESSING {chunk_name} ({len(chunk) // 1000}K chars)\n{'=' * 50}")

                try:
                    res_json, notes, flat_data = self.process_content_chunk(
                        chunk, company, prompt_str, chunk_name, debug
                    )

                    # Enhanced logging for response quality
                    if res_json is not None:
                        na_count = count_na_values(res_json)
                        total_fields = sum(
                            len(stage) for cat in res_json.values()
                            for stage in cat.values() if isinstance(stage, dict)
                        )
                        print(
                            f"SUCCESS: {chunk_name} returned valid JSON with {na_count} N/A values out of {total_fields} fields")
                        print(f"Structure: {list(res_json.keys())}")
                        valid_responses.append(res_json)
                        valid_notes.append(notes)
                        valid_data.append(flat_data)
                    else:
                        print(f"FAILURE: {chunk_name} did not return valid JSON")
                except Exception as e:
                    print(f"ERROR processing {chunk_name}: {e}")

                except Exception as e:
                    print(f"Error processing {chunk_name}: {e}")
                    # Continue with other chunks even if one fails

            # Check if we have any valid results
            if not valid_responses:
                print(f"No valid responses from any chunk in {part_name}")
                return None, f"All chunks failed to produce valid JSON for {part_name}", [
                    {"Category": "Error", "Stage": "N/A", "Field": "N/A", "Value": "No valid data extracted"}
                ]

            # Merge the valid responses
            merged_response = merge_json_responses(valid_responses)
            combined_notes = "\n\n".join([f"--- Notes from {part_name} Chunk {i + 1} ---\n{note}"
                                          for i, note in enumerate(valid_notes)])

            # Generate flattened data from the merged response
            flattened_data = flatten_json_to_rows(merged_response)

            # Log success
            print(f"Successfully merged {len(valid_responses)} responses for {part_name}")
            return merged_response, combined_notes, flattened_data
        else:
            # Content is small enough to process in one go
            return self.process_content_chunk(cleaned, company, prompt_str, part_name, debug)

    def find_table_sections(docs: List[Document], keywords: List[str]) -> List[List[Document]]:
        """Find sections of the document containing specific keywords and return them as chunks."""
        table_sections = []
        current_section = []
        in_section = False
        window_size = 3  # Pages to include before and after keyword matches

        # First pass: mark pages that contain keywords
        keyword_pages = set()
        for i, doc in enumerate(docs):
            if any(keyword.lower() in doc.page_content.lower() for keyword in keywords):
                # Add the page index and surrounding pages within window
                for j in range(max(0, i - window_size), min(len(docs), i + window_size + 1)):
                    keyword_pages.add(j)

        # Now group continuous sections
        if keyword_pages:
            current_group = []
            sorted_pages = sorted(keyword_pages)

            for i in range(len(sorted_pages)):
                if i > 0 and sorted_pages[i] > sorted_pages[i - 1] + 1:
                    # Break in continuity
                    if current_group:
                        table_sections.append([docs[j] for j in current_group])
                    current_group = [sorted_pages[i]]
                else:
                    current_group.append(sorted_pages[i])

            # Add the last group
            if current_group:
                table_sections.append([docs[j] for j in current_group])

        # If no sections found, return a sensible fallback
        if not table_sections:
            print("No keyword sections found, returning whole document in chunks")
            chunk_size = 20  # Smaller chunks for better processing
            for i in range(0, len(docs), chunk_size):
                end = min(i + chunk_size, len(docs))
                table_sections.append(docs[i:end])

        return table_sections

    def find_relevant_sections(self, docs: List[Document]) -> List[List[Document]]:
        """Find sections of the document relevant to ECL/credit risk data across any bank report."""
        # ECL-related keywords that appear in most bank reports
        keywords = [
            "credit risk", "expected credit loss", "ecl", "loan impairment",
            "stage 1", "stage 2", "stage 3", "provision", "credit quality",
            "coverage ratio", "loan to value", "ltv", "impairment allowance",
            "credit-impaired", "performing", "non-performing", "significant increase"
        ]

        # First pass: identify pages with keywords
        keyword_pages = []
        keyword_found_info = {}  # For debugging

        # Debug: Print what keywords are found on which pages
        for i, doc in enumerate(docs):
            content = doc.page_content.lower()
            found_keywords = []  # Track which keywords found

            for keyword in keywords:
                if keyword in content:
                    found_keywords.append(keyword)

            if found_keywords:
                keyword_pages.append(i)
                keyword_found_info[i] = found_keywords
                print(f"DEBUG: Page {i} contains keywords: {', '.join(found_keywords)}")

        # If we found relevant pages, create chunks around them
        section_chunks = []
        if keyword_pages:
            print(f"Found {len(keyword_pages)} pages with ECL-related content")

            # Group consecutive pages
            page_groups = []
            current_group = [keyword_pages[0]]

            for i in range(1, len(keyword_pages)):
                # If pages are consecutive or close (within 2 pages)
                if keyword_pages[i] <= keyword_pages[i - 1] + 3:
                    current_group.append(keyword_pages[i])
                else:
                    page_groups.append(current_group)
                    current_group = [keyword_pages[i]]

            # Add the last group
            if current_group:
                page_groups.append(current_group)

            # Create document chunks with context (include surrounding pages)
            context_size = 2  # pages before/after to include for context

            for group in page_groups:
                start = max(0, min(group) - context_size)
                end = min(len(docs), max(group) + context_size + 1)
                section_chunks.append(docs[start:end])

        # Fallback: create smaller, regular chunks if no keywords found
        if not section_chunks:
            print("No specific ECL content found - creating standard chunks")
            chunk_size = min(20, len(docs) // 10 + 1)  # Create reasonably sized chunks
            section_chunks = [docs[i:i + chunk_size] for i in range(0, len(docs), chunk_size)]

        # Debug: Print information about each chunk
        for chunk_idx, chunk in enumerate(section_chunks):
            start_page = chunk[0].metadata['page']
            end_page = chunk[-1].metadata['page']
            chunk_keywords = set()
            for page_idx in range(start_page, end_page + 1):
                if page_idx in keyword_found_info:
                    chunk_keywords.update(keyword_found_info[page_idx])

            print(
                f"DEBUG: Chunk {chunk_idx + 1} (pages {start_page}-{end_page}) contains keywords: {', '.join(chunk_keywords)}")

        return section_chunks

    def ingest_pdfs(self, debug: bool = False) -> List[str]:
        collection = self.chroma_client  # Already loaded
        existing_sources = {meta['source'] for meta in collection.get(include=['metadatas'])['metadatas']
                            if 'source' in meta}
        pdf_files = [f for f in os.listdir(SOURCE_DIRECTORY) if f.endswith(".pdf")]
        if not pdf_files:
            print(f"No PDFs found in {SOURCE_DIRECTORY}")
            return []
        ingested = []
        for pdf_file in pdf_files:
            pdf_path = os.path.join(SOURCE_DIRECTORY, pdf_file)
            company = os.path.splitext(pdf_file)[0]
            if pdf_file in existing_sources:
                print(f"Embeddings exist for {pdf_file}, skipping")
                ingested.append(company)
                continue
            if not os.path.exists(pdf_path):
                print(f"File {pdf_path} missing, skipping")
                continue
            create_backup_folder(PERSIST_DIRECTORY, BACKUP_FOLDER)
            try:
                vectordb = self.create_embedding_pdf(pdf_path, company, debug)
                if vectordb is None or not self.chroma_client.get(where={"source": pdf_file})['ids']:
                    print(f"No embeddings created for {pdf_file}")
                    continue
                print(f"Ingested {pdf_file} for {company}")
                ingested.append(company)
            except Exception as e:
                print(f"Error ingesting {pdf_file}: {e}")
        return ingested

    def run_automation_script(self, companies, prompts, debug=False, force=False, output_dir=None):
        """Process a list of companies with their respective prompts."""
        start_time = datetime.now()
        print(f"Started at {start_time.strftime('%Y%m%d_%H%M%S')}")

        # Use provided output directory or default
        output_directory = output_dir if output_dir else OUTPUT_DIRECTORY

        results = {}  # Store all results for returning

        for company in companies:
            print(f"Processing company: {company}")
            company_results = {}  # Store results for this company

            pdf_path = os.path.join(SOURCE_DIRECTORY, f"{company}.pdf")
            source_name = f"{company}.pdf"

            # Load documents
            existing = self.chroma_client.get(where={"source": source_name}, include=['documents', 'metadatas'])
            if existing['ids']:
                docs = [Document(page_content=content, metadata=meta)
                        for content, meta in zip(existing['documents'], existing['metadatas'])]
            else:
                if not os.path.exists(pdf_path):
                    print(f"Error: PDF file {pdf_path} does not exist, skipping {company}")
                    continue
                docs = self.load_single_document(pdf_path, company, debug=debug)
                if not docs:
                    print(f"Warning: No content loaded for {company}, skipping prompt processing")
                    continue
                Chroma.from_documents(
                    docs,
                    embedding=self.embedding,
                    persist_directory=PERSIST_DIRECTORY,
                    collection_name='IFRS9'
                )
                print(f"Successfully ingested {source_name} into the database")

            num_pages = len(docs)
            print(f"PDF for {company} has {num_pages} pages")

            for prompt_idx, prompt_entry in enumerate(prompts, 1):
                self.total_prompts_run += 1
                request, prompt_str = prompt_entry

                # Type checking for prompt
                if not isinstance(prompt_str, str):
                    print(f"Warning: prompt is not a string but {type(prompt_str)}, converting to string")
                    prompt_str = str(prompt_str) if prompt_str is not None else ""

                field_name = extract_field_from_prompt(prompt_str)
                print(f"Extracting field '{field_name}' for prompt {prompt_idx}: {request}")

                # STEP 4: Enhance ECL-related prompts
                if "ecl" in field_name.lower() or "stage" in field_name.lower() or "impairment" in prompt_str.lower():
                    original_prompt = prompt_str
                    prompt_str = enhance_ecl_prompt(prompt_str)
                    if prompt_str != original_prompt:
                        print("Enhanced prompt for better ECL data extraction")

                    # ADD THIS DEBUGGING LINE HERE:
                    print(f"DEBUG: Prompt for {company} ({request}): {prompt_str[:300]}...")

                # Generate unique timestamp per prompt
                timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
                output_file = os.path.join(output_directory, f"{company}_{request}_{timestamp}.xlsx")
                error_file = os.path.join(output_directory, f"{company}_{request}_{timestamp}_error.xlsx")

                if not force and (os.path.exists(output_file) or os.path.exists(error_file)):
                    print(f"Output already exists for '{company}' prompt {request}, skipping")
                    company_results[request] = {
                        "status": "Skipped",
                        "timestamp": timestamp,
                        "file": output_file if os.path.exists(output_file) else error_file
                    }
                    continue

                try:
                    # STEP 5: Intelligent document chunking
                    if num_pages >= PAGE_THRESHOLD:
                        # Use intelligent section finding for ECL related prompts
                        if "ecl" in field_name.lower() or "stage" in field_name.lower() or "credit" in prompt_str.lower():
                            print(f"Using ECL-targeted document chunking for {company} ({num_pages} pages)")
                            parts = self.find_relevant_sections(docs)
                            print(f"Created {len(parts)} targeted chunks")
                        else:
                            # Standard chunking for non-ECL prompts
                            if num_pages > 200:
                                print(f"Extra large PDF detected ({num_pages} pages), using 10 smaller chunks")
                                chunk_size = num_pages // 10
                                parts = [docs[i:i + chunk_size] for i in range(0, num_pages, chunk_size)]
                            else:
                                print(f"Large PDF detected ({num_pages} pages), using standard 3-part chunking")
                                chunk_size = num_pages // 3
                                parts = [docs[:chunk_size], docs[chunk_size:2 * chunk_size], docs[2 * chunk_size:]]

                        # Process each part and collect results
                        valid_json_responses = []
                        valid_notes = []

                        for i, part_docs in enumerate(parts):
                            part_name = f"Part {i + 1}"
                            print(f"\n{'=' * 30}\nProcessing {part_name} ({len(part_docs)} pages)\n{'=' * 30}")

                            # Process with longer timeout for ECL data
                            try:
                                # For ECL data, use longer timeout
                                timeout = 60 if "ecl" in field_name.lower() else 30
                                json_response, notes, flattened_data = self.process_pdf_part(
                                    part_docs, company, prompt_str, part_name, debug
                                )

                                # ADD THIS DEBUGGING BLOCK HERE:
                                if json_response is not None:
                                    # Save raw JSON for debugging
                                    debug_file = os.path.join(output_directory, f"debug_{company}_{request}_{part_name.replace(' ', '_')}.json")
                                    try:
                                        with open(debug_file, "w") as f:
                                            json.dump(json_response, f, indent=2)
                                        print(f"DEBUG: Saved raw JSON from {part_name} to {debug_file}")
                                    except Exception as e:
                                        print(f"DEBUG: Failed to save JSON debug file: {str(e)}")

                                if json_response is not None:
                                    valid_json_responses.append(json_response)
                                    valid_notes.append(f"--- Notes from {part_name} ---\n{notes}")
                                    print(f"✅ Valid result from {part_name}")
                                else:
                                    print(f"No valid result from {part_name}")
                            except Exception as e:
                                print(f"⚠️ Error processing {part_name}: {str(e)}")
                                continue

                        # Handle successful parts
                        if valid_json_responses:
                            if len(valid_json_responses) == 1:
                                # Only one valid response
                                json_response = valid_json_responses[0]
                                notes = valid_notes[0]
                                flattened_data = flatten_json_to_rows(json_response)
                            else:
                                # Try to merge multiple responses
                                try:
                                    merged_response = merge_json_responses(valid_json_responses)
                                    combined_notes = "\n\n".join(valid_notes)

                                    # ADD THIS DEBUGGING BLOCK HERE:
                                    debug_file = os.path.join(output_directory,
                                                              f"debug_{company}_{request}_merged.json")
                                    try:
                                        with open(debug_file, "w") as f:
                                            json.dump(merged_response, f, indent=2)
                                        print(f"DEBUG: Saved merged JSON to {debug_file}")
                                    except Exception as e:
                                        print(f"DEBUG: Failed to save merged JSON debug file: {str(e)}")

                                    flattened_data = flatten_json_to_rows(merged_response)
                                    json_response = merged_response
                                    notes = combined_notes
                                    print(f"Successfully merged {len(valid_json_responses)} responses")
                                except Exception as e:
                                    # If merging fails, use the response with the most data
                                    print(f"Error merging responses: {e}, using best single response")
                                    best_idx = 0
                                    max_fields = 0

                                    for i, resp in enumerate(valid_json_responses):
                                        num_fields = sum(
                                            len(stage) for cat in resp.values()
                                            for stage in cat.values() if isinstance(stage, dict)
                                        )
                                        if num_fields > max_fields:
                                            max_fields = num_fields
                                            best_idx = i

                                    json_response = valid_json_responses[best_idx]
                                    notes = valid_notes[
                                                best_idx] + "\n\nNOTE: Selected best individual response - merge failed"
                                    flattened_data = flatten_json_to_rows(json_response)
                        else:
                            raise ValueError("No valid results from any part of the document")

                    else:
                        # Single processing for smaller documents
                        full_content = "\n\n".join([doc.page_content for doc in docs])
                        cleaned_content = clean_ocr_text(full_content)

                        if len(cleaned_content) > CHAR_THRESHOLD:
                            # Handle long content by splitting
                            chunks = split_content_by_chars(cleaned_content, CHAR_THRESHOLD)
                            chunk_results = []

                            for i, chunk in enumerate(chunks):
                                chunk_name = f"Chunk {i + 1}"
                                result = self.process_content_chunk(chunk, company, prompt_str, chunk_name, debug)
                                if result[0] is not None:
                                    chunk_results.append(result)

                            if not chunk_results:
                                raise ValueError("No valid results from any chunk")

                            if len(chunk_results) == 1:
                                json_response, notes, flattened_data = chunk_results[0]
                            else:
                                # Find the chunk with fewest N/A values
                                scored_chunks = [
                                    (res, notes, data, count_na_values(res))
                                    for res, notes, data in chunk_results
                                ]
                                best_chunk = min(scored_chunks, key=lambda x: x[3])
                                json_response, notes, flattened_data, _ = best_chunk
                        else:
                            # Process directly if under threshold
                            json_response, notes, flattened_data = self.process_content_chunk(
                                cleaned_content, company, prompt_str, "Full Content", debug
                            )

                    # Check if all values are N/A
                    if json_response and all_values_na(json_response):
                        raise ValueError("All extracted values are 'N/A', extraction likely failed")

                    # Write to Excel and store results
                    write_to_excel(flattened_data, notes, output_file)
                    self.total_successful_results += 1

                    company_results[request] = {
                        "status": "Success",
                        "timestamp": timestamp,
                        "file": output_file,
                        "data": flattened_data,
                        "notes": notes
                    }

                except Exception as e:
                    # STEP 6: Improved error handling
                    print(f"Error processing {company} for prompt {request}: {str(e)}")

                    # Check if it's an ECL-related prompt
                    is_ecl_prompt = any(term in field_name.lower() for term in ["ecl", "stage", "impairment"])

                    if is_ecl_prompt:
                        # Create informative fallback for ECL prompts
                        fallback_data = [
                            {"Category": "ERROR", "Stage": "N/A", "Field": "Error Type",
                             "Value": "Extraction failed: " + str(e)},
                            {"Category": "ACTION NEEDED", "Stage": "N/A", "Field": "Required Action",
                             "Value": "Manual extraction recommended - review document pages with ECL tables"}
                        ]

                        # Add helpful instructions
                        error_notes = (
                            f"ERROR EXTRACTING ECL DATA FOR {company}: {str(e)}\n\n"
                            f"The system attempted to process ECL data but encountered errors.\n\n"
                            f"TROUBLESHOOTING TIPS:\n"
                            f"1. Check pages with Stage 1, 2, 3 information\n"
                            f"2. Look for credit quality or loan tables\n"
                            f"3. Try adjusting chunk size if tables are split across pages\n\n"
                            f"Technical error details:\n{traceback.format_exc()}"
                        )

                        # Still create an informative output file
                        write_to_excel(fallback_data, error_notes, error_file)
                    else:
                        # Standard error handling for non-ECL prompts
                        error_data = [{"Category": "Error", "Stage": "N/A", "Field": field_name, "Value": str(e)}]
                        error_notes = f"Error: {str(e)}\n{traceback.format_exc()}"
                        write_to_excel(error_data, error_notes, error_file)

                    self.total_failed_results += 1

                    company_results[request] = {
                        "status": "Error",
                        "timestamp": timestamp,
                        "file": error_file,
                        "data": fallback_data if is_ecl_prompt else error_data,
                        "notes": error_notes,
                        "error": str(e)
                    }

                # Clean up any variables that might use a lot of memory
                if 'json_response' in locals():
                    del json_response
                if 'flattened_data' in locals():
                    del flattened_data
                if 'full_content' in locals():
                    del full_content
                if 'cleaned_content' in locals():
                    del cleaned_content

            # Store results for this company
            results[company] = company_results

            # Clear docs after all prompts for this company
            del docs

        end_time = datetime.now()
        duration = end_time - start_time
        success_rate = self.total_successful_results / self.total_prompts_run if self.total_prompts_run > 0 else 0
        print(f"Run Summary: {self.total_prompts_run} prompts, {self.total_successful_results} successes, "
              f"{self.total_failed_results} failures, {success_rate:.2%} success rate")

        return results


# Load Prompts from a csv and not directly in python as Grant so badly wanted... XD

def load_prompts_from_csv(csv_path):
    """
    Load bank-specific prompts from a CSV file and ensure proper formatting.
    """
    try:
        # Handle different encodings
        try:
            df = pd.read_csv(csv_path, encoding='utf-8')
        except UnicodeDecodeError:
            df = pd.read_csv(csv_path, encoding='cp1252')

        # Validate columns
        required_columns = ['Bank', 'PromptName', 'PromptText']
        if not all(col in df.columns for col in required_columns):
            missing = [col for col in required_columns if col not in df.columns]
            print(f"CSV {csv_path} is missing required columns: {', '.join(missing)}")
            return {}

        # Clean and format prompts
        for i, row in df.iterrows():
            # Handle NaN values
            for col in df.columns:
                if pd.isna(row[col]):
                    df.at[i, col] = ""

            # Ensure PromptText is a string
            if not isinstance(row['PromptText'], str):
                df.at[i, 'PromptText'] = str(row['PromptText'])

            # Fix specific issues in Santander prompts
            if 'Santander' in str(row['Bank']) and 'IFRS9 Data by Stage' in str(row['PromptName']):
                text = df.at[i, 'PromptText']
                # Fix JSON structure
                text = text.replace('}\n     "', '},\n     "')
                text = text.replace('" ', '"').replace(' "', '"')
                df.at[i, 'PromptText'] = text

        # Organize prompts by bank
        bank_prompts = {}
        for _, row in df.iterrows():
            bank = row['Bank']
            prompt_name = row['PromptName']
            prompt_text = row['PromptText']

            if bank not in bank_prompts:
                bank_prompts[bank] = []

            bank_prompts[bank].append((prompt_name, prompt_text))

        return bank_prompts

    except Exception as e:
        print(f"Error loading prompts from {csv_path}: {e}")
        print(traceback.format_exc())
        return {}


def process_bank(processor, bank, prompts, debug=False, force=False):
    """Process a single bank and its prompts"""
    print(f"Processing {bank} with {len(prompts)} prompts")

    # Find PDFs for this bank
    bank_pdfs = [f for f in os.listdir(SOURCE_DIRECTORY)
                 if f.endswith('.pdf') and bank.lower() in f.lower()]

    if not bank_pdfs:
        print(f"No PDF files found for {bank}, skipping.")
        return None

    # Ingest PDFs for this bank
    companies = processor.ingest_pdfs(debug=debug)

    # Filter companies to only those matching this bank
    bank_companies = [c for c in companies if bank.lower() in c.lower()]

    if bank_companies:
        bank_results = processor.run_automation_script(bank_companies, prompts, debug=debug, force=force)
        return bank_results
    else:
        print(f"No companies successfully ingested for {bank}, skipping.")
        return None


# =============================================================================
# Main Execution
# =============================================================================
def main():
    # Configuration
    CSV_PROMPTS_PATH = os.path.join(os.path.dirname(__file__), "EY_FinSight_Prompts3.csv")
    #CSV_PROMPTS_PATH = "C:/Users/BM754JC/Benchmarking/EY_FinSight_Prompts3.csv"  # Update with actual path
    PROCESS_ALL_BANKS = True  # Set to False to process only specific banks
    TARGET_BANKS = ["Barclays"]  # Only used if PROCESS_ALL_BANKS is False
    MAX_WORKERS = 3  # Number of banks to process in parallel

    embedding = EYQEmbeddings(
        model=EYQ_EMBEDDING_MODEL,
        api_key=EYQ_INCUBATOR_KEY,
        api_base=EYQ_BASE_URL,
        api_version=EYQ_API_VERSION,
        auth_header_name=AUTH_HEADER_NAME,
        use_bearer=USE_BEARER
    )
    processor = IFRS9Processor(embedding, EYQ_CHAT_MODEL, EYQ_INCUBATOR_KEY)

    # Load prompts from CSV
    bank_prompts = load_prompts_from_csv(CSV_PROMPTS_PATH)
    if not bank_prompts:
        print("Error: No prompts loaded from CSV. Please check the CSV file and try again.")
        return  # Exit if no prompts are found

    # Determine which banks to process
    banks_to_process = list(bank_prompts.keys()) if PROCESS_ALL_BANKS else TARGET_BANKS
    banks_to_process = [b for b in banks_to_process if b in bank_prompts]

    print(f"Processing the following banks: {', '.join(banks_to_process)}")

    # Process banks in parallel and collect results
    all_results = {}
    with concurrent.futures.ThreadPoolExecutor(max_workers=MAX_WORKERS) as executor:
        # Create a mapping of futures to banks
        future_to_bank = {
            executor.submit(process_bank, processor, bank, bank_prompts[bank], False, False): bank
            for bank in banks_to_process
        }

        # Process results as they complete
        for future in concurrent.futures.as_completed(future_to_bank):
            bank = future_to_bank[future]
            try:
                bank_results = future.result()
                if bank_results:
                    all_results[bank] = bank_results
                    print(f"Successfully processed {bank}")
                else:
                    print(f"No results for {bank}")
            except Exception as e:
                print(f"Error processing {bank}: {e}")
                print(traceback.format_exc())

    # Combine all results into a single Excel file if we have any
    if all_results:
        timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
        combined_output = os.path.join(OUTPUT_DIRECTORY, f"IFRS9_Combined_Results_{timestamp}.xlsx")
        combine_excel_outputs(all_results, combined_output)
    else:
        print("No results to combine into a workbook.")


if __name__ == '__main__':
    main()

```

# IFRS9\.chroma\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\data_level0.bin

This is a binary file of the type: Binary

# IFRS9\.chroma\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\header.bin

This is a binary file of the type: Binary

# IFRS9\.chroma\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\length.bin

This is a binary file of the type: Binary

# IFRS9\.chroma\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\link_lists.bin

```bin

```

# IFRS9\.chroma\chroma.sqlite3

This is a binary file of the type: Binary

# IFRS9\backup\.chromadb_20250523_144457_0\chroma.sqlite3

This is a binary file of the type: Binary

# IFRS9\backup\.chromadb_20250523_144759_0\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\data_level0.bin

This is a binary file of the type: Binary

# IFRS9\backup\.chromadb_20250523_144759_0\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\header.bin

This is a binary file of the type: Binary

# IFRS9\backup\.chromadb_20250523_144759_0\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\length.bin

This is a binary file of the type: Binary

# IFRS9\backup\.chromadb_20250523_144759_0\18cb038a-37ef-4963-b0e9-9d9c3b84da6a\link_lists.bin

```bin

```

# IFRS9\backup\.chromadb_20250523_144759_0\chroma.sqlite3

This is a binary file of the type: Binary

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_IFRS9 Data by Stage_Part_5.json

```json
{
  "Mortgages": {
    "Stage 1": {
      "ECL": "10",
      "Balance": "157268",
      "Coverage": "0.01%"
    },
    "Stage 2": {
      "ECL": "84",
      "Balance": "16973",
      "Coverage": "0.50%"
    },
    "Stage 3": {
      "ECL": "78",
      "Balance": "1785",
      "Coverage": "4.37%"
    }
  },
  "EDB - Credit Cards": {
    "Stage 1": {
      "ECL": "N/A",
      "Balance": "2271",
      "Coverage": "N/A"
    },
    "Stage 2": {
      "ECL": "N/A",
      "Balance": "454",
      "Coverage": "N/A"
    },
    "Stage 3": {
      "ECL": "N/A",
      "Balance": "49",
      "Coverage": "N/A"
    }
  },
  "EDB - Other": {
    "Stage 1": {
      "ECL": "N/A",
      "Balance": "N/A",
      "Coverage": "N/A"
    },
    "Stage 2": {
      "ECL": "N/A",
      "Balance": "N/A",
      "Coverage": "N/A"
    },
    "Stage 3": {
      "ECL": "N/A",
      "Balance": "N/A",
      "Coverage": "N/A"
    }
  },
  "Consumer Finance": {
    "Stage 1": {
      "ECL": "25",
      "Balance": "4389",
      "Coverage": "0.57%"
    },
    "Stage 2": {
      "ECL": "16",
      "Balance": "334",
      "Coverage": "4.79%"
    },
    "Stage 3": {
      "ECL": "27",
      "Balance": "36",
      "Coverage": "75.00%"
    }
  },
  "Corporate & Commercial Banking": {
    "Stage 1": {
      "ECL": "73",
      "Balance": "23023",
      "Coverage": "0.32%"
    },
    "Stage 2": {
      "ECL": "85",
      "Balance": "2568",
      "Coverage": "3.31%"
    },
    "Stage 3": {
      "ECL": "184",
      "Balance": "716",
      "Coverage": "25.70%"
    }
  },
  "Corporate Centre": {
    "Stage 1": {
      "ECL": "N/A",
      "Balance": "N/A",
      "Coverage": "N/A"
    },
    "Stage 2": {
      "ECL": "N/A",
      "Balance": "N/A",
      "Coverage": "N/A"
    },
    "Stage 3": {
      "ECL": "N/A",
      "Balance": "N/A",
      "Coverage": "N/A"
    }
  }
}
```

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario ECL_Part_5.json

```json
{
  "Retail & Business Banking": {
    "Upside": {
      "ECL": "380",
      "Balance": "196732"
    },
    "Base": {
      "ECL": "403",
      "Balance": "196732"
    },
    "Downside 1": {
      "ECL": "517",
      "Balance": "196732"
    },
    "Downside 2": {
      "ECL": "1051",
      "Balance": "196732"
    },
    "Weighted": {
      "ECL": "458",
      "Balance": "196732"
    }
  },
  "Mortgages": {
    "Upside": {
      "ECL": "112",
      "Balance": "176026"
    },
    "Base": {
      "ECL": "128",
      "Balance": "176026"
    },
    "Downside 1": {
      "ECL": "218",
      "Balance": "176026"
    },
    "Downside 2": {
      "ECL": "705",
      "Balance": "176026"
    },
    "Weighted": {
      "ECL": "172",
      "Balance": "176026"
    }
  },
  "Consumer Finance": {
    "Upside": {
      "ECL": "67",
      "Balance": "4759"
    },
    "Base": {
      "ECL": "68",
      "Balance": "4759"
    },
    "Downside 1": {
      "ECL": "69",
      "Balance": "4759"
    },
    "Downside 2": {
      "ECL": "70",
      "Balance": "4759"
    },
    "Weighted": {
      "ECL": "69",
      "Balance": "4759"
    }
  },
  "Corporate & Commercial Banking": {
    "Upside": {
      "ECL": "294",
      "Balance": "26307"
    },
    "Base": {
      "ECL": "303",
      "Balance": "26307"
    },
    "Downside 1": {
      "ECL": "335",
      "Balance": "26307"
    },
    "Downside 2": {
      "ECL": "403",
      "Balance": "26307"
    },
    "Weighted": {
      "ECL": "342",
      "Balance": "26307"
    }
  },
  "Corporate Centre": {
    "Upside": {
      "ECL": "N/A",
      "Balance": "56062"
    },
    "Base": {
      "ECL": "N/A",
      "Balance": "56062"
    },
    "Downside 1": {
      "ECL": "N/A",
      "Balance": "56062"
    },
    "Downside 2": {
      "ECL": "N/A",
      "Balance": "56062"
    },
    "Weighted": {
      "ECL": "N/A",
      "Balance": "56062"
    }
  }
}
```

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_merged.json

```json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "15"
    },
    "Base case ": {
      "Weight": "50"
    },
    "Downside 1": {
      "Weight": "25"
    },
    "Downside 2  ": {
      "Weight": "10"
    }
  }
}
```

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_1.json

```json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
```

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_2.json

```json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
```

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_3.json

```json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "15"
    },
    "Base case ": {
      "Weight": "50"
    },
    "Downside 1": {
      "Weight": "25"
    },
    "Downside 2  ": {
      "Weight": "10"
    }
  }
}
```

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_4.json

```json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
```

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_5.json

```json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
```

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_6.json

```json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
```

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_7.json

```json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
```

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_8.json

```json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
```

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_9.json

```json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
```

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_10.json

```json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
```

# IFRS9\outputs\debug_Santander UK plc 2024 Annual Report_Scenario Weight_Part_11.json

```json
{
  "Scenario weights %": {
    "Upside ": {
      "Weight": "N/A"
    },
    "Base case ": {
      "Weight": "N/A"
    },
    "Downside 1": {
      "Weight": "N/A"
    },
    "Downside 2  ": {
      "Weight": "N/A"
    }
  }
}
```

# IFRS9\outputs\IFRS9_Combined_Results_20250523_145155.xlsx

This is a binary file of the type: Excel Spreadsheet

# IFRS9\outputs\Santander UK plc 2024 Annual Report_IFRS9 Data by Stage_20250523_145123.xlsx

This is a binary file of the type: Excel Spreadsheet

# IFRS9\outputs\Santander UK plc 2024 Annual Report_Scenario ECL_20250523_145024.xlsx

This is a binary file of the type: Excel Spreadsheet

# IFRS9\outputs\Santander UK plc 2024 Annual Report_Scenario Weight_20250523_145055.xlsx

This is a binary file of the type: Excel Spreadsheet

# IFRS9\reports\Barclays-Bank-UK-Annual-Report-2024.pdf

This is a binary file of the type: PDF

# IFRS9\reports\Postman-win64-Setup.exe

This is a binary file of the type: Executable

# IFRS9\reports\Santander UK plc 2024 Annual Report.pdf

This is a binary file of the type: PDF

# minimal_requirements.txt

```txt
langchain==0.3.20
langchain-openai==0.3.8
langchain-community==0.3.19
langchain-core==0.3.43
python-dotenv==1.0.0
chromadb==0.4.18
tabula-py==2.9.0
pandas==2.1.1
numpy==1.26.4
PyPDF2==3.0.1
httpx==0.28.1
jsonpointer==2.4
jsonschema==4.19.1
MarkupSafe==2.1.3
marshmallow==3.20.1
networkx==3.3
openai==1.66.0
ipykernel==6.29.5
jedi==0.19.2
```

# missing_packages.txt

```txt
jsonschema-specifications==2023.7.1
xmltodict==0.13.0
networkx==3.3
nibabel==5.2.1
httpx==0.28.1
jedi==0.19.2
onnxruntime==1.16.0
opentelemetry-api==1.30.0
overrides==7.4.0
packaging==23.2
Pillow==10.0.1
pyparsing==3.1.2
pydantic==2.10.6
pygments==2.16.1
tenacity==8.2.3
tokenizers==0.14.0
tqdm==4.66.1
typing_extensions==4.12.2
urllib3==2.0.6
wrapt==1.17.2
llama-index
```

# requirements_minimal.txt

```txt
langchain==0.3.20
langchain-openai==0.3.8
python-dotenv==1.0.0
chromadb==0.4.18
tabula-py==2.9.0
pandas==2.1.1
numpy==1.26.4
PyPDF2==3.0.1
httpx==0.28.1
```

# requirements.txt

```txt
aiohttp==3.8.5
aiosignal==1.3.1
altair==5.1.2
annotated-types==0.7.0
anyio==3.7.1
asgiref==3.8.1
asttokens==3.0.0
async-timeout==4.0.3
attrs==23.1.0
azure-core==1.29.4
backoff==2.2.1
bcrypt==4.0.1
blinker==1.6.2
cachetools==5.3.1
certifi==2023.7.22
charset-normalizer==3.3.0
chroma-hnswlib==0.7.3
chromadb==0.4.18
ci-info==0.3.0
click==8.1.7
cloudpickle==3.1.1
colorama==0.4.6
coloredlogs==15.0.1
comm==0.2.2
configobj==5.0.8
configparser==7.0.0
dataclasses-json==0.6.1
debugpy==1.8.13
decorator==5.2.1
Deprecated==1.2.18
distro==1.9.0
durationpy==0.9
etelemetry==0.3.1
executing==2.2.0
fastapi==0.103.2
filelock==3.12.4
fitz==0.0.1.dev2
flatbuffers==23.5.26
frozenlist==1.4.0
fsspec==2023.9.2
gitdb==4.0.10
GitPython==3.1.37
google-auth==2.38.0
googleapis-common-protos
greenlet==3.0.0
grpcio==1.71.0
h11==0.14.0
httpcore==1.0.7
httplib2==0.22.0
httptools==0.6.0
httpx==0.28.1
httpx-sse==0.4.0
huggingface-hub==0.16.4
humanfriendly==10.0
idna==3.4
importlib-metadata==6.8.0
importlib-resources==6.1.0
ipykernel==6.29.5
ipython==8.34.0
isodate==0.6.1
jedi==0.19.2
Jinja2==3.1.2
jiter==0.9.0
jpype1==1.5.2
jsonpatch==1.33
jsonpointer==2.4
jsonschema==4.19.1
jsonschema-specifications==2023.7.1
jupyter_client==8.6.3
jupyter_core==5.7.2
kubernetes==32.0.1
langchain==0.3.20
langchain-community==0.3.19
langchain-core==0.3.43
langchain-openai==0.3.8
langchain-text-splitters==0.3.6
langsmith==0.3.13
looseversion==1.3.0
lxml==5.2.2
markdown-it-py==3.0.0
MarkupSafe==2.1.3
marshmallow==3.20.1
matplotlib-inline==0.1.7
mdurl==0.1.2
mmh3==5.1.0
monotonic==1.6
mpmath==1.3.0
multidict==6.0.4
mypy-extensions==1.0.0
nest-asyncio==1.6.0
networkx==3.3
nibabel==5.2.1
nipype==1.8.6
numpy==1.26.4
oauthlib==3.2.2
onnxruntime>=1.17.0
openai==1.66.0
opentelemetry-api==1.30.0
opentelemetry-exporter-otlp-proto-common==1.30.0
opentelemetry-exporter-otlp-proto-grpc==1.30.0
opentelemetry-instrumentation==0.51b0
opentelemetry-instrumentation-asgi==0.51b0
opentelemetry-instrumentation-fastapi==0.51b0
opentelemetry-proto
opentelemetry-sdk==1.30.0
opentelemetry-semantic-conventions==0.51b0
opentelemetry-util-http==0.51b0
orjson==3.10.15
overrides==7.4.0
packaging==23.2
pandas==2.1.1
parso==0.8.4
pathlib==1.0.1
Pillow==10.0.1
platformdirs==4.3.6
posthog==3.0.2
prompt_toolkit==3.0.50
protobuf
prov==2.0.1
psutil==7.0.0
pulsar-client>=3.4.0
pure_eval==0.2.3
pyarrow==13.0.0
pyasn1==0.6.1
pyasn1_modules==0.4.1
pydantic==2.10.6
pydantic-settings==2.8.1
pydantic_core==2.27.2
pydeck==0.8.1b0
pydot==2.0.0
Pygments==2.16.1
pyparsing==3.1.2
pypdf==3.16.2
PyPDF2==3.0.1
PyPika==0.48.9
pyreadline3==3.4.1
python-dateutil==2.8.2
python-dotenv==1.0.0
pytz==2023.3.post1
pywin32==309
pyxnat==1.6.2
PyYAML==6.0.1
pyzmq==26.2.1
rdflib==6.3.2
referencing==0.30.2
regex==2023.10.3
requests==2.31.0
requests-oauthlib==2.0.0
requests-toolbelt==1.0.0
rich==13.6.0
rpds-py==0.10.4
rsa==4.9
scipy==1.13.1
simplejson==3.19.2
six==1.16.0
smmap==5.0.1
sniffio==1.3.0
spyder-kernels==3.0.3
SQLAlchemy==2.0.21
stack-data==0.6.3
starlette==0.27.0
streamlit
sympy==1.12
tabula==1.0.5
tabula-py==2.9.3
tenacity==8.2.3
tiktoken==0.9.0
tokenizers==0.14.0
toml==0.10.2
toolz==0.12.0
tornado==6.3.3
tqdm==4.66.1
traitlets==5.14.3
traits==6.3.2
typer==0.9.0
typing-inspect==0.9.0
typing_extensions==4.12.2
tzdata==2023.3
tzlocal==5.1
urllib3==2.0.6
uvicorn==0.23.2
validators==0.22.0
watchdog==3.0.0
watchfiles==0.20.0
wcwidth==0.2.13
websocket-client==1.8.0
websockets==11.0.3
wrapt==1.17.2
XlsxWriter==3.2.0
yarl==1.9.2
zipp==3.17.0
zstandard==0.23.0
onnxruntime==1.16.3
openpyxl
llama-index

```

# V6.py

```py
#!/usr/bin/env python3
"""
Interactive IFRS9 Automation Script - User Upload Version

This script allows users to upload individual PDFs for IFRS9 data extraction,
rather than batch processing from a folder. It provides a user-friendly interface
for single document processing with bank-specific prompts.
"""

import os
import json
import re
import shutil
import time
import traceback
from datetime import datetime
from typing import List, Tuple, Optional, Dict, Any
import tkinter as tk
from tkinter import filedialog, messagebox, ttk
import threading

import requests
import pandas as pd
import openpyxl
from dotenv import load_dotenv
import nest_asyncio

from langchain_community.vectorstores import Chroma
from langchain.schema import Document
from chromadb.api.types import EmbeddingFunction
from llama_index.readers.llama_parse import LlamaParse

# Apply nest_asyncio to allow nested event loops
nest_asyncio.apply()

# =============================================================================
# Configuration and Global Constants
# =============================================================================
ENV_PATH = os.path.join(os.path.dirname(__file__), "ATT27768.env")
load_dotenv(ENV_PATH)

LLAMA_PARSE_API_KEY = os.getenv("LLAMA_PARSE_API_KEY")
if not LLAMA_PARSE_API_KEY:
    raise ValueError("LLAMA_PARSE_API_KEY not found in .env file.")

EYQ_INCUBATOR_KEY = os.getenv("EYQ_INCUBATOR_KEY")
EYQ_BASE_URL = "https://eyq-incubator.europe.fabric.ey.com/eyq/eu/api"
EYQ_CHAT_MODEL = "gpt-4o"
EYQ_EMBEDDING_MODEL = "text-embedding-3-large"
EYQ_API_VERSION = "2023-05-15"
AUTH_HEADER_NAME = "api-key"
USE_BEARER = False

# Create temp directories for single file processing
TEMP_DIRECTORY = './temp_processing'
PERSIST_DIRECTORY = './temp_processing/.chroma'
OUTPUT_DIRECTORY = './outputs'

# Create directories if they don't exist
for directory in [TEMP_DIRECTORY, OUTPUT_DIRECTORY]:
    os.makedirs(directory, exist_ok=True)

# Thresholds
PAGE_THRESHOLD = 150
CHAR_THRESHOLD = 1_000_000


# =============================================================================
# Import all utility functions from original code
# =============================================================================

def clean_ocr_text(text: str) -> str:
    replacements = {
        '': '6', '': '5', '': '7', '': '4', '': '3',
        '': '0', '': '9', '': '8', '': '1', '': '2',
        '': '', '': '.', '': '0', '|': ' ', '\n': ' ',
        ' S': ' 5', ' I': ' 1', ' O': ' 0', ' B': ' 8'
    }
    for garbled, replacement in replacements.items():
        text = text.replace(garbled, replacement)
    return text


def split_content_by_chars(content: str, char_threshold: int) -> List[str]:
    if len(content) <= char_threshold:
        return [content]
    chunks = []
    start = 0
    while start < len(content):
        end = min(start + char_threshold, len(content))
        break_point = content.rfind('\n', start, end)
        if break_point == -1:
            break_point = content.rfind(' ', start, end)
        if break_point == -1 or break_point <= start:
            break_point = end
        chunks.append(content[start:break_point])
        start = break_point + 1
    return chunks


def flatten_json_to_rows(json_data):
    """Flatten nested JSON into a list of rows for Excel."""
    rows = []

    if isinstance(json_data, str):
        return [{"Category": "Error", "Stage": "N/A", "Field": "Response", "Value": json_data}]

    if all(not isinstance(val, dict) for val in json_data.values()):
        for key, value in json_data.items():
            rows.append({
                "Category": "Main",
                "Stage": "N/A",
                "Field": key,
                "Value": str(value)
            })
        return rows

    for category, content in json_data.items():
        if isinstance(content, dict):
            for field, value in content.items():
                if isinstance(value, dict):
                    for subfield, subvalue in value.items():
                        rows.append({
                            "Category": category,
                            "Stage": field,
                            "Field": subfield,
                            "Value": str(subvalue)
                        })
                else:
                    rows.append({
                        "Category": category,
                        "Stage": "N/A",
                        "Field": field,
                        "Value": str(value)
                    })
        else:
            rows.append({
                "Category": "Summary",
                "Stage": "N/A",
                "Field": category,
                "Value": str(content)
            })

    return rows


def write_to_excel(data: List[Dict[str, str]], notes: str, output_file: str) -> None:
    with pd.ExcelWriter(output_file, engine="xlsxwriter") as writer:
        pd.DataFrame(data).to_excel(writer, index=False, sheet_name="IFRS9 Data")
        pd.DataFrame({"Notes": [notes]}).to_excel(writer, index=False, sheet_name="Notes")
    print(f"Data written to {output_file}")


# =============================================================================
# Custom Classes (copied from original)
# =============================================================================

class EYQEmbeddings(EmbeddingFunction):
    def __init__(self, model: str, api_key: str, api_base: str, api_version: str,
                 auth_header_name: str = "Authorization", use_bearer: bool = True):
        self.model = model
        self.api_key = api_key
        self.api_base = api_base
        self.api_version = api_version
        self.auth_header_name = auth_header_name
        self.use_bearer = use_bearer
        self.session = requests.Session()

    def __call__(self, inputs: List[str]) -> List[List[float]]:
        headers = {"Content-Type": "application/json",
                   self.auth_header_name: f"Bearer {self.api_key}" if self.use_bearer else self.api_key}
        embeddings = []
        for text in inputs:
            payload = {"model": self.model, "input": text, "api_version": self.api_version}
            endpoint = f"{self.api_base}/openai/deployments/{self.model}/embeddings"
            response = self.session.post(endpoint, headers=headers, json=payload, timeout=30)
            if response.ok:
                data = response.json()
                embeddings.append(data["data"][0]["embedding"])
            else:
                raise Exception(f"Embedding request failed: {response.text}")
        return embeddings

    def embed_documents(self, texts: List[str]) -> List[List[float]]:
        return self.__call__(texts)

    def embed_query(self, text: str) -> List[float]:
        return self.__call__([text])[0]


class EYQChat:
    def __init__(self, deployment_name: str, api_key: str, api_base: str, api_version: str,
                 temperature: float = 0, verbose: bool = False):
        self.deployment_name = deployment_name
        self.api_key = api_key
        self.api_base = api_base
        self.api_version = api_version
        self.temperature = temperature
        self.verbose = verbose
        self.session = requests.Session()

    def __call__(self, messages: List[Dict[str, str]], retries: int = 3, delay: int = 2, **kwargs) -> str:
        headers = {AUTH_HEADER_NAME: self.api_key, "Content-Type": "application/json"}
        payload = {"model": self.deployment_name, "messages": messages, "temperature": self.temperature}
        endpoint = f"{self.api_base}/openai/deployments/{self.deployment_name}/chat/completions"
        timeout = kwargs.get('timeout', 60)

        for attempt in range(retries):
            try:
                response = self.session.post(endpoint, headers=headers, json=payload, timeout=timeout)
                if response.ok:
                    return response.json()["choices"][0]["message"]["content"]
                else:
                    raise Exception(f"Chat request failed: {response.status_code} - {response.text}")
            except Exception as e:
                if attempt < retries - 1:
                    print(
                        f"Attempt {attempt + 1}/{retries} failed: {e}. Retrying in {delay * (2 ** attempt)} seconds...")
                    time.sleep(delay * (2 ** attempt))
                else:
                    raise Exception(f"Failed after {retries} attempts: {e}")


# =============================================================================
# Interactive PDF Processor Class
# =============================================================================

class InteractivePDFProcessor:
    def __init__(self):
        self.embedding = EYQEmbeddings(
            model=EYQ_EMBEDDING_MODEL,
            api_key=EYQ_INCUBATOR_KEY,
            api_base=EYQ_BASE_URL,
            api_version=EYQ_API_VERSION,
            auth_header_name=AUTH_HEADER_NAME,
            use_bearer=USE_BEARER
        )
        self.parser = LlamaParse(api_key=LLAMA_PARSE_API_KEY, result_type="markdown", verbose=True)
        self.chat_model = EYQChat(
            deployment_name=EYQ_CHAT_MODEL,
            api_key=EYQ_INCUBATOR_KEY,
            api_base=EYQ_BASE_URL,
            api_version=EYQ_API_VERSION,
            verbose=True
        )

        # Load available prompts
        self.load_prompts()

    def load_prompts(self):
        """Load prompts from CSV file"""
        csv_path = os.path.join(os.path.dirname(__file__), "EY_FinSight_Prompts3.csv")
        try:
            df = pd.read_csv(csv_path, encoding='utf-8')
            self.bank_prompts = {}

            for _, row in df.iterrows():
                bank = row['Bank']
                prompt_name = row['PromptName']
                prompt_text = row['PromptText']

                if bank not in self.bank_prompts:
                    self.bank_prompts[bank] = []
                self.bank_prompts[bank].append((prompt_name, prompt_text))

            print(f"Loaded prompts for banks: {list(self.bank_prompts.keys())}")

        except Exception as e:
            print(f"Error loading prompts: {e}")
            self.bank_prompts = {}

    def parse_pdf(self, pdf_path: str) -> List[Document]:
        """Parse a PDF file and return Document objects"""
        try:
            documents = self.parser.load_data(pdf_path)
            if not documents:
                return []

            docs = [
                Document(
                    page_content=doc.text,
                    metadata={
                        "source": os.path.basename(pdf_path),
                        "page": i,
                        "name": os.path.splitext(os.path.basename(pdf_path))[0]
                    }
                )
                for i, doc in enumerate(documents)
            ]
            return docs

        except Exception as e:
            print(f"Error parsing PDF: {e}")
            return []

    def process_with_prompt(self, docs: List[Document], prompt_text: str, company_name: str) -> Dict:
        """Process documents with a specific prompt"""
        try:
            # Combine all document content
            full_content = "\n\n".join([doc.page_content for doc in docs])
            cleaned_content = clean_ocr_text(full_content)

            # Handle large content by splitting if necessary
            if len(cleaned_content) > CHAR_THRESHOLD:
                chunks = split_content_by_chars(cleaned_content, CHAR_THRESHOLD)
                print(f"Content split into {len(chunks)} chunks")

                # Process first chunk for now (can be enhanced to process all chunks)
                content_to_process = chunks[0]
                print("Processing first chunk only for demonstration")
            else:
                content_to_process = cleaned_content

            # Create the full prompt
            full_prompt = (
                f"{prompt_text}\n\n"
                f"Document Content:\n{content_to_process}\n\n"
                "Return the result as a JSON string with the field populated. "
                "If information is not found, return 'N/A' for that field."
            )

            messages = [{"role": "user", "content": full_prompt}]
            response = self.chat_model(messages)

            # Parse the response
            try:
                # Look for JSON in response
                json_match = re.search(r'\`\`\`json\s*(.*?)\s*\`\`\`', response, re.DOTALL)
                if json_match:
                    json_str = json_match.group(1).strip()
                else:
                    json_match = re.search(r'\{.*\}', response, re.DOTALL)
                    if json_match:
                        json_str = json_match.group(0).strip()
                    else:
                        raise ValueError("No valid JSON found in response")

                json_response = json.loads(json_str)
                flattened_data = flatten_json_to_rows(json_response)

                return {
                    "success": True,
                    "data": flattened_data,
                    "notes": f"Processed {len(docs)} pages successfully",
                    "raw_response": response
                }

            except Exception as e:
                return {
                    "success": False,
                    "error": f"JSON parsing error: {e}",
                    "raw_response": response
                }

        except Exception as e:
            return {
                "success": False,
                "error": f"Processing error: {e}",
                "raw_response": ""
            }


# =============================================================================
# GUI Application
# =============================================================================

class FinSightGUI:
    def __init__(self, root):
        self.root = root
        self.root.title("EY FinSight - Interactive PDF Processor")
        self.root.geometry("800x600")

        self.processor = InteractivePDFProcessor()
        self.current_pdf_path = None
        self.processed_docs = None

        self.setup_gui()

    def setup_gui(self):
        # Create main frame
        main_frame = ttk.Frame(self.root, padding="10")
        main_frame.grid(row=0, column=0, sticky=(tk.W, tk.E, tk.N, tk.S))

        # Configure grid weights
        self.root.columnconfigure(0, weight=1)
        self.root.rowconfigure(0, weight=1)
        main_frame.columnconfigure(1, weight=1)

        # PDF Upload Section
        ttk.Label(main_frame, text="Step 1: Upload PDF", font=('Arial', 12, 'bold')).grid(row=0, column=0, columnspan=2,
                                                                                          sticky=tk.W, pady=(0, 10))

        ttk.Button(main_frame, text="Select PDF File", command=self.select_pdf).grid(row=1, column=0, sticky=tk.W)

        self.pdf_label = ttk.Label(main_frame, text="No PDF selected", foreground="gray")
        self.pdf_label.grid(row=1, column=1, sticky=tk.W, padx=(10, 0))

        # Bank Selection
        ttk.Label(main_frame, text="Step 2: Select Bank", font=('Arial', 12, 'bold')).grid(row=2, column=0,
                                                                                           columnspan=2, sticky=tk.W,
                                                                                           pady=(20, 10))

        self.bank_var = tk.StringVar()
        self.bank_combo = ttk.Combobox(main_frame, textvariable=self.bank_var, width=30)
        self.bank_combo['values'] = list(self.processor.bank_prompts.keys()) if self.processor.bank_prompts else []
        self.bank_combo.grid(row=3, column=0, columnspan=2, sticky=tk.W)
        self.bank_combo.bind('<<ComboboxSelected>>', self.on_bank_selected)

        # Prompt Selection
        ttk.Label(main_frame, text="Step 3: Select Prompt", font=('Arial', 12, 'bold')).grid(row=4, column=0,
                                                                                             columnspan=2, sticky=tk.W,
                                                                                             pady=(20, 10))

        self.prompt_var = tk.StringVar()
        self.prompt_combo = ttk.Combobox(main_frame, textvariable=self.prompt_var, width=50)
        self.prompt_combo.grid(row=5, column=0, columnspan=2, sticky=tk.W)

        # Process Button
        self.process_button = ttk.Button(main_frame, text="Process PDF", command=self.process_pdf, state='disabled')
        self.process_button.grid(row=6, column=0, columnspan=2, pady=(20, 10))

        # Progress Bar
        self.progress = ttk.Progressbar(main_frame, mode='indeterminate')
        self.progress.grid(row=7, column=0, columnspan=2, sticky=(tk.W, tk.E), pady=(10, 0))

        # Status Label
        self.status_label = ttk.Label(main_frame, text="Ready", foreground="green")
        self.status_label.grid(row=8, column=0, columnspan=2, sticky=tk.W, pady=(10, 0))

        # Results Text Area
        ttk.Label(main_frame, text="Results:", font=('Arial', 12, 'bold')).grid(row=9, column=0, columnspan=2,
                                                                                sticky=tk.W, pady=(20, 10))

        # Create frame for text area and scrollbar
        text_frame = ttk.Frame(main_frame)
        text_frame.grid(row=10, column=0, columnspan=2, sticky=(tk.W, tk.E, tk.N, tk.S), pady=(0, 10))
        text_frame.columnconfigure(0, weight=1)
        text_frame.rowconfigure(0, weight=1)

        self.results_text = tk.Text(text_frame, height=15, width=80, wrap=tk.WORD)
        scrollbar = ttk.Scrollbar(text_frame, orient=tk.VERTICAL, command=self.results_text.yview)
        self.results_text.configure(yscrollcommand=scrollbar.set)

        self.results_text.grid(row=0, column=0, sticky=(tk.W, tk.E, tk.N, tk.S))
        scrollbar.grid(row=0, column=1, sticky=(tk.N, tk.S))

        # Configure main frame row weight for text area
        main_frame.rowconfigure(10, weight=1)

        # Export Button
        self.export_button = ttk.Button(main_frame, text="Export to Excel", command=self.export_results,
                                        state='disabled')
        self.export_button.grid(row=11, column=0, columnspan=2, pady=(10, 0))

        self.last_result = None

    def select_pdf(self):
        file_path = filedialog.askopenfilename(
            title="Select PDF file",
            filetypes=[("PDF files", "*.pdf"), ("All files", "*.*")]
        )

        if file_path:
            self.current_pdf_path = file_path
            filename = os.path.basename(file_path)
            self.pdf_label.config(text=f"Selected: {filename}", foreground="black")
            self.update_process_button_state()

    def on_bank_selected(self, event):
        selected_bank = self.bank_var.get()
        if selected_bank in self.processor.bank_prompts:
            prompts = self.processor.bank_prompts[selected_bank]
            self.prompt_combo['values'] = [prompt[0] for prompt in prompts]  # Just the names
            self.prompt_var.set('')  # Clear selection
        self.update_process_button_state()

    def update_process_button_state(self):
        if (self.current_pdf_path and
                self.bank_var.get() and
                self.prompt_var.get()):
            self.process_button.config(state='normal')
        else:
            self.process_button.config(state='disabled')

    def process_pdf(self):
        if not self.current_pdf_path or not self.bank_var.get() or not self.prompt_var.get():
            messagebox.showerror("Error", "Please select PDF, bank, and prompt")
            return

        # Start processing in a separate thread
        threading.Thread(target=self._process_pdf_thread, daemon=True).start()

    def _process_pdf_thread(self):
        try:
            # Update UI in main thread
            self.root.after(0, self._start_processing)

            # Parse PDF
            company_name = os.path.splitext(os.path.basename(self.current_pdf_path))[0]
            docs = self.processor.parse_pdf(self.current_pdf_path)

            if not docs:
                self.root.after(0, lambda: self._show_error("Failed to parse PDF"))
                return

            # Get selected prompt text
            selected_bank = self.bank_var.get()
            selected_prompt_name = self.prompt_var.get()

            prompt_text = None
            for prompt_name, prompt_content in self.processor.bank_prompts[selected_bank]:
                if prompt_name == selected_prompt_name:
                    prompt_text = prompt_content
                    break

            if not prompt_text:
                self.root.after(0, lambda: self._show_error("Prompt not found"))
                return

            # Process with prompt
            result = self.processor.process_with_prompt(docs, prompt_text, company_name)

            # Update UI with results
            self.root.after(0, lambda: self._show_results(result))

        except Exception as e:
            self.root.after(0, lambda: self._show_error(f"Processing error: {e}"))

    def _start_processing(self):
        self.progress.start()
        self.status_label.config(text="Processing PDF...", foreground="blue")
        self.process_button.config(state='disabled')
        self.export_button.config(state='disabled')

    def _show_error(self, error_msg):
        self.progress.stop()
        self.status_label.config(text=f"Error: {error_msg}", foreground="red")
        self.process_button.config(state='normal')
        self.results_text.delete(1.0, tk.END)
        self.results_text.insert(tk.END, f"Error: {error_msg}")

    def _show_results(self, result):
        self.progress.stop()
        self.process_button.config(state='normal')
        self.last_result = result

        if result['success']:
            self.status_label.config(text="Processing completed successfully", foreground="green")
            self.export_button.config(state='normal')

            # Display results
            self.results_text.delete(1.0, tk.END)
            self.results_text.insert(tk.END, f"Processing completed successfully!\n\n")
            self.results_text.insert(tk.END, f"Extracted {len(result['data'])} data points:\n\n")

            for item in result['data']:
                self.results_text.insert(tk.END,
                                         f"Category: {item.get('Category', 'N/A')}\n"
                                         f"Stage: {item.get('Stage', 'N/A')}\n"
                                         f"Field: {item.get('Field', 'N/A')}\n"
                                         f"Value: {item.get('Value', 'N/A')}\n"
                                         f"{'-' * 50}\n"
                                         )
        else:
            self.status_label.config(text="Processing failed", foreground="red")
            self.results_text.delete(1.0, tk.END)
            self.results_text.insert(tk.END, f"Processing failed:\n{result['error']}\n\n")
            if result['raw_response']:
                self.results_text.insert(tk.END, f"Raw response:\n{result['raw_response']}")

    def export_results(self):
        if not self.last_result or not self.last_result['success']:
            messagebox.showerror("Error", "No successful results to export")
            return

        # Ask user where to save
        save_path = filedialog.asksaveasfilename(
            title="Save Excel file",
            defaultextension=".xlsx",
            filetypes=[("Excel files", "*.xlsx"), ("All files", "*.*")]
        )

        if save_path:
            try:
                write_to_excel(
                    self.last_result['data'],
                    self.last_result['notes'],
                    save_path
                )
                messagebox.showinfo("Success", f"Results exported to {save_path}")
            except Exception as e:
                messagebox.showerror("Error", f"Failed to export: {e}")


# =============================================================================
# Main Execution
# =============================================================================

def main():
    """Run the interactive GUI application"""
    root = tk.Tk()
    app = FinSightGUI(root)
    root.mainloop()


if __name__ == '__main__':
    main()
```

